<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="pv-proxy-endpoint" content="https://myochosite-291718.appspot.com/query?id=ahNwfm15b2Nob3NpdGUtMjkxNzE4chULEghBcGlRdWVyeRiAgIDo14eBCgw"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="GCP - VPC Virtual Private Cloud" /><meta property="og:locale" content="en" /><meta name="description" content="GCP - Virtual Private Cloud Virtual Private Cloud Specifications Default network subnet Subnet creation mode custom mode VPC network auto mode VPC network consideration Subnet ranges Valid ranges Restricted ranges Route Dynamic routing mode routing tables / Forwarding rules Firewall Global distributed firewall DNS Google Cloud CDN Interfaces and IP addresses IP addresses Alias IP ranges Network interfaces VPC connection Shared VPC VPC Network Peering Hybrid cloud connection Virtual Private Network Direct Peering Dedicated Interconnect Private Google Access Cloud CDN Cloud Load Balancing different load balancer Communications and access Communication within the network Internet access requirements Communications and access for App Engine Traceroute to external IP addresses Egress throughput limits Packet size Maximum transmission unit - MTU VMs and MTU settings Migrating services to a different MTU network Consequences of mismatched MTUs Network performance Latency Packet loss" /><meta property="og:description" content="GCP - Virtual Private Cloud Virtual Private Cloud Specifications Default network subnet Subnet creation mode custom mode VPC network auto mode VPC network consideration Subnet ranges Valid ranges Restricted ranges Route Dynamic routing mode routing tables / Forwarding rules Firewall Global distributed firewall DNS Google Cloud CDN Interfaces and IP addresses IP addresses Alias IP ranges Network interfaces VPC connection Shared VPC VPC Network Peering Hybrid cloud connection Virtual Private Network Direct Peering Dedicated Interconnect Private Google Access Cloud CDN Cloud Load Balancing different load balancer Communications and access Communication within the network Internet access requirements Communications and access for App Engine Traceroute to external IP addresses Egress throughput limits Packet size Maximum transmission unit - MTU VMs and MTU settings Migrating services to a different MTU network Consequences of mismatched MTUs Network performance Latency Packet loss" /><link rel="canonical" href="https://ocholuo.github.io//posts/GCP-VPC/" /><meta property="og:url" content="https://ocholuo.github.io//posts/GCP-VPC/" /><meta property="og:site_name" content="Grace" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-01T10:11:11-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="GCP - VPC Virtual Private Cloud" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-10-30T21:02:21-04:00","datePublished":"2021-01-01T10:11:11-05:00","description":"GCP - Virtual Private Cloud Virtual Private Cloud Specifications Default network subnet Subnet creation mode custom mode VPC network auto mode VPC network consideration Subnet ranges Valid ranges Restricted ranges Route Dynamic routing mode routing tables / Forwarding rules Firewall Global distributed firewall DNS Google Cloud CDN Interfaces and IP addresses IP addresses Alias IP ranges Network interfaces VPC connection Shared VPC VPC Network Peering Hybrid cloud connection Virtual Private Network Direct Peering Dedicated Interconnect Private Google Access Cloud CDN Cloud Load Balancing different load balancer Communications and access Communication within the network Internet access requirements Communications and access for App Engine Traceroute to external IP addresses Egress throughput limits Packet size Maximum transmission unit - MTU VMs and MTU settings Migrating services to a different MTU network Consequences of mismatched MTUs Network performance Latency Packet loss","headline":"GCP - VPC Virtual Private Cloud","mainEntityOfPage":{"@type":"WebPage","@id":"https://ocholuo.github.io//posts/GCP-VPC/"},"url":"https://ocholuo.github.io//posts/GCP-VPC/"}</script><title>GCP - VPC Virtual Private Cloud | Grace</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Grace"><meta name="application-name" content="Grace"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://myochosite-291718.appspot.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://myochosite-291718.appspot.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/huoye.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Grace</a></div><div class="site-subtitle font-italic">2023 Mar 14 updated</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/ocholuo" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>GCP - VPC Virtual Private Cloud</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>GCP - VPC Virtual Private Cloud</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Grace JyL </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Jan 1, 2021, 10:11 AM -0500" >Jan 1, 2021<i class="unloaded">2021-01-01T10:11:11-05:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Oct 30, 2022, 6:02 PM -0700" >Oct 30, 2022<i class="unloaded">2022-10-30T21:02:21-04:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5810 words">32 min read</span> <span id="pv" class="pageviews"> <i class="fas fa-spinner fa-spin fa-fw"></i> </span> views</div></div><div class="post-content"><ul><li><a href="#gcp---virtual-private-cloud">GCP - Virtual Private Cloud</a><ul><li><a href="#virtual-private-cloud">Virtual Private Cloud</a><ul><li><a href="#specifications">Specifications</a><li><a href="#default-network">Default network</a></ul><li><a href="#subnet">subnet</a><ul><li><a href="#subnet-creation-mode">Subnet creation mode</a><ul><li><a href="#custom-mode-vpc-network">custom mode VPC network</a><li><a href="#auto-mode-vpc-network">auto mode VPC network</a><li><a href="#consideration">consideration</a></ul><li><a href="#subnet-ranges">Subnet ranges</a><ul><li><a href="#valid-ranges">Valid ranges</a><li><a href="#restricted-ranges">Restricted ranges</a></ul></ul><li><a href="#route">Route</a><ul><li><a href="#dynamic-routing-mode">Dynamic routing mode</a><li><a href="#routing-tables--forwarding-rules">routing tables / Forwarding rules</a></ul><li><a href="#firewall">Firewall</a><ul><li><a href="#global-distributed-firewall">Global distributed firewall</a><li><a href="#dns">DNS</a><li><a href="#google-cloud-cdn">Google Cloud CDN</a></ul><li><a href="#interfaces-and-ip-addresses">Interfaces and IP addresses</a><ul><li><a href="#ip-addresses">IP addresses</a><li><a href="#alias-ip-ranges">Alias IP ranges</a><li><a href="#network-interfaces">Network interfaces</a></ul><li><a href="#vpc-connection">VPC connection</a><ul><li><a href="#shared-vpc">Shared VPC</a><li><a href="#vpc-network-peering">VPC Network Peering</a></ul><li><a href="#hybrid-cloud-connection">Hybrid cloud connection</a><ul><li><a href="#virtual-private-network">Virtual Private Network</a><li><a href="#direct-peering">Direct Peering</a><li><a href="#dedicated-interconnect">Dedicated Interconnect</a><li><a href="#private-google-access">Private Google Access</a></ul><li><a href="#cloud-cdn">Cloud CDN</a><li><a href="#cloud-load-balancing">Cloud Load Balancing</a><ul><li><a href="#different-load-balancer">different load balancer</a></ul><li><a href="#communications-and-access">Communications and access</a><ul><li><a href="#communication-within-the-network">Communication within the network</a><li><a href="#internet-access-requirements">Internet access requirements</a><li><a href="#communications-and-access-for-app-engine">Communications and access for App Engine</a><li><a href="#traceroute-to-external-ip-addresses">Traceroute to external IP addresses</a><li><a href="#egress-throughput-limits">Egress throughput limits</a><li><a href="#packet-size">Packet size</a></ul><li><a href="#maximum-transmission-unit---mtu">Maximum transmission unit - MTU</a><ul><li><a href="#vms-and-mtu-settings">VMs and MTU settings</a><li><a href="#migrating-services-to-a-different-mtu-network">Migrating services to a different MTU network</a><li><a href="#consequences-of-mismatched-mtus">Consequences of mismatched MTUs</a></ul><li><a href="#network-performance">Network performance</a><ul><li><a href="#latency">Latency</a><li><a href="#packet-loss">Packet loss</a></ul></ul><li>ref<ul><li><a href="https://www.coursera.org/learn/gcp-infrastructure-foundation/lecture/WZq76/lab-intro-vpc-networking">GCP Google Cloud Platform Fundamentals - Core Infrastructure</a></ul></ul><hr /><h1 id="gcp---virtual-private-cloud">GCP - Virtual Private Cloud</h1><hr /><h2 id="virtual-private-cloud">Virtual Private Cloud</h2><ul><li><p>Virtual Private Cloud (VPC) provides networking functionality to <strong>Compute Engine virtual machine (VM) instances</strong>, <strong>Google Kubernetes Engine (GKE) clusters</strong>, and the <strong>App Engine flexible environment</strong>. VPC provides networking for the cloud-based resources and services that is global, scalable, and flexible.</p><li><p>Offers built-in Internal TCP/UDP Load Balancing and proxy systems for Internal HTTP(S) Load Balancing.</p><li><p>Connects to on-premises networks using <strong>Cloud VPN tunnels</strong> and <strong>Cloud Interconnect attachments</strong>.</p><li><p>Distributes traffic from Google Cloud external load balancers to backends.</p><li>define the own VPC inside the GCP project, or choose the default VPC.<ul><li>Projects can contain multiple VPC networks.<li>Unless you with an organizational policy that prohibits it, new projects start with a default network (an auto mode VPC network) that has one subnetwork (subnet) in each region.</ul><li><p>A VPC network is a global resource that <code class="language-plaintext highlighter-rouge">consists of a list of regional virtual subnetworks (subnets) in data centers</code>, all connected by a global wide area network.</p><li><p>VPC networks are logically isolated from each other in Google Cloud.</p><li>VPC networks connect the Google Cloud platform resources to each other and to the internet.<ul><li>segment the networks,<li>use firewall rules to restrict access to instances,<li>and create static routes to forward traffic to specific destinations.</ul></ul><p><img data-proofer-ignore data-src="https://i.imgur.com/xVdAWp7.png" alt="Screen Shot 2021-02-03 at 15.48.15" /></p><p><img data-proofer-ignore data-src="https://i.imgur.com/xKaYAJ7.png" alt="Screen Shot 2021-06-25 at 2.45.42 PM" /></p><hr /><h3 id="specifications">Specifications</h3><ul><li> <font color="red"> Networks are global; subnets are regional </font><ul><li>VPC networks, associated routes and firewall rules have <strong>global scope</strong>.<ul><li>define the own network layout with global scope.<li>VPC can have subnets in any GCP region worldwide<li>They are not associated with any particular region or zone.</ul><li>VPC subnets have <strong>regional scope</strong>.<ul><li>Each subnet defines a range of IP addresses.<li>subnet can span the zones that make up a region.<ul><li>can have resources in different zones on the same subnet.</ul><li>solutions can incorporate fault tolerance without complicating the network topology.<li>example<ul><li>the VPC has one network.<li>it has one <strong>subnet</strong> defined in GCP us-east1 region.<li>it has two <strong>Compute Engine VMs</strong> attached to it.<li>They’re neighbors on the same subnet even though they are in different zones.<li>solutions that are resilient but still have simple network layouts.</ul></ul></ul><li>Traffic to and from instances can be controlled with <strong>network firewall rules</strong>.<ul><li>Rules are implemented on the VMs themselves, so traffic can only be controlled and logged as it leaves or arrives at a VM.</ul><li>can dynamically increase the size of a subnet in a custom network by expanding the range of IP addresses.<ul><li>Doing that doesn’t affect already configured VMs.</ul><li><p>Resources within a VPC network can communicate with one another by using internal IPv4 addresses, subject to applicable network firewall rules.</p><li>VPC networks only support IPv4 unicast traffic.<ul><li>do not support broadcast, multicast, or IPv6 traffic within the network;<li>VMs in the VPC network can only send to IPv4 destinations and only receive traffic from IPv4 sources.<li>However, it is possible to create an IPv6 address for a global load balancer.</ul><li><p>Instances with internal IP addresses can communicate with Google APIs and services.</p><li><p>Network administration can be secured by using <strong>Identity and Access Management (IAM) roles</strong>.</p><li>An organization can use Shared VPC to keep a VPC network in a common host project.<ul><li>Authorized IAM members from other projects in the same organization can create resources that use subnets of the Shared VPC network.</ul><li><p>VPC networks can be connected to other VPC networks in different projects or organizations by using <strong>VPC Network Peering</strong>.</p><li><p>VPC networks can be securely connected in hybrid environments by using <strong>Cloud VPN or Cloud Interconnect</strong>.</p><li>VPC networks support GRE traffic, including traffic on Cloud VPN and Cloud Interconnect.<ul><li>VPC networks do not support GRE for Cloud NAT or for forwarding rules for load balancing and protocol forwarding.<li>Support for GRE allows you to terminate GRE traffic on a VM from the internet (external IP address) and Cloud VPN or Cloud Interconnect (internal IP address).<li>The decapsulated traffic can then be forwarded to a reachable destination.<li>GRE enables you to use services such as Secure Access Service Edge (SASE) and SD-WAN.<li>Note: GRE support for VPN and Interconnect has been tested only with GRE version 0. Additionally, support for GRE traffic does not include support from Google Cloud for troubleshooting the overlay network.</ul></ul><h3 id="default-network">Default network</h3><p>Unless disable it, each new project starts with a default network.</p><ul><li>The default network is an <strong>auto mode VPC network</strong> with pre-populated firewall rules.</ul><p>disable the creation of default networks by creating an organization policy with the <code class="language-plaintext highlighter-rouge">compute.skipDefaultNetworkCreation</code> constraint.</p><ul><li>Projects that inherit this policy won’t have a default network.</ul><hr /><h2 id="subnet">subnet</h2><ul><li>Each VPC network consists of one or more useful IP range partitions called subnets.<li>Each subnet is associated with a region.<ul><li>VPC networks do not have any IP address ranges associated with them.<li>can create more than one subnet per region.</ul><li>IP ranges are defined for the subnets.</ul><p>A network must have at least one subnet before you can use it.</p><ul><li><strong>Auto mode VPC networks</strong><ul><li>create subnets in each region automatically.</ul><li><strong>Custom mode VPC networks</strong><ul><li>start with no subnets, giving full control over subnet creation.</ul></ul><p>creating an instance</p><ul><li>involves selecting a zone, a network, and a subnet. The subnets available for selection are restricted to those in the selected region. Google Cloud assigns the instance an IP address from the range of available addresses in the subnet.</ul><p>creating a managed instance group</p><ul><li>involves selecting a zone or region, depending on the group type, and an instance template. The instance templates available for selection are restricted to those whose defined subnets are in the same region selected for the managed instance group.</ul><p>creating an instance template</p><ul><li><strong>Instance templates</strong> are global resources<li>involves selecting a network and a subnet.<li>If you select an auto mode VPC network, you can choose to use auto subnets to defer subnet selection to one that is available in the selected region of any managed instance group that would use the template. Auto mode VPC networks have a subnet in every region by definition.</ul><p>creating a Kubernetes container cluster</p><ul><li>involves selecting a zone or region (depending on the cluster type), a network, and a subnet. The subnets available for selection are restricted to those in the selected region.</ul><h3 id="subnet-creation-mode">Subnet creation mode</h3><p>switch a VPC network from auto mode to custom mode is a one-way conversion;</p><ul><li>custom mode VPC networks cannot be changed to auto mode VPC networks.</ul><h4 id="custom-mode-vpc-network">custom mode VPC network</h4><ul><li>no subnets are automatically created.<li>provides complete control over its subnets and IP ranges.<li>decide which subnets to create in regions by using IP ranges that specify.</ul><h4 id="auto-mode-vpc-network">auto mode VPC network</h4><ul><li>one subnet from each region is automatically created within it.<li>These automatically created subnets use a set of predefined IP ranges that fit within the <code class="language-plaintext highlighter-rouge">10.128.0.0/9</code> CIDR block.<li>As new Google Cloud regions become available, new subnets in those regions are automatically added to auto mode VPC networks by using an IP range from that block.<li>In addition to the automatically created subnets, you can add more subnets manually to auto mode VPC networks in regions that you choose by using IP ranges outside of <code class="language-plaintext highlighter-rouge">10.128.0.0/9</code></ul><h4 id="consideration">consideration</h4><p><strong>Auto mode VPC networks</strong></p><ul><li>easy to set up and use<li>well suited for use cases with these attributes:<ul><li>subnets automatically created in each region is useful.<li>predefined IP ranges of the subnets do not overlap with IP ranges that you would use for different purposes (for example, Cloud VPN connections to on-premises resources).</ul></ul><p><strong>custom mode VPC networks</strong></p><ul><li>more flexible and are better suited to production.<li>The following attributes highlight use cases where custom mode VPC networks are recommended or required:<ul><li>one subnet automatically created in each region isn’t necessary.<li>new subnets automatically created as new regions become available could overlap with IP addresses used by manually created subnets or static routes, or could interfere with the overall network planning.<li>You need complete control over the subnets created in the VPC network, including regions and IP address ranges used.<li>You plan to connect VPC networks by using VPC Network Peering or Cloud VPN. Because the subnets of every auto mode VPC network use the same predefined range of IP addresses, you cannot connect auto mode VPC networks to one another.<li>Important: Production networks should be planned in advance. We recommend that you use custom mode VPC networks in production.</ul></ul><h3 id="subnet-ranges">Subnet ranges</h3><p>When create a subnet, must define its primary IP address range.</p><ul><li><p>The primary internal addresses for the following resources come from the subnet’s primary range: VM instances, internal load balancers, and internal protocol forwarding.</p><li><p>optionally add secondary IP address ranges to a subnet, which are only used by alias IP ranges. However, you can configure alias IP ranges for instances from the primary or secondary range of a subnet.</p><li><p>Each primary or secondary IP range for all subnets in a VPC network must be a unique valid CIDR block. Refer to the per network limits for the number of secondary IP ranges you can define.</p><li><p>subnets don’t need to form a predefined contiguous CIDR block, but you can do that if desired. For example, auto mode VPC networks do create subnets that fit within a predefined auto mode IP range.</p></ul><h4 id="valid-ranges">Valid ranges</h4><blockquote><p>A subnet’s primary and secondary IP address ranges are <strong>regional internal IP addresses</strong>.</p></blockquote><p>Valid ranges:</p><ul><li><code class="language-plaintext highlighter-rouge">10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16</code><ul><li>Private IP addresses RFC 1918</ul><li><code class="language-plaintext highlighter-rouge">100.64.0.0/10</code><ul><li>Shared address space RFC 6598</ul><li><code class="language-plaintext highlighter-rouge">192.0.0.0/24</code><ul><li>IETF protocol assignments RFC 6890</ul><li><code class="language-plaintext highlighter-rouge">192.0.2.0/24 (TEST-NET-1), 198.51.100.0/24 (TEST-NET-2), 203.0.113.0/24 (TEST-NET-3)</code><ul><li>Documentation RFC 5737</ul><li><code class="language-plaintext highlighter-rouge">192.88.99.0/24</code><ul><li>Pv6 to IPv4 relay (deprecated) RFC 7526</ul><li><code class="language-plaintext highlighter-rouge">198.18.0.0/15</code><ul><li>Benchmark testing RFC 2544</ul><li><code class="language-plaintext highlighter-rouge">240.0.0.0/4</code><ul><li>Reserved for future use (Class E) as noted in RFC 5735 and RFC 1112.<li>Some operating systems do not support the use of this range, so verify that the OS supports it before creating subnets that use this range.</ul><li><code class="language-plaintext highlighter-rouge">Privately used public IP addresses</code><ul><li>Includes IP addresses that are not part of the RFC ranges listed in this table and not part of the restricted set.<li>use these addresses as subnet ranges, Google Cloud does not announce these routes to the internet and does not route traffic from the internet to them.<li>For VPC Network Peering, subnet routes for <code class="language-plaintext highlighter-rouge">public IP addresses</code> are not automatically exchanged.<li>The subnet routes are automatically exported by default, but peer networks must be explicitly configured to import them in order to use them.</ul><div class="language-bash highlighter-rouge"><div class="code-header" text-data="bash"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>gcloud compute <span class="nt">--project</span><span class="o">=</span>qwiklabs-gcp-00-cdc530d7d99c <span class="se">\</span>
  firewall-rules create managementnet-allow-icmp-ssh-rdp <span class="se">\</span>
                        <span class="nt">--direction</span><span class="o">=</span>INGRESS <span class="se">\</span>
                        <span class="nt">--priority</span><span class="o">=</span>1000 <span class="se">\</span>
                        <span class="nt">--network</span><span class="o">=</span>managementnet <span class="se">\</span>
                        <span class="nt">--action</span><span class="o">=</span>ALLOW <span class="se">\</span>
                        <span class="nt">--rules</span><span class="o">=</span>tcp:22,tcp:3389,icmp <span class="se">\</span>
                        <span class="nt">--source-ranges</span><span class="o">=</span>0.0.0.0/0
</pre></table></code></div></div></ul><h4 id="restricted-ranges">Restricted ranges</h4><blockquote><p>Restricted ranges include <strong>Google public IP addresses and commonly reserved RFC ranges</strong>, These ranges cannot be used for subnet ranges.</p></blockquote><p>Range Description</p><ul><li><code class="language-plaintext highlighter-rouge">Public IP addresses for Google APIs and services, including Google Cloud netblocks</code><ul><li>https://gstatic.com/ipranges/goog.txt.</ul><li><code class="language-plaintext highlighter-rouge">199.36.153.4/30 and 199.36.153.8/30</code><ul><li>Private Google Access-specific virtual IP addresses</ul><li><code class="language-plaintext highlighter-rouge">0.0.0.0/8</code><ul><li>Current (local) network RFC 1122</ul><li><code class="language-plaintext highlighter-rouge">127.0.0.0/8</code><ul><li>Local host RFC 1122</ul><li><code class="language-plaintext highlighter-rouge">169.254.0.0/16</code><ul><li>Link-local RFC 3927</ul><li><code class="language-plaintext highlighter-rouge">224.0.0.0/4</code><ul><li>Multicast (Class D) RFC 5771</ul><li><code class="language-plaintext highlighter-rouge">255.255.255.255/32</code><ul><li>Limited broadcast destination address RFC 8190 and RFC 919</ul><li><code class="language-plaintext highlighter-rouge">Reserved IP addresses in a subnet</code><ul><li>Every subnet has <strong>four reserved IP addresses</strong> in its <font color="red"> primary IP range </font>.<li>There are no reserved IP addresses in the <font color="red"> secondary IP ranges </font>.<ul><li>Network<ul><li>First address in the primary IP range for the subnet<li><code class="language-plaintext highlighter-rouge">10.1.2.0 in 10.1.2.0/24</code></ul><li>Default gateway<ul><li>Second address in the primary IP range for the subnet<li><code class="language-plaintext highlighter-rouge">10.1.2.1 in 10.1.2.0/24</code></ul><li>Second-to-last address<ul><li>Second-to-last address in the primary IP range for the subnet that is reserved by Google Cloud for potential future use<li><code class="language-plaintext highlighter-rouge">10.1.2.254 in 10.1.2.0/24</code></ul><li>Broadcast<ul><li>Last address in the primary IP range for the subnet<li><code class="language-plaintext highlighter-rouge">10.1.2.255 in 10.1.2.0/24</code></ul></ul></ul></ul><hr /><h2 id="route">Route</h2><p>Routes define paths for packets leaving instances (egress traffic).</p><ul><li>Routes tell VM instances and the VPC network how to send traffic from an instance to a destination, either inside the network or outside of Google Cloud.</ul><p>Routes in Google Cloud are divided into two categories: <font color="red"> system-generated and custom </font>.</p><ul><li>Each VPC network comes with <strong>some system-generated routes</strong><ul><li>to route traffic among its subnets and send traffic from <strong>eligible instances</strong> to the internet.<li>Every new network starts with two types of <strong>system-generated routes</strong>:<ul><li> <font color="blue"> The default route </font><ul><li><strong>defines a path for traffic to leave the VPC network</strong><li>It provides general internet access to VMs that meet the internet access requirements.<li>It also provides the typical path for Private Google Access.</ul><li> <font color="blue"> subnet route </font><ul><li><strong>define paths for traffic to reach VMs that use the subnets</strong><li>a subnet route is created for each of the IP ranges associated with a subnet.<li>Every subnet has at least one subnet route for its primary IP range.<li>Additional subnet routes are created for a subnet if you add secondary IP ranges to it.<li>You cannot remove subnet routes manually.</ul></ul></ul><li>create <strong>custom static routes</strong> to direct some packets to specific destinations.<ul><li>static routes that create manually<li>dynamic routes maintained automatically by one or more of the Cloud Routers.</ul></ul><h3 id="dynamic-routing-mode">Dynamic routing mode</h3><ul><li>Each VPC network has an associated <strong>dynamic routing mode</strong> that controls the behavior of all of its <strong>Cloud Routers</strong><ul><li>Cloud Routers<li><strong>share routes to your VPC network</strong><li><strong>learn custom dynamic routes from connected networks</strong> when you connect your VPC network to another network by using a <code class="language-plaintext highlighter-rouge">Cloud VPN tunnel that uses dynamic routing</code>, or by using <code class="language-plaintext highlighter-rouge">Dedicated / Partner Interconnect</code>.</ul><li><strong>Regional dynamic routing</strong> is the default.<ul><li><code class="language-plaintext highlighter-rouge">routes to on-premises resources learned by a given Cloud Router in the VPC network</code> only apply to the subnets in the same region as the Cloud Router.<li>Unless modified by custom advertisements, each Cloud Router only shares the routes to subnets in its region with its on-premises counterpart.</ul><li><strong>Global dynamic routing</strong><ul><li>changes the behavior of all Cloud Routers in the network such that the <code class="language-plaintext highlighter-rouge">routes to on-premises resources that they learn</code> are available in all subnets in the VPC network, regardless of region.<li>Unless modified by custom advertisements, each Cloud Router shares routes to all subnets in the VPC network with its on-premises counterpart.</ul></ul><p>The dynamic routing mode can be set when create or modify a VPC network.</p><ul><li>can change the dynamic routing mode from regional to global and vice-versa without restriction.<li>Changing the dynamic routing mode has the potential to interrupt traffic within the network or enable or disable routes in unexpected ways. Carefully review the role of each Cloud Router before changing the dynamic routing mode.</ul><h3 id="routing-tables--forwarding-rules">routing tables / Forwarding rules</h3><p>While routes govern traffic leaving an instance, <strong>forwarding rules</strong> direct traffic <em>to</em> a Google Cloud resource in a VPC network based on <strong>IP address, protocol, and port</strong>.</p><ul><li>Much like physical networks, VPCs have routing tables.<ul><li>forward traffic between instance within the same network.<li>forward traffic across sub-networks<li>forward traffic between GCP zones without requiring an external IP address.</ul><li><p>Destinations for forwarding rules are <code class="language-plaintext highlighter-rouge">target instances</code>, <code class="language-plaintext highlighter-rouge">load balancer targets</code> (target proxies, target pools, and backend services), and <code class="language-plaintext highlighter-rouge">Cloud VPN gateways</code>.</p><li>VPCs routing tables are built in,<ul><li>don’t have to provision or manage a router.<li>don’t have to provision or manage for GCP, a firewall instance.</ul></ul><hr /><h2 id="firewall">Firewall</h2><h3 id="global-distributed-firewall">Global distributed firewall</h3><ul><li><p>Each VPC network implements a distributed virtual firewall</p><li>Firewall rules apply to both outgoing (egress) and incoming (ingress) traffic in the network.<ul><li>Firewall rules control traffic even if it is entirely within the network, including communication among VM instances.</ul><li>Firewall rules control which packets are allowed to travel to which destinations.<ul><li>Every VPC network has two <strong>implied</strong> firewall rules<ul><li>One rule <strong>allows most egress traffic</strong>,<li>and the other <strong>denies all ingress traffic</strong>.</ul><li>cannot delete the implied rules, but can override them<li>The <code class="language-plaintext highlighter-rouge">default</code> network has <strong>additional firewall rules</strong><ul><li>including the <code class="language-plaintext highlighter-rouge">default-allow-internal</code> rule: permit communication among instances in the network.</ul><li>Google Cloud always blocks some traffic, regardless of firewall rules; for more information, see blocked traffic.</ul><li>define firewall rules in terms of metadata tags on Compute Engine instances<ul><li>example<li>tag all the web servers with say, “web,”<li>and write a firewall rule saying that traffic on ports 80 or 443 is allowed into all VMs with the “web” tag, no matter what their IP address happens to be.</ul></ul><hr /><h3 id="dns">DNS</h3><ul><li>8.8.8.8<ul><li>Google services<li>provides a public domain name service to the world.<ul><li>DNS is what translates internet host names to addresses.</ul><li>Google has a highly developed DNS infrastructure.<ul><li>It makes 8.8.8.8 available so that everybody can take advantage of it.</ul></ul><li>Cloud DNS<ul><li>for the internet host names and addresses of applications build in GCP<li>to help the world find them<li>a managed DNS service running on the same infrastructure as Google.<li>It has low latency and high availability<li>a cost-effective way to make the applications and services available to the users.<li>The DNS information you publish is served from redundant locations around the world.<li>Cloud DNS is also programmable.<ul><li>publish and manage millions of DNS zones and records<li>using the GCP console, the command line interface or the API.</ul></ul></ul><hr /><h3 id="google-cloud-cdn">Google Cloud CDN</h3><ul><li>Google has a global system of edge caches.<li>You can use this system to accelerate content delivery in the application<li>the customers<ul><li>experience lower network latency.</ul><li>The origins of the content<ul><li>experience reduced load<li>and save money too.</ul><li>Once you’ve set up HTTPS load balancing, simply enable Cloud CDN with a single checkbox.<li>CDN is a part of GCPs,<ul><li>CDN interconnect partner program and you can continue to use it.</ul></ul><hr /><h2 id="interfaces-and-ip-addresses">Interfaces and IP addresses</h2><h3 id="ip-addresses">IP addresses</h3><p>Google Cloud resources, such as Compute Engine VM instances, forwarding rules, GKE containers, and App Engine, rely on IP addresses to communicate.</p><h3 id="alias-ip-ranges">Alias IP ranges</h3><p>For multiple services running on a single VM instance</p><ul><li>can give each service a <code class="language-plaintext highlighter-rouge">different internal IP address</code> by using <strong>alias IP ranges</strong>.<li>The VPC network forwards packets that are destined to a particular service to the corresponding VM.</ul><h3 id="network-interfaces">Network interfaces</h3><p>Add multiple <strong>network interfaces</strong> to a VM instance</p><ul><li>each interface resides in a unique VPC network.<li>Multiple network interfaces enable a network appliance VM to act as a gateway for securing traffic among different VPC networks or to and from the internet.</ul><hr /><h2 id="vpc-connection">VPC connection</h2><blockquote><p>VPCs belong to GCP projects if the company has several GCP projects and the VPCs need to talk to each other</p></blockquote><p>VPC sharing and peering</p><h3 id="shared-vpc">Shared VPC</h3><ul><li>to share a VPC network, or individual subnets, with other GCP projects<ul><li>share a VPC network from one project (called a host project) to other projects in the Google Cloud organization.</ul><li>to use the full power of IAM<ul><li>control who and what in one project can interact with a VPC in another<li>grant access to entire Shared VPC networks or select subnets by <strong>specific IAM permissions</strong>.<li>provide centralized control over a common network while maintaining organizational flexibility.<li>Shared VPC is especially useful in large organizations.</ul></ul><h3 id="vpc-network-peering">VPC Network Peering</h3><ul><li>peering relationship between two VPCs to exchange traffic<li><p>to interconnect networks in GCP projects</p><li><p>VPC Network Peering lets you build <strong>software as a service (SaaS)</strong> ecosystems in Google Cloud, making services available <strong>privately across</strong> different VPC networks, whether the networks are in the same project, different projects, or projects in different organizations.</p><li>With VPC Network Peering, all communication happens by using internal IP addresses.<ul><li>Subject to firewall rules, VM instances in each peered network can communicate with one another without using external IP addresses.</ul><li>Peered networks <code class="language-plaintext highlighter-rouge">automatically exchange subnet routes for private IP address ranges</code>.<ul><li>VPC Network Peering lets you configure whether the following types of routes are exchanged:<li>Subnet routes for privately re-used public IP ranges<li>Custom static and dynamic routes</ul><li>Network administration for each peered network is unchanged:<ul><li>IAM policies are never exchanged by VPC Network Peering.<li>For example, Network and Security Admins for one VPC network do not automatically get those roles for the peered network.</ul></ul><hr /><h2 id="hybrid-cloud-connection">Hybrid cloud connection</h2><p><img data-proofer-ignore data-src="https://i.imgur.com/pcVgd0Y.png" alt="Screen Shot 2021-02-03 at 20.38.04" /></p><ul><li>interconnect their networks to Google VPCs<ul><li>such as on-premises networks or their networks in other clouds.</ul></ul><h3 id="virtual-private-network">Virtual Private Network</h3><ul><li><p>connect the VPC network to the physical, on-premises network or another cloud provider by using a secure <strong>virtual private network</strong>.</p><li>Virtual Private Network connection over the internet using the IPSEC protocol.<li>Cloud Router<ul><li>simple way to let a VPN into Google VPC continue to work in spite of routing changes,<li>Cloud Router lets their networks and the Google VPC exchange route information over the VPN using the Border Gateway Protocol.<li>example<ul><li>add a new subnet to the Google VPC,<li>the on-premises network will automatically get routes to it.</ul></ul></ul><h3 id="direct-peering">Direct Peering</h3><ul><li>don’t want to use the internet<ul><li>either because of security concerns or need more reliable bandwidth.</ul><li>peering with Google using Direct Peering.<li>putting a router in the same public data center as a <font color="red"> Google point of presence </font> and exchanging traffic.<li>Google has more than 100 <font color="red"> points of presence </font> around the world.<li>Customers who aren’t already in a point of presence can contract with a partner in the carrier peering program to get connected.<li>One downside:<ul><li>it isn’t covered by a Google service level agreement.<li>Customers who want the highest uptimes for their interconnection with Google should use Dedicated Interconnect</ul><li>If these connections have topologies that meet Google’s specifications, they can be covered by up to a 99.99 percent SLA.<li>These connections can be backed up by a VPN for even greater reliability.</ul><h3 id="dedicated-interconnect">Dedicated Interconnect</h3><ul><li>customers get one or more direct private connections to Google.<li>highest uptimes for their interconnection with Google<li>connect the VPC network to the on-premises network by using a high speed physical connection.</ul><h3 id="private-google-access">Private Google Access</h3><p>enable <strong>Private Google Access</strong> for a subnet</p><ul><li>instances in a subnet of a VPC network can communicate with <strong>Google APIs and services</strong> by using private IP addresses instead of external IP addresses.</ul><hr /><h2 id="cloud-cdn">Cloud CDN</h2><p><img data-proofer-ignore data-src="https://i.imgur.com/9E6ozaA.jpg" alt="Screen Shot 2022-08-16 at 23.33.31" /></p><hr /><h2 id="cloud-load-balancing">Cloud Load Balancing</h2><p><img data-proofer-ignore data-src="https://i.imgur.com/nNsf2wp.jpg" alt="Screen Shot 2022-08-16 at 23.34.01" /></p><p><img data-proofer-ignore data-src="https://i.imgur.com/BCOC9ta.png" alt="Screen Shot 2022-08-16 at 23.34.15" /></p><ul><li>a fully distributed, software-defined managed service for all the traffic.<ul><li>because the load balancers don’t run in VMs, no worry about scaling or managing them.</ul><li>put Cloud Load Balancing in front of all the traffic<ul><li>HTTP and HTTPS, TCP and SSL traffic, and UDP traffic too.<li>basic<li>you application presents a single front-end to the world<li>users get a single, global anycast IP address<li>Traffic goes over the google backbone from the closet point-of-presence to the user<ul><li>backend instances in regions around the world.</ul></ul><li>provides <font color="red"> cross-region load balancing </font><ul><li>including automatic multi-region failover,</ul><li>backbone are selected based on load<ul><li>Cloud Load Balancing reacts quickly to changes in users, traffic, backend health, network conditions, and other related conditions.<li>gently moves traffic in fractions if backends become unhealthy.<li>only healthy backends receive reaffic<li>no pre-warming is required</ul></ul><h3 id="different-load-balancer">different load balancer</h3><ul><li> <font color="red"> Global external load balancing </font><ul><li> <font color="blue"> global HTTPS load balancer </font><ul><li>layer 7 load balancing based on load<li>cross regional load balancing for a web application<li>route different URLs to different back ends</ul><li> <font color="blue"> global SSL proxy load balancer </font><ul><li>layer 4 load balancing of non-HTTPS SSL traffic based on load<li>For Secure Sockets Layer traffic that is not HTTP<li>Supported on specific port numbers<li>only work for TCP and specific port numbers</ul><li> <font color="blue"> global TCP proxy load balancer </font><ul><li>layer 4 load balancing of non-SSL TCP traffic<li>If it’s other TCP traffic that does not use Secure Sockets Layer<li>Supported on specific port numbers<li>only work for TCP and specific port numbers</ul></ul><li> <font color="red"> Regional external Network Load Balancing </font><ul><li> <font color="blue"> regional load balancer </font><ul><li>load balancing of any traffic (TCP/UDP) on any port number<li>load balance across a GCP region with the regional load balancer</ul></ul><li> <font color="red"> Regional Internal TCP/UDP Load Balancing </font><ul><li> <font color="blue"> internal load balancer </font><ul><li>load balance traffic inside a VPC / the project<li>for traffic<ul><li>coming into the Google network from the internet.<ul><li>example:<li>between the presentation layer and the business logic layer of the application</ul><li>TCP traffic on arbitrary port numbers<li>UDP traffic</ul><li>accepts traffic on a GCP internal IP address and load balances it across Compute Engine VMs.<li>for the interbal tiers of multi-tier applications<li>to load-balance traffic among the back-end VMs that form part of a multi-tier application.</ul></ul></ul><p><img data-proofer-ignore data-src="https://i.imgur.com/LSAsJ01.png" alt="Screen Shot 2021-02-03 at 20.26.54" /></p><hr /><h2 id="communications-and-access">Communications and access</h2><h3 id="communication-within-the-network">Communication within the network</h3><ul><li>The <strong>system-generated subnet routes</strong> define the paths for sending traffic among instances within the network by using <code class="language-plaintext highlighter-rouge">internal IP addresses</code>.<li>The <strong>Firewall</strong><ul><li>For one instance to be able to communicate with another, appropriate firewall rules must also be configured because every network has an <code class="language-plaintext highlighter-rouge">implied deny firewall rule for ingress traffic</code>.<li>Except for the default network, must explicitly create <strong>higher priority ingress firewall rules</strong> to allow instances to communicate with one another.<li>The default network includes several other firewall rules:<ul><li>the <code class="language-plaintext highlighter-rouge">default-allow-internal rule</code>: permits instance-to-instance communication within the network.<li>The default network also comes with <code class="language-plaintext highlighter-rouge">ingress rules allowing protocols such as RDP and SSH</code>.<li>Rules that come with the default network are also presented as options for you to apply to new <strong>auto mode VPC networks</strong> that you create by using the Cloud Console.</ul></ul></ul><h3 id="internet-access-requirements">Internet access requirements</h3><p>The following criteria must be satisfied for an instance to have outgoing internet access:</p><ul><li><strong>default internet gateway route or custom route</strong><ul><li>The network must have a valid <code class="language-plaintext highlighter-rouge">default internet gateway route or custom route</code> whose destination IP range is the most general (0.0.0.0/0). This route defines the path to the internet.</ul><li><strong>Firewall rules</strong><ul><li>must allow egress traffic from the instance.<li>Unless overridden by a higher priority rule, the implied allow rule for egress traffic permits outbound traffic from all instances.</ul><li>One of the following must be true:<ul><li>The instance must have an <code class="language-plaintext highlighter-rouge">external IP address</code>. be assigned when created or after created.<li>The instance must be able to use <code class="language-plaintext highlighter-rouge">Cloud NAT</code> or an <code class="language-plaintext highlighter-rouge">instance-based proxy</code> that is the target for a static 0.0.0.0/0 route.</ul></ul><h3 id="communications-and-access-for-app-engine">Communications and access for App Engine</h3><p>VPC firewall rules apply to resources running in the VPC network, such as Compute Engine VMs.</p><p>For App Engine instances, firewall rules work as follows:</p><ul><li><strong>App Engine standard environment</strong>:<ul><li>Only <strong>App Engine firewall rules</strong> apply to ingress traffic.<li>Because App Engine standard environment instances do not run inside your VPC network, <strong>VPC firewall rules</strong> do not apply to them.</ul><li><strong>App Engine flexible environment</strong>:<ul><li>Both <strong>App Engine and VPC firewall rules</strong> apply to ingress traffic.<li>Inbound traffic is only permitted if it is allowed by both types of firewall rules.<li>For outbound traffic, VPC firewall rules apply.</ul></ul><h3 id="traceroute-to-external-ip-addresses">Traceroute to external IP addresses</h3><ul><li>For internal reasons, Google Cloud increases the TTL counter of packets that traverse next hops in Google’s network.<li>Tools like <code class="language-plaintext highlighter-rouge">traceroute</code> and <code class="language-plaintext highlighter-rouge">mtr</code> might provide incomplete results because the TTL doesn’t expire on some of the hops.</ul><p>Hops that are inside and outside of Google’s network might be hidden in these circumstances:</p><ul><li>When you send packets <strong>from Compute Engine instances to external IP addresses</strong>, including external IP addresses of other Google Cloud resources or destinations on the internet.<li>When you send packets to the <strong>external IP address associated with a Compute Engine instance or other Google Cloud resource</strong>.</ul><p>The number of hidden hops varies based on the instance’s Network Service Tiers, region, and other factors. If there are only a few hops, it’s possible for all of them to be hidden. Missing hops from a traceroute or mtr result don’t mean that outbound traffic is dropped.</p><p>There is no workaround for this behavior. You must take it into account if you configure third-party monitoring that connects to an external IP address associated with a VM.</p><p>Important:</p><ul><li>Probe loss statistics are a component of traceroute tests, but care must be taken when analyzing test results. traceroute and mtr by default utilize ICMP-based probing.<li>ICMP probe response generation is typically rate-limited (or disabled) in routers that reside in the network path of your probing and can result in missing probe responses.<li>When this behavior occurs, you may see probe loss in intermediate routing hops, but this should not reflect end-to-end performance. If looking for packet loss, the only hop that generally matters is the destination hop.</ul><h3 id="egress-throughput-limits">Egress throughput limits</h3><p>Network throughput information is available on the Network bandwidth page in the Compute Engine documentation.</p><h3 id="packet-size">Packet size</h3><p>Information about packet size is in the maximum transmission unit section.</p><hr /><h2 id="maximum-transmission-unit---mtu">Maximum transmission unit - MTU</h2><ul><li><p>The MTU is the size, in bytes, of the largest packet supported by a network layer protocol, including both headers and data.</p><li><p>VPC networks have a default maximum transmission unit (MTU) of 1460 bytes. However, you can configure your VPC networks to have an MTU of 1500 bytes.</p><li>In Google Cloud, you set the MTU for each VPC network, and VM instances that use that network must also be configured to use that MTU for their interfaces.<li>The network’s MTU setting is communicated to a VM when that VM requests an IP address using DHCP. DHCP Option 26 contains the network’s MTU.</ul><p>The MTU impacts both UDP and TCP traffic:</p><ul><li>If a UDP packet is larger than the destination can receive or the MTU on network link on the path to the destination, the packet<ul><li>dropped if the <code class="language-plaintext highlighter-rouge">Don't-Fragment</code> flag is set. an ICMP packet of the type <code class="language-plaintext highlighter-rouge">Fragmentation-Needed</code> is sent back to the sender.<li>(generally) fragmented if the <code class="language-plaintext highlighter-rouge">Don't-Fragment</code> flag is not set. This fragmentation is done where a mismatch is detected: this could be at an intermediate router or even at the sender itself if a packet is sent that is larger than the MTU.</ul><li>TCP negotiates the <strong>maximum segment size (MSS)</strong> during connection setup time. Packets are then segmented into the smaller MTU size of both endpoints of the connection.</ul><h3 id="vms-and-mtu-settings">VMs and MTU settings</h3><ul><li><p>Linux VMs based on <strong>Google-provided OS images</strong> automatically have their interface MTU set to the MTU of the VPC network when they are created.</p><li><p>If a VM has multiple network interfaces, each interface is set to the MTU of the attached network.</p><ul><li><p>If you change the MTU of a VPC that has running VMs, you must stop and then start those VMs to pick up the new MTU. When the VMs start up again, the changed network MTU is communicated to them from DHCP.</p><li><p>Windows VMs do not automatically configure their interfaces to use the VPC network’s MTU when they start. To set Windows VMs based on Google-provided OS images to an MTU of 1500, do the following on each Windows VM:</p></ul><div class="language-bash highlighter-rouge"><div class="code-header" text-data="bash"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>netsh interface ipv4 show interface
netsh interface ipv4 <span class="nb">set </span>interface INTERFACE_INDEX <span class="nv">mtu</span><span class="o">=</span>1500 <span class="nv">store</span><span class="o">=</span>persistent
shutdown /r /t 0
</pre></table></code></div></div><pre><code class="language-PowerShell">Set-NetIPInterface -InterfaceAlias INTERFACE_NAME -AddressFamily IPv4 -NlMtu 1500
Restart-Computer -Force
</code></pre></ul><h3 id="migrating-services-to-a-different-mtu-network">Migrating services to a different MTU network</h3><p>to migrate your services to new VMs in a new network rather than changing the MTU of your existing network. In such a case, you might have a server, such as a database server, that needs to be accessible to all VMs during the migration. If so, the following general approach might help you migrate cleanly:</p><ul><li>Create the new <strong>network</strong> with the new MTU.<li>Create any necessary <strong>firewall rules and routes</strong> in the new network.<li>Create a <strong>VM with multiple network interfaces</strong> in the old network. One interface connects to the new network using the new MTU and the other connects to the old network using the old MTU.<li><p>Configure this <strong>new VM as a secondary server</strong> for the existing one.</p><li>Fail the primary server over to the secondary one.<li>Either Migrate VMs to the new network or create new VMs in the new network.<ul><li>If you create new VMs, you can create them from scratch, from an existing image, or by creating a snapshot of the existing VMs and using that to populate the new persistent disks.</ul><li>Configure these VMs to use the operational server in that network.<li>Migrate traffic to the new VMs.<li>If you intend to delete the old network, create a new server in the new network, get it in sync with the existing server, and fail over to it.<li>Delete the old server and old network.</ul><h3 id="consequences-of-mismatched-mtus">Consequences of mismatched MTUs</h3><p>mismatched MTU: two communicating VM instances that have different MTU settings.</p><ul><li>This can, in a limited number of cases, cause connectivity problems. Specific cases involve the use of instances as routers and the use of Kubernetes inside VMs.<li>In most common scenarios, TCP connections established between instances with different MTUs are successful due to the MSS negotiation, where both ends of a connection will agree to use the lower of the two MTUs.<li>This applies whether the two VMs are in the same network or peered networks.</ul><ol><li><p>MTU differences with Cloud VPN</p><li><p>MTU differences with <strong>Cloud Interconnect</strong></p><ul><li><p>Cloud Interconnect can have an <code class="language-plaintext highlighter-rouge">MTU of 1440 or 1500</code>.</p><li>If the <code class="language-plaintext highlighter-rouge">communicating VMs</code> have an MTU of 1500 and the <code class="language-plaintext highlighter-rouge">Interconnect connection</code> has an MTU of 1440<ul><li>MSS clamping reduces the MTU of <strong>TCP connections</strong> to 1440 and TCP traffic proceeds.<li>MSS clamping does not affect <strong>UDP packets</strong></ul><li>if the <code class="language-plaintext highlighter-rouge">VPC network</code> has an MTU of 1500 and the <code class="language-plaintext highlighter-rouge">Interconnect connection</code> has an MTU of 1440,<ul><li>then UDP datagrams with more than 1412 bytes of data (1412 bytes UDP data + 8 byte UDP header + 20 byte IPv4 header = 1440) are dropped.<ul><li>In such a case, you can do one of the following:<ul><li>Lower the MTU of the attached VPC network to 1460.<li>Adjust your application to send smaller UDP packets.<li>Create a new Interconnect connection of 1500 bytes</ul></ul></ul></ul></ol><hr /><h2 id="network-performance">Network performance</h2><h3 id="latency">Latency</h3><p>The measured <strong>inter-region latency for Google Cloud networks</strong> can be found in our live dashboard.</p><ul><li><p>The dashboard shows Google Cloud’s <code class="language-plaintext highlighter-rouge">median inter-region latency</code> and <code class="language-plaintext highlighter-rouge">throughput performance metrics</code> and <code class="language-plaintext highlighter-rouge">methodology to reproduce</code> these results using PerfKit Benchmarker.</p><li><p>Google Cloud typically measures round-trip latencies less than 55 μs at the 50th percentile and tail latencies less than 80μs at the 99th percentile between c2-standard-4 VM instances in the same zone.</p><li><p>Google Cloud typically measures round-trip latencies less than 45μs at the 50th percentile and tail latencies less than 60μs at the 99th percentile between c2-standard-4 VM instances in the same low-latency network (“compact” placement policy). Compact placement policy lowers the network latency by ensuring that the VMs are located physically within the same low-latency network.</p></ul><p>Methodology: Intra-zone latency is monitored via a blackbox prober that constantly runs netperf TCP_RR benchmark between a pair of c2-types VMs in every zone c2 instances are available. It collects P50 and P99 results for setup with and without compact placement policy. TCP_RR benchmark measures request/response performance by measuring the transaction rate. If your applications require best possible latency, c2 instances are recommended.</p><h3 id="packet-loss">Packet loss</h3><p>Google Cloud tracks <strong>cross-region packet loss</strong> by regularly measuring <code class="language-plaintext highlighter-rouge">round-trip loss</code> between all regions.</p><ul><li>We target the global average of those measurements to be lower than 0.01% .<li>Methodology:<ul><li>A blackbox vm-to-vm prober monitors the packet loss for every zone pair using pings and aggregates the results into one global loss metric.<li>This metric is tracked with a one-day window.</ul></ul><p>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/01gcp/'>01GCP</a>, <a href='/categories/network/'>Network</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/gcp/" class="post-tag no-text-decoration" >GCP</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=GCP - VPC Virtual Private Cloud - Grace&url=https://ocholuo.github.io//posts/GCP-VPC/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=GCP - VPC Virtual Private Cloud - Grace&u=https://ocholuo.github.io//posts/GCP-VPC/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=GCP - VPC Virtual Private Cloud - Grace&url=https://ocholuo.github.io//posts/GCP-VPC/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Amazon-CloudFront/">AWS Lab - AWS CloudFront</a><li><a href="/posts/Alexa-1stSkill/">AWS Alex First Skill - RedVelvet Time</a><li><a href="/posts/NetworkProtocol-SSL-TLS-Handshake/">NetworkProtocol SSL/TLS Handshake</a><li><a href="/posts/pythonCrash/">Python Crash</a><li><a href="/posts/%E4%B8%80%E5%8F%A5%E8%AF%9D%E8%A7%A3%E9%87%8AAWS/">AWS - 一句话解释AWS</a><li><a href="/posts/GKE/">GCP - Google Cloud Computing - Kubernetes and Kubernetes Engine</a><li><a href="/posts/Go-Note/">Go Note</a><li><a href="/posts/SCPs/">AWS - IdenAccessManage - SCPs (Service Control Policies)</a><li><a href="/posts/CompanyBenefit/">Company Benefit</a><li><a href="/posts/Encryption-SSL&TLS/">Cryptography - SSL/TLS Encryption</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/cyberattack/">CyberAttack</a> <a class="post-tag" href="/tags/lab/">Lab</a> <a class="post-tag" href="/tags/cyberattacktools/">CyberAttackTools</a> <a class="post-tag" href="/tags/gcp/">GCP</a> <a class="post-tag" href="/tags/sysadmin/">Sysadmin</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/soc/">SOC</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/GCP-Network-connection/"><div class="card-body"> <span class="timeago small" >Jan 1, 2021<i class="unloaded">2021-01-01T10:11:11-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>GCP - GCP connection</h3><div class="text-muted small"><p> GCP Network basic Cloud Interconnect and Peering Dedicated connections and Partner Interconnect IPsec VPN tunnels Dedicated connectio...</p></div></div></a></div><div class="card"> <a href="/posts/GCP-Region/"><div class="card-body"> <span class="timeago small" >Jan 1, 2021<i class="unloaded">2021-01-01T10:11:11-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>GCP - GCP Region</h3><div class="text-muted small"><p> GCP Region GCP Region global -&gt; multi region -&gt; region -&gt; zone Deploying applications across multiple zones enables fault tolerance and high availability network late...</p></div></div></a></div><div class="card"> <a href="/posts/GCP-Labs/"><div class="card-body"> <span class="timeago small" >Jan 2, 2021<i class="unloaded">2021-01-02T10:11:11-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>GCP - LABs</h3><div class="text-muted small"><p> Fundamental Lab 1 lab1 - Google Cloud Fundamentals: Cloud Marketplace Task 1: Sign in to the Google Cloud Platform (GCP) Console Task 2: Use Cloud Marketp...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/GCP-Region/" class="btn btn-outline-primary" prompt="Older"><p>GCP - GCP Region</p></a> <a href="/posts/Cloud-IAM/" class="btn btn-outline-primary" prompt="Newer"><p>GCP - Cloud IAM</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/ocholuo">Grace JyL</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/cyberattack/">CyberAttack</a> <a class="post-tag" href="/tags/lab/">Lab</a> <a class="post-tag" href="/tags/cyberattacktools/">CyberAttackTools</a> <a class="post-tag" href="/tags/gcp/">GCP</a> <a class="post-tag" href="/tags/sysadmin/">Sysadmin</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/soc/">SOC</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://ocholuo.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script async src="https://cdn.jsdelivr.net/npm/countup.js@1.9.3/dist/countUp.min.js"></script> <script defer src="/assets/js/dist/pvreport.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-179830187-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-179830187-1'); }); </script>
