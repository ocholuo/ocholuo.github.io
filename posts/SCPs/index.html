<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="pv-proxy-endpoint" content="https://myochosite-291718.appspot.com/query?id=ahNwfm15b2Nob3NpdGUtMjkxNzE4chULEghBcGlRdWVyeRiAgIDo14eBCgw"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="AWS - IdenAccessManage - SCPs (Service Control Policies)" /><meta property="og:locale" content="en" /><meta name="description" content="Service Control Policies (SCPs) basic Testing effects of SCPs Maximum size of SCPs Inheritance of SCPs in the OU hierarchy Effects on permissions Using access data to improve SCPs create, update, and delete Creating an SCP Updating an SCP Editing tags attached to an SCP Deleting an SCP Attach and detach Attach Detaching an SCP from the organization root, OUs, or accounts Strategies for using SCPs SCPs FullAWSAccess Using SCPs as a deny list Using SCPs as an allow list SCP syntax * Version element Statement element Statement ID (Sid) element Effect element &quot;Effect&quot;: &quot;Allow&quot; &quot;Effect&quot;: &quot;Deny&quot; Action and NotAction elements Action element Example of NotAction element ??? Resource element Condition element multiple condition Unsupported elements" /><meta property="og:description" content="Service Control Policies (SCPs) basic Testing effects of SCPs Maximum size of SCPs Inheritance of SCPs in the OU hierarchy Effects on permissions Using access data to improve SCPs create, update, and delete Creating an SCP Updating an SCP Editing tags attached to an SCP Deleting an SCP Attach and detach Attach Detaching an SCP from the organization root, OUs, or accounts Strategies for using SCPs SCPs FullAWSAccess Using SCPs as a deny list Using SCPs as an allow list SCP syntax * Version element Statement element Statement ID (Sid) element Effect element &quot;Effect&quot;: &quot;Allow&quot; &quot;Effect&quot;: &quot;Deny&quot; Action and NotAction elements Action element Example of NotAction element ??? Resource element Condition element multiple condition Unsupported elements" /><link rel="canonical" href="https://ocholuo.github.io//posts/SCPs/" /><meta property="og:url" content="https://ocholuo.github.io//posts/SCPs/" /><meta property="og:site_name" content="Grace" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-07-18T11:11:11-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="AWS - IdenAccessManage - SCPs (Service Control Policies)" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-02-16T18:45:51-05:00","datePublished":"2020-07-18T11:11:11-04:00","description":"Service Control Policies (SCPs) basic Testing effects of SCPs Maximum size of SCPs Inheritance of SCPs in the OU hierarchy Effects on permissions Using access data to improve SCPs create, update, and delete Creating an SCP Updating an SCP Editing tags attached to an SCP Deleting an SCP Attach and detach Attach Detaching an SCP from the organization root, OUs, or accounts Strategies for using SCPs SCPs FullAWSAccess Using SCPs as a deny list Using SCPs as an allow list SCP syntax * Version element Statement element Statement ID (Sid) element Effect element &quot;Effect&quot;: &quot;Allow&quot; &quot;Effect&quot;: &quot;Deny&quot; Action and NotAction elements Action element Example of NotAction element ??? Resource element Condition element multiple condition Unsupported elements","headline":"AWS - IdenAccessManage - SCPs (Service Control Policies)","mainEntityOfPage":{"@type":"WebPage","@id":"https://ocholuo.github.io//posts/SCPs/"},"url":"https://ocholuo.github.io//posts/SCPs/"}</script><title>AWS - IdenAccessManage - SCPs (Service Control Policies) | Grace</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Grace"><meta name="application-name" content="Grace"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://myochosite-291718.appspot.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://myochosite-291718.appspot.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/huoye.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Grace</a></div><div class="site-subtitle font-italic">2023 Mar 14 updated</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/ocholuo" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>AWS - IdenAccessManage - SCPs (Service Control Policies)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>AWS - IdenAccessManage - SCPs (Service Control Policies)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Grace JyL </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Jul 18, 2020, 11:11 AM -0400" >Jul 18, 2020<i class="unloaded">2020-07-18T11:11:11-04:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Feb 16, 2023, 3:45 PM -0800" >Feb 16<i class="unloaded">2023-02-16T18:45:51-05:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5350 words">29 min read</span> <span id="pv" class="pageviews"> <i class="fas fa-spinner fa-spin fa-fw"></i> </span> views</div></div><div class="post-content"><ul><li><a href="#service-control-policies-scps">Service Control Policies (SCPs)</a><ul><li><a href="#basic">basic</a><li><a href="#testing-effects-of-scps">Testing effects of SCPs</a><li><a href="#maximum-size-of-scps">Maximum size of SCPs</a><li><a href="#inheritance-of-scps-in-the-ou-hierarchy">Inheritance of SCPs in the OU hierarchy</a><li><a href="#effects-on-permissions">Effects on permissions</a><li><a href="#using-access-data-to-improve-scps">Using access data to improve SCPs</a><li><a href="#create-update-and-delete">create, update, and delete</a><ul><li><a href="#creating-an-scp">Creating an SCP</a><li><a href="#updating-an-scp">Updating an SCP</a><li><a href="#editing-tags-attached-to-an-scp">Editing tags attached to an SCP</a><li><a href="#deleting-an-scp">Deleting an SCP</a></ul><li><a href="#attach-and-detach">Attach and detach</a><ul><li><a href="#attach">Attach</a><li><a href="#detaching-an-scp-from-the-organization-root-ous-or-accounts">Detaching an SCP from the organization root, OUs, or accounts</a></ul><li><a href="#strategies-for-using-scps">Strategies for using SCPs</a><ul><li><a href="#scps-fullawsaccess">SCPs <code class="language-plaintext highlighter-rouge">FullAWSAccess</code></a><li><a href="#using-scps-as-a-deny-list">Using SCPs as a deny list</a><li><a href="#using-scps-as-an-allow-list">Using SCPs as an allow list</a></ul><li><a href="#scp-syntax">SCP syntax</a><ul><li><a href="#"><code class="language-plaintext highlighter-rouge">*</code></a><li><a href="#version-element"><code class="language-plaintext highlighter-rouge">Version</code> element</a><li><a href="#statement-element"><code class="language-plaintext highlighter-rouge">Statement</code> element</a><li><a href="#statement-id-sid-element">Statement ID (<code class="language-plaintext highlighter-rouge">Sid</code>) element</a><li><a href="#effect-element"><code class="language-plaintext highlighter-rouge">Effect</code> element</a><ul><li><a href="#effect-allow"><code class="language-plaintext highlighter-rouge">"Effect": "Allow"</code></a></ul><li><a href="#effect-deny"><code class="language-plaintext highlighter-rouge">"Effect": "Deny"</code></a><li><a href="#action-and-notaction-elements"><code class="language-plaintext highlighter-rouge">Action</code> and <code class="language-plaintext highlighter-rouge">NotAction</code> elements</a><ul><li><a href="#action-element"><code class="language-plaintext highlighter-rouge">Action</code> element</a></ul><li><a href="#example-of-notaction-element-">Example of <code class="language-plaintext highlighter-rouge">NotAction</code> element ???</a><li><a href="#resource-element"><code class="language-plaintext highlighter-rouge">Resource</code> element</a><li><a href="#condition-element"><code class="language-plaintext highlighter-rouge">Condition</code> element</a><ul><li><a href="#multiple-condition">multiple condition</a></ul><li><a href="#unsupported-elements">Unsupported elements</a></ul></ul></ul><hr /><h1 id="service-control-policies-scps">Service Control Policies (SCPs)</h1><hr /><h2 id="basic">basic</h2><ul><li><p>one type of policy</p><li>use <font color="red"> to manage organization </font><ul><li>Attaching an SCP to an AWS Organizations entity (root, OU, or account)<li>defines a guardrail for what actions the principals can perform.</ul><li>enables <font color="red"> permission controls </font><ul><li>can <font color="blue"> limit account usage </font> to organizational units or linked accounts.<li>offer <font color="red"> central control </font> over the maximum available permissions <font color="blue"> for all accounts in organization </font><li>ensure accounts stay in organization’s access control guidelines.</ul><li>available only in an organization that <font color="red"> has all features enabled </font><ul><li>SCPs are not automatically enabled;<li>including consolidated billing<ul><li>SCPs aren’t available if organization has enabled only the consolidated billing feature</ul></ul><li> <font color="red"> restrict the root user of an Organization Unit account </font><ul><li>SCP is a way to restrict a root user on an account.<li>defines a safeguard for the actions that accounts in the organization root or OU can do.<li>Attaching an SCP to the organization root/unit (OU)<ul><li>Log in to the master account and create the SCP<li>Select the <font color="blue"> Organizational Unit </font><li> <font color="blue"> Enable the SCP </font><p>for the Organizational Unit</p><li>Attach the SCP to the member account within the Organizational Unit</ul></ul><li> <font color="red"> not a substitute for well-managed each account </font><ul><li>still need attach IAM policies to users/roles in organization’s accounts<li>to actually grant permissions to them.</ul><li>similar to IAM permissions policies<ul><li>almost the same syntax. JSON<li>but, SCP policies <font color="blue"> never grants permissions. </font><ul><li> <font color="red"> it the maximum permissions </font><p> for an organization or OU.</p></ul></ul><li> <font color="red"> No permissions are granted by an SCP </font><ul><li>it defines a guardrail, or sets limits, on the actions that the account’s administrator can delegate to the IAM users/roles in the affected accounts.<ul><li>The administrator must still attach <code class="language-plaintext highlighter-rouge">identity/resource-based policies</code> to IAM users/roles, or to the resources in accounts to actually grant permissions.</ul><li>The <font color="blue"> effective permissions </font><ul><li>the logical intersection between <strong>what is allowed by the SCP</strong> and <strong>what is allowed by the IAM/Resource-based policies</strong></ul><li>Important<ul><li>SCPs don’t affect users or roles in the management account.<li>affect only the member accounts in the organization.</ul></ul><li>by default <code class="language-plaintext highlighter-rouge">FullAWSAccess</code><ul><li>a service control policy<li>allows users to access services/resources on an attached account.<li>allows access to all AWS services within an attached member account</ul></ul><hr /><h2 id="testing-effects-of-scps">Testing effects of SCPs</h2><blockquote><p>recommends don’t attach SCPs to the root of the organization without thoroughly testing the impact that the policy has on accounts.</p></blockquote><p>Instead, create an OU that you can move the accounts into one at a time, or at least in small numbers, to ensure that you don’t inadvertently lock users out of key services.</p><p>to determine whether a service is used by an account</p><ol><li>examine the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/accesspoliciesaccess-advisor.html">service last accessed data in IAM</a>.<li><a href="https://docs.aws.amazon.com/awscloudtrail/latest/userguide/how-cloudtrail-works.html">use AWS CloudTrail to log service usage at the API level</a>.</ol><hr /><h2 id="maximum-size-of-scps">Maximum size of SCPs</h2><p>All characters in the SCP count against its maximum size.</p><ul><li>if the policy size approaches the maximum size, delete any white space, such as space characters and line breaks that are outside quotation marks.</ul><blockquote><p>Use the visual editor to build the SCP. It automatically removes extra white space.</p></blockquote><hr /><h2 id="inheritance-of-scps-in-the-ou-hierarchy">Inheritance of SCPs in the OU hierarchy</h2><p>[Detailed explanation]</p><p><img data-proofer-ignore data-src="https://i.imgur.com/82X5eFC.png" alt="HowSCPPermissionsWork" /></p><hr /><h2 id="effects-on-permissions">Effects on permissions</h2><ul><li>similar to AWS IAM permission policies and use almost the same syntax.<li>However, an SCP never grants permissions.<li><p>Instead, SCPs are JSON policies that specify the maximum permissions for the affected accounts.</p><li> <font color="red"> SCPs affect only IAM users/roles managed by accounts that are part of the organization </font><ul><li>don’t affect resource-based policies directly.<li>also don’t affect users or roles from accounts outside the organization.<li>For example<li>an Amazon S3 bucket that’s owned by account A in an organization.<li>The bucket policy (resource-based policy) grants access to users from account B outside the organization.<li>Account A has an SCP attached that doesn’t apply to those outside users in account B.<li>The SCP applies only to users that are managed by account A in the organization.</ul><li> <font color="red"> SCP restricts permissions for IAM users/roles in member accounts, including the member account's root user </font><ul><li>Any account has only those permissions permitted by <strong>every</strong> parent above it.<li>If a permission is blocked at any level above the account<ul><li>either implicitly<ul><li>not being included in an <font color="red"> Allow </font> policy statement</ul><li>or explicitly<ul><li>being included in a <font color="red"> Deny </font> policy statement</ul></ul><li>a user/role in the affected account can’t use that permission<li>even if the account administrator attaches the <font color="red"> AdministratorAccess </font> IAM policy with <code class="language-plaintext highlighter-rouge">*/*</code> permissions to the user.</ul><li> <font color="red"> SCPs affect only member accounts in the organization </font><ul><li>They have no effect on users or roles in the management account.</ul><li>Users/roles must still be <font color="red"> granted permissions by IAM permission policies </font><ul><li><p>A user without any IAM permission policies has no access, even if the applicable SCPs allow all services and all actions.</p><li>If a user/role has an <font color="blue"> IAM permission policy grants access to an action that is also allowed by the applicable SCPs </font><ul><li>the user/role can perform that action.</ul><li>If a user/role has an <font color="blue"> IAM permission policy grants access to an action that is not allowed or explicitly denied by the applicable SCPs </font><ul><li>the user/role can’t perform that action.</ul></ul><li> <font color="red"> SCPs affect all users/roles in attached accounts, including the root user </font><ul><li>The only exceptions are<li>some <font color="blue"> Tasks and entities not restricted by SCPs </font><ul><li>Any action performed by the management account<li>Any action performed using permissions that are attached to a service-linked role<li>Register for the Enterprise support plan as the root user<li>Change the AWS support level as the root user<li>Manage Amazon CloudFront keys as the root user<li>Provide trusted signer functionality for CloudFront private content<li>Configure reverse DNS for an Amazon Lightsail email server as the root user<li>Tasks on some AWS-related services:<ul><li>Alexa Top Sites<li>Alexa Web Information Service<li>Amazon Mechanical Turk<li>Amazon Product Marketing API</ul></ul><li><strong>Exceptions for only member accounts created before September 15, 2017</strong><ul><li><strong>can’t</strong> use SCPs to prevent the root user in those member accounts from performing the following tasks:<li>Enable or disable multi-factor authentication on the root user<li>Create, update, or delete x.509 keys for the root user<li>Change the root user’s password<li>Create, update, or delete root access keys</ul><li>For <strong>all</strong> accounts created after September 15, 2017, the exceptions don’t apply and you <em>*can-</em> use SCPs to prevent the root user in those member accounts from performing the following tasks.<li>However, unless you are certain that <strong>all</strong> of the accounts in the organization were created after September 15, 2017, recommend that don’t rely on SCPs to try to restrict these operations</ul><li> <font color="red"> SCPs do not affect any service-linked role </font><ul><li>Service-linked roles enable other AWS services to integrate with AWS Organizations<li>can’t be restricted by SCPs.</ul><li> <font color="red"> disable the SCP policy type in a root </font><ul><li>all SCPs are automatically detached from all AWS Organizations entities in that root<ul><li>AWS Organizations entities: organizational units, organizations, and accounts.</ul></ul><li> <font color="red"> re-enable SCPs in a root </font><ul><li>that root reverts to only the default <code class="language-plaintext highlighter-rouge">FullAWSAccess</code> policy automatically attached to all entities in the root.<li>Any attachments of SCPs to AWS Organizations entities from before SCPs were disabled are lost and aren’t automatically recoverable, although you can manually reattach them.</ul><li> <font color="red"> If both a permissions boundary (an advanced IAM feature) and an SCP are present </font><ul><li>then the boundary, the SCP, and the identity-based policy must all allow the action.</ul></ul><hr /><h2 id="using-access-data-to-improve-scps">Using access data to improve SCPs</h2><p>When signed in with management account credentials</p><ul><li>IAM console &gt; AWS Organizations section, view <strong>service last accessed data</strong> for an AWS Organizations entity or policy<li>or use the AWS CLI or AWS API in IAM to retrieve <strong>service last accessed data</strong>.</ul><p>service last accessed data</p><ul><li>includes information about which allowed services that the IAM users/roles in an AWS Organizations account last attempted to access and when.<li>use this information to identify unused permissions so that you can refine the SCPs to better adhere to the principle of least privilege</ul><p>example</p><ul><li>might have a deny list SCP that prohibits access to three AWS services.<li>All services that aren’t listed in the SCP’s <font color="red"> Deny </font> statement are allowed.<li>The <strong>service last accessed data</strong> in IAM tells you which AWS services are allowed by the SCP but are never used.<li>update the SCP to deny access to services that don’t need.</ul><p>example:</p><ul><li><p><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/accesspoliciesaccess-advisor-view-data-orgs.html">Viewing Organizations Service Last Accessed Data for Organizations</a></p><li><p><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/accesspoliciesaccess-advisor-example-scenarios.html#accesspoliciesaccess-advisor-reduce-permissions-orgs">Using Data to Refine Permissions for an Organizational Unit</a></p></ul><hr /><h2 id="create-update-and-delete">create, update, and delete</h2><p>When you sign in to the organization’s management account, you can create and update service control policies (SCPs)</p><ul><li>building statements that deny or allow access to services and actions</ul><p>The default configuration for working with SCPs is to use a “block list” strategy</p><ul><li>where all actions are implicitly allowed except for those actions you want to block by creating statements that deny access.<li>With deny statements, you can specify resources and conditions for the statement and use the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/referencepolicieselementsnotaction.html">NotAction</a> element.</ul><blockquote><p>use <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/accesspoliciesaccess-advisor.html">service last accessed data</a> in IAM as a data point for updating the SCPs to restrict access to only the AWS services that you need.</p></blockquote><hr /><h3 id="creating-an-scp">Creating an SCP</h3><ul><li>Minimum permissions<ul><li>To create SCPs, need permission to run the following action:<li><code class="language-plaintext highlighter-rouge">organizations:CreatePolicy</code></ul><li>AWS CLI<ul><li><a href="https://docs.aws.amazon.com/cli/latest/reference/organizations/create-policy.html">aws organizations create-policy</a><li>Example<li>assumes have a file named <code class="language-plaintext highlighter-rouge">Deny-IAM.json</code> with the JSON policy text in it.<li>It uses that file to create a new service control policy.</ul></ul><div class="language-bash highlighter-rouge"><div class="code-header" text-data="bash"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nv">$ </span>aws organizations create-policy <span class="se">\</span>
  <span class="nt">--content</span> file://Deny-IAM.json <span class="se">\</span>
  <span class="nt">--description</span> <span class="s2">"Deny all IAM actions"</span> <span class="se">\</span>
  <span class="nt">--name</span> DenyIAMSCP <span class="se">\</span>
  <span class="nt">--type</span> SERVICECONTROLPOLICY
<span class="c"># {</span>
<span class="c">#   "Policy": {</span>
<span class="c">#       "PolicySummary": {</span>
<span class="c">#           "Id": "p-i9j8k7l6m5",</span>
<span class="c">#           "Arn": "arn:aws:organizations::123456789012:policy/o-aa111bb222/servicecontrolpolicy/p-i9j8k7l6m5",</span>
<span class="c">#           "Name": "DenyIAMSCP",</span>
<span class="c">#           "Description": "Deny all IAM actions",</span>
<span class="c">#           "Type": "SERVICECONTROLPOLICY",</span>
<span class="c">#           "AwsManaged": false</span>
<span class="c">#       },</span>
<span class="c">#       "Content": "{"Version":"2012-10-17","Statement":[{"Sid":"Statement1","Effect":"Deny","Action":["iam:*"],"Resource":["*"]}]}"</span>
<span class="c">#   }</span>
<span class="c"># }</span>
</pre></table></code></div></div><ul><li>AWS SDKs:<ul><li><a href="https://docs.aws.amazon.com/organizations/latest/APIReference/APICreatePolicy.html">CreatePolicy</a></ul></ul><hr /><h3 id="updating-an-scp">Updating an SCP</h3><p>Minimum permissions</p><ul><li><p>To update an SCP, you need permission to run the following actions:</p><ul><li><code class="language-plaintext highlighter-rouge">organizations:UpdatePolicy</code><ul><li>with a <code class="language-plaintext highlighter-rouge">Resource</code> element in the same policy statement that includes the ARN of the specified policy (or <code class="language-plaintext highlighter-rouge">\*</code>)</ul><li><code class="language-plaintext highlighter-rouge">organizations:DescribePolicy</code><ul><li>with a <code class="language-plaintext highlighter-rouge">Resource</code> element in the same policy statement that includes the ARN of the specified policy (or <code class="language-plaintext highlighter-rouge">\*</code>)</ul></ul><li><p>AWS CLI:</p><ul><li><a href="https://docs.aws.amazon.com/cli/latest/reference/organizations/update-policy.html">aws organizations update-policy</a><li>Example</ul></ul><div class="language-bash highlighter-rouge"><div class="code-header" text-data="bash"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre><span class="c"># renames a policy.</span>
<span class="nv">$ </span>aws organizations update-policy <span class="se">\</span>
  <span class="nt">--policy-id</span> p-i9j8k7l6m5 <span class="se">\</span>
  <span class="nt">--name</span> <span class="s2">"MyRenamedPolicy"</span>
<span class="c"># {</span>
<span class="c">#   "Policy": {</span>
<span class="c">#       "PolicySummary": {</span>
<span class="c">#           "Id": "p-i9j8k7l6m5",</span>
<span class="c">#           "Arn": "arn:aws:organizations::123456789012:policy/o-aa111bb222/servicecontrolpolicy/p-i9j8k7l6m5",</span>
<span class="c">#           "Name": "MyRenamedPolicy",</span>
<span class="c">#           "Description": "Blocks all IAM actions",</span>
<span class="c">#           "Type": "SERVICECONTROLPOLICY",</span>
<span class="c">#           "AwsManaged": false</span>
<span class="c">#       },</span>
<span class="c">#       "Content": "{"Version":"2012-10-17","Statement":[{"Sid":"Statement1","Effect":"Den"Action":["iam:*"],"Resource":["*"]}]}"</span>
<span class="c">#   }</span>
<span class="c"># }</span>


<span class="c"># adds or changes the description for a service control policy.</span>
<span class="nv">$ </span>aws organizations update-policy <span class="se">\</span>
  <span class="nt">--policy-id</span> p-i9j8k7l6m5 <span class="se">\</span>
  <span class="nt">--description</span> <span class="s2">"My new policy description"</span>
  <span class="c"># {</span>
  <span class="c">#       "Policy": {</span>
  <span class="c">#           "PolicySummary": {</span>
  <span class="c">#               "Id": "p-i9j8k7l6m5",</span>
  <span class="c">#               "Arn": "arn:aws:organizations::123456789012:policy/o-aa111bb222/servicecontrolpolicy/p-i9j8k7l6m5",</span>
  <span class="c">#               "Name": "MyRenamedPolicy",</span>
  <span class="c">#               "Description": "My new policy description",</span>
  <span class="c">#               "Type": "SERVICECONTROLPOLICY",</span>
  <span class="c">#               "AwsManaged": false</span>
  <span class="c">#           },</span>
  <span class="c">#           "Content": "{"Version":"2012-10-17","Statement":[{"Sid":"Statement1","Effect":"Deny","Action":["iam:*"],"Resource":["*"]}]}"</span>
  <span class="c">#       }</span>
  <span class="c"># }</span>


<span class="c"># changes the policy document of the SCP by specifying a file that contains the new JSON policy text.</span>
<span class="nv">$ </span>aws organizations update-policy <span class="se">\</span>
  <span class="nt">--policy-id</span> p-zlfw1r64
  <span class="nt">--content</span> file://MyNewPolicyText.json
  <span class="c"># {</span>
  <span class="c">#       "Policy": {</span>
  <span class="c">#           "PolicySummary": {</span>
  <span class="c">#               "Id": "p-i9j8k7l6m5",</span>
  <span class="c">#               "Arn": "arn:aws:organizations::123456789012:policy/o-aa111bb222/servicecontrolpolicy/p-i9j8k7l6m5",</span>
  <span class="c">#               "Name": "MyRenamedPolicy",</span>
  <span class="c">#               "Description": "My new policy description",</span>
  <span class="c">#               "Type": "SERVICECONTROLPOLICY",</span>
  <span class="c">#               "AwsManaged": false</span>
  <span class="c">#           },</span>
  <span class="c">#           "Content": "{"Version":"2012-10-17","Statement":[{"Sid":"AModifiedPolicy","Effect":"Deny","Action":["iam:*"],"Resource":["*"]}]}"</span>
  <span class="c">#       }</span>
  <span class="c"># }</span>
</pre></table></code></div></div><ul><li>AWS SDKs:<ul><li><a href="https://docs.aws.amazon.com/organizations/latest/APIReference/APIUpdatePolicy.html">UpdatePolicy</a></ul></ul><hr /><h3 id="editing-tags-attached-to-an-scp">Editing tags attached to an SCP</h3><p>add or remove the tags attached to an SCP. For more information about tagging</p><ul><li>Minimum permissions<ul><li>To edit the tags attached to an SCP in the AWS organization, you must have the following permissions:<ul><li><code class="language-plaintext highlighter-rouge">organizations:DescribeOrganization</code> – required only when using the Organizations console<li><code class="language-plaintext highlighter-rouge">organizations:DescribePolicy</code> – required only when using the Organizations console<li><code class="language-plaintext highlighter-rouge">organizations:TagResource</code><li><code class="language-plaintext highlighter-rouge">organizations:UntagResource</code></ul></ul><li>AWS CLI:<ul><li><a href="https://docs.aws.amazon.com/cli/latest/reference/organizations/tag-resource.html">aws organizations tag-resource</a><li><a href="https://docs.aws.amazon.com/cli/latest/reference/organizations/untag-resource.html">aws organizations untag-resource</a></ul><li>AWS SDKs:<ul><li><a href="https://docs.aws.amazon.com/organizations/latest/APIReference/APITagResource.html">TagResource</a><li><a href="https://docs.aws.amazon.com/organizations/latest/APIReference/APIUntagResource.html">UntagResource</a></ul></ul><hr /><h3 id="deleting-an-scp">Deleting an SCP</h3><ul><li>Before you can delete a policy, you must first detach it from all attached entities.<li><p>can’t delete any AWS managed SCP such as the SCP named <code class="language-plaintext highlighter-rouge">FullAWSAccess</code>.</p><li>Minimum permissions<ul><li>To delete an SCP, you need permission to run the following action:<li><code class="language-plaintext highlighter-rouge">organizations:DeletePolicy</code></ul><li>AWS CLI:<ul><li><a href="https://docs.aws.amazon.com/cli/latest/reference/organizations/delete-policy.html">aws organizations delete-policy</a></ul></ul><div class="language-bash highlighter-rouge"><div class="code-header" text-data="bash"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>aws organizations delete-policy <span class="se">\</span>
  <span class="nt">--policy-id</span> p-i9j8k7l6m5
  <span class="c"># This command produces no output when successful.</span>
</pre></table></code></div></div><ul><li>AWS SDKs:<ul><li><a href="https://docs.aws.amazon.com/organizations/latest/APIReference/APIDeletePolicy.html">DeletePolicy</a></ul></ul><hr /><h2 id="attach-and-detach">Attach and detach</h2><hr /><h3 id="attach">Attach</h3><p>Minimum permissions</p><ul><li>To attach an SCP to a root, OU, or account, you need permission to run the following action:<li><code class="language-plaintext highlighter-rouge">organizations:AttachPolicy</code><ul><li>with a <code class="language-plaintext highlighter-rouge">Resource</code> element in the same policy statement that<ul><li>includes<li><code class="language-plaintext highlighter-rouge">*</code> or the Amazon Resource Name (ARN) of the specified policy<li>and the ARN of the root, OU, or account that you want to attach the policy to</ul></ul><li>AWS CLI:</ul><div class="language-bash highlighter-rouge"><div class="code-header" text-data="bash"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>aws organizations attach-policy <span class="se">\</span>
    <span class="nt">--policy-id</span> p-i9j8k7l6m5 <span class="se">\</span>
    <span class="nt">--target-id</span> ou-a1b2-f6g7h222
This <span class="nb">command </span>produces no output when successful.
</pre></table></code></div></div><ul><li>AWS SDKs: <code class="language-plaintext highlighter-rouge">AttachPolicy</code></ul><hr /><h3 id="detaching-an-scp-from-the-organization-root-ous-or-accounts">Detaching an SCP from the organization root, OUs, or accounts</h3><blockquote><p>You can’t detach the last SCP from a root, an OU, or an account. There must be at least one SCP attached to every root, OU, and account at all times.</p></blockquote><p>Minimum permissions</p><ul><li>To detach an SCP from the root, OU, or account, you need permission to run the following action:<li><p><code class="language-plaintext highlighter-rouge">organizations:DetachPolicy</code></p><li>AWS CLI:</ul><div class="language-bash highlighter-rouge"><div class="code-header" text-data="bash"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>aws organizations detach-policy <span class="se">\</span>
    <span class="nt">--policy-id</span> p-i9j8k7l6m5 <span class="se">\</span>
    <span class="nt">--target-id</span> ou-a1b2-f6g7h222
</pre></table></code></div></div><ul><li>AWS SDKs: <code class="language-plaintext highlighter-rouge">DetachPolicy</code></ul><hr /><h2 id="strategies-for-using-scps">Strategies for using SCPs</h2><p>configure the service control policies (SCPs) as either of the following:</p><ul><li>A deny list strategy<ul><li>actions are allowed by default,<li>and you specify what services and actions are prohibited<li>makes use of the <code class="language-plaintext highlighter-rouge">FullAWSAccess</code> SCP attached by default to every OU and account.<li>This SCP<ul><li>overrides the default implicit deny<li>explicitly allows all permissions from the root to every account<li>unless explicitly deny a permission with an additional SCP created and attached to the appropriate OU or account.</ul><li>This strategy works because an <font color="red"> explicit deny in a policy always overrides allow </font><li>No account below the level of the OU with the deny policy can use the denied API<li>and there is no way to add the permission back lower in the hierarchy.</ul><li>An allow list strategy<ul><li>actions are prohibited by default<li>and you specify what services and actions are allowed<li>remove the <code class="language-plaintext highlighter-rouge">FullAWSAccess</code> SCP ttached by default to every OU and account.<li>no APIs are permitted anywhere unless you explicitly allow them.<li>To allow a service API to operate in an AWS account, you must create your own SCPs and attach them to the account and every OU above it, up to and including the root.<li>Every SCP in the hierarchy, starting at the root, must explicitly allow the APIs to be usable in the OUs and accounts below it.<li>This strategy works because an <font color="red"> explicit allow in an SCP overrides an implicit 暗示的 deny </font></ul></ul><hr /><h3 id="scps-fullawsaccess">SCPs <code class="language-plaintext highlighter-rouge">FullAWSAccess</code></h3><p>AWS Organizations attaches an AWS managed SCP named <code class="language-plaintext highlighter-rouge">FullAWSAccess</code> to every root and OU when it’s created.</p><ul><li>This policy allows all services and actions.<li>attach or detach from the entities in your organization as needed.<li>Because the policy is an AWS managed SCP, you can’t modify or delete it.</ul><p>The policy looks like the following.</p><div class="language-json highlighter-rouge"><div class="code-header" text-data="json"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><hr /><h3 id="using-scps-as-a-deny-list">Using SCPs as a deny list</h3><p>The default configuration of AWS Organizations supports using SCPs as deny lists.</p><ul><li>Using a deny list strategy<li>account administrators can delegate all services and actions until you create and attach an SCP that denies a specific service or set of actions.<li>Deny statements require less maintenance,<ul><li>no need to update them when AWS adds new services.</ul><li>Deny statements usually use less space<ul><li>easier to stay within the maximum size for SCPs.</ul><li>In a statement where the Effect element has a value of Deny, you can also restrict access to specific resources, or define conditions for when SCPs are in effect.</ul><p>Such a policy might look like the following example</p><div class="language-json highlighter-rouge"><div class="code-header" text-data="json"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="mi">1</span><span class="err">.</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">SCP</span><span class="w"> </span><span class="err">still</span><span class="w"> </span><span class="err">allows</span><span class="w"> </span><span class="err">all</span><span class="w"> </span><span class="err">other</span><span class="w"> </span><span class="err">services</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">their</span><span class="w"> </span><span class="err">actions.</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">prevents</span><span class="w"> </span><span class="err">users</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">affected</span><span class="w"> </span><span class="err">accounts</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">performing</span><span class="w"> </span><span class="err">any</span><span class="w"> </span><span class="err">actions</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">Amazon</span><span class="w"> </span><span class="err">DynamoDB</span><span class="w"> </span><span class="err">service.</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AllowsAllActions"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DenyDynamoDB"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deny"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dynamodb:*"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">


</span><span class="err">//</span><span class="w"> </span><span class="mi">2</span><span class="err">.</span><span class="w"> </span><span class="err">leaving</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">FullAWSAccess</span><span class="w"> </span><span class="err">policy</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">place</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">then</span><span class="w"> </span><span class="err">attaching</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">second</span><span class="w"> </span><span class="err">policy</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">has</span><span class="w"> </span><span class="err">only</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">Deny</span><span class="w"> </span><span class="err">statement</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">it</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deny"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dynamodb:*"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><hr /><h3 id="using-scps-as-an-allow-list">Using SCPs as an allow list</h3><ol><li>must replace the AWS managed <code class="language-plaintext highlighter-rouge">FullAWSAccess</code> SCP with an SCP that explicitly permits only those services and actions that you want to allow.<li>By removing the default <code class="language-plaintext highlighter-rouge">FullAWSAccess</code> SCP, all actions for all services are now implicitly denied.<li>Your custom SCP then overrides the implicit Deny with an explicit Allow for only those actions that you want to permit.<li>For a permission to be enabled for a specified account, every SCP from the root through each OU in the direct path to the account, and even attached to the account itself, must allow that permission.</ol><p>An Allow statement in an SCP</p><ul><li>can’t have a Resource element with anything except a “*”.<li>can’t have a Condition element at all.</ul><p>An allow list policy might look like the following example</p><div class="language-json highlighter-rouge"><div class="code-header" text-data="json"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="err">//</span><span class="w"> </span><span class="err">enables</span><span class="w"> </span><span class="err">account</span><span class="w"> </span><span class="err">users</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">perform</span><span class="w"> </span><span class="err">operations</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">Amazon</span><span class="w"> </span><span class="err">Elastic</span><span class="w"> </span><span class="err">Compute</span><span class="w"> </span><span class="err">Cloud</span><span class="w"> </span><span class="err">(Amazon</span><span class="w"> </span><span class="err">EC</span><span class="mi">2</span><span class="err">)</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">Amazon</span><span class="w"> </span><span class="err">CloudWatch,</span><span class="w"> </span><span class="err">but</span><span class="w"> </span><span class="err">no</span><span class="w"> </span><span class="err">other</span><span class="w"> </span><span class="err">service.</span><span class="w">
</span><span class="err">//</span><span class="w">  </span><span class="err">All</span><span class="w"> </span><span class="err">SCPs</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">parent</span><span class="w"> </span><span class="err">OUs</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">root</span><span class="w"> </span><span class="err">also</span><span class="w"> </span><span class="err">must</span><span class="w"> </span><span class="err">explicitly</span><span class="w"> </span><span class="err">allow</span><span class="w"> </span><span class="err">these</span><span class="w"> </span><span class="err">permissions.</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"ec2:*"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"cloudwatch:*"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><hr /><h2 id="scp-syntax">SCP syntax</h2><p>Elements summary</p><div class="table-wrapper"><table><thead><tr><th>Element<th>Purpose<th>Supported effects<tbody><tr><td>Version<td>Specifies the language syntax rules to use for processing the policy.<td><code class="language-plaintext highlighter-rouge">Allow</code>, <code class="language-plaintext highlighter-rouge">Deny</code><tr><td>Statement<td>Serves as the container for policy elements. You can have multiple statements in SCPs.<td><code class="language-plaintext highlighter-rouge">Allow</code>, <code class="language-plaintext highlighter-rouge">Deny</code><tr><td>Statement ID (Sid)<td>(Optional) Provides a friendly name for the statement.<td><code class="language-plaintext highlighter-rouge">Allow</code>, <code class="language-plaintext highlighter-rouge">Deny</code><tr><td>Effect<td>Defines whether the SCP statement <code class="language-plaintext highlighter-rouge">allows</code> or <code class="language-plaintext highlighter-rouge">denies</code> access to the IAM users and roles in an account.<td><code class="language-plaintext highlighter-rouge">Allow</code>, <code class="language-plaintext highlighter-rouge">Deny</code><tr><td>Action<td>Specifies AWS service and actions that the SCP allows or denies.<td><code class="language-plaintext highlighter-rouge">Allow</code>, <code class="language-plaintext highlighter-rouge">Deny</code><tr><td>NotAction<td>Specifies AWS service and actions that are exempt from the SCP. Used instead of the <code class="language-plaintext highlighter-rouge">Action</code> element.<td><code class="language-plaintext highlighter-rouge">Deny</code><tr><td>Resource<td>Specifies the AWS resources that the SCP applies to.<td><code class="language-plaintext highlighter-rouge">Deny</code><tr><td>Condition<td>Specifies conditions for when the statement is in effect.<td><code class="language-plaintext highlighter-rouge">Deny</code></table></div><hr /><h3><code class="language-plaintext highlighter-rouge">*</code></h3><p>It is case sensitivity in SCP</p><ul><li>the Action and NotAction are case sensitive and must be typed as shown in each service’s documentation.</ul><p>can use an asterisk (<code class="language-plaintext highlighter-rouge">*</code>) as a wildcard to match multiple actions that share part of a name,</p><ul><li>however, the wildcard characters (<code class="language-plaintext highlighter-rouge">*</code>) and (<code class="language-plaintext highlighter-rouge">?</code>) in an Action or NotAction element can be used <code class="language-plaintext highlighter-rouge">only by itself</code> or <code class="language-plaintext highlighter-rouge">at the end of the string</code>.<li>It can’t appear at the beginning or middle of the string.<li><code class="language-plaintext highlighter-rouge">"servicename:action*"</code> is valid,<li>but <code class="language-plaintext highlighter-rouge">"servicename:*action"</code> and <code class="language-plaintext highlighter-rouge">"servicename:some*action"</code> are both invalid in SCPs.</ul><h3 id="version-element"><code class="language-plaintext highlighter-rouge">Version</code> element</h3><ul><li>Every SCP must include a <code class="language-plaintext highlighter-rouge">Version</code> element with the value <code class="language-plaintext highlighter-rouge">"2012-10-17"</code>.<li>This is the same version value as the most recent version of IAM permission policies.</ul><p><code class="language-plaintext highlighter-rouge">"Version": "2012-10-17",</code></p><hr /><h3 id="statement-element"><code class="language-plaintext highlighter-rouge">Statement</code> element</h3><ul><li>An SCP consists of one or more <code class="language-plaintext highlighter-rouge">Statement</code> elements.<li>can have only one <code class="language-plaintext highlighter-rouge">Statement</code> keyword in a policy,<ul><li>but the value can be a JSON array of statements (surrounded by <code class="language-plaintext highlighter-rouge">[ ]</code> characters).<li>single statement consists of single <code class="language-plaintext highlighter-rouge">Effect</code>, <code class="language-plaintext highlighter-rouge">Action</code>, and <code class="language-plaintext highlighter-rouge">Resource</code> elements.</ul></ul><div class="language-json highlighter-rouge"><div class="code-header" text-data="json"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="err">//</span><span class="w"> </span><span class="err">two</span><span class="w"> </span><span class="err">statements</span><span class="w"> </span><span class="err">as</span><span class="w"> </span><span class="err">an</span><span class="w"> </span><span class="err">array</span><span class="w"> </span><span class="err">list</span><span class="w"> </span><span class="err">inside</span><span class="w"> </span><span class="err">one</span><span class="w"> </span><span class="err">`Statement`</span><span class="w"> </span><span class="err">element.</span><span class="w">

</span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deny"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ec2:*"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
        </span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><hr /><h3 id="statement-id-sid-element">Statement ID (<code class="language-plaintext highlighter-rouge">Sid</code>) element</h3><ul><li>optional identifier that you provide for the policy statement.<li>You can assign a <code class="language-plaintext highlighter-rouge">Sid</code> value to each statement in a statement array.<li>The following example SCP shows a sample <code class="language-plaintext highlighter-rouge">Sid</code> statement.</ul><div class="language-json highlighter-rouge"><div class="code-header" text-data="json"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AllowsAllActions"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><hr /><h3 id="effect-element"><code class="language-plaintext highlighter-rouge">Effect</code> element</h3><p>Each statement must contain one <code class="language-plaintext highlighter-rouge">Effect</code> element.</p><ul><li>The value can be either <code class="language-plaintext highlighter-rouge">Allow</code> or <code class="language-plaintext highlighter-rouge">Deny</code>.<li>It affects any actions listed in the same statement.</ul><p>Even though this statement uses the same <code class="language-plaintext highlighter-rouge">Allow</code> value keyword as an IAM permission policy, in an SCP it doesn’t actually grant a user permission to do anything.</p><ul><li>Instead, SCPs act as filters that specify the maximum permissions for the accounts in an organization, organizational unit (OU), or account.<li>even if a user in the account had the <code class="language-plaintext highlighter-rouge">AdministratorAccess</code> managed policy attached, this SCP limits <strong>all</strong> users in affected accounts to only Amazon S3 actions.</ul><hr /><h4 id="effect-allow"><code class="language-plaintext highlighter-rouge">"Effect": "Allow"</code></h4><ul><li>permits account users to perform actions for the Amazon S3 service.</ul><div class="language-json highlighter-rouge"><div class="code-header" text-data="json"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="err">//</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">statement</span><span class="w"> </span><span class="err">allows</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">Amazon</span><span class="w"> </span><span class="err">S</span><span class="mi">3</span><span class="w"> </span><span class="err">permissions</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">any</span><span class="w"> </span><span class="err">attached</span><span class="w"> </span><span class="err">accounts:</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3:*"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><hr /><h3 id="effect-deny"><code class="language-plaintext highlighter-rouge">"Effect": "Deny"</code></h3><ul><li>restrict access to specific resources or define conditions for when SCPs are in effect.</ul><div class="language-json highlighter-rouge"><div class="code-header" text-data="json"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deny"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ec2:RunInstances"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:ec2:*:*:instance/*"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Condition"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"StringNotEquals"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"ec2:InstanceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"t2.micro"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">prevent</span><span class="w"> </span><span class="err">affected</span><span class="w"> </span><span class="err">accounts</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">launching</span><span class="w"> </span><span class="err">Amazon</span><span class="w"> </span><span class="err">EC</span><span class="mi">2</span><span class="w"> </span><span class="err">instances</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">Amazon</span><span class="w"> </span><span class="err">EC</span><span class="mi">2</span><span class="w"> </span><span class="err">instance</span><span class="w"> </span><span class="err">isn't</span><span class="w"> </span><span class="err">set</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">`t</span><span class="mi">2</span><span class="err">.micro`.</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">Even</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">an</span><span class="w"> </span><span class="err">IAM</span><span class="w"> </span><span class="err">policy</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">allows</span><span class="w"> </span><span class="err">this</span><span class="w"> </span><span class="err">action</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">attached</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">account,</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">guardrail</span><span class="w"> </span><span class="err">created</span><span class="w"> </span><span class="err">by</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">SCP</span><span class="w"> </span><span class="err">prevents</span><span class="w"> </span><span class="err">it.</span><span class="w">
</span></pre></table></code></div></div><hr /><h3 id="action-and-notaction-elements"><code class="language-plaintext highlighter-rouge">Action</code> and <code class="language-plaintext highlighter-rouge">NotAction</code> elements</h3><hr /><p>Each statement must contain one of the following:</p><ul><li><p>In <code class="language-plaintext highlighter-rouge">allow</code> and <code class="language-plaintext highlighter-rouge">deny</code> statements, an <code class="language-plaintext highlighter-rouge">Action</code> element.</p><li><p>In <code class="language-plaintext highlighter-rouge">deny</code> statements only, an <code class="language-plaintext highlighter-rouge">Action</code> or <code class="language-plaintext highlighter-rouge">NotAction</code> element.</p></ul><p>The value for the <code class="language-plaintext highlighter-rouge">Action</code> or <code class="language-plaintext highlighter-rouge">NotAction</code> element is</p><ul><li>a list (a JSON array) of strings<ul><li>identify AWS services and actions that are allowed or denied by the statement.<li>Each string consists of the abbreviation for the service (such as “s3”, “ec2”, “iam”, or “organizations”), in all lowercase,<li>followed by a colon<li>and then an action from that service.</ul><li>The actions and notactions are case sensitive<ul><li>must be typed as shown in each service’s documentation.<li>Generally, they are all typed with each word starting with an uppercase letter and the rest lowercase.<li>For example: <code class="language-plaintext highlighter-rouge">"s3:ListAllMyBuckets"</code>.</ul><li>use an asterisk as a wildcard to match multiple actions that share part of a name.<ul><li>The value <code class="language-plaintext highlighter-rouge">"s3:*"</code> means all actions in the Amazon S3 service.<li>The value <code class="language-plaintext highlighter-rouge">"ec2:Describe*"</code> matches only the EC2 actions that begin with “Describe”.<li>In an SCP, the wildcard <code class="language-plaintext highlighter-rouge">*</code> character in an <code class="language-plaintext highlighter-rouge">Action</code> or <code class="language-plaintext highlighter-rouge">NotAction</code> element<ul><li>can be used only by itself or at the end of the string.<li>It can’t appear at the beginning or middle of the string.<ul><li><code class="language-plaintext highlighter-rouge">"servicename:action*"</code> is valid,<li><code class="language-plaintext highlighter-rouge">"servicename:*action"</code> and <code class="language-plaintext highlighter-rouge">"servicename:some*action"</code> are both invalid in SCPs.</ul></ul></ul></ul><p>list of all the services and the actions that they support in both AWS Organizations SCPs and IAM permission policies</p><ul><li><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/referencepoliciesactionsconditions.html">Actions, Resources, and Condition Keys for AWS Services</a> in the IAM User Guide.</ul><h4 id="action-element"><code class="language-plaintext highlighter-rouge">Action</code> element</h4><p>an example of an allow list</p><ul><li>useful when the default <code class="language-plaintext highlighter-rouge">Allow *</code> policies are not attached so that ermissions are implicitly denied.<li>If the default <code class="language-plaintext highlighter-rouge">Allow *</code> policy is still attached, the policy has no effect.</ul><div class="language-json highlighter-rouge"><div class="code-header" text-data="json"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="err">//</span><span class="w"> </span><span class="err">permits</span><span class="w"> </span><span class="err">account</span><span class="w"> </span><span class="err">administrators</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">delegate</span><span class="w"> </span><span class="err">describe,</span><span class="w"> </span><span class="err">start,</span><span class="w"> </span><span class="err">stop,</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">terminate</span><span class="w"> </span><span class="err">permissions</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">EC</span><span class="mi">2</span><span class="w"> </span><span class="err">instances</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">account.</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"ec2:DescribeInstances"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"ec2:DescribeImages"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"ec2:DescribeKeyPairs"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"ec2:DescribeSecurityGroups"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"ec2:DescribeAvailabilityZones"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"ec2:RunInstances"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"ec2:TerminateInstances"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"ec2:StopInstances"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"ec2:StartInstances"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>an example of an deny list</p><ul><li>deny access to services that you don’t want used in attached accounts.<li>It assumes that the default <code class="language-plaintext highlighter-rouge">"Allow *"</code> SCPs are still attached to all OUs and the root.</ul><div class="language-json highlighter-rouge"><div class="code-header" text-data="json"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="err">//</span><span class="w"> </span><span class="err">prevents</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">account</span><span class="w"> </span><span class="err">administrators</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">attached</span><span class="w"> </span><span class="err">accounts</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">delegating</span><span class="w"> </span><span class="err">any</span><span class="w"> </span><span class="err">permissions</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">IAM,</span><span class="w"> </span><span class="err">Amazon</span><span class="w"> </span><span class="err">EC</span><span class="mi">2</span><span class="err">,</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">Amazon</span><span class="w"> </span><span class="err">RDS</span><span class="w"> </span><span class="err">services.</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">Any</span><span class="w"> </span><span class="err">action</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">other</span><span class="w"> </span><span class="err">services</span><span class="w"> </span><span class="err">can</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">delegated</span><span class="w"> </span><span class="err">as</span><span class="w"> </span><span class="err">long</span><span class="w"> </span><span class="err">as</span><span class="w"> </span><span class="err">there</span><span class="w"> </span><span class="err">isn't</span><span class="w"> </span><span class="err">another</span><span class="w"> </span><span class="err">attached</span><span class="w"> </span><span class="err">policy</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">denies</span><span class="w"> </span><span class="err">them.</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deny"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"iam:*"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ec2:*"</span><span class="p">,</span><span class="w"> </span><span class="s2">"rds:*"</span><span class="w"> </span><span class="p">],</span><span class="w">
        </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><hr /><h3 id="example-of-notaction-element-">Example of <code class="language-plaintext highlighter-rouge">NotAction</code> element ???</h3><ul><li>use a <code class="language-plaintext highlighter-rouge">NotAction</code> element to exclude AWS services from the effect of the policy.</ul><div class="language-json highlighter-rouge"><div class="code-header" text-data="json"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LimitActionsInRegion"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deny"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"NotAction"</span><span class="p">:</span><span class="w"> </span><span class="s2">"iam:*"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Condition"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"StringNotEquals"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"aws:RequestedRegion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"us-west-1"</span><span class="w">
         </span><span class="p">}</span><span class="w">
       </span><span class="p">}</span><span class="w">
     </span><span class="p">}</span><span class="w">
   </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">affected</span><span class="w"> </span><span class="err">accounts</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">limited</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">taking</span><span class="w"> </span><span class="err">actions</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">specified</span><span class="w"> </span><span class="err">AWS</span><span class="w"> </span><span class="err">Region,</span><span class="w"> </span><span class="err">except</span><span class="w"> </span><span class="err">when</span><span class="w"> </span><span class="err">using</span><span class="w"> </span><span class="err">IAM</span><span class="w"> </span><span class="err">actions.</span><span class="w">
</span></pre></table></code></div></div><hr /><h3 id="resource-element"><code class="language-plaintext highlighter-rouge">Resource</code> element</h3><p>In statements <code class="language-plaintext highlighter-rouge">Effect</code> element has a value of <code class="language-plaintext highlighter-rouge">Allow</code></p><ul><li>you can specify only <code class="language-plaintext highlighter-rouge">\*</code> in the <code class="language-plaintext highlighter-rouge">Resource</code> element of an SCP ???<li>You can’t specify individual resource Amazon Resource Names (ARNs).</ul><p>In statements <code class="language-plaintext highlighter-rouge">Effect</code> element has a value of <code class="language-plaintext highlighter-rouge">Deny</code></p><ul><li>you can specify individual ARNs</ul><div class="language-json highlighter-rouge"><div class="code-header" text-data="json"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DenyAccessToAdminRole"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deny"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"iam:AttachRolePolicy"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"iam:DeleteRole"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"iam:DeleteRolePermissionsBoundary"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"iam:DeleteRolePolicy"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"iam:DetachRolePolicy"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"iam:PutRolePermissionsBoundary"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"iam:PutRolePolicy"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"iam:UpdateAssumeRolePolicy"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"iam:UpdateRole"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"iam:UpdateRoleDescription"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"arn:aws:iam::*:role/`role-to-deny`"</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">SCP</span><span class="w"> </span><span class="err">restricts</span><span class="w"> </span><span class="err">IAM</span><span class="w"> </span><span class="err">users</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">roles</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">affected</span><span class="w"> </span><span class="err">accounts</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">making</span><span class="w"> </span><span class="err">changes</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">common</span><span class="w"> </span><span class="err">administrative</span><span class="w"> </span><span class="err">IAM</span><span class="w"> </span><span class="err">role</span><span class="w"> </span><span class="err">created</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">all</span><span class="w"> </span><span class="err">accounts</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">your</span><span class="w"> </span><span class="err">organization.</span><span class="w">
</span></pre></table></code></div></div><hr /><h3 id="condition-element"><code class="language-plaintext highlighter-rouge">Condition</code> element</h3><p>You can specify a <code class="language-plaintext highlighter-rouge">Condition</code> element in <font color="red"> deny statements </font> in an SCP.</p><div class="language-json highlighter-rouge"><div class="code-header" text-data="json"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DenyAllOutsideEU"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deny"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"NotAction"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"cloudfront:*"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"iam:*"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"route53:*"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"support:*"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Condition"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"StringNotEquals"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"aws:RequestedRegion"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"eu-central-1"</span><span class="p">,</span><span class="s2">"eu-west-1"</span><span class="p">]</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">SCP</span><span class="w"> </span><span class="err">denies</span><span class="w"> </span><span class="err">access</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">any</span><span class="w"> </span><span class="err">operations</span><span class="w"> </span><span class="err">outside</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">`eu-central</span><span class="mi">-1</span><span class="err">`</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">`eu-west</span><span class="mi">-1</span><span class="err">`</span><span class="w"> </span><span class="err">Regions</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">except</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">actions</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">listed</span><span class="w"> </span><span class="err">services.</span><span class="w">
</span></pre></table></code></div></div><p>For more information, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/referencepolicieselementscondition.html">IAM JSON Policy Elements: Condition</a> in the IAM User Guide.</p><h4 id="multiple-condition">multiple condition</h4><p>PolicyA: <strong>Deny CreateNotebookInstance if both value is “Enabled”</strong></p><ul><li>if both parameter are missing (null), API been denied<li>if one parameter is missing, API been denied<li>if both parameter existed and are “Enabled” (are not “Disabled”), API been denied<li>if both parameter existed and are “Disabled” (are not “Enabled”), API Pass.</ul><div class="language-json highlighter-rouge"><div class="code-header" text-data="json"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deny"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sagemaker:CreateNotebookInstance"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Condition"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"StringEquals"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"sagemaker:DirectInternetAccess"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deny"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sagemaker:CreateNotebookInstance"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Condition"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"StringEquals"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"sagemaker:RootAccess"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><hr /><p>PolicyB: <strong>Deny CreateNotebookInstance and UpdateNotebookInstance if any of the values is not “Disabled”</strong></p><ul><li><p>if both parameter are null, 2 APIs been denied</p><li>if <code class="language-plaintext highlighter-rouge">DirectInternetAccess</code> is null and the other is <code class="language-plaintext highlighter-rouge">Enabled</code>, 2 APIs been denied<li><p>if <code class="language-plaintext highlighter-rouge">DirectInternetAccess</code> is null and the other is <code class="language-plaintext highlighter-rouge">Disabled</code>, only “CreateNotebookInstance” been denied</p><li>if <code class="language-plaintext highlighter-rouge">RootAccess</code> is null and the other is <code class="language-plaintext highlighter-rouge">Enabled</code>, 2 APIs been denied<li><p>if <code class="language-plaintext highlighter-rouge">RootAccess</code> is null and the other is <code class="language-plaintext highlighter-rouge">Disabled</code>, 2 APIs been denied</p><li>if both parameter existed and are <code class="language-plaintext highlighter-rouge">Enabled</code> (are not <code class="language-plaintext highlighter-rouge">Disabled</code>), 2 APIs been denied<li>if both parameter existed and are <code class="language-plaintext highlighter-rouge">Disabled</code> (are not <code class="language-plaintext highlighter-rouge">Enabled</code>), 2 APIs Pass.</ul><div class="language-json highlighter-rouge"><div class="code-header" text-data="json"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deny"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sagemaker:CreateNotebookInstance"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Condition"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"StringNotEquals"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"sagemaker:DirectInternetAccess"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Disabled"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deny"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"sagemaker:CreateNotebookInstance"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"sagemaker:UpdateNotebookInstance"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Condition"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"StringNotEquals"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"sagemaker:RootAccess"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Disabled"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><hr /><p><strong>Duplicate String Operator is not allowed as per JSON syntax</strong></p><p>PolicyC:</p><ul><li>if both parameter are null, 2 APIs been denied (?)<li>if one parameter is null and the other is <code class="language-plaintext highlighter-rouge">Enabled</code>, 2 APIs been denied (?)<li>if one parameter is null and the other is <code class="language-plaintext highlighter-rouge">Disabled</code>, 2 APIs been denied (?)<li>if both parameter existed and are “Enabled” (are not “Disabled”), 2 APIs been denied<li>if both parameter existed and are “Disabled” (are not “Enabled”), 2 APIs Pass.</ul><div class="language-json highlighter-rouge"><div class="code-header" text-data="json"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deny"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sagemaker:CreateNotebookInstance"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Condition"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"StringNotEquals"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"sagemaker:DirectInternetAccess"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Disabled"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"StringNotEquals"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"sagemaker:RootAccess"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Disabled"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">policy</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">not</span><span class="w"> </span><span class="err">valid</span><span class="w"> </span><span class="err">since</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">has</span><span class="w"> </span><span class="err">Duplicate</span><span class="w"> </span><span class="err">“StringNotEquals”</span><span class="w"> </span><span class="err">operator.</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">After</span><span class="w"> </span><span class="err">saving</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">SCP</span><span class="w"> </span><span class="err">policy</span><span class="w"> </span><span class="err">console</span><span class="w"> </span><span class="err">automatically</span><span class="w"> </span><span class="err">removed</span><span class="w"> </span><span class="err">duplicate</span><span class="w"> </span><span class="err">condition</span><span class="w"> </span><span class="err">(“ForAnyValue:StringNotEquals</span><span class="s2">": { "</span><span class="err">sagemaker:DirectInternetAccess</span><span class="s2">": “Disabled”) from the SCP policy.


{
  "</span><span class="err">Version</span><span class="s2">": "</span><span class="mi">2012-10-17</span><span class="s2">",
  "</span><span class="err">Statement</span><span class="s2">": [
    {
      "</span><span class="err">Effect</span><span class="s2">": "</span><span class="err">Deny</span><span class="s2">",
      "</span><span class="err">Action</span><span class="s2">": "</span><span class="err">sagemaker:CreateNotebookInstance</span><span class="s2">",
      "</span><span class="err">Resource</span><span class="s2">": "</span><span class="err">*</span><span class="s2">",
      "</span><span class="err">Condition</span><span class="s2">": {
        "</span><span class="err">StringNotEquals</span><span class="s2">": {
          "</span><span class="err">sagemaker:DirectInternetAccess</span><span class="s2">": "</span><span class="err">Disabled</span><span class="s2">"
        },
        "</span><span class="err">StringEquals</span><span class="s2">": {
          "</span><span class="err">sagemaker:RootAccess</span><span class="s2">": "</span><span class="err">Disabled</span><span class="s2">"
        }
      }
    }
  ]
}
// In the above policy, AND logic will be applied
// the API call will only be allowed when “DirectInternetAccess” is “Enabled” since it’s used with “StringNotEquals” operator and “RootAccess” is “Disabled” since it is used with “StringEquals” operator.

Result:
- DirectInternetAccess -&gt; Enabled ----------------&gt; Deny
- RootAccess -&gt; Disabled

- DirectInternetAccess -&gt; Enabled ———-—————&gt; Allow
- RootAccess -&gt; Enabled

- DirectInternetAccess -&gt; Disabled --------------&gt; Allow
- RootAccess -&gt; Enabled

- DirectInternetAccess -&gt; Disabled ----------------&gt; Allow
- RootAccess -&gt; Disabled
</span></pre></table></code></div></div><hr /><p>PolicyD: Good</p><ul><li>if both parameter are null, 2 APIs been denied (?)<li>if one parameter is null and the other is <code class="language-plaintext highlighter-rouge">Enabled</code>, 2 APIs been denied (?)<li>if one parameter is null and the other is <code class="language-plaintext highlighter-rouge">Disabled</code>, 2 APIs been denied (?)<li>if both parameter existed and are “Enabled” (are not “Disabled”), 2 APIs been denied<li>if both parameter existed and are “Disabled” (are not “Enabled”), 2 APIs Pass.</ul><div class="language-json highlighter-rouge"><div class="code-header" text-data="json"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deny"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sagemaker:CreateNotebookInstance"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Condition"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"StringNotEquals"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"sagemaker:DirectInternetAccess"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Disabled"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"sagemaker:RootAccess"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Disabled"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">You</span><span class="w"> </span><span class="err">need</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">select</span><span class="w"> </span><span class="err">“Enabled”</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">“Disabled”</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">not,</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">take</span><span class="w"> </span><span class="err">default</span><span class="w"> </span><span class="err">value</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">keys</span><span class="w"> </span><span class="err">which</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">“Enabled”.</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">either</span><span class="w"> </span><span class="err">parameter</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">`Disabled`,</span><span class="w"> </span><span class="err">allow</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">both</span><span class="w"> </span><span class="err">parameter</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">`Enabled`</span><span class="w"> </span><span class="err">(are</span><span class="w"> </span><span class="err">not</span><span class="w"> </span><span class="err">`Disabled`),</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="err">APIs</span><span class="w"> </span><span class="err">been</span><span class="w"> </span><span class="err">denied</span><span class="w">
</span></pre></table></code></div></div><hr /><p>PolicyE:</p><ul><li>if both parameter are null, 2 APIs been denied (?)<li>if one parameter is null and the other is <code class="language-plaintext highlighter-rouge">Enabled</code>, 2 APIs been denied (?)<li>if one parameter is null and the other is <code class="language-plaintext highlighter-rouge">Disabled</code>, 2 APIs been denied (?)<li>if both parameter existed and are “Enabled” (are not “Disabled”), 2 APIs been denied<li>if both parameter existed and are “Disabled” (are not “Enabled”), 2 APIs Pass. ```json { “Version”: “2012-10-17”, “Statement”: [ { “Effect”: “Deny”, “Action”: [ “sagemaker:CreateNotebookInstance”, “sagemaker:UpdateNotebookInstance” ], “Resource”: “*”, “Condition”: { “StringNotEquals”: { “sagemaker:DirectInternetAccess”: “Disabled”, “sagemaker:RootAccess”: “Disabled” } } } ] }</ul><p>// - if both parameter are <code class="language-plaintext highlighter-rouge">Disabled</code> allow // - if one parameter are <code class="language-plaintext highlighter-rouge">Enabled</code>, allow // - if both parameter are <code class="language-plaintext highlighter-rouge">Enabled</code> (not <code class="language-plaintext highlighter-rouge">Disabled</code>), 2 APIs been denied ```</p><hr /><h3 id="unsupported-elements">Unsupported elements</h3><p>The following elements aren’t supported in SCPs:</p><ul><li><code class="language-plaintext highlighter-rouge">Principal</code><li><code class="language-plaintext highlighter-rouge">NotPrincipal</code><li><code class="language-plaintext highlighter-rouge">NotResource</code></ul><p>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/01aws/'>01AWS</a>, <a href='/categories/idenaccessmanage/'>IdenAccessManage</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/aws/" class="post-tag no-text-decoration" >AWS</a> <a href="/tags/idenaccessmanage/" class="post-tag no-text-decoration" >IdenAccessManage</a> <a href="/tags/scps/" class="post-tag no-text-decoration" >SCPs</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=AWS - IdenAccessManage - SCPs (Service Control Policies) - Grace&url=https://ocholuo.github.io//posts/SCPs/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=AWS - IdenAccessManage - SCPs (Service Control Policies) - Grace&u=https://ocholuo.github.io//posts/SCPs/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=AWS - IdenAccessManage - SCPs (Service Control Policies) - Grace&url=https://ocholuo.github.io//posts/SCPs/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Amazon-CloudFront/">AWS Lab - AWS CloudFront</a><li><a href="/posts/Alexa-1stSkill/">AWS Alex First Skill - RedVelvet Time</a><li><a href="/posts/NetworkProtocol-SSL-TLS-Handshake/">NetworkProtocol SSL/TLS Handshake</a><li><a href="/posts/pythonCrash/">Python Crash</a><li><a href="/posts/%E4%B8%80%E5%8F%A5%E8%AF%9D%E8%A7%A3%E9%87%8AAWS/">AWS - 一句话解释AWS</a><li><a href="/posts/GKE/">GCP - Google Cloud Computing - Kubernetes and Kubernetes Engine</a><li><a href="/posts/Go-Note/">Go Note</a><li><a href="/posts/SCPs/">AWS - IdenAccessManage - SCPs (Service Control Policies)</a><li><a href="/posts/CompanyBenefit/">Company Benefit</a><li><a href="/posts/Encryption-SSL&TLS/">Cryptography - SSL/TLS Encryption</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/cyberattack/">CyberAttack</a> <a class="post-tag" href="/tags/lab/">Lab</a> <a class="post-tag" href="/tags/cyberattacktools/">CyberAttackTools</a> <a class="post-tag" href="/tags/gcp/">GCP</a> <a class="post-tag" href="/tags/sysadmin/">Sysadmin</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/soc/">SOC</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/SCPs-Policy-inheritance/"><div class="card-body"> <span class="timeago small" >Jul 18, 2020<i class="unloaded">2020-07-18T11:11:11-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS - IdenAccessManage - SCPs policy inheritance</h3><div class="text-muted small"><p> [toc] SCPs policy inheritance attach policies to organization entities (organization root, organizational unit (OU), or account) in your organization: attach a policy to the organization r...</p></div></div></a></div><div class="card"> <a href="/posts/SCPs-template/"><div class="card-body"> <span class="timeago small" >Jul 18, 2020<i class="unloaded">2020-07-18T11:11:11-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS - IdenAccessManage - SCPs Template</h3><div class="text-muted small"><p> [toc] SCPs Template General Example Example: Deny access to AWS based on the requested AWS Region This SCP denies access to any operations outside of the specified Regions. ...</p></div></div></a></div><div class="card"> <a href="/posts/IAM-Service/"><div class="card-body"> <span class="timeago small" >Jul 18, 2020<i class="unloaded">2020-07-18T11:11:11-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS - IdenAccessManage - AWS services that work with IAM</h3><div class="text-muted small"><p> AWS services that work with IAM Compute services Containers services Storage services Database services Developer tools services Security, identity, and ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/SCPs-template/" class="btn btn-outline-primary" prompt="Older"><p>AWS - IdenAccessManage - SCPs Template</p></a> <a href="/posts/SNS/" class="btn btn-outline-primary" prompt="Newer"><p>AWS - MQ - SAM</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/ocholuo">Grace JyL</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/cyberattack/">CyberAttack</a> <a class="post-tag" href="/tags/lab/">Lab</a> <a class="post-tag" href="/tags/cyberattacktools/">CyberAttackTools</a> <a class="post-tag" href="/tags/gcp/">GCP</a> <a class="post-tag" href="/tags/sysadmin/">Sysadmin</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/soc/">SOC</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://ocholuo.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script async src="https://cdn.jsdelivr.net/npm/countup.js@1.9.3/dist/countUp.min.js"></script> <script defer src="/assets/js/dist/pvreport.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-179830187-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-179830187-1'); }); </script>
