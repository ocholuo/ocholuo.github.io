<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="pv-proxy-endpoint" content="https://myochosite-291718.appspot.com/query?id=ahNwfm15b2Nob3NpdGUtMjkxNzE4chULEghBcGlRdWVyeRiAgIDo14eBCgw"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="AWS Lab - for SAA" /><meta property="og:locale" content="en" /><meta name="description" content="Lab for SAA" /><meta property="og:description" content="Lab for SAA" /><link rel="canonical" href="https://ocholuo.github.io//posts/Lab-AWSCloudSolutionArchitect/" /><meta property="og:url" content="https://ocholuo.github.io//posts/Lab-AWSCloudSolutionArchitect/" /><meta property="og:site_name" content="Grace" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-07-16T11:11:11-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="AWS Lab - for SAA" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-07-16T11:11:11-04:00","datePublished":"2020-07-16T11:11:11-04:00","description":"Lab for SAA","headline":"AWS Lab - for SAA","mainEntityOfPage":{"@type":"WebPage","@id":"https://ocholuo.github.io//posts/Lab-AWSCloudSolutionArchitect/"},"url":"https://ocholuo.github.io//posts/Lab-AWSCloudSolutionArchitect/"}</script><title>AWS Lab - for SAA | Grace</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Grace"><meta name="application-name" content="Grace"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://myochosite-291718.appspot.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://myochosite-291718.appspot.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/huoye.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Grace</a></div><div class="site-subtitle font-italic">2023 Mar 14 updated</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/ocholuo" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>AWS Lab - for SAA</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>AWS Lab - for SAA</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Grace JyL </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Jul 16, 2020, 11:11 AM -0400" >Jul 16, 2020<i class="unloaded">2020-07-16T11:11:11-04:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3872 words">21 min read</span> <span id="pv" class="pageviews"> <i class="fas fa-spinner fa-spin fa-fw"></i> </span> views</div></div><div class="post-content"><h1 id="lab-for-saa">Lab for SAA</h1><ul><li><a href="#lab-for-saa">Lab for SAA</a><li><a href="#lab-1-making-your-environment-highly-available">lab 1: Making Your Environment Highly Available</a><ul><li><a href="#task-1-inspect-your-environment">Task 1: Inspect Your environment</a><li><a href="#task-2-login-to-ec2-instance">Task 2: Login to EC2 instance</a><li><a href="#task-3-download-install-and-launch-your-web-servers-php-application">Task 3: Download, Install, and Launch Your Web Server’s PHP Application</a><li><a href="#task-4-create-an-amazon-machine-image-ami">Task 4: Create an Amazon Machine Image (AMI)</a><li><a href="#task-5-configure-a-second-availability-zone">Task 5: Configure a Second Availability Zone</a><li><a href="#task-6-create-an-application-load-balancer">Task 6: Create an Application Load Balancer</a><li><a href="#task-7-create-an-auto-scaling-group">Task 7: Create an Auto Scaling Group</a><li><a href="#task-8-test-the-application">Task 8: Test the Application</a><li><a href="#task-9-test-high-availability">Task 9: Test High Availability</a></ul><li><a href="#lab2-using-notifications-to-trigger-aws-lambda">lab2: Using Notifications to Trigger AWS Lambda</a><ul><li><a href="#task-1-create-an-sns-topic">Task 1: Create an SNS Topic</a><li><a href="#task-2-configure-auto-scaling-to-send-events">Task 2: Configure Auto Scaling to Send Events</a><li><a href="#task-3-an-iam-role-for-the-lambda-function">Task 3: An IAM Role for the Lambda function</a><li><a href="#task-4-create-a-lambda-function">Task 4: Create a Lambda Function</a><li><a href="#task-5-scale-out-the-auto-scaling-group-to-trigger-the-lambda-function">Task 5: Scale-Out the Auto Scaling Group to Trigger the Lambda function</a></ul><li><a href="#lab-7-implementing-a-serverless-architecture-with-aws-managed-services">lab 7 Implementing a Serverless Architecture with AWS Managed Services</a><ul><li><a href="#task-1-create-a-lambda-function-to-process-a-transactions-file">Task 1: Create a Lambda Function to Process a Transactions File</a><li><a href="#task-2-create-a-lambda-function-to-calculate-transaction-totals-and-notify-about-high-account-balances">Task 2: Create a Lambda Function to Calculate Transaction Totals and Notify About High Account Balances</a><li><a href="#task-3-create-a-simple-notification-service-sns-topic">Task 3: Create a Simple Notification Service (SNS) Topic</a><li><a href="#task-4-create-two-simple-queue-service-queues">Task 4: Create Two Simple Queue Service Queues</a><li><a href="#task-5-testing-the-serverless-architecture-by-uploading-a-transactions-file">Task 5: Testing the Serverless Architecture by Uploading a Transactions File</a></ul><li><a href="#lab-8-multi-region-failover-with-amazon-route-53">lab 8: multi-Region failover with Amazon Route 53</a><ul><li><a href="#task-1-inspect-your-environment-1">Task 1: Inspect Your Environment</a><li><a href="#task-2-configure-a-health-check">Task 2: Configure a Health Check</a><li><a href="#task-3-configure-your-domain-in-route-53">Task 3: Configure your Domain in Route 53</a><li><a href="#task-4-check-the-dns-resolution">Task 4: Check the DNS Resolution</a><li><a href="#task-5---test-your-failover">Task 5 - Test Your Failover</a></ul></ul><hr /><h1 id="lab-1-making-your-environment-highly-available">lab 1: Making Your Environment Highly Available</h1><p>Objectives Create an image of an existing Amazon EC2 instance and use it to launch new instances. Expand an Amazon VPC to additional Availability Zones. Create VPC Subnets and Route Tables. Create an AWS NAT Gateway. Create a Load Balancer. Create an Auto Scaling group.</p><p><img data-proofer-ignore data-src="https://i.imgur.com/4BEx0e4.jpg" alt="P1" /></p><h2 id="task-1-inspect-your-environment">Task 1: Inspect Your environment</h2><p>This lab begins with an environment already deployed via AWS CloudFormation including:</p><ul><li>An Amazon VPC<li>A public subnet and a private subnet in one Availability Zone<li>An Internet Gateway associated with the public subnet<li>A NAT Gateway in the public subnet<li>An Amazon EC2 instance in the public subnet</ul><p><img data-proofer-ignore data-src="https://i.imgur.com/goKUVbr.jpg" alt="P2" /></p><hr /><p><strong>Task 1.1: Inspect Your VPC</strong></p><ol><li>AWS Management Console &gt; Services menu &gt; VPC &gt; Your VPCs.<ul><li>In the IPv4 CIDR column: 10.200.0.0/20, which means this VPC includes 4,096 IPs between 10.200.0.0 and 10.200.15.255 (with some reserved and unusable).<li>also attached to a Route Table and a Network ACL.<li>also has a Tenancy of default, instances launched into this VPC will by default use shared tenancy hardware.</ul><li>AWS Management Console &gt; Services menu &gt; VPC &gt; Subnets.<ul><li><strong>Public Subnet</strong> 1 subnet:<ul><li>VPC column, subnet exists inside of Lab VPC.<li>IPv4 CIDR column: 10.200.0.0/24, which means this subnet includes the 256 IPs (5 of which are reserved and unusable) between 10.200.0.0 and 10.200.0.255.<li>Availability Zone column: the Availability Zone in which this subnet resides.<li>Click on the row containing Public Subnet 1 to reveal more details at the bottom of the page.<li>Route Table tab<ul><li>Destination Target<li>10.200.0.0/20 local<li>0.0.0.0/0 igw-</ul><li>Network ACL tab<li><img data-proofer-ignore data-src="https://i.imgur.com/5Xbn8cW.png" width="500" /></ul></ul><li>AWS Management Console &gt; Services menu &gt; VPC &gt; <strong>Internet Gateways.</strong><ul><li><img data-proofer-ignore data-src="https://i.imgur.com/nYdD6Up.png" width="500" /></ul><li>AWS Management Console &gt; Services menu &gt; VPC &gt; <strong>Security Groups</strong><ul><li>Click Configuration Server SG.<ul><li>Inbound Rules tab<li><img data-proofer-ignore data-src="https://i.imgur.com/3b5gxv7.png" width="500" /><li>Outbound Rules tab.<li><img data-proofer-ignore data-src="https://i.imgur.com/PURZ7AQ.png" width="500" /> -</ul></ul></ol><p><strong>Task 1.2: Inspect Your Amazon EC2 Instance</strong></p><ol><li>Services menu &gt; EC2 &gt; click Instances.<ul><li>In the Actions menu, click Instance Settings &gt; View/Change User Data.<li>no User Data appears<li>the instance has not yet been configured to run your web application.<li>When launching an Amazon EC2 instance, you can provide a User Data script that is executed when the instance first starts and is used to configure the instance. However, in this lab you will configure the instance yourself!</ul></ol><h2 id="task-2-login-to-ec2-instance">Task 2: Login to EC2 instance</h2><div class="language-c highlighter-rouge"><div class="code-header" text-data="c"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">cd</span> <span class="o">~/</span><span class="n">Downloads</span>
<span class="n">chmod</span> <span class="mi">400</span> <span class="n">labsuser</span><span class="p">.</span><span class="n">pem</span>
<span class="n">ssh</span> <span class="o">-</span><span class="n">i</span> <span class="n">labsuser</span><span class="p">.</span><span class="n">pem</span> <span class="n">ec2</span><span class="o">-</span><span class="n">user</span><span class="err">@</span><span class="o">&lt;</span><span class="n">public</span><span class="o">-</span><span class="n">ip</span><span class="o">&gt;</span>
</pre></table></code></div></div><h2 id="task-3-download-install-and-launch-your-web-servers-php-application">Task 3: Download, Install, and Launch Your Web Server’s PHP Application</h2><div class="language-c highlighter-rouge"><div class="code-header" text-data="c"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="n">sudo</span> <span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="n">update</span>

<span class="n">sudo</span> <span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">httpd</span> <span class="n">php</span>
<span class="c1">// To install a package that creates a web server</span>

<span class="n">sudo</span> <span class="n">chkconfig</span> <span class="n">httpd</span> <span class="n">on</span>
<span class="c1">// configures the Apache web server to automatically start when the instance starts.</span>

<span class="n">wget</span> <span class="n">https</span><span class="o">:</span><span class="c1">//aws-tc-largeobjects.s3-us-west-2.amazonaws.com/CUR-TF-200-ACACAD/studentdownload/phpapp.zip</span>
<span class="c1">// downloads a zip file containing the PHP web application.</span>


<span class="n">sudo</span> <span class="n">unzip</span> <span class="n">phpapp</span><span class="p">.</span><span class="n">zip</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span>
<span class="c1">// unzips the PHP application into the default Apache web server directory.</span>

<span class="n">sudo</span> <span class="n">service</span> <span class="n">httpd</span> <span class="n">start</span>
<span class="c1">// This starts the Apache web server.</span>
</pre></table></code></div></div><p>Your web application is now configured</p><p>now access application to confirm that it is working.</p><p>The web application should appear and will display information about your location (actually, the location of your Amazon EC2 instance). This information is obtained from freegeoip.app.</p><p><img data-proofer-ignore data-src="https://i.imgur.com/4fX1Dnt.png" width="500" /></p><p>Return to your SSH session, execute the following command:</p><p>exit This ends your SSH session.</p><h2 id="task-4-create-an-amazon-machine-image-ami">Task 4: Create an Amazon Machine Image (AMI)</h2><p>web application is configured on your instance</p><p>to clone instances to run an application on multiple instances, even across multiple Availability Zones.</p><p>create an AMI from your Amazon EC2 instance. You will later use this image to launch additional, fully-configured instances to provide a Highly Available solution.</p><ol><li>EC2 Management Console &gt; Configuration Server is selected, and click Actions &gt; Image &gt; Create Image.<ul><li>a Root Volume is currently associated with the instance. This volume will be copied into the AMI.<li>For Image name, type: Web application<li>Leave other values at their default settings and click Create Image.<li><img data-proofer-ignore data-src="https://i.imgur.com/LwqrPal.png" width="500" /></ul></ol><h2 id="task-5-configure-a-second-availability-zone">Task 5: Configure a Second Availability Zone</h2><p>To build a highly available application, it is a best practice to launch resources in multiple Availability Zones.</p><p>duplicate your network environment into a second Availability Zone. You will create:</p><ul><li>A second public subnet<li>A second private subnet<li>A second NAT Gateway<li>A second private Route Table<li>2nd AZ<li><img data-proofer-ignore data-src="https://i.imgur.com/q6x7wWZ.jpg" width="500" /></ul><p><strong>Task 5.1: Create a second Public Subnet</strong></p><ol><li><p>Services menu &gt; VPC &gt; Subnets.</p><li><p>Create Subnet.</p><ul><li><img data-proofer-ignore data-src="https://i.imgur.com/M5vB5h4.png" width="500" /><li><img data-proofer-ignore data-src="https://i.imgur.com/VXC5NfS.png" width="500" /></ul></ol><p><strong>Task 5.2: Create a Second Private Subnet</strong></p><ol><li>Create subnet.<ul><li><img data-proofer-ignore data-src="https://i.imgur.com/nF3i8sq.png" width="500" /></ul></ol><p><strong>Task 5.3: Create a Second NAT Gateway</strong></p><ol><li><p>left navigation pane, click NAT Gateways.</p><li><p>Create NAT Gateway.</p><ul><li><img data-proofer-ignore data-src="https://i.imgur.com/dvlRVj5.png" width="500" /></ul></ol><p><strong>Task 5.4: Create a Second Private Route Table</strong></p><ol><li>In the navigation pane, click Route Tables.<li>Create route table.<ul><li><img data-proofer-ignore data-src="https://i.imgur.com/dC8D6re.png" width="500" /></ul><li>Highlight the Private Route Table 2 &gt; Routes tab &gt; Edit routes.<ul><li><img data-proofer-ignore data-src="https://i.imgur.com/aWCnJ8S.png" width="500" /></ul><li>Highlight the Private Route Table 2 &gt; Subnet Associations tab &gt; Edit subnet associations.<ul><li>Select (tick) the checkbox beside <code class="language-plaintext highlighter-rouge">Private Subnet 2</code>.<li><img data-proofer-ignore data-src="https://i.imgur.com/F2KlhYJ.png" width="500" /></ul><li>Private Subnet 2 will now route Internet-bound traffic through the second NAT Gateway.</ol><h2 id="task-6-create-an-application-load-balancer">Task 6: Create an Application Load Balancer</h2><p><img data-proofer-ignore data-src="https://i.imgur.com/YaiN4p2.jpg" width="500" /></p><p>do not have any instances yet</p><ul><li>created by the Auto Scaling group in the next task.</ul><ol><li>Services menu &gt; EC2 &gt; Load Balancers<ul><li>Create Load Balancer &gt; Application Load Balancer<li><img data-proofer-ignore data-src="https://i.imgur.com/YkmN5md.png" width="500" /></ul></ol><ul><li>Next: Configure Security Settings<ul><li>Select: Security group for the web servers<li>Note: This Security Group permits only HTTP incoming traffic, so it can be used on both the Load Balancer and the web servers.</ul><li>Click Next: Configure Routing.<li><img data-proofer-ignore data-src="https://i.imgur.com/JxE0NzM.png" width="500" /></ul><h2 id="task-7-create-an-auto-scaling-group">Task 7: Create an Auto Scaling Group</h2><p><img data-proofer-ignore data-src="https://i.imgur.com/oxZ7lNl.jpg" width="500" /></p><ol><li>In the left navigation pane &gt; Auto Scaling Groups &gt; Create Auto Scaling group &gt; My AMIs &gt; Web application<ul><li>Accept the default (t2.micro) instance type and click Next: Configure details .<li>Name: Web-Configuration<li>Click Next: Add Storage.<li>Click Next: Configure Security Group.<li>Click Select an existing security group.<ul><li>Select the Security Group with a Description of Security group for the web servers.</ul><li>Click Review.<li>Create launch configuration.<li>accept the vockey keypair, select the acknowledgement check box, then click Create launch configuration.</ul><li>create the Auto Scaling group.<ul><li><img data-proofer-ignore data-src="https://i.imgur.com/0gcS4bq.png" width="500" /><li><img data-proofer-ignore data-src="https://i.imgur.com/lmJcPbb.png" width="500" /></ul></ol><p>Ensure Keep this group at its initial size is selected.</p><blockquote><p>This configuration tells Auto Scaling to always maintain two instances in the Auto Scaling group. This is ideal for a Highly Available application because the application will continue to operate even if one instance fails. In such an event, Auto Scaling will automatically launch a replacement instance.</p></blockquote><p>Click Next: Configure Notifications.</p><p>Click Next: Configure Tags.</p><ul><li>For Key, type: Name<li>For Value, type: Web application</ul><p>Click Review. click Create Auto Scaling group.</p><p>Auto Scaling group will initially show zero instances. should soon update to two instances.</p><p>Your application will soon be running across two Availability Zones and Auto Scaling will maintain that configuration even if an instance or Availability Zone fails.</p><h2 id="task-8-test-the-application">Task 8: Test the Application</h2><ol><li>left navigation pane &gt; Target Groups.</ol><p>Click the Targets tab in the lower half of the window.</p><p>You should see two Registered instances. The Status column shows the results of the Load Balancer Health Check that is performed against the instances.</p><p>Occasionally click the refresh icon in the top-right until the Status for both instances appears as healthy. If the status does not eventually change to healthy, ask your instructor for assistance in diagnosing the configuration. Hovering over the icon in the Status column will provide more information about the status.</p><p>testing the application by connecting to the Load Balancer, which will then send your request to one of the Amazon EC2 instances. You will need to retrieve the DNS Name of the Load Balancer.</p><ol><li>left navigation pane &gt; Load Balancers &gt; copy the DNS Name: LB1-xxxx.elb.amazonaws.com<ul><li>Open a new web browser tab, paste<li>The Load Balancer forwarded your request to one of the Amazon EC2 instances. The Instance ID and Availability Zone are shown at the bottom of the web application.<ul><li><code class="language-plaintext highlighter-rouge">You are connected to instance i-0315fbffecb6ab3af in us-east-1a.</code></ul><li>Reload the page in your web browser. You should notice that the Instance ID and Availability Zone sometimes changes between the two instances.<ul><li><code class="language-plaintext highlighter-rouge">You are connected to instance i-082fccc5cfb52db95 in us-east-1b.</code></ul></ul></ol><p>The flow of information when displaying this web application is: <img data-proofer-ignore data-src="https://i.imgur.com/ctic2dc.jpg" width="500" /></p><p>Data flow</p><ul><li>sent the request to the Load Balancer, which resides in the public subnets that are connected to the Internet.<li>The Load Balancer chose one of the Amazon EC2 instances that reside in the private subnets and forwarded the request to it.<li>EC2 instance requested geographic information from freegeoip.app. This request went out to the Internet through the NAT Gateway in the same Availability Zone as the instance.<li>The Amazon EC2 instance then returned the web page to the Load Balancer, which returned it to your web browser.</ul><h2 id="task-9-test-high-availability">Task 9: Test High Availability</h2><p>Your application has been configured to be Highly Available. This can be proven by stopping one of the Amazon EC2 instances.</p><ol><li><p>EC2 Management Console &gt; Instances &gt; Select the <code class="language-plaintext highlighter-rouge">Configuration Server</code> &gt; Actions &gt; Instance State &gt; Terminate</p><li><p>In a short time, the Load Balancer will notice that the instance is not responding and will automatically route all requests to the remaining instance.</p></ol><hr /><h1 id="lab2-using-notifications-to-trigger-aws-lambda">lab2: Using Notifications to Trigger AWS Lambda</h1><p><img data-proofer-ignore data-src="https://i.imgur.com/6BND5ml.png" width="500" /></p><p><img data-proofer-ignore data-src="https://i.imgur.com/wDkrKIN.png" width="500" /></p><p>Many AWS services can automatically generate notifications when events occur.</p><ul><li>These notifications can be used to trigger automated actions without requiring human intervention.<li>create an <strong>AWS Lambda function</strong> that automatically <strong>snapshot and tag new Amazon EC2 instances</strong> launched by Auto Scaling.</ul><p>The lab scenario is:</p><ul><li>An Auto Scaling group has already been configured.<li>trigger Auto Scaling to scale-out and launch a new EC2 instance.<li>This will send a notification to an Amazon Simple Notification Service (SNS) topic.<li>The SNS topic will trigger an <strong>AWS Lambda function</strong> which will:<ul><li>Create a snapshot of the Amazon EBS volumes attached to the instance.<li>Add a tag to the instance.<li>Sent log information to Amazon CloudWatch Logs.</ul></ul><h2 id="task-1-create-an-sns-topic">Task 1: Create an SNS Topic</h2><p>create an Amazon Simple Notification Service (SNS) <strong>topic</strong> that the Auto Scaling group will use as a notification target.</p><ol><li>AWS Management Console &gt; Services &gt; Simple Notification Service &gt; to reveal the Amazon SNS menu &gt; Topics &gt; Create topic.<ul><li><img data-proofer-ignore data-src="https://i.imgur.com/grlMWBr.png" width="500" /></ul></ol><p>The topic is now ready to receive notifications.</p><h2 id="task-2-configure-auto-scaling-to-send-events">Task 2: Configure Auto Scaling to Send Events</h2><ul><li>configure an Auto Scaling group to<ul><li>send notifications to the SNS topic<li>when new EC2 instances are launched in the group.</ul></ul><ol><li>AWS Management Console &gt; EC2 &gt; Auto Scaling Groups &gt; the Auto Scaling group created &gt; Notifications tab &gt; Create notification.<ul><li><img data-proofer-ignore data-src="https://i.imgur.com/GChiJl9.png" width="500" /></ul></ol><h2 id="task-3-an-iam-role-for-the-lambda-function">Task 3: An IAM Role for the Lambda function</h2><p>An IAM role named <code class="language-plaintext highlighter-rouge">SnapAndTagRole</code> that has permission to perform operations on EC2 instances and to log messages in Amazon CloudWatch Logs has been pre-created for you. You will later associate this role with your Lambda function.</p><h2 id="task-4-create-a-lambda-function">Task 4: Create a Lambda Function</h2><ul><li>create an <strong>AWS Lambda function</strong> that will be invoked by Amazon SNS when Auto Scaling launches a new EC2 instance.<li>The Lambda function will create a snapshot of the Amazon EBS volumes attached to the instance and then add a tag to the instance.</ul><ol><li>AWS Management Console &gt; Lambda &gt; Create a function &gt; Author from scratch<ul><li><img data-proofer-ignore data-src="https://i.imgur.com/zx5Y8vJ.png" width="500" /></ul></ol><p>This role grants permission to the Lambda function to create an EBS Snapshot and to tag the EC2 instance.</p><blockquote><p>Blueprints code templates for writing Lambda functions. Blueprints are provided for standard Lambda triggers such as creating Alexa skills and processing Amazon Kinesis Firehose streams.</p></blockquote><ol><li>Function code section:</ol><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="c1"># Snap_and_Tag Lambda function
#
# This function is triggered when Auto Scaling launches a new instance.
# A snapshot of EBS volumes will be created and a tag will be added.
</span>
<span class="kn">from</span> <span class="n">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="n">json</span><span class="p">,</span> <span class="n">boto3</span>

<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Received event: "</span> <span class="o">+</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

    <span class="c1"># Extract the EC2 instance ID from the Auto Scaling event notification
</span>    <span class="n">message</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s">'Records'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">'Sns'</span><span class="p">][</span><span class="s">'Message'</span><span class="p">]</span>
    <span class="n">autoscalingInfo</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="n">ec2InstanceId</span> <span class="o">=</span> <span class="n">autoscalingInfo</span><span class="p">[</span><span class="s">'EC2InstanceId'</span><span class="p">]</span>

    <span class="c1"># Snapshot all EBS volumes attached to the instance
</span>    <span class="n">ec2</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">resource</span><span class="p">(</span><span class="s">'ec2'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ec2</span><span class="p">.</span><span class="n">volumes</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">Filters</span><span class="o">=</span><span class="p">[{</span><span class="s">'Name'</span><span class="p">:</span> <span class="s">'attachment.instance-id'</span><span class="p">,</span> <span class="s">'Values'</span><span class="p">:</span> <span class="p">[</span><span class="n">ec2InstanceId</span><span class="p">]}]):</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s">'Autosnap-%s-%s'</span> <span class="o">%</span> <span class="p">(</span> <span class="n">ec2InstanceId</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">volume_id</span> <span class="p">)</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">.</span><span class="nf">create_snapshot</span><span class="p">(</span><span class="n">Description</span> <span class="o">=</span> <span class="n">description</span><span class="p">):</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t\t</span><span class="s">Snapshot created with description [%s]"</span> <span class="o">%</span> <span class="n">description</span><span class="p">)</span>

    <span class="c1"># Add a tag to the EC2 instance: Key = Snapshots, Value = Created
</span>    <span class="n">ec2</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="s">'ec2'</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">ec2</span><span class="p">.</span><span class="nf">create_tags</span><span class="p">(</span>
        <span class="n">Resources</span><span class="o">=</span><span class="p">[</span><span class="n">ec2InstanceId</span><span class="p">],</span>
        <span class="n">Tags</span><span class="o">=</span><span class="p">[{</span><span class="s">'Key'</span><span class="p">:</span> <span class="s">'Snapshots'</span><span class="p">,</span> <span class="s">'Value'</span><span class="p">:</span> <span class="s">'Created'</span><span class="p">}]</span>
    <span class="p">)</span>
    <span class="nf">print </span><span class="p">(</span><span class="s">"***Tag added to EC2 instance with id: "</span> <span class="o">+</span> <span class="n">ec2InstanceId</span><span class="p">)</span>

    <span class="c1"># Finished!
</span>    <span class="k">return</span> <span class="n">ec2InstanceId</span>

</pre></table></code></div></div><p>Examine the code.</p><ul><li>Extract the EC2 instance ID from the notification message<li>Create a snapshot of all EBS volumes attached to the instance<li>Add a tag to the instance to indicate that snapshots were created</ul><ol><li>the Basic settings section at the bottom<ul><li><img data-proofer-ignore data-src="https://i.imgur.com/ixPP4zM.png" width="500" /></ul><li>configure the trigger that will activate the Lambda function.<ul><li>Add triggers at the top of the page.<li>Configure triggers<li>SNS topic: ScaleEvent</ul></ol><p>Note: the topic may already be pre-populated in the text box.</p><p>Amazon SNS will invoke this Lambda function when the ScaleEvent topic receives a notification from Auto Scaling.</p><p>Your Lambda function will now automatically execute whenever Auto Scaling launches a new instance.</p><h2 id="task-5-scale-out-the-auto-scaling-group-to-trigger-the-lambda-function">Task 5: Scale-Out the Auto Scaling Group to Trigger the Lambda function</h2><ul><li>increase the desired capacity of the Auto Scaling group.<li>This will cause the Auto Scaling group to launch a new Amazon EC2 instance to meet the increased capacity requirement.<li>Auto Scaling will then send a notification to the ScaleEvent SNS topic.<li>Amazon SNS will then invoke the Snap_and_Tag Lambda function.</ul><ol><li>AWS Management Console &gt; EC2 &gt; Auto Scaling Groups &gt; Details tab &gt; click Edit &gt; Desired Capacity: <code class="language-plaintext highlighter-rouge">2</code><ul><li>cause Auto Scaling to launch an additional Amazon EC2 instance.<li>the Activity History tab and monitor the progress of the new EC2 instance that is being launched.<li>Wait for the status to change to show 2 rows with a Status of Successful. You can occasionally click refresh to update the status.<li><img data-proofer-ignore data-src="https://i.imgur.com/reYRdBp.png" width="500" /></ul></ol><p>Once the status has updated, you can confirm that the Lambda function executed correctly.</p><ol><li>AWS Management Console &gt; Instances &gt; the instance that has the most recent launch time &gt; Tags tab<ul><li>see a tag with Snapshots as the key, and Created as the value.<li>This tag was added to the EC2 instance by your Lambda function.</ul><li>AWS Management Console &gt; Snapshots.<ul><li>two snapshots that were created by the Lambda function.<li>Your Auto Scaling group successfully triggered the Lambda function, which created the tag and snapshots.<li>This provides an example serverless solution on AWS.</ul></ol><hr /><h1 id="lab-7-implementing-a-serverless-architecture-with-aws-managed-services">lab 7 Implementing a Serverless Architecture with AWS Managed Services</h1><p><img data-proofer-ignore data-src="https://i.imgur.com/zAKe31Q.png" alt="Screen Shot 2020-07-12 at 23.22.49" /></p><ul><li>The scenario workflow is:<ul><li>upload a transactions file to an <strong>Amazon S3 bucket</strong><li>This will trigger an <strong>AWS Lambda function</strong> that read the file and insert records into two <strong>Amazon DynamoDB tables</strong><li>This will trigger another <strong>AWS Lambda function</strong> that calculate customer totals and will send a message to an <strong>Amazon Simple Notification Service (SNS) Topic</strong> if the account balance is over $1500<li><strong>Amazon SNS</strong> will send an email notification and will store a message in <strong>Amazon Simple Queue Service (SQS) queues</strong> to notify the customer and your credit collection department.</ul></ul><h2 id="task-1-create-a-lambda-function-to-process-a-transactions-file">Task 1: Create a Lambda Function to Process a Transactions File</h2><p><img data-proofer-ignore data-src="https://i.imgur.com/c6WI7Yy.png" width="320" /></p><ul><li>create an <strong>AWS Lambda function</strong> to process a transactions file.<ul><li>The Lambda function will read the file and insert information into the Customer and Transactions DynamoDB tables.</ul></ul><p>Step:</p><ol><li>AWS Management Console &gt; Lambda<li>Create a function &gt; <code class="language-plaintext highlighter-rouge">Author from scratch</code><li>Configure the following:<ul><li>Name: <code class="language-plaintext highlighter-rouge">TransactionProcessor</code><li>Runtime: <code class="language-plaintext highlighter-rouge">Python 2.7</code><li>Execution Role: <code class="language-plaintext highlighter-rouge">Choose Use an existing role</code><li>Existing role: <code class="language-plaintext highlighter-rouge">TransactionProcessorRole</code></ul><li><strong>Function code section</strong></ol><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre><td class="rouge-code"><pre><span class="c1"># TransactionProcessor Lambda function
# This function is triggered by an object being created in an Amazon S3 bucket.
# The file is downloaded and each line is inserted into DynamoDB tables.
</span>
<span class="kn">from</span> <span class="n">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="n">json</span><span class="p">,</span> <span class="n">urllib</span><span class="p">,</span> <span class="n">boto3</span><span class="p">,</span> <span class="n">csv</span>

<span class="c1"># Connect to S3 and DynamoDB
</span><span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">resource</span><span class="p">(</span><span class="s">'s3'</span><span class="p">)</span>
<span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">resource</span><span class="p">(</span><span class="s">'dynamodb'</span><span class="p">)</span>

<span class="c1"># Connect to the DynamoDB tables
</span><span class="n">customerTable</span>     <span class="o">=</span> <span class="n">dynamodb</span><span class="p">.</span><span class="nc">Table</span><span class="p">(</span><span class="s">'Customer'</span><span class="p">);</span>
<span class="n">transactionsTable</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="p">.</span><span class="nc">Table</span><span class="p">(</span><span class="s">'Transactions'</span><span class="p">);</span>

<span class="c1"># This handler is executed every time the Lambda function is triggered
</span><span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>

  <span class="c1"># Show the incoming event in the debug log
</span>  <span class="nf">print</span><span class="p">(</span><span class="s">"Event received by Lambda function: "</span> <span class="o">+</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

  <span class="c1"># Get the bucket and object key from the Event
</span>  <span class="n">bucket</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s">'Records'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">'s3'</span><span class="p">][</span><span class="s">'bucket'</span><span class="p">][</span><span class="s">'name'</span><span class="p">]</span>
  <span class="n">key</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="nf">unquote_plus</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s">'Records'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">'s3'</span><span class="p">][</span><span class="s">'object'</span><span class="p">][</span><span class="s">'key'</span><span class="p">]).</span><span class="nf">decode</span><span class="p">(</span><span class="s">'utf8'</span><span class="p">)</span>
  <span class="n">localFilename</span> <span class="o">=</span> <span class="s">'/tmp/transactions.txt'</span>

  <span class="c1"># Download the file from S3 to the local filesystem
</span>  <span class="k">try</span><span class="p">:</span>
    <span class="n">s3</span><span class="p">.</span><span class="n">meta</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">download_file</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">localFilename</span><span class="p">)</span>
  <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">'Error getting object {} from bucket {}. Make sure they exist and your bucket is in the same region as this function.'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">bucket</span><span class="p">))</span>
    <span class="k">raise</span> <span class="n">e</span>

  <span class="c1"># Read the Transactions CSV file. Delimiter is the '|' character
</span>  <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">localFilename</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="p">.</span><span class="nc">DictReader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">'|'</span><span class="p">)</span>

    <span class="c1"># Read each row in the file
</span>    <span class="n">rowCount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
      <span class="n">rowCount</span> <span class="o">+=</span> <span class="mi">1</span>

      <span class="c1"># Show the row in the debug log
</span>      <span class="nf">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'customer_id'</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s">'customer_address'</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s">'trn_id'</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s">'trn_date'</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s">'trn_amount'</span><span class="p">])</span>

      <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Insert Customer ID and Address into Customer DynamoDB table
</span>        <span class="n">customerTable</span><span class="p">.</span><span class="nf">put_item</span><span class="p">(</span>
          <span class="n">Item</span><span class="o">=</span><span class="p">{</span>
            <span class="s">'CustomerId'</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s">'customer_id'</span><span class="p">],</span>
            <span class="s">'Address'</span><span class="p">:</span>  <span class="n">row</span><span class="p">[</span><span class="s">'customer_address'</span><span class="p">]})</span>

        <span class="c1"># Insert transaction details into Transactions DynamoDB table
</span>        <span class="n">transactionsTable</span><span class="p">.</span><span class="nf">put_item</span><span class="p">(</span>
          <span class="n">Item</span><span class="o">=</span><span class="p">{</span>
            <span class="s">'CustomerId'</span><span class="p">:</span>    <span class="n">row</span><span class="p">[</span><span class="s">'customer_id'</span><span class="p">],</span>
            <span class="s">'TransactionId'</span><span class="p">:</span>   <span class="n">row</span><span class="p">[</span><span class="s">'trn_id'</span><span class="p">],</span>
            <span class="s">'TransactionDate'</span><span class="p">:</span>  <span class="n">row</span><span class="p">[</span><span class="s">'trn_date'</span><span class="p">],</span>
            <span class="s">'TransactionAmount'</span><span class="p">:</span> <span class="nf">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'trn_amount'</span><span class="p">])})</span>

      <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
         <span class="nf">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
         <span class="nf">print</span><span class="p">(</span><span class="s">"Unable to insert data into DynamoDB table"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="c1"># Finished!
</span>    <span class="k">return</span> <span class="s">"%d transactions inserted"</span> <span class="o">%</span> <span class="n">rowCount</span>
</pre></table></code></div></div><ol><li>Basic settings<ul><li><img data-proofer-ignore data-src="https://i.imgur.com/pJIni1S.png" width="300" /></ul><li>Add triggers &gt; S3<ul><li><img data-proofer-ignore data-src="https://i.imgur.com/4L2oqF9.png" width="500" /></ul></ol><h2 id="task-2-create-a-lambda-function-to-calculate-transaction-totals-and-notify-about-high-account-balances">Task 2: Create a Lambda Function to Calculate Transaction Totals and Notify About High Account Balances</h2><p><img data-proofer-ignore data-src="https://i.imgur.com/StldKFD.png" width="500" /></p><ul><li>create an <strong>AWS Lambda function</strong> to calculate transaction totals and send a <strong>Simple Notification Service</strong> notification if an account balance exceeds $1500.</ul><ol><li>AWS Management Console &gt; Lambda<li>Create a function &gt; <code class="language-plaintext highlighter-rouge">Author from scratch</code><li>Configure the following<ul><li><img data-proofer-ignore data-src="https://i.imgur.com/4aIfHkv.png" width="500" /></ul><li><strong>Function code</strong> section</ol><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre><td class="rouge-code"><pre><span class="c1"># TotalNotifier Lambda function
#
# This function is triggered when values are inserted into the Transactions DynamoDB table.
# Transaction totals are calculated and notifications are sent to SNS if limits are exceeded.
</span>
<span class="kn">from</span> <span class="n">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="n">json</span><span class="p">,</span> <span class="n">boto3</span>

<span class="c1"># Connect to SNS
</span><span class="n">sns</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="s">'sns'</span><span class="p">)</span>
<span class="n">alertTopic</span> <span class="o">=</span> <span class="s">'HighBalanceAlert'</span>
<span class="n">snsTopicArn</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="s">'TopicArn'</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">sns</span><span class="p">.</span><span class="nf">list_topics</span><span class="p">()[</span><span class="s">'Topics'</span><span class="p">]</span> <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="s">'TopicArn'</span><span class="p">].</span><span class="nf">endswith</span><span class="p">(</span><span class="s">':'</span> <span class="o">+</span> <span class="n">alertTopic</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Connect to DynamoDB
</span><span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">resource</span><span class="p">(</span><span class="s">'dynamodb'</span><span class="p">)</span>
<span class="n">transactionTotalTableName</span> <span class="o">=</span> <span class="s">'TransactionTotal'</span>
<span class="n">transactionsTotalTable</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="p">.</span><span class="nc">Table</span><span class="p">(</span><span class="n">transactionTotalTableName</span><span class="p">);</span>

<span class="c1"># This handler is executed every time the Lambda function is triggered
</span><span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>

  <span class="c1"># Show the incoming event in the debug log
</span>  <span class="nf">print</span><span class="p">(</span><span class="s">"Event received by Lambda function: "</span> <span class="o">+</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

  <span class="c1"># For each transaction added, calculate the new Transactions Total
</span>  <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">event</span><span class="p">[</span><span class="s">'Records'</span><span class="p">]:</span>
    <span class="n">customerId</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s">'dynamodb'</span><span class="p">][</span><span class="s">'NewImage'</span><span class="p">][</span><span class="s">'CustomerId'</span><span class="p">][</span><span class="s">'S'</span><span class="p">]</span>
    <span class="n">transactionAmount</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s">'dynamodb'</span><span class="p">][</span><span class="s">'NewImage'</span><span class="p">][</span><span class="s">'TransactionAmount'</span><span class="p">][</span><span class="s">'N'</span><span class="p">])</span>

    <span class="c1"># Update the customer's total in the TransactionTotal DynamoDB table
</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">transactionsTotalTable</span><span class="p">.</span><span class="nf">update_item</span><span class="p">(</span>
      <span class="n">Key</span><span class="o">=</span><span class="p">{</span>
        <span class="s">'CustomerId'</span><span class="p">:</span> <span class="n">customerId</span>
      <span class="p">},</span>
      <span class="n">UpdateExpression</span><span class="o">=</span><span class="s">"add accountBalance :val"</span><span class="p">,</span>
      <span class="n">ExpressionAttributeValues</span><span class="o">=</span><span class="p">{</span>
        <span class="s">':val'</span><span class="p">:</span> <span class="n">transactionAmount</span>
      <span class="p">},</span>
      <span class="n">ReturnValues</span><span class="o">=</span><span class="s">"UPDATED_NEW"</span>
    <span class="p">)</span>

    <span class="c1"># Retrieve the latest account balance
</span>    <span class="n">latestAccountBalance</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s">'Attributes'</span><span class="p">][</span><span class="s">'accountBalance'</span><span class="p">]</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Latest account balance: "</span> <span class="o">+</span> <span class="nf">format</span><span class="p">(</span><span class="n">latestAccountBalance</span><span class="p">))</span>

    <span class="c1"># If balance &gt; $1500, send a message to SNS
</span>    <span class="k">if</span> <span class="n">latestAccountBalance</span> <span class="o">&gt;=</span> <span class="mi">1500</span><span class="p">:</span>

      <span class="c1"># Construct message to be sent
</span>      <span class="n">message</span> <span class="o">=</span> <span class="s">'{"customerID": "'</span> <span class="o">+</span> <span class="n">customerId</span> <span class="o">+</span> <span class="s">'", '</span> <span class="o">+</span> <span class="s">'"accountBalance": "'</span> <span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="n">latestAccountBalance</span><span class="p">)</span> <span class="o">+</span> <span class="s">'"}'</span>
      <span class="nf">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

      <span class="c1"># Send message to SNS
</span>      <span class="n">sns</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span>
        <span class="n">TopicArn</span><span class="o">=</span><span class="n">snsTopicArn</span><span class="p">,</span>
        <span class="n">Message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
        <span class="n">Subject</span><span class="o">=</span><span class="s">'Warning! Account balance is very high'</span><span class="p">,</span>
        <span class="n">MessageStructure</span><span class="o">=</span><span class="s">'raw'</span>
      <span class="p">)</span>

  <span class="c1"># Finished!
</span>  <span class="k">return</span> <span class="s">'Successfully processed {} records.'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s">'Records'</span><span class="p">]))</span>
</pre></table></code></div></div><ol><li>Basic settings section<ul><li><img data-proofer-ignore data-src="https://i.imgur.com/zSXqVCP.png" width="500" /></ul><li>Add trigger<ul><li><img data-proofer-ignore data-src="https://i.imgur.com/AiUB6eg.png" width="500" /></ul></ol><h2 id="task-3-create-a-simple-notification-service-sns-topic">Task 3: Create a Simple Notification Service (SNS) Topic</h2><p><img data-proofer-ignore data-src="https://i.imgur.com/nrgegoF.png" width="500" /></p><ul><li>create a <strong>Simple Notification Service (SNS)</strong> topic that will receive a notification from your Lambda function when an account balance exceeds $1500. You will also subscribe to the topic with an email and via SMS.</ul><ol><li>Services &gt; Simple Notification Service.<li>Create topic<ul><li><img data-proofer-ignore data-src="https://i.imgur.com/2nyhKV3.png" width="500" /></ul><li>Create subscription<ul><li><img data-proofer-ignore data-src="https://i.imgur.com/mTjk6zB.png" width="500" /></ul></ol><h2 id="task-4-create-two-simple-queue-service-queues">Task 4: Create Two Simple Queue Service Queues</h2><p><img data-proofer-ignore data-src="https://i.imgur.com/yesnLBb.png" width="500" /></p><ul><li>create two Simple Queue Service (SQS) queues.<ul><li>subscribe 3 queues to the Simple Notification Service (SNS) topic created.<li>This setup is known as a fan-out scenario because each SNS notification is sent to multiple subscribers and those subscribers can independently consume messages from their own queue.</ul></ul><ol><li>Simple Queue Service<li>create queue<ul><li>Queue Name, type: <code class="language-plaintext highlighter-rouge">CreditCollection</code><li>Queue Name, type: <code class="language-plaintext highlighter-rouge">CustomerNotify</code></ul><li>Subscribe Queues to SNS Topic.<ul><li><img data-proofer-ignore data-src="https://i.imgur.com/5RFOqaA.png" width="500" /></ul></ol><h2 id="task-5-testing-the-serverless-architecture-by-uploading-a-transactions-file">Task 5: Testing the Serverless Architecture by Uploading a Transactions File</h2><hr /><h1 id="lab-8-multi-region-failover-with-amazon-route-53">lab 8: multi-Region failover with Amazon Route 53</h1><ol><li>Inspecting resources in <code class="language-plaintext highlighter-rouge">two Regions</code>.<li>Creating an <strong>Amazon Route 53</strong> <code class="language-plaintext highlighter-rouge">health check</code><li>Creating an <strong>Amazon Route 53</strong> <code class="language-plaintext highlighter-rouge">domain</code>.<li>Configuring <code class="language-plaintext highlighter-rouge">primary and secondary settings</code>.<li>And testing the failover</ol><p><img data-proofer-ignore data-src="https://i.imgur.com/HmhQ9lz.png" alt="Screen Shot 2020-07-18 at 22.48.39" /></p><p>Objectives</p><p>After completing this lab, you will be able to:</p><ul><li>Use Route 53 to configure cross-region failover of a web application.<li>Use Route 53 health checks to determine the health of a resource.</ul><h2 id="task-1-inspect-your-environment-1">Task 1: Inspect Your Environment</h2><p><img data-proofer-ignore data-src="https://i.imgur.com/1PZSWg4.png" alt="mdtable1" /></p><ul><li>Web-Application-1<ul><li>IPv4 Public IP: <code class="language-plaintext highlighter-rouge">34.234.178.0</code></ul><li>Web-Application-2<ul><li>IPv4 Public IP: <code class="language-plaintext highlighter-rouge">35.163.208.11</code></ul></ul><h2 id="task-2-configure-a-health-check">Task 2: Configure a Health Check</h2><p>Route 53 &gt; Health checks <img data-proofer-ignore data-src="https://i.imgur.com/h3kV6Bt.png" alt="Screen Shot 2020-07-18 at 23.28.51" /></p><h2 id="task-3-configure-your-domain-in-route-53">Task 3: Configure your Domain in Route 53</h2><p>Route 53 &gt; Hosted zones &gt; <code class="language-plaintext highlighter-rouge">domain name</code></p><ol><li>create a <code class="language-plaintext highlighter-rouge">DNS A-record</code> to <code class="language-plaintext highlighter-rouge">point to your Primary web server</code>.<ul><li>An <code class="language-plaintext highlighter-rouge">A-record</code> resolves a domain name by returning an IP address.<li>also associate this Record Set with the Health Check so traffic will only be sent to your Primary web server if the Health Check indicates that the server is healthy.</ul></ol><p><img data-proofer-ignore data-src="https://i.imgur.com/GTBwLHZ.png" alt="Screen Shot 2020-07-18 at 23.47.42" /></p><ol><li>create a <code class="language-plaintext highlighter-rouge">DNS A-record</code> to <code class="language-plaintext highlighter-rouge">point to your 2nd web server</code>.</ol><p><img data-proofer-ignore data-src="https://i.imgur.com/9u8PE2F.png" alt="Screen Shot 2020-07-18 at 23.49.27" /></p><ol><li>check <code class="language-plaintext highlighter-rouge">heath check</code> &gt; Health checkers tab<ul><li>The health check is performed independently from multiple locations around the world, with each location requesting the page every 10 seconds.</ul></ol><h2 id="task-4-check-the-dns-resolution">Task 4: Check the DNS Resolution</h2><p>Hosted zones &gt; domain &gt; Test Record Set.</p><ul><li>Check response from Route 53<li>Record name: <code class="language-plaintext highlighter-rouge">www</code><li>Type: <code class="language-plaintext highlighter-rouge">A</code><li>Get response.<li>Response returned by Route 53 value. Confirm that it is the same IP address as your Primary web server.</ul><h2 id="task-5---test-your-failover">Task 5 - Test Your Failover</h2><ol><li>stop Primary web server instance</ol><p><img data-proofer-ignore data-src="https://i.imgur.com/rD1UwFN.png" alt="Screen Shot 2020-07-19 at 00.01.03" /></p><ol><li><p>test again</p><li><p>2nd web server ip.</p></ol><p>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/01aws/'>01AWS</a>, <a href='/categories/awslab/'>AWSLab</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/aws/" class="post-tag no-text-decoration" >AWS</a> <a href="/tags/lab/" class="post-tag no-text-decoration" >Lab</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=AWS Lab - for SAA - Grace&url=https://ocholuo.github.io//posts/Lab-AWSCloudSolutionArchitect/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=AWS Lab - for SAA - Grace&u=https://ocholuo.github.io//posts/Lab-AWSCloudSolutionArchitect/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=AWS Lab - for SAA - Grace&url=https://ocholuo.github.io//posts/Lab-AWSCloudSolutionArchitect/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Amazon-CloudFront/">AWS Lab - AWS CloudFront</a><li><a href="/posts/Alexa-1stSkill/">AWS Alex First Skill - RedVelvet Time</a><li><a href="/posts/NetworkProtocol-SSL-TLS-Handshake/">NetworkProtocol SSL/TLS Handshake</a><li><a href="/posts/pythonCrash/">Python Crash</a><li><a href="/posts/%E4%B8%80%E5%8F%A5%E8%AF%9D%E8%A7%A3%E9%87%8AAWS/">AWS - 一句话解释AWS</a><li><a href="/posts/GKE/">GCP - Google Cloud Computing - Kubernetes and Kubernetes Engine</a><li><a href="/posts/Go-Note/">Go Note</a><li><a href="/posts/SCPs/">AWS - IdenAccessManage - SCPs (Service Control Policies)</a><li><a href="/posts/CompanyBenefit/">Company Benefit</a><li><a href="/posts/Encryption-SSL&TLS/">Cryptography - SSL/TLS Encryption</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/cyberattack/">CyberAttack</a> <a class="post-tag" href="/tags/lab/">Lab</a> <a class="post-tag" href="/tags/cyberattacktools/">CyberAttackTools</a> <a class="post-tag" href="/tags/gcp/">GCP</a> <a class="post-tag" href="/tags/sysadmin/">Sysadmin</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/soc/">SOC</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/AWS-Create-simple-microservice-using-Lambda-and-API-Gateway/"><div class="card-body"> <span class="timeago small" >Jul 16, 2020<i class="unloaded">2020-07-16T11:11:11-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS Lab - Create a simple microservice using Lambda and API Gateway</h3><div class="text-muted small"><p> Create a simple microservice using Lambda and API Gateway Create a simple microservice using Lambda and API Gateway overall create an API using Amazon API Gateway o...</p></div></div></a></div><div class="card"> <a href="/posts/AWS-lab/"><div class="card-body"> <span class="timeago small" >Jul 16, 2020<i class="unloaded">2020-07-16T11:11:11-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS Lab</h3><div class="text-muted small"><p> AWS Lab AWS Lab 1. beginning 启动实例 2 连接实例 remote desktop 1.3 终止您的实例 2. begin 2.1 Active directory ...</p></div></div></a></div><div class="card"> <a href="/posts/LAB-AWSCertifiedCloudPractitionerexam.ACFv2EN-Interns/"><div class="card-body"> <span class="timeago small" >Jul 16, 2020<i class="unloaded">2020-07-16T11:11:11-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS Lab - ACFv2EN-Interns</h3><div class="text-muted small"><p> ACFv2EN-Interns. ACFv2EN-Interns. Module 1 Overview cloud computing: different types of cloud computing models three main cloud computing deplo...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Lab-AWSCloudPractitioner/" class="btn btn-outline-primary" prompt="Older"><p>AWS Lab - for CCP</p></a> <a href="/posts/README/" class="btn btn-outline-primary" prompt="Newer"><p>AWS Lab - Readme</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/ocholuo">Grace JyL</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/cyberattack/">CyberAttack</a> <a class="post-tag" href="/tags/lab/">Lab</a> <a class="post-tag" href="/tags/cyberattacktools/">CyberAttackTools</a> <a class="post-tag" href="/tags/gcp/">GCP</a> <a class="post-tag" href="/tags/sysadmin/">Sysadmin</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/soc/">SOC</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://ocholuo.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script async src="https://cdn.jsdelivr.net/npm/countup.js@1.9.3/dist/countUp.min.js"></script> <script defer src="/assets/js/dist/pvreport.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-179830187-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-179830187-1'); }); </script>
