<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="pv-proxy-endpoint" content="https://myochosite-291718.appspot.com/query?id=ahNwfm15b2Nob3NpdGUtMjkxNzE4chULEghBcGlRdWVyeRiAgIDo14eBCgw"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="AWS - CodeDevelop - CodeDeploy" /><meta property="og:locale" content="en" /><meta name="description" content="[toc]" /><meta property="og:description" content="[toc]" /><link rel="canonical" href="https://ocholuo.github.io//posts/3CodeDeploy/" /><meta property="og:url" content="https://ocholuo.github.io//posts/3CodeDeploy/" /><meta property="og:site_name" content="Grace" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-07-18T11:11:11-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="AWS - CodeDevelop - CodeDeploy" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-10-30T21:02:21-04:00","datePublished":"2020-07-18T11:11:11-04:00","description":"[toc]","headline":"AWS - CodeDevelop - CodeDeploy","mainEntityOfPage":{"@type":"WebPage","@id":"https://ocholuo.github.io//posts/3CodeDeploy/"},"url":"https://ocholuo.github.io//posts/3CodeDeploy/"}</script><title>AWS - CodeDevelop - CodeDeploy | Grace</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Grace"><meta name="application-name" content="Grace"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://myochosite-291718.appspot.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://myochosite-291718.appspot.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/huoye.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Grace</a></div><div class="site-subtitle font-italic">2023 Mar 14 updated</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/ocholuo" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>AWS - CodeDevelop - CodeDeploy</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>AWS - CodeDevelop - CodeDeploy</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Grace JyL </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Jul 18, 2020, 11:11 AM -0400" >Jul 18, 2020<i class="unloaded">2020-07-18T11:11:11-04:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Oct 30, 2022, 6:02 PM -0700" >Oct 30, 2022<i class="unloaded">2022-10-30T21:02:21-04:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4689 words">26 min read</span> <span id="pv" class="pageviews"> <i class="fas fa-spinner fa-spin fa-fw"></i> </span> views</div></div><div class="post-content"><p>[toc]</p><hr /><h1 id="codedeploy">CodeDeploy</h1><ul><li>a deployment service<li>CodeDeploy makes it easier to:<ul><li> <font color="red"> Rapidly release new features </font><li> <font color="red"> Update AWS Lambda function versions</font><li> <font color="red"> Avoid downtime during application deployment </font><li> <font color="red"> avoid risks associated with manual deployments </font><ul><li>CodeDeploy handle the complexity of updating the applications</ul></ul></ul><p>2 <font color="red"> deployment approaches </font> type options:</p><ul><li> <font color="blue"> In-place / rolling update deployment </font><ul><li>The application is stopped on each instance in the deployment group, and the new version is installed.<li>roll back: <font color="red"> re-deploy, time consume </font></ul><li> <font color="blue"> Blue/Green deployment </font><p><code class="language-plaintext highlighter-rouge">more save</code></p><ul><li>new release is installed on the new instances.<li>blue: active deployment<li>green: new release<li>roll back, <font color="red"> easy switch, registered and deregistered to the load balancer </font></ul></ul><p><img data-proofer-ignore data-src="https://i.imgur.com/3cwLO0t.png" alt="deployment approaches" /></p><p>can deploy nearly unlimited variety of application content, including:</p><ul><li>Code<ul><li>Serverless AWS Lambda functions<ul><li>do not need to make changes to your existing code before you can use CodeDeploy.</ul></ul><li>Web and configuration files<li>Executables<li>Packages<li>Scripts<li>Multimedia files</ul><hr /><h2 id="benefits-of-aws-codedeploy">Benefits of AWS CodeDeploy</h2><p>CodeDeploy offers these benefits:</p><ol><li> <font color="red"> Server, serverless, and container applications </font><ul><li>deploy both<ul><li>traditional applications on servers (EC2 instances, on-premises instances)<li>and applications that deploy a serverless AWS Lambda function version or an Amazon ECS application.</ul><li>CodeDeploy works with various systems for <font color="blue"> configuration management, source control, continuous integration, continuous delivery, and continuous deployment </font></ul><li> <font color="red"> Automated application deployments </font><ul><li>fully automates the application deployments across the <font color="blue"> development, test, and production environments </font><li> <font color="blue"> Repeatable deployments </font><ul><li>easily repeat an application deployment across different groups of instances with AWS CodeDeploy.<li>CodeDeploy uses a file and command-based install model, which enables it to deploy any application and reuse existing setup code.<li>The same setup code can be used to consistently deploy and test updates across your deployment, test, and production release stages for Amazon EC2 instances.<li>Eliminate manual steps from deployments increases the speed and reliability of software delivery process.</ul><li> <font color="blue"> Automatic scaling </font><ul><li>scales with your infrastructure to deploy to one instance or thousands.<li>integrate software deployment and scaling activities in order to keep your application up-to-date in a dynamic production environment.<li>For Amazon EC2 instances, CodeDeploy integrates with Auto Scaling. Auto Scaling allows you to scale EC2 capacity according to conditions you define such as spikes in traffic. CodeDeploy is notified whenever a new instance launches into an Auto Scaling group and will automatically perform an application deployment on the new instance before it is added to an Elastic Load Balancing load balancer.</ul><li> <font color="blue"> On-premises deployments </font><ul><li>use AWS CodeDeploy to automate software deployments across the <font color="blue"> development, test, and production environments </font> running on any instance<ul><li>including instances in your own data centers (instances need to connect to AWS public endpoints).</ul><li>enables you to use a single service to consistently deploy applications across hybrid architectures.</ul></ul><li> <font color="red"> Minimize downtime </font><ul><li><p>no require downtime when upgraded to a new revision</p><li> <font color="blue"> in-place / rolling update </font><ul><li>for EC2/On-Premises compute platform<li>maximize the application availability.<li>CodeDeploy performs a <font color="red"> rolling update across Amazon EC2 instances </font><li>specify the number of instances to be taken offline at a time for updates.</ul><li> <font color="blue"> blue/green deployment update </font><ul><li>the latest application revision is installed on replacement instances.<li>new version of application is launched alongside the old version.<li>Once the new revision is tested and declared ready, CodeDeploy shift the traffic from your prior version to new version according to the specifications.<li>Traffic is rerouted to these instances when you choose,<font color="blue"> Canary, Linear, all-at-once </font></ul><li> <font color="blue"> deployment health tracking </font><ul><li>For both deployment types, CodeDeploy tracks application health according to rules you configure.<li>works in conjunction with rolling updates to keep applications highly available during deployments.<li>Unexpected downtime can occur if bad updates are deployed.<li>AWS CodeDeploy monitors your deployment and will stop a deployment if there are too many failed updates.</ul></ul><li> <font color="red"> Stop and roll back </font><ul><li>stop an application deployment that is in process at any time using the AWS Management Console, the AWS CLI, or any of the AWS SDKs.<ul><li>can automatically or manually stop and roll back deployments if there are errors.<li>re-deploy that revision if you want to continue the stopped deployment at a later time.<li>or immediately rollback by redeploying the previous revision.</ul></ul><li> <font color="red"> Centralized control </font><ul><li><p>receive a report that lists when each application revision was deployed and to which Amazon EC2 instances.</p><li>Monitoring and control<ul><li>launch, control, and monitor deployments of the software directly from the AWS Management Console or by using the AWS CLI, SDKs, or APIs.<li>In the case of a failure, you can<ul><li>pinpoint the script experiencing failure.<li>set push notifications to monitor the status of the deployments via SMS or email through Amazon Simple Notification Service.</ul></ul><li>Deployment groups<ul><li>One application can be deployed to multiple deployment groups.<li>Deployment groups are used to match configurations to specific environments, such as a staging or production environments.<li>You can test a revision in staging and then deploy that same code with the same deployment instructions to production once you are satisfied.</ul><li>Deployment history<ul><li>tracks and stores the recent history of the deployments.<li>view which application versions are currently deployed to each of your target deployment groups.<li>inspect the change history and success rates of past deployments to specific deployment groups.<li>investigate a timeline of past deployments for a detailed view of the deployment successes and errors.</ul><li>quickly search for resources<ul><li>such as repositories, build projects, deployment applications, and pipelines.<li>Go to resource or press the / key &gt; type the name of the resource.<li>Any matches appear in the list.<li>Searches are case insensitive.<li>only see resources that you have permissions to view.</ul></ul><li> <font color="red"> Easy to adopt </font><ul><li>platform and language agnostic and works with any application.<li> <font color="blue"> easily reuse the setup code </font><ul><li>AWS CodeDeploy uses a file and command-based install model<ul><li>single AppSpec configuration file to run actions, tests, or verifications at each lifecycle event (phase of deployment).<li>The commands can be any code, such as a shell script, a custom program, or even a configuration management tool.</ul><li>enables it to deploy any application and reuse existing setup code.</ul><li>Tool chain integration<ul><li>easy to integrate application deployments with your existing <font color="blue"> software delivery toolchain </font> by using the AWS CodeDeploy APIs.<li>AWS CodePipeline, AWS CodeStar, and some AWS partners provide pre-built CodeDeploy integrations for continuous integration and continuous delivery services, making it simple to automatically deploy your updated application.<li>can deploy application content that <font color="red"> runs on a server </font> and is <font color="red"> stored in S3 buckets, GitHub repositories, or Bitbucket repositories </font></ul></ul><li> <font color="red"> 同时地 Concurrent deployments. </font><ul><li>have more than one application that uses the EC2/On-Premises compute platform, CodeDeploy can deploy them concurrently to the same set of instances.</ul><li> <font color="red"> Receive Notifications </font><ul><li>Review defined events<ul><li>create notifications for events impacting the deployments.<li>Notifications will come in the form of Amazon SNS notifications.<li>Each notification includes a status message as well as a link to the resources whose event generated that notification.</ul></ul></ol><hr /><h2 id="overview-of-codedeploy-compute-platforms">Overview of CodeDeploy compute platforms</h2><p>CodeDeploy is able to deploy applications to three compute platforms:</p><h3 id="1--ec2on-premises-compute-platform-">1. <font color="red"> EC2/On-Premises compute platform </font></h3><ul><li>Deployments that use physical servers like Amazon EC2 cloud instances, on-premises servers, or both.<li>Applications created using the EC2/On-Premises compute platform can be composed of executable files, configuration files, images, and more.<li>manage the way in which traffic is directed to instances by using:<ul><li> <font color="blue"> in-place deployment type </font><li>or <font color="blue"> blue/green deployment type </font></ul></ul><h3 id="2--aws-lambda-">2. <font color="red"> AWS Lambda </font></h3><ul><li>deploy applications that consist of an updated version of a Lambda function.<li>AWS Lambda manages the Lambda function in a serverless compute environment made up of a high-availability compute structure. All administration of the compute resources is performed by AWS Lambda<li>manage the way in which traffic is shifted to the updated Lambda function versions during a deployment by choosing:<ul><li> <font color="blue"> canary, linear, or all-at-once configuration </font></ul></ul><h3 id="3--amazon-ecs-">3. <font color="red"> Amazon ECS </font></h3><ul><li>deploy an Amazon ECS containerized application as a task set.<li>CodeDeploy performs a blue/green deployment by installing an updated version of the application as a new replacement task set.<li>CodeDeploy reroutes production traffic from the original application task set to the replacement task set.<li>The original task set is terminated after a successful deployment.<li>manage the way in which traffic is shifted to the updated task set during a deployment by choosing<ul><li> <font color="blue"> canary, linear, or all-at-once configuration </font><li>Amazon ECS blue/green deployments are supported using both CodeDeploy and AWS CloudFormation.</ul></ul><div class="table-wrapper"><table><thead><tr><th>CodeDeploy component<th>EC2/On-Premises<th>AWS Lambda<th>Amazon ECS<tbody><tr><td>Deployment group<td>Deploys a revision to a set of instances.<td>Deploys a new version of a serverless Lambda function on a high-availability compute infrastructure.<td>Specifies the Amazon ECS service with the containerized application to deploy as a task set, a production and optional test listener used to serve traffic to the deployed application, when to reroute traffic and terminate the deployed application’s original task set, and optional trigger, alarm, and rollback settings.<tr><td>Deployment<td>Deploys a new revision that consists of an application and AppSpec file. <font color="blue"> The AppSpec specifies how to deploy the application to the instances in a deployment group </font><td>Shifts production traffic from one version of a Lambda function to a new version of the same function. <font color="blue"> The AppSpec file specifies which Lambda function version to deploy </font><td>Deploys an updated version of an Amazon ECS containerized application as a new, replacement task set. CodeDeploy reroutes production traffic from the task set with the original version to the new replacement task set with the updated version. When the deployment completes, the original task set is terminated.<tr><td>Deployment configuration<td>Settings that determine <font color="blue"> the deployment speed and the minimum number of instances that must be healthy </font> at any point during a deployment.<td>Settings that determine <font color="blue"> how traffic is shifted </font> to the updated Lambda function versions.<td>Settings that determine <font color="blue"> how traffic is shifted </font> to the updated Amazon ECS task set.<tr><td>Revision<td>A combination of an AppSpec file and application files, such as executables, configuration files, and so on.<td>An AppSpec file that specifies which Lambda function to deploy and Lambda functions that can run validation tests during deployment lifecycle event hooks.<td>An AppSpec file that specifies: <br /> - The Amazon ECS task definition for the Amazon ECS service with the containerized application to deploy. <br /> - The container where your updated application is deployed. <br /> - A port for the container where production traffic is rerouted. <br /> - Optional network configuration settings and Lambda functions that can run validation tests during deployment lifecycle event hooks.<tr><td>Application<td>A collection of deployment groups and revisions. <br /> An EC2/On-Premises application uses the EC2/On-Premises compute platform.<td>A collection of deployment groups and revisions. <br /> An application used for an AWS Lambda deployment uses the serverless AWS Lambda compute platform.<td>A collection of deployment groups and revisions. <br /> An application used for an Amazon ECS deployment uses the Amazon ECS compute platform.</table></div><hr /><h2 id="codedeploy-deployment-approaches-types">CodeDeploy deployment approaches types</h2><p>CodeDeploy provides two <font color="red"> deployment approaches </font> type options:</p><ul><li> <font color="red"> In-place deployment </font><ul><li>hook: de-registering, installation, re-registering</ul><li> <font color="red"> Blue/Green deployment </font></ul><hr /><h3 id="bluegreen-deployment-vs-in-place-deployment">blue/green deployment vs in-place deployment</h3><p>A blue/green deployment offers a number of advantages over an in-place deployment:</p><ul><li><p>install and test an application in the new replacement environment and <font color="blue"> deploy it to production simply by rerouting traffic </font></p><li>the EC2/On-Premises compute platform, <font color="blue"> switching back to the most recent version of an application is faster and more reliable </font><ul><li>traffic can be routed back to the original instances as long as they have not been terminated.<li>With an in-place deployment, versions must be rolled back by redeploying the previous version of the application.</ul><li><p>EC2/On-Premises compute platform, new instances are provisioned for a blue/green deployment and reflect the most up-to-date server configurations. This helps you avoid the types of problems that sometimes occur on long-running instances.</p><li><p>AWS Lambda compute platform, you control how traffic is shifted from your original AWS Lambda function version to your new AWS Lambda function version.</p><li>Amazon ECS compute platform, you control how traffic is shifted from your original task set to your new task set.</ul><hr /><h3 id="-in-place-deployment-"><font color="red"> In-place deployment </font></h3><p>In-place deployment:</p><ul><li> <font color="red"> rolling update </font><li>The application on each instance in the deployment group is stopped<ul><li>the instance is offline</ul><li>the latest/new application revision is installed<ul><li>the new version of the application is started and validated.</ul></ul><p>The AppSpec file</p><ul><li>unique to CodeDeploy<li>It defines the deployment actions you want CodeDeploy to execute.</ul><p>You can use a load balancer so that each instance is deregistered during its deployment and then restored to service after the deployment is complete.</p><blockquote><p>Only deployments that use the EC2/On-Premises compute platform can use in-place deployments. AWS Lambda and Amazon ECS deployments cannot use an in-place deployment type.</p></blockquote><p><img data-proofer-ignore data-src="https://i.imgur.com/H9CWDpT.png" alt="sds_architecture" /></p><p>Here’s how it works:</p><ol><li>local development machine:<ul><li>bundle <font color="blue"> deployable content + Application specification file (AppSpec file) </font> into an <font color="red"> archive file (an application revision) </font><li>and then upload it to an Amazon S3 bucket or a GitHub repository.</ul><li>provide CodeDeploy with information about your deployment<ul><li>such as<ul><li>which Amazon S3 bucket or GitHub repository to pull the revision from<li>to which set of Amazon EC2 instances to deploy its contents.</ul><li> <font color="red"> deployment group </font><ul><li>CodeDeploy calls a set of Amazon EC2 instances a deployment group.<li>A deployment group contains<ul><li> <font color="blue"> individually tagged Amazon EC2 instances </font><li> <font color="blue"> Amazon EC2 instances in Amazon EC2 Auto Scaling groups </font><li>or both.</ul></ul><li>Each time successfully upload a new application revision to deploy to the deployment group, that bundle is set as the target revision for the deployment group.<li>In other words, the application revision that is currently targeted for deployment is the target revision.<li>This is also the revision that is pulled for automatic deployments.</ul><li> <font color="red"> CodeDeploy agent </font><p>on each instance</p><ul><li>polls CodeDeploy to determine what and when to pull from the specified Amazon S3 bucket or GitHub repository.<li>pulls the target revision from the Amazon S3 bucket or GitHub repository<li>using the instructions in the AppSpec file, deploys the contents to the instance.</ul></ol><p><img data-proofer-ignore data-src="https://i.imgur.com/04Fr8pe.png" alt="Screen Shot 2021-01-18 at 16.07.37" /></p><p><img data-proofer-ignore data-src="https://i.imgur.com/KporMZq.png" alt="Screen Shot 2021-01-18 at 16.08.10" /></p><p><img data-proofer-ignore data-src="https://i.imgur.com/W3jDElq.png" alt="Screen Shot 2021-01-18 at 16.08.23" /></p><hr /><h3 id="-bluegreen-deployment-"><font color="red"> Blue/Green deployment </font></h3><p>One of the challenges of automating deployment is the cutover,</p><ul><li>take software from the <font color="red"> final stage of testing to live production </font></ul><p>Blue/Green deployment</p><ol><li> <font color="red"> test new hardware or applications without going fully into production </font><li><p>update the applications while <font color="red"> minimizing interruptions caused by the changes </font> of a new application version.</p><li>CodeDeploy provisions your new application version alongside the old version <font color="red"> before rerouting your production traffic </font><ul><li>After the green deployment is complete and functional, begin to shut down or upgrade the blue deployment.</ul><li> <font color="red"> rapid roll back </font><ul><li>switching back to blue deployment if the green environment is not working properly.</ul></ol><p>blue/green deployment is highly desirable</p><ul><li>the live production environment is “blue”<li>the matching environment is “green”</ul><h4 id="bluegreen-deployment-on-different-compute-platform">Blue/green deployment on different compute platform</h4><p><strong>Blue/green deployment</strong>: The behavior of your deployment depends on which compute platform you use:</p><ol><li> <font color="red"> AWS Lambda </font><p>:</p><ul><li>Traffic is shifted from <font color="blue"> one version of a Lambda function to a new version of the same Lambda function </font><li>specify Lambda functions that perform validation tests and choose the way in which the traffic shifting occurs.</ul><li> <font color="red"> Amazon ECS </font><p>:</p><ul><li>Traffic is shifted from <font color="blue"> a task set in your Amazon ECS service to an updated, replacement task set in the same Amazon ECS service </font><li>can set the <font color="blue"> traffic shifting to linear or canary </font> through the deployment configuration.<li>The protocol and port of a specified load balancer listener is used to reroute production traffic.<li>During a deployment, a test listener can be used to serve traffic to the replacement task set while validation tests are run.</ul><li> <font color="red"> EC2/On-Premises </font><p>:</p><ul><li>Traffic is shifted from <font color="blue"> one set of instances in the original environment to a replacement/different set of instances </font><li>the original environment -&gt; the replacement environment<ul><li>Instances are provisioned for the replacement environment.<li>The latest application revision is installed on the replacement instances.<li>An optional wait time occurs for activities such as application testing and system verification.</ul><li>Elastic Load Balancing load balancer<ul><li> <font color="blue"> Instances in the replacement environment </font><p>are registered with an <font color="red"> Elastic Load Balancing load balancer </font>, causing traffic to be rerouted to them.</p><li> <font color="blue"> Instances in the original environment </font><p>are deregistered and can be terminated or kept running for other uses.</p></ul></ul><li> <font color="red"> AWS CloudFormation </font><p>:</p><ul><li>Traffic is shifted from your <font color="blue"> current resources to your updated resources </font> as part of an AWS CloudFormation stack update.<li><p>Currently, only Amazon ECS blue/green deployments are supported.</p><li>AWS CloudFormation templates for deployments:<ul><li>configure deployments with AWS CloudFormation templates<li>deployments are triggered by AWS CloudFormation updates.<li>change a resource and upload a template change, a <font color="blue"> stack update in AWS CloudFormation initiates the new deployment </font></ul><li>Blue/green deployments through AWS CloudFormation: use AWS CloudFormation to manage your blue/green deployments through stack updates.<ul><li>define both your blue and green resources, in addition to specifying the traffic routing and stabilization settings, within the stack template.<li>if update selected resources during a stack update, AWS CloudFormation generates all the necessary green resources, shifts the traffic based on the specified traffic routing parameters, and deletes the blue resources.</ul></ul></ol><p>overall</p><ul><li>All AWS Lambda and Amazon ECS deployments are blue/green. For this reason, do not need to specify a deployment type.<li>An EC2/On-Premises deployment can be in-place or blue/green.<ul><li>blue/green deployments work with Amazon EC2 instances only.</ul></ul><hr /><h4 id="bluegreen-deployment-through-lambda-and-ecs">Blue/Green deployment through lambda and ECS</h4><blockquote><p>If using the AWS Lambda compute platform, must choose the deployment configuration types specify <font color="blue"> how traffic is shifted from the original AWS Lambda function version to the new AWS Lambda function version </font></p></blockquote><blockquote><p>If you’re using the Amazon ECS compute platform, you must choose one of the following deployment configuration types to specify how traffic is shifted from the original Amazon ECS task set to the new Amazon ECS task set:</p></blockquote><ul><li><strong>Canary</strong> 金丝雀 :<ul><li>split traffic<li> <font color="red"> sending a small percentage </font><p>of the traffic to the new version of your application</p><li>Traffic is <font color="blue"> shifted in two increments </font><li><strong>predefined canary options</strong><ul><li> <font color="blue"> specify the percentage of traffic shifted </font><p>to the updated Lambda function version in the first increment</p><li>and the interval, in minutes, before the remaining traffic is shifted in the second increment.</ul></ul><li><strong>Linear</strong>:<ul><li>Traffic is shifted in <font color="red"> equal increments </font> with an <font color="red"> equal number of minutes </font> between each increment.<li><strong>predefined linear options</strong><ul><li>specify the percentage of traffic shifted in each increment<li>and the number of minutes between each increment.</ul></ul><li><strong>All-at-once</strong>:<ul><li>All traffic is shifted from the original Lambda function to the updated Lambda function version all at once.</ul></ul><hr /><h4 id="bluegreen-deployment-on-an-ec2on-premises-compute-platform">Blue/Green deployment on an EC2/on-premises compute platform</h4><blockquote><p>must use Amazon EC2 instances for blue/green deployments on the EC2/On-Premises compute platform. On-premises instances are not supported for the blue/green deployment type.</p></blockquote><p>to use the EC2/On-Premises compute platform, the following applies:</p><ul><li>must have one or more Amazon EC2 instances with identifying Amazon EC2 tags or an Amazon EC2 Auto Scaling group.<li>The instances must meet these additional requirements:<ul><li>Each Amazon EC2 instance must have the correct IAM instance profile attached.<li>The CodeDeploy agent must be installed and running on each instance.</ul></ul><blockquote><p>You typically also have an application revision running on the instances in your original environment, but this is not a requirement for a blue/green deployment.</p></blockquote><ul><li> <font color="red"> create a deployment group </font><p>that is used in blue/green deployments, <font color="red"> choose how your replacement environment is specified </font></p><ul><li> <font color="red"> Copy an existing Amazon EC2 Auto Scaling group </font><ul><li>During the blue/green deployment, CodeDeploy creates the instances for your replacement environment during the deployment.<li>CodeDeploy uses the Amazon EC2 Auto Scaling group you specify as a template for the replacement environment, including the same number of running instances and many other configuration options.</ul><li> <font color="red"> Choose instances manually </font><ul><li>specify the instances to be the replacement using <font color="blue"> Amazon EC2 instance tags, Amazon EC2 Auto Scaling group names, or both </font><li>do not need to specify the instances for the replacement environment until you create a deployment.</ul></ul></ul><p>Here’s how it works:</p><ol><li>have instances or an Amazon EC2 Auto Scaling group serves as the original environment.<ul><li>The first time you run a blue/green deployment, you typically use instances that were already used in an in-place deployment.</ul><li>In an existing CodeDeploy application<ul><li> <font color="blue"> create a blue/green deployment group </font><li>in addition to the options required for an in-place deployment, <font color="blue"> specify the following </font>:<ul><li>The load balancer: routes traffic from original environment to replacement environment during the blue/green deployment process.<li>Whether to reroute traffic to the replacement environment immediately or wait to reroute it manually.<li>The rate at which traffic is routed to the replacement instances.<li>Whether the instances that are replaced are terminated or kept running.</ul></ul><li>create a deployment for this deployment group during which the following occur:<ul><li>chose to copy an Amazon EC2 Auto Scaling group,<ul><li>instances are provisioned for your replacement environment.<li>The application revision you specify for the deployment is installed on the replacement instances.</ul><li>specified a wait time in the deployment group settings, the deployment is paused.<ul><li>This is the time when you can run tests and verifications in your replacement environment.<li>If you don’t manually reroute the traffic before the end of the wait period, the deployment is stopped.</ul><li> <font color="blue"> replacement environment Instances are registered with an Elastic Load Balancing load balancer </font><p>and traffic starts being routed to them.</p><li> <font color="blue"> original environment Instances are deregistered </font><p>and handled according to your specification in the deployment group, either terminated or kept running.</p></ul></ol><hr /><h4 id="bluegreen-deployment-through-aws-cloudformation">Blue/Green deployment through AWS CloudFormation</h4><p>manage CodeDeploy blue/green deployments by model the blue/green resources with an AWS CloudFormation template.</p><ol><li>create a stack update in AWS CloudFormation that updates your task set.<li>Production traffic shifts from your service’s original task set to a replacement task set<ul><li>either all at once,<li>with linear deployments and bake times,<li>or with canary deployments.</ul><li>The stack update initiates a deployment in CodeDeploy.</ol><blockquote><p>You can view the deployment status and history in CodeDeploy but you do not otherwise create or manage CodeDeploy resources outside of the AWS CloudFormation template. For blue/green deployments through AWS CloudFormation, you don’t create a CodeDeploy application or deployment group.</p></blockquote><blockquote><p>This method supports Amazon ECS blue/green deployments only.</p></blockquote><hr /><h2 id="appspec-file---application-specification-file">AppSpec File - Application Specification File</h2><p>a YAML-formatted or JSON-formatted file used by CodeDeploy to manage a deployment.</p><font color="red"> defines the parameters </font><p>to be used during a CodeDeploy deployment</p><div class="language-json highlighter-rouge"><div class="code-header" text-data="json"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="err">appspec.yml</span><span class="w">  </span><span class="err">//</span><span class="w"> </span><span class="err">must</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">root</span><span class="w">
</span><span class="err">/Scripts</span><span class="w">
</span><span class="err">/Config</span><span class="w">
</span><span class="err">/Source</span><span class="w">
</span></pre></table></code></div></div><p><img data-proofer-ignore data-src="https://i.imgur.com/YQVng95.png" alt="Screen Shot 2020-12-28 at 22.39.43" /></p><blockquote><p>Hooks: Lifycycle event hooks have a very specific run order</p></blockquote><ol><li><p>create a completed AppSpec file</p><li>bundle it with the content to deploy, into an archive file (zip, tar, or compressed tar).<blockquote><p>The tar and compressed tar archive file formats (.tar and .tar.gz) are not supported for Windows Server instances.</p></blockquote><li><p>upload it to an Amazon S3 bucket or Git repository.</p><li>use CodeDeploy to deploy the revision.</ol><h3 id="appspec-files-on-an-amazon-ecs-compute-platform">AppSpec files on an Amazon ECS compute platform</h3><p>the AppSpec file is used by CodeDeploy to determine:</p><ul><li> <font color="blue"> the Amazon ECS task definition file </font><p>. This is specified with its ARN in the TaskDefinition instruction in the AppSpec file.</p><li> <font color="blue"> The container and port in replacement task set </font><p>where your Application Load Balancer or Network Load Balancer reroutes traffic during a deployment. This is specified with the LoadBalancerInfo instruction in the AppSpec file.</p><li><p>Optional information about your Amazon ECS service, such the platform version on which it runs, its subnets, and its security groups.</p><li>Optional Lambda functions to run during hooks that correspond with lifecycle events during an Amazon ECS deployment.</ul><h3 id="appspec-files-on-an-aws-lambda-compute-platform">AppSpec files on an AWS Lambda compute platform</h3><p>the AppSpec file is used by CodeDeploy to determine:</p><ul><li><p>Which Lambda function version to deploy.</p><li><p>Which Lambda functions to use as validation tests.</p></ul><p>An AppSpec file can be YAML-formatted or JSON-formatted.</p><ul><li>can also enter the contents of an AppSpec file directly into CodeDeploy console when you create a deployment.</ul><h3 id="appspec-files-on-an-ec2on-premises-compute-platform">AppSpec files on an EC2/on-premises compute platform</h3><p>the AppSpec file</p><ul><li>YAML only, named <code class="language-plaintext highlighter-rouge">appspec.yml</code>.<li>must be placed in the root of the directory structure of an application’s source code. Otherwise, deployments fail.</ul><p>It is used by CodeDeploy to determine:</p><ul><li>What it should install onto your instances from your application revision in Amazon S3 or GitHub.<li>Which lifecycle event hooks to run in response to deployment lifecycle events.</ul><hr /><h3 id="appspec-file-spacing">AppSpec File spacing</h3><p>The following is the correct format for AppSpec file spacing. The numbers in square brackets indicate the number of spaces that must occur between items.</p><blockquote><p>CodeDeploy raises an error that might be difficult to debug if the locations and number of spaces in an AppSpec file are not correct.</p></blockquote><div class="language-yml highlighter-rouge"><div class="code-header" text-data="yml"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
</pre><td class="rouge-code"><pre><span class="s">version:[1]version-number</span>                      <span class="c1"># version: 0.0</span>
<span class="s">os:[1]operating-system-name</span>                    <span class="c1"># os: linux OR windows</span>
<span class="na">files</span><span class="pi">:</span>                                         <span class="c1"># files:</span>
<span class="pi">[</span><span class="nv">2</span><span class="pi">]</span><span class="s">-[1]source:[1]source-files-location</span>         <span class="c1">#  - source: /</span>
<span class="pi">[</span><span class="nv">4</span><span class="pi">]</span><span class="s">destination:[1]destination-files-location</span>   <span class="c1">#    destination: /var/www/html/WordPress</span>
<span class="na">permissions</span><span class="pi">:</span>                                   <span class="c1"># permissions:</span>
<span class="pi">[</span><span class="nv">2</span><span class="pi">]</span><span class="s">-[1]object:[1]object-specification</span>
<span class="pi">[</span><span class="nv">4</span><span class="pi">]</span><span class="s">pattern:[1]pattern-specification</span>
<span class="pi">[</span><span class="nv">4</span><span class="pi">]</span><span class="s">except:[1]exception-specification</span>
<span class="pi">[</span><span class="nv">4</span><span class="pi">]</span><span class="s">owner:[1]owner-account-name</span>
<span class="pi">[</span><span class="nv">4</span><span class="pi">]</span><span class="s">group:[1]group-name</span>
<span class="pi">[</span><span class="nv">4</span><span class="pi">]</span><span class="s">mode:[1]mode-specification</span>
<span class="pi">[</span><span class="nv">4</span><span class="pi">]</span><span class="na">acls</span><span class="pi">:</span>                                       <span class="c1"># [4]acls:</span>
<span class="pi">[</span><span class="nv">6</span><span class="pi">]</span><span class="s">-[1]acls-specification</span>
<span class="pi">[</span><span class="nv">4</span><span class="pi">]</span><span class="na">context</span><span class="pi">:</span>
<span class="pi">[</span><span class="nv">6</span><span class="pi">]</span><span class="s">user:[1]user-specification</span>
<span class="pi">[</span><span class="nv">6</span><span class="pi">]</span><span class="s">type:[1]type-specification</span>
<span class="pi">[</span><span class="nv">6</span><span class="pi">]</span><span class="s">range:[1]range-specification</span>
<span class="pi">[</span><span class="nv">4</span><span class="pi">]</span><span class="na">type</span><span class="pi">:</span>
<span class="pi">[</span><span class="nv">6</span><span class="pi">]</span><span class="s">-[1]object-type</span>
<span class="na">hooks</span><span class="pi">:</span>                                         <span class="c1"># hooks:</span>
<span class="pi">[</span><span class="nv">2</span><span class="pi">]</span><span class="na">deployment-lifecycle-event-name</span><span class="pi">:</span>            <span class="c1">#   BeforeInstall:</span>
<span class="pi">[</span><span class="nv">4</span><span class="pi">]</span><span class="s">-[1]location:[1]script-location</span>             <span class="c1">#     - location: scripts/install_dependencies.sh</span>
<span class="pi">[</span><span class="nv">6</span><span class="pi">]</span><span class="s">timeout:[1]timeout-in-seconds</span>               <span class="c1">#       timeout: 300</span>
<span class="pi">[</span><span class="nv">6</span><span class="pi">]</span><span class="s">runas:[1]user-name</span>                          <span class="c1">#       runas: root</span>
                                               <span class="c1">#   AfterInstall:</span>
                                               <span class="c1">#     - location: scripts/change_permissions.sh</span>
                                               <span class="c1">#       timeout: 300</span>
                                               <span class="c1">#       runas: root</span>
                                               <span class="c1">#   ApplicationStart:</span>
                                               <span class="c1">#     - location: scripts/start_server.sh</span>
                                               <span class="c1">#     - location: scripts/create_test_db.sh</span>
                                               <span class="c1">#       timeout: 300</span>
                                               <span class="c1">#       runas: root</span>
                                               <span class="c1">#   ApplicationStop:</span>
                                               <span class="c1">#     - location: scripts/stop_server.sh</span>
                                               <span class="c1">#       timeout: 300</span>
                                               <span class="c1">#       runas: root</span>

<span class="c1"># example of a correctly spaced AppSpec file:</span>
<span class="na">version</span><span class="pi">:</span> <span class="m">0.0</span>
<span class="na">os</span><span class="pi">:</span> <span class="s">linux</span>
<span class="na">files</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">source</span><span class="pi">:</span> <span class="s">/</span>
    <span class="na">destination</span><span class="pi">:</span> <span class="s">/var/www/html/WordPress</span>
<span class="na">hooks</span><span class="pi">:</span>
  <span class="na">BeforeInstall</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">location</span><span class="pi">:</span> <span class="s">scripts/install_dependencies.sh</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="m">300</span>
      <span class="na">runas</span><span class="pi">:</span> <span class="s">root</span>
  <span class="na">AfterInstall</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">location</span><span class="pi">:</span> <span class="s">scripts/change_permissions.sh</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="m">300</span>
      <span class="na">runas</span><span class="pi">:</span> <span class="s">root</span>
  <span class="na">ApplicationStart</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">location</span><span class="pi">:</span> <span class="s">scripts/start_server.sh</span>
    <span class="pi">-</span> <span class="na">location</span><span class="pi">:</span> <span class="s">scripts/create_test_db.sh</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="m">300</span>
      <span class="na">runas</span><span class="pi">:</span> <span class="s">root</span>
  <span class="na">ApplicationStop</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">location</span><span class="pi">:</span> <span class="s">scripts/stop_server.sh</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="m">300</span>
      <span class="na">runas</span><span class="pi">:</span> <span class="s">root</span>


<span class="c1"># example of a correctly spaced AppSpec file:</span>
<span class="na">version</span><span class="pi">:</span> <span class="m">0.0</span>
<span class="na">os</span><span class="pi">:</span> <span class="s">linux</span>
<span class="na">files</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">source</span><span class="pi">:</span> <span class="s">Config/config.txt</span>
    <span class="na">destination</span><span class="pi">:</span> <span class="s">/webapps/Config</span>
  <span class="pi">-</span> <span class="na">source</span><span class="pi">:</span> <span class="s">Source</span>
    <span class="na">destination</span><span class="pi">:</span> <span class="s">/webapps/Config</span>
<span class="na">hooks</span><span class="pi">:</span>
  <span class="na">BeforeInstall</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">location</span><span class="pi">:</span> <span class="s">scripts/install_dependencies.sh</span>
    <span class="pi">-</span> <span class="na">location</span><span class="pi">:</span> <span class="s">scripts/UnzipResourceBundle.sh</span>
      <span class="na">location</span><span class="pi">:</span> <span class="s">scripts/UnzipDataBundle.sh</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="m">300</span>
      <span class="na">runas</span><span class="pi">:</span> <span class="s">root</span>
  <span class="na">AfterInstall</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">location</span><span class="pi">:</span> <span class="s">scripts/change_permissions.sh</span>
    <span class="pi">-</span> <span class="na">location</span><span class="pi">:</span> <span class="s">scripts/RunResourceTests.sh</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="m">300</span>
      <span class="na">runas</span><span class="pi">:</span> <span class="s">root</span>
  <span class="na">ApplicationStart</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">location</span><span class="pi">:</span> <span class="s">scripts/start_server.sh</span>
    <span class="pi">-</span> <span class="na">location</span><span class="pi">:</span> <span class="s">scripts/create_test_db.sh</span>
    <span class="pi">-</span> <span class="na">location</span><span class="pi">:</span> <span class="s">scripts/RunFunctionTests.sh</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="m">300</span>
      <span class="na">runas</span><span class="pi">:</span> <span class="s">root</span>
  <span class="na">ValidataService</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">location</span><span class="pi">:</span> <span class="s">scripts/MonitorService.sh</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="m">3600</span>
      <span class="na">runas</span><span class="pi">:</span> <span class="s">CodeDeployuser</span>
<span class="na">ApplicationStop</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">location</span><span class="pi">:</span> <span class="s">scripts/stop_server.sh</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="m">300</span>
      <span class="na">runas</span><span class="pi">:</span> <span class="s">root</span>
</pre></table></code></div></div><hr /><h3 id="codedeploy-lifecycle-event-hooks">CodeDeploy Lifecycle Event Hooks</h3><p><img data-proofer-ignore data-src="https://i.imgur.com/0dhiM3N.png" alt="Screen Shot 2020-12-28 at 22.52.25" /></p><p><img data-proofer-ignore data-src="https://i.imgur.com/EnvL4Zi.png" alt="Screen Shot 2020-12-28 at 22.59.32" /></p><p><img data-proofer-ignore data-src="https://i.imgur.com/HlCCRwz.png" alt="Screen Shot 2020-12-28 at 22.59.18" /></p><p><img data-proofer-ignore data-src="https://i.imgur.com/TKYJgop.png" alt="Screen Shot 2020-12-28 at 23.00.21" /></p><div class="table-wrapper"><table><thead><tr><th>Lifecycle event name<th>In-place deployment<th>Blue/green deployment<th> <th> <th> <tbody><tr><td>Lifecycle event name<td>In-place deployment<td>Blue/green deployment: Original instances<td>Blue/green deployment: Replacement instances<td>Blue/green deployment rollback: Original instances<td>Blue/green deployment rollback: Replacement instances<tbody><tr><td>BeforeBlockTraffic<td>✓<td>✓<td> <td> <td>✓<tr><td>BlockTraffic<td>✓<td>✓<td> <td> <td>✓<tr><td>AfterBlockTraffic<td>✓<td>✓<td> <td> <td>✓<tr><td>ApplicationStop <br /> <font color="red"> gracefully stop the app </font><td>✓<td> <td>✓<td> <td> <tr><td>DownloadBundle <br /> <font color="red"> CodeDeploy agent copy the revision files to location <br /> </font><td>✓<td> <td>✓<td> <td> <tr><td>BeforeInstall <br /> <font color="red"> pre-install, backup the current version, configurstion, decrypting files </font><td>✓<td> <td>✓<td> <td> <tr><td>Install <br /> <font color="red"> copy application file to final location </font><td>✓<td> <td>✓<td> <td> <tr><td>AfterInstall <br /> <font color="red"> post-install, configuration, file permissions <br /> </font><td>✓<td> <td>✓<td> <td> <tr><td>ApplicationStart <br /> <font color="red"> start servicesthat were stop during application stop <br /> </font><td>✓<td> <td>✓<td> <td> <tr><td>ValidateService <br /> <font color="red"> run tests to validate the service</font><td>✓<td> <td>✓<td> <td> <tr><td>BeforeAllowTraffic<td>✓<td> <td>✓<td>✓<td> <tr><td>AllowTraffic<td>✓<td> <td>✓<td>✓<td> <tr><td>AfterAllowTraffic<td>✓<td> <td>✓<td>✓<td> </table></div><hr /><h2 id="setup-an-app-in-codedeploy">Setup an app in CodeDeploy</h2><blockquote><ol><li>setup ec2 role (EC2 - S3FullAcess)<li>setup CodeDeploy role (CodeDeploy - AWSCodeDeployRole)<li>create ec2 with ec2 role<li>install CodeDeploy agent on ec2 instance<li>create IAM user for local machine to CodeDeploy<li>create application.zip<li>create S3 bucket<li>create application.zip and load it to CodeDeploy<li>app should be in CodeDeploy<li>create depolyment group</ol></blockquote><ol><li>setup ec2 role (EC2 - S3FullAcess)<li>setup CodeDeploy role (CodeDeploy - AWSCodeDeployRole)<ul><li>autoscaling, tag, sns, cloudwatch, elasticloadbalancing</ul><li>create ec2 with ec2 role<li><p>install CodeDeploy agent on ec2 instance</p><div class="language-bash highlighter-rouge"><div class="code-header" text-data="bash"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre> <span class="c"># install CodeDeploy agent</span>
 <span class="nb">sudo </span>yum update
 <span class="nb">sudo </span>yum <span class="nb">install </span>ruby
 <span class="nb">sudo </span>yum <span class="nb">install </span>wget
 <span class="nb">cd</span> /home.ec2-user
 <span class="c"># CodeDeploy agent file</span>
 wget https://aws-CodeDeploy-eu-west-2.s3.amazonaws.com/latest/install
 <span class="nb">chmod</span> +x ./install
 <span class="nb">sudo</span> ./install auto
 <span class="nb">sudo </span>service CodeDeploy-agent status
</pre></table></code></div></div><li>create IAM user for local machine to CodeDeploy<ul><li>CodeDeploy&amp;s3 policy<div class="language-bash highlighter-rouge"><div class="code-header" text-data="bash"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre> aws configure
 <span class="c"># add access key id</span>
 <span class="c"># add secrect access key</span>
</pre></table></code></div></div></ul><li><p>create application.zip</p><div class="language-bash highlighter-rouge"><div class="code-header" text-data="bash"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre> application.zip
 - appspec.yml
 - index.html
 - scripts/
   - install_dependencies.sh
   - start_server.sh
   - stop_server.sh

 <span class="c"># appspec.yml</span>
 version: 0.0
 os: linux
 files:
   - <span class="nb">source</span>: /index.html
     destination: /var/www/html
 hooks:
   BeforeInstall:
     - location: scripts/install_dependencies.sh
       <span class="nb">timeout</span>: 300
       runas: root
     - location: scripts/start_server.sh
       <span class="nb">timeout</span>: 300
       runas: root
   ApplicationStop:
     - location: scripts/stop_server.sh
       <span class="nb">timeout</span>: 300
       runas: root

 <span class="c"># install_dependencies.sh</span>
 yum <span class="nb">install</span> <span class="nt">-y</span> httpd
 <span class="c"># start_server.sh</span>
 service httpd start
 <span class="c"># stop_server.sh</span>
 service httpd stop
</pre></table></code></div></div><li><p>create S3 bucket</p><li><p>create application.zip and load it to CodeDeploy</p><div class="language-bash highlighter-rouge"><div class="code-header" text-data="bash"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre> <span class="c"># create application</span>
 aws CodeDeploy create-application <span class="nt">--application-name</span> mywebapp
 <span class="c"># push app to s3</span>
 aws CodeDeploy push <span class="nt">--application-name</span> mywebapp <span class="nt">--s3-location</span> s3://&lt;My_Bucket_name&gt;//webapp.zip <span class="nt">--install</span>
</pre></table></code></div></div><li><p>app should be in CodeDep</p><li>create depolyment group<ul><li>select service role, deployment type, deployment setting (Allatonce, HalfAtATime, OneAtATime), load balancer.</ul><li>Create Deployment<ul><li>select revision location (S3/Github)<li>rollback</ul></ol><p>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/01aws/'>01AWS</a>, <a href='/categories/codedevelop/'>CodeDevelop</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/aws/" class="post-tag no-text-decoration" >AWS</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=AWS - CodeDevelop - CodeDeploy - Grace&url=https://ocholuo.github.io//posts/3CodeDeploy/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=AWS - CodeDevelop - CodeDeploy - Grace&u=https://ocholuo.github.io//posts/3CodeDeploy/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=AWS - CodeDevelop - CodeDeploy - Grace&url=https://ocholuo.github.io//posts/3CodeDeploy/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Amazon-CloudFront/">AWS Lab - AWS CloudFront</a><li><a href="/posts/Alexa-1stSkill/">AWS Alex First Skill - RedVelvet Time</a><li><a href="/posts/NetworkProtocol-SSL-TLS-Handshake/">NetworkProtocol SSL/TLS Handshake</a><li><a href="/posts/pythonCrash/">Python Crash</a><li><a href="/posts/%E4%B8%80%E5%8F%A5%E8%AF%9D%E8%A7%A3%E9%87%8AAWS/">AWS - 一句话解释AWS</a><li><a href="/posts/GKE/">GCP - Google Cloud Computing - Kubernetes and Kubernetes Engine</a><li><a href="/posts/Go-Note/">Go Note</a><li><a href="/posts/SCPs/">AWS - IdenAccessManage - SCPs (Service Control Policies)</a><li><a href="/posts/CompanyBenefit/">Company Benefit</a><li><a href="/posts/Encryption-SSL&TLS/">Cryptography - SSL/TLS Encryption</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/cyberattack/">CyberAttack</a> <a class="post-tag" href="/tags/lab/">Lab</a> <a class="post-tag" href="/tags/cyberattacktools/">CyberAttackTools</a> <a class="post-tag" href="/tags/gcp/">GCP</a> <a class="post-tag" href="/tags/sysadmin/">Sysadmin</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/soc/">SOC</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/0CodePipeline/"><div class="card-body"> <span class="timeago small" >Jul 18, 2020<i class="unloaded">2020-07-18T11:11:11-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS - CodeDevelop - CodePipeline</h3><div class="text-muted small"><p> CodePipeline basic Components of AWS Data Pipeline Accessing AWS Data Pipeline Related Services Pipeline Components, Instances, and Attempts Pipeline Def...</p></div></div></a></div><div class="card"> <a href="/posts/1CodeCommit/"><div class="card-body"> <span class="timeago small" >Jul 18, 2020<i class="unloaded">2020-07-18T11:11:11-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS - CodeDevelop - CodeCommit</h3><div class="text-muted small"><p> CodeCommit basic work flow setup CodeCommit a version control service hosted by Amazon Web Services tracks and manages code changes Ma...</p></div></div></a></div><div class="card"> <a href="/posts/2CodeBuild/"><div class="card-body"> <span class="timeago small" >Jul 18, 2020<i class="unloaded">2020-07-18T11:11:11-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS - CodeDevelop - CodeBuild</h3><div class="text-muted small"><p> CodeBuild How to run CodeBuild manually docker build process codebuild auto build docker CodeBuild # docker command to build, tag and push you docker image to...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/2CodeBuildTemplate-buildspec/" class="btn btn-outline-primary" prompt="Older"><p>AWS - CodeDevelop - CodeBuild - buildspec.yml Template</p></a> <a href="/posts/3CodeDeployTemplate-appspec/" class="btn btn-outline-primary" prompt="Newer"><p>AWS - CodeDevelop - CodeDeploy - appspec.yml Template</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/ocholuo">Grace JyL</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/cyberattack/">CyberAttack</a> <a class="post-tag" href="/tags/lab/">Lab</a> <a class="post-tag" href="/tags/cyberattacktools/">CyberAttackTools</a> <a class="post-tag" href="/tags/gcp/">GCP</a> <a class="post-tag" href="/tags/sysadmin/">Sysadmin</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/soc/">SOC</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://ocholuo.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script async src="https://cdn.jsdelivr.net/npm/countup.js@1.9.3/dist/countUp.min.js"></script> <script defer src="/assets/js/dist/pvreport.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-179830187-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-179830187-1'); }); </script>
