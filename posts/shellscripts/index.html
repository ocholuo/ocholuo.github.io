<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="pv-proxy-endpoint" content="https://myochosite-291718.appspot.com/query?id=ahNwfm15b2Nob3NpdGUtMjkxNzE4chULEghBcGlRdWVyeRiAgIDo14eBCgw"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="ShellScripts" /><meta property="og:locale" content="en" /><meta name="description" content="Writing Shell Scripts" /><meta property="og:description" content="Writing Shell Scripts" /><link rel="canonical" href="https://ocholuo.github.io//posts/shellscripts/" /><meta property="og:url" content="https://ocholuo.github.io//posts/shellscripts/" /><meta property="og:site_name" content="Grace" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-07-16T11:11:11-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="ShellScripts" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-10-30T21:02:21-04:00","datePublished":"2020-07-16T11:11:11-04:00","description":"Writing Shell Scripts","headline":"ShellScripts","mainEntityOfPage":{"@type":"WebPage","@id":"https://ocholuo.github.io//posts/shellscripts/"},"url":"https://ocholuo.github.io//posts/shellscripts/"}</script><title>ShellScripts | Grace</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Grace"><meta name="application-name" content="Grace"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://myochosite-291718.appspot.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://myochosite-291718.appspot.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/huoye.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Grace</a></div><div class="site-subtitle font-italic">2023 Mar 14 updated</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/ocholuo" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>ShellScripts</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>ShellScripts</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Grace JyL </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Jul 16, 2020, 11:11 AM -0400" >Jul 16, 2020<i class="unloaded">2020-07-16T11:11:11-04:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Oct 30, 2022, 6:02 PM -0700" >Oct 30, 2022<i class="unloaded">2022-10-30T21:02:21-04:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="12622 words">70 min read</span> <span id="pv" class="pageviews"> <i class="fas fa-spinner fa-spin fa-fw"></i> </span> views</div></div><div class="post-content"><h1 id="writing-shell-scripts">Writing Shell Scripts</h1><p>[toc]</p><h1 id="what-are-shell-scripts">What are Shell Scripts?</h1><p>ref http://linuxcommand.org/lc3_wss0140.php</p><p>With the thousands of commands available for the command line user, how can you remember them all? The answer is, you don’t. The real power of the computer is its ability to do the work for you. To get it to do that, we use <code class="language-plaintext highlighter-rouge">shell</code> to automate things. We write <code class="language-plaintext highlighter-rouge">shell scripts</code>.</p><ul><li>a file containing a series of commands.<li>The <code class="language-plaintext highlighter-rouge">shell</code> reads this file and carries out the commands as though they have been entered directly on the command line.</ul><p>The shell is somewhat unique, in that it is both a <code class="language-plaintext highlighter-rouge">powerful command line interface</code> to the system and a <code class="language-plaintext highlighter-rouge">scripting language interpreter</code>. As we will see, most of the things that can be done on the command line can be done in scripts, and most of the things that can be done in scripts can be done on the command line.</p><p>To successfully write a shell script, you have to do three things:</p><ul><li><code class="language-plaintext highlighter-rouge">Write</code> a script<li>Give the shell permission to <code class="language-plaintext highlighter-rouge">execute</code> it<li>Put it somewhere the shell can <code class="language-plaintext highlighter-rouge">find</code> it</ul><h2 id="writing-a-script">Writing a Script</h2><p>A shell script is a file that contains ASCII text. To create a shell script, you use a text editor that reads and writes ASCII text files.</p><p>There are many, many text editors available for your Linux system, both for the command line environment and the GUI environment. Here is a list of some common ones:</p><p><code class="language-plaintext highlighter-rouge">vi, vim</code> command line</p><ul><li>The granddaddy of Unix text editors<li>infamous for its difficult, non-intuitive command structure. On the bright side, vi is powerful, lightweight, and fast. On most Linux distributions, an enhanced version of the traditional <code class="language-plaintext highlighter-rouge">vi</code> editor called <code class="language-plaintext highlighter-rouge">vim</code> is used.</ul><p><code class="language-plaintext highlighter-rouge">Emacs</code> command line</p><ul><li>The true giant in the world of text editors is Emacs by Richard Stallman.<li>Emacs contains (or can be made to contain) every feature ever conceived for a text editor. It should be noted that vi and Emacs fans fight bitter religious wars over which is better.</ul><p><code class="language-plaintext highlighter-rouge">nano</code> command line</p><ul><li>nano is a free clone of the text editor supplied with the pine email program. nano is very easy to use but is very short on features. I recommend nano for first-time users who need a command line editor.</ul><p><code class="language-plaintext highlighter-rouge">gedit</code> graphical</p><ul><li>gedit is the editor supplied with the Gnome desktop environment.</ul><p><code class="language-plaintext highlighter-rouge">kwrite</code> graphical</p><ul><li>kwrite is the “advanced editor” supplied with KDE. It has syntax highlighting, a helpful feature for programmers and script writers.</ul><p>use text editor and type in your first script as follows:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>#!/bin/bash
# My first script

echo "Hello World!"
</pre></table></code></div></div><p>The first line of the script is important. This is <code class="language-plaintext highlighter-rouge">shebang</code>, given to the shell indicating what program is used to interpret the script. In this case, it is /bin/bash. Other scripting languages such as Perl, awk, tcl, Tk, and python also use this mechanism.</p><p>The second line is a <code class="language-plaintext highlighter-rouge">comment</code>. Everything that appears after a “#” symbol is ignored by bash. As your scripts become bigger and more complicated, comments become vital. They are used by programmers to explain what is going on so that others can figure it out.</p><p>The last line is the echo command. echo: prints its arguments on the display.</p><h2 id="setting-permissions">Setting Permissions</h2><p>The next thing, give the <code class="language-plaintext highlighter-rouge">shell</code> permission to execute your script.</p><p>$ chmod 755 hello_world</p><p>The “755” will give you read, write, and execute permission. Everybody else will get only read and execute permission. If you want your script to be private (i.e., only you can read and execute), use “700” instead.</p><h2 id="putting-it-in-your-path">Putting It in Your Path</h2><p>At this point, your script will run. $ ./hello_world</p><p>You should see “Hello World!” displayed. If you do not, see what directory you really saved your script in, go there and try again.</p><h2 id="talk-about-paths">talk about paths.</h2><ul><li>When you type in the name of a command, the system does not search the entire computer to find where the program is located.<li>You have noticed that you don’t usually have to specify a complete path name to the program you want to run, the shell just seems to know.<li>The shell does know. Here’s how:<ul><li>the shell maintains a list of directories where executable files (programs) are kept, and only searches the directories in that list.<li>If it does not find the program after searching each directory in the list, it will issue the famous command not found error message.<li>This list of directories is called your path. You can view the list of directories with the following command: <code class="language-plaintext highlighter-rouge">$ echo $PATH</code></ul></ul><p>This will return a colon separated list of directories that will be searched if a specific path name is not given when a command is attempted. In our first attempt to execute your new script, we specified a pathname (“./”) to the file.</p><p>You can add directories to your path with the following command, where directory is the name of the directory you want to add: <code class="language-plaintext highlighter-rouge">$ export PATH=$PATH:directory</code></p><p>A better way would be to edit your <code class="language-plaintext highlighter-rouge">.bash_profile</code> or <code class="language-plaintext highlighter-rouge">.profile</code> file to include the above command. That way, it would be done automatically every time you log in.</p><p>Most Linux distributions encourage a practice in which each user has a specific directory for the programs he/she personally uses: <code class="language-plaintext highlighter-rouge">bin</code>. If you do not already have one, create it: <code class="language-plaintext highlighter-rouge">$ mkdir bin</code> Move your script into <code class="language-plaintext highlighter-rouge">bin</code> directory and you’re all set. Now you just have to type: <code class="language-plaintext highlighter-rouge">$ hello_world</code> and your script will run.</p><p>On some distributions, most notably Ubuntu, you will need to open a new terminal session before your newly created bin directory will be recognized.</p><h2 id="editing-the-scripts-you-already-have">Editing the Scripts You Already Have</h2><p>you have some scripts of your own already. These scripts were put into your home directory when your account was created, and are used to configure the behavior of your sessions on the computer.</p><p>You can edit these scripts to change things.</p><h3 id="environment">environment</h3><p>During your session, the system is holding a number of facts about the world in its memory. This information is called the <code class="language-plaintext highlighter-rouge">environment</code>. The environment contains such things as your path, your user name, the name of the file where your mail is delivered, and much more. You can see a complete list of what is in your environment with the <code class="language-plaintext highlighter-rouge">set</code> command.</p><p>Two types of commands are often contained in the <code class="language-plaintext highlighter-rouge">environment</code>. They are <code class="language-plaintext highlighter-rouge">aliases</code> and <code class="language-plaintext highlighter-rouge">shell functions</code>.</p><h4 id="how-is-the-environment-established">How is the Environment Established?</h4><p>When you log on to the system, the <code class="language-plaintext highlighter-rouge">bash</code> program starts, and reads a series of configuration scripts called <code class="language-plaintext highlighter-rouge">startup files</code>. These define the default environment shared by all users. This is followed by more startup files in your home directory that define your personal environment. The exact sequence depends on the type of shell session being started.</p><p>There are two kinds: a <code class="language-plaintext highlighter-rouge">login shell session</code> and a <code class="language-plaintext highlighter-rouge">non-login shell session</code>.</p><ul><li><code class="language-plaintext highlighter-rouge">login shell session</code>: one in which we are prompted for our user name and password; when we start a virtual console session, for example.<li><code class="language-plaintext highlighter-rouge">non-login shell session</code> typically occurs when we launch a terminal session in the GUI.</ul><p><code class="language-plaintext highlighter-rouge">Login shells</code> read one or more startup files as shown below:</p><ul><li><code class="language-plaintext highlighter-rouge">/etc/profile</code> :<ul><li>A global configuration script that applies to all users.</ul><li><code class="language-plaintext highlighter-rouge">~/.bash_profile</code> :<ul><li>A user’s personal startup file.<li>Can be used to extend or override settings in the global configuration script.</ul><li><code class="language-plaintext highlighter-rouge">~/.bash_login</code> :<ul><li>If ~/.bash_profile is not found, bash attempts to read this script.</ul><li><code class="language-plaintext highlighter-rouge">~/.profile</code> :<ul><li>If neither ~/.bash_profile nor ~/.bash_login is found, bash attempts to read this file.<li>This is the default in Debian-based distributions, such as Ubuntu.</ul></ul><p><code class="language-plaintext highlighter-rouge">Non-login shell sessions</code> read the following startup files:</p><ul><li><code class="language-plaintext highlighter-rouge">/etc/bash.bashrc</code> :<ul><li>A global configuration script that applies to all users.</ul><li><code class="language-plaintext highlighter-rouge">~/.bashrc</code> :<ul><li>A user’s personal startup file.<li>Can be used to extend or override settings in the global configuration script.</ul></ul><p>In addition to reading the startup files above, non-login shells also inherit the environment from their parent process, usually a login shell.</p><p>Take a look at your system and see which of these startup files you have. most of the file names listed above start with a period (hidden), need to use the “-a” option</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>$ cat profile
# System-wide .profile for sh(1)

if [ -x /usr/libexec/path_helper ]; then
	eval `/usr/libexec/path_helper -s`
fi

if [ "${BASH-no}" != "no" ]; then
	[ -r /etc/bashrc ] &amp;&amp; . /etc/bashrc
fi
---------------------------------------------
$ cat bashrc
# System-wide .bashrc file for interactive bash(1) shells.
if [ -z "$PS1" ]; then
 return
fi

PS1='\h:\W \u\$ '
# Make bash check its window size after a process completes
shopt -s checkwinsize

[ -r "/etc/bashrc_$TERM_PROGRAM" ] &amp;&amp; . "/etc/bashrc_$TERM_PROGRAM"
</pre></table></code></div></div><p>The <code class="language-plaintext highlighter-rouge">~/.bashrc</code> file is probably the most important startup file from the ordinary user’s point of view, since it is almost always read. Non-login shells read it by default and most startup files for login shells are written in such a way as to read the ~/.bashrc file as well.</p><p>look inside a typical .bash_profile</p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c1"># .bash_profile
# Get the aliases and functions
# Lines not read by the shell. for human readability.
</span><span class="k">if</span> <span class="p">[</span> <span class="o">-</span><span class="n">f</span> <span class="o">~/</span><span class="p">.</span><span class="n">bashrc</span> <span class="p">];</span> <span class="n">then</span>
	<span class="p">.</span> <span class="o">~/</span><span class="p">.</span><span class="n">bashrc</span>
<span class="n">fi</span>

<span class="o">-</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">called</span> <span class="n">an</span> <span class="k">if</span> <span class="n">compound</span> <span class="n">command</span>
<span class="o">-</span> <span class="n">If</span> <span class="n">the</span> <span class="nb">file</span> <span class="s">"~/.bashrc"</span> <span class="n">exists</span><span class="p">,</span> <span class="n">then</span> <span class="n">read</span> <span class="n">the</span> <span class="s">"~/.bashrc"</span> <span class="nb">file</span><span class="p">.</span>
<span class="o">-</span> <span class="n">this</span> <span class="n">bit</span> <span class="n">of</span> <span class="n">code</span> <span class="ow">is</span> <span class="n">how</span> <span class="n">a</span> <span class="n">login</span> <span class="n">shell</span> <span class="n">gets</span> <span class="n">the</span> <span class="n">contents</span> <span class="n">of</span> <span class="p">.</span><span class="n">bashrc</span><span class="p">.</span>

<span class="c1"># User specific environment and startup programs
</span><span class="n">PATH</span><span class="o">=</span><span class="err">$</span><span class="n">PATH</span><span class="p">:</span><span class="err">$</span><span class="n">HOME</span><span class="o">/</span><span class="nb">bin</span>
<span class="c1"># The next thing in our startup file, set set PATH variable to add the ~/bin directory to the path.
</span><span class="n">export</span> <span class="n">PATH</span>
<span class="c1"># The export command tells the shell to make the contents of PATH available to child processes of this shell.
</span></pre></table></code></div></div><h3 id="aliases">Aliases</h3><p>An alias is an easy way to create a new command which acts as an abbreviation for a longer one. <code class="language-plaintext highlighter-rouge">alias name=value</code></p><ul><li>name: the name of the new command<li>value: the text to be executed whenever name is entered on the command line.</ul><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="n">create</span> <span class="n">an</span> <span class="n">alias</span> <span class="n">called</span> <span class="s">"l"</span> <span class="ow">and</span> <span class="n">make</span> <span class="n">it</span> <span class="n">an</span> <span class="n">abbreviation</span> <span class="k">for</span> <span class="n">the</span> <span class="n">command</span> <span class="s">"ls -l"</span><span class="p">.</span>
<span class="c1"># Make sure you are in your home directory.
# open the file .bashrc and add this line to the end of the file:
</span><span class="n">alias</span> <span class="n">l</span><span class="o">=</span><span class="s">'ls -l'</span>
<span class="c1"># we have created a new command called "l" which will perform "ls -l".
#To try out your new command, close your terminal session and start a new one. This will reload the .bashrc file.
</span>
<span class="c1"># Using this technique, you can create any number of custom commands for yourself. Here is another one for you to try:
</span><span class="n">alias</span> <span class="n">today</span><span class="o">=</span><span class="s">'date +"%A, %B %-d, %Y"'</span>
<span class="c1"># This alias creates a new command called "today" that will display today's date with nice formatting.
</span>
<span class="n">By</span> <span class="n">the</span> <span class="n">way</span><span class="p">,</span> <span class="n">the</span> <span class="n">alias</span> <span class="n">command</span> <span class="ow">is</span> <span class="n">just</span> <span class="n">another</span> <span class="n">shell</span> <span class="n">builtin</span><span class="p">.</span>
<span class="n">You</span> <span class="n">can</span> <span class="n">create</span> <span class="n">your</span> <span class="n">aliases</span> <span class="n">directly</span> <span class="n">at</span> <span class="n">the</span> <span class="n">command</span> <span class="n">prompt</span><span class="p">;</span>
<span class="n">however</span> <span class="n">they</span> <span class="n">will</span> <span class="n">only</span> <span class="n">remain</span> <span class="ow">in</span> <span class="n">effect</span> <span class="n">during</span> <span class="n">your</span> <span class="n">current</span> <span class="n">shell</span> <span class="n">session</span><span class="p">.</span>

<span class="p">[</span><span class="n">me</span><span class="nd">@linuxbox</span> <span class="n">me</span><span class="p">]</span><span class="err">$</span> <span class="n">alias</span> <span class="n">l</span><span class="o">=</span><span class="s">'ls -l'</span>
</pre></table></code></div></div><h3 id="shell-functions">Shell Functions</h3><p>Aliases are good for very simple commands, but to create something more complex, try shell functions. Shell functions can be thought of as “scripts within scripts” or little sub-scripts.</p><ul><li>open .bashrc with your text editor again<li>replace the alias for “today” with the following:</ul><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nf">today</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">echo</span> <span class="o">-</span><span class="n">n</span> <span class="s">"Today's date is: "</span>
    <span class="n">date</span> <span class="o">+</span><span class="s">"%A, %B %-d, %Y"</span>
<span class="p">}</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">()</code> is a shell builtin too, and as with <code class="language-plaintext highlighter-rouge">alias</code><li>enter shell functions directly at the command prompt.</ul><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="p">[</span><span class="n">me</span><span class="nd">@linuxbox</span> <span class="n">me</span><span class="p">]</span><span class="err">$</span> <span class="nf">today</span><span class="p">()</span> <span class="p">{</span>
<span class="o">&gt;</span> <span class="n">echo</span> <span class="o">-</span><span class="n">n</span> <span class="s">"Today's date is: "</span>
<span class="o">&gt;</span> <span class="n">date</span> <span class="o">+</span><span class="s">"%A, %B %-d, %Y"</span>
<span class="o">&gt;</span> <span class="p">}</span>

<span class="c1"># like alias, shell functions defined directly on the command line only last as long as the current shell session.
</span></pre></table></code></div></div><h1 id="here-scripts">Here Scripts</h1><p>Beginning with this lesson, we will construct a useful application. This application will produce an <code class="language-plaintext highlighter-rouge">HTML document</code> that contains information about your system.</p><p>I spent a lot of time thinking about how to teach shell programming, and the approach I have chosen is very different from most others that I have seen. Most favor a systematic treatment of shell features, and often presume experience with other programming languages. Although I do not assume that you already know how to program, I realize that many people today know how to write HTML, so our program will produce a web page.</p><p>As we construct our script, we will discover step by step the tools needed to solve the problem at hand.</p><h2 id="writing-an-html-file-with-a-script">Writing an HTML File with a Script</h2><p>a well formed HTML file contains the following content:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;
    The title of your page
    &lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
    Your page content goes here.
&lt;/body&gt;
&lt;/html&gt;
</pre></table></code></div></div><p>Now, write a script to produce the above content:</p><div class="language-shell highlighter-rouge"><div class="code-header" text-data="shell"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>

<span class="c"># sysinfo_page - A script to produce an html file</span>

<span class="nb">echo</span> <span class="s2">"&lt;html&gt;"</span>
<span class="nb">echo</span> <span class="s2">"&lt;head&gt;"</span>
<span class="nb">echo</span> <span class="s2">"  &lt;title&gt;"</span>
<span class="nb">echo</span> <span class="s2">"  The title of your page"</span>
<span class="nb">echo</span> <span class="s2">"  &lt;/title&gt;"</span>
<span class="nb">echo</span> <span class="s2">"&lt;/head&gt;"</span>
<span class="nb">echo</span> <span class="s2">""</span>
<span class="nb">echo</span> <span class="s2">"&lt;body&gt;"</span>
<span class="nb">echo</span> <span class="s2">"  Your page content goes here."</span>
<span class="nb">echo</span> <span class="s2">"&lt;/body&gt;"</span>
<span class="nb">echo</span> <span class="s2">"&lt;/html&gt;"</span>
</pre></table></code></div></div><p>This script can be used as follows: [me@linuxbox me]$ sysinfo_page &gt; sysinfo_page.html</p><p>lever programmers write programs, they try to save themselves typing.</p><p>The first improvement replace the repeated use of the echo with a single instance by using quotation more efficiently:</p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">#!/bin/bash
# sysinfo_page - A script to produce an HTML file
</span>
<span class="n">echo</span> <span class="s">"&lt;html&gt;
 &lt;head&gt;
   &lt;title&gt;
   The title of your page
   &lt;/title&gt;
 &lt;/head&gt;

 &lt;body&gt;
   Your page content goes here.
 &lt;/body&gt;
 &lt;/html&gt;"</span>
</pre></table></code></div></div><p>Using quotation, it is possible to embed carriage returns in our text and have the echo command’s argument span multiple lines.</p><p>While this is certainly an improvement, it does have a limitation. Since many types of markup used in html incorporate quotation marks themselves, it makes using a quoted string awkward. A quoted string can be used but each embedded quotation mark will need to be escaped with a backslash character.</p><p>to avoid the additional typing, the shell provides <code class="language-plaintext highlighter-rouge">here script</code>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>#!/bin/bash
# sysinfo_page - A script to produce an HTML file

cat &lt;&lt; _EOF_

&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;
    The title of your page
    &lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
    Your page content goes here.
&lt;/body&gt;
&lt;/html&gt;

_EOF_
</pre></table></code></div></div><p>A <code class="language-plaintext highlighter-rouge">here script</code> (here document) is an additional form of I/O redirection.</p><ul><li>It provides a way to include content that will be given to the standard input of a command.<li>In the case of the script above, the standard input of the cat command was given a stream of text from our script.<li>A <code class="language-plaintext highlighter-rouge">here script</code> is constructed like:</ul><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>command &lt;&lt; token
content to be used as command's standard input
token
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">token</code> can be any string of characters.</p><ul><li>“<em>EOF</em>” (“End Of File”) or use anything, as long as it does not conflict with a bash reserved word.<li>The token that ends must exactly match the one that starts, or else the remainder of your script will be interpreted as more standard input to the command.</ul><p>one additional trick to indent the content portion of the <code class="language-plaintext highlighter-rouge">here script</code> to improve the readability of your script.</p><ul><li>Changing the the <code class="language-plaintext highlighter-rouge">&lt;&lt;</code> to <code class="language-plaintext highlighter-rouge">&lt;&lt;-</code> causes bash to <code class="language-plaintext highlighter-rouge">ignore the leading tabs</code> (but not spaces) in the here script.<li>The output from the cat command will not contain any of the leading tab characters.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>#!/bin/bash
# sysinfo_page - A script to produce an HTML file

cat &lt;&lt;- _EOF_
    &lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;
        The title of your page
        &lt;/title&gt;
    &lt;/head&gt;

    &lt;body&gt;
        Your page content goes here.
    &lt;/body&gt;
    &lt;/html&gt;
_EOF_
</pre></table></code></div></div><p>O.k. edit our page to:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>#!/bin/bash
# sysinfo_page - A script to produce an HTML file

cat &lt;&lt;- _EOF_
    &lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;
        My System Information
        &lt;/title&gt;
    &lt;/head&gt;

    &lt;body&gt;
    &lt;h1&gt;My System Information&lt;/h1&gt;
    &lt;/body&gt;
    &lt;/html&gt;
_EOF_
</pre></table></code></div></div><h2 id="variables">Variables</h2><p>make some changes because we want to be lazy.</p><ul><li>the phrase “My System Information” is repeated. improve it:<li>added a line to the beginning of the script and replaced the two occurrences of the phrase “My System Information” with <code class="language-plaintext highlighter-rouge">$title</code>.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>#!/bin/bash
# sysinfo_page - A script to produce an HTML file

title="My System Information"

cat &lt;&lt;- _EOF_
    &lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;
        $title
        &lt;/title&gt;
    &lt;/head&gt;

    &lt;body&gt;
    &lt;h1&gt;$title&lt;/h1&gt;
    &lt;/body&gt;
    &lt;/html&gt;
_EOF_
</pre></table></code></div></div><p>Variables Variables: areas of memory that can be used to store information and are referred to by a name.</p><ul><li>In the case of our script, variable “title” placed the phrase “My System Information” into memory. Inside the <code class="language-plaintext highlighter-rouge">here script</code> that contains our HTML, we use “$title” to tell the shell to perform <code class="language-plaintext highlighter-rouge">parameter expansion</code> and replace the name of the variable with the variable’s contents.<li>Whenever the shell sees a word that begins with a <code class="language-plaintext highlighter-rouge">$</code>, it find out what was assigned to the variable and substitutes it.</ul><p>to Create a Variable</p><ul><li><code class="language-plaintext highlighter-rouge">variable=assign the information you wish to store</code><ul><li>followed immediately by an equal sign (“=”).<li>No spaces are allowed.</ul></ul><p>to choose the names for variables. few rules.</p><ul><li>Names must start with a letter.<li>A name must not contain embedded spaces. Use underscores instead.<li>cannot use punctuation marks.</ul><p>How Does This Increase Our Laziness?</p><ul><li>First, it reduced the amount of typing.<li>Second and more importantly, it made our script easier to maintain.</ul><p>programs are rarely ever finished. They are modified and improved by their creators and others. After all, that’s what open source development is all about.</p><ul><li>wanted to change the phrase “My System Information” to “Linuxbox System Information.” you would have had to change this in two locations.<li>In the new version with the title variable, you only have to change it in one place.<li>as scripts get larger and more complicated, it becomes very important.</ul><h2 id="environment-variables">Environment Variables</h2><p>When you start your shell session, some variables are already set by the startup file we looked at earlier.</p><ul><li>To see all the variables that are in your environment, use the <code class="language-plaintext highlighter-rouge">printenv</code> command.<li>variable <code class="language-plaintext highlighter-rouge">$HOSTNAME</code>: contains the host name for your system.<li>add this variable to script:</ul><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>#!/bin/bash
# sysinfo_page - A script to produce an HTML file

title="System Information for"

cat &lt;&lt;- _EOF_
    &lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;
        $title $HOSTNAME
        &lt;/title&gt;
    &lt;/head&gt;

    &lt;body&gt;
    &lt;h1&gt;$title $HOSTNAME&lt;/h1&gt;
    &lt;/body&gt;
    &lt;/html&gt;
_EOF_

# Now our script will always include the name of the machine on which we are running.
# by convention, environment variables names are uppercase.
</pre></table></code></div></div><h2 id="command-substitution-and-constants">Command Substitution and Constants</h2><h3 id="substitute-the-results-from-a-command--">substitute the results from a command. <code class="language-plaintext highlighter-rouge">$( )</code></h3><p>our script, it could create an HTML page that contained a few simple lines of text, including the host name of the machine which we obtained from the environment variable <code class="language-plaintext highlighter-rouge">HOSTNAME</code>. Now, we will add a time stamp to the page to indicate when it was last updated, along with the user that did it.</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>#!/bin/bash
# sysinfo_page - A script to produce an HTML file

title="System Information for"

cat &lt;&lt;- _EOF_
    &lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;
        $title $HOSTNAME
        &lt;/title&gt;
    &lt;/head&gt;

    &lt;body&gt;
    &lt;h1&gt;$title $HOSTNAME&lt;/h1&gt;
    &lt;p&gt;Updated on $(date +"%x %r %Z") by $USER&lt;/p&gt;
    &lt;/body&gt;
    &lt;/html&gt;
_EOF_
</pre></table></code></div></div><p>employed another environment variable, <code class="language-plaintext highlighter-rouge">$USER</code>, to get the user name.</p><p>In addition, we used this strange looking thing: $(date +”%x %r %Z”)</p><p>The characters <code class="language-plaintext highlighter-rouge">$( )</code></p><ul><li>tell the shell, “substitute the results of the enclosed command.”<li>In our script, the shell insert the results of the command date +”%x %r %Z” which expresses the current date and time.</ul><p>an older, alternate syntax for <code class="language-plaintext highlighter-rouge">$()</code>, uses the backtick character “ ` “.</p><ul><li>This older form is compatible with the original Bourne shell (sh).<li>The bash shell fully supports scripts written for sh<li>the following forms are equivalent:<ul><li>$(command)<li>`command`</ul></ul><p>You can also assign the results of a command to a variable: <code class="language-plaintext highlighter-rouge">right_now=$(date +"%x %r %Z")</code></p><p>You can nest the variables (place one inside another): <code class="language-plaintext highlighter-rouge">right_now=$(date +"%x %r %Z")</code> <code class="language-plaintext highlighter-rouge">time_stamp="Updated on $right_now by $USER"</code></p><h3 id="constants">Constants</h3><p><code class="language-plaintext highlighter-rouge">variable</code>: the content of a variable is subject to change.</p><ul><li>it is expected that during the execution of your script, a variable may have its content modified by something you do.</ul><p><code class="language-plaintext highlighter-rouge">constants</code>: values that, once set, should never be changed.</p><ul><li>Bash also has these facilities but, to be honest, I never see it used.<li>Instead, if a value is intended to be a constant, it is given an <code class="language-plaintext highlighter-rouge">uppercase name</code> to remind the programmer that it should be considered a constant even if it’s not being enforced.</ul><p><code class="language-plaintext highlighter-rouge">Environment variables</code> are usually considered <code class="language-plaintext highlighter-rouge">constants</code> since they are rarely changed. Like constants, environment variables are given uppercase names by convention.</p><p>use uppercase names for <code class="language-plaintext highlighter-rouge">constants</code> and lowercase names for <code class="language-plaintext highlighter-rouge">variables</code>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>#!/bin/bash
# sysinfo_page - A script to produce an HTML file

title="System Information for $HOSTNAME"
RIGHT_NOW=$(date +"%x %r %Z")
TIME_STAMP="Updated on $RIGHT_NOW by $USER"

cat &lt;&lt;- _EOF_
    &lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;
        $title
        &lt;/title&gt;
    &lt;/head&gt;

    &lt;body&gt;
    &lt;h1&gt;$title&lt;/h1&gt;
    &lt;p&gt;$TIME_STAMP&lt;/p&gt;
    &lt;/body&gt;
    &lt;/html&gt;
_EOF_
</pre></table></code></div></div><h2 id="shell-functions-1">Shell Functions</h2><p>As programs get longer and more complex, they become more difficult to design, code, and maintain.</p><ul><li>it is often useful to break a single, large task into a series of smaller tasks.<li>to break our single monolithic script into a number of separate functions.</ul><p>As our script continues to grow, we will use <code class="language-plaintext highlighter-rouge">top down design</code> to help us plan and code our script.</p><p>If we look at our script’s top-level tasks, we find the following list:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>Open page           &lt;html&gt;
Open head section     &lt;head&gt;
Write title              &lt;title&gt; $title &lt;/title&gt;
Close head section    &lt;/head&gt;
Open body section     &lt;body&gt;
Write title              &lt;h1&gt;$title&lt;/h1&gt;
Write time stamp         &lt;p&gt;$TIME_STAMP&lt;/p&gt;    task 7
Close body section    &lt;/body&gt;
Close page          &lt;/html&gt;
</pre></table></code></div></div><p>All of these tasks are implemented, but we want to add more. Let’s insert some additional tasks after task 7:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>Write time stamp
Write system release info
Write up-time
Write drive space
Write home space
Close body section
Close page
</pre></table></code></div></div><hr /><ol><li>if there were commands that performed these additional tasks. use command substitution to place them in our script like so:</ol><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="c1">#!/bin/bash
# sysinfo_page - A script to produce a system information HTML file
</span>
<span class="c1">##### Constants
</span>
<span class="n">TITLE</span><span class="o">=</span><span class="s">"System Information for $HOSTNAME"</span>
<span class="n">RIGHT_NOW</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">date</span> <span class="o">+</span><span class="s">"%x %r %Z"</span><span class="p">)</span>
<span class="n">TIME_STAMP</span><span class="o">=</span><span class="s">"Updated on $RIGHT_NOW by $USER"</span>

<span class="c1">##### Main
</span>
<span class="n">cat</span> <span class="o">&lt;&lt;-</span> <span class="n">_EOF_</span>
  <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="err">$</span><span class="n">TITLE</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>

  <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="err">$</span><span class="n">TITLE</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">$</span><span class="n">TIME_STAMP</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
      <span class="err">$</span><span class="p">(</span><span class="n">system_info</span><span class="p">)</span>
      <span class="err">$</span><span class="p">(</span><span class="n">show_uptime</span><span class="p">)</span>
      <span class="err">$</span><span class="p">(</span><span class="n">drive_space</span><span class="p">)</span>
      <span class="err">$</span><span class="p">(</span><span class="n">home_space</span><span class="p">)</span>
  <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
<span class="n">_EOF_</span>
</pre></table></code></div></div><hr /><ol><li>While there are no commands that do exactly what we need, create them using <code class="language-plaintext highlighter-rouge">shell functions</code>.<ul><li>shell functions act as “little programs within programs” and allow us to follow top-down design principles.<li>To add the shell functions to our script, we change it so:</ul></ol><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="c1">#!/bin/bash
# sysinfo_page - A script to produce an system information HTML file
</span>
<span class="c1">##### Constants
</span><span class="n">TITLE</span><span class="o">=</span><span class="s">"System Information for $HOSTNAME"</span>
<span class="n">RIGHT_NOW</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">date</span> <span class="o">+</span><span class="s">"%x %r %Z"</span><span class="p">)</span>
<span class="n">TIME_STAMP</span><span class="o">=</span><span class="s">"Updated on $RIGHT_NOW by $USER"</span>

<span class="c1">##### Functions
</span><span class="nf">system_info</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="nf">show_uptime</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="nf">drive_space</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="nf">home_space</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="c1">##### Main
</span>
<span class="n">cat</span> <span class="o">&lt;&lt;-</span> <span class="n">_EOF_</span>
  <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="err">$</span><span class="n">TITLE</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>

  <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="err">$</span><span class="n">TITLE</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">$</span><span class="n">TIME_STAMP</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
      <span class="err">$</span><span class="p">(</span><span class="n">system_info</span><span class="p">)</span>
      <span class="err">$</span><span class="p">(</span><span class="n">show_uptime</span><span class="p">)</span>
      <span class="err">$</span><span class="p">(</span><span class="n">drive_space</span><span class="p">)</span>
      <span class="err">$</span><span class="p">(</span><span class="n">home_space</span><span class="p">)</span>
  <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
<span class="n">_EOF_</span>
</pre></table></code></div></div><p>A couple of important points about functions:</p><ul><li>First, they must appear before you attempt to use them.<li>Second, the function body (the portions of the function between the { and } characters) must contain at least one valid command. As written, the script will execute error, because the function bodies are empty.<li>The simple way to fix this is to place a return statement in each function body. script will execute successfully again.</ul><h3 id="keep-your-scripts-working">Keep Your Scripts Working</h3><p>When you are developing a program, it is is often a good practice to add a small amount of code, run the script, add some more code, run the script, and so on. mistake into your code will be easier to find and correct.</p><p>As you add functions to your script, you can also use a technique called <code class="language-plaintext highlighter-rouge">stubbing</code> to help watch the logic of your script develop.</p><ul><li>Stubbing works like this: imagine that we are going to create a function called “system_info” but we haven’t figured out all of the details of its code yet.<li>Rather than hold up the development of the script until we are finished with system_info, we just add an <code class="language-plaintext highlighter-rouge">echo</code> command like this:<div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>system_info()
{
  # Temporary function stub
  echo "function system_info"
}
</pre></table></code></div></div></ul><p>This way, our script will still execute successfully, even though we do not yet have a finished system_info function. We will later replace the temporary stubbing code with the complete working version.</p><p>The reason we use an <code class="language-plaintext highlighter-rouge">echo</code> command is so we get some feedback from the script to indicate that the functions are being executed.</p><p>go ahead and write stubs for our new functions and keep the script working.</p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre><td class="rouge-code"><pre><span class="c1">#!/bin/bash
# sysinfo_page - A script to produce an system information HTML file
</span>
<span class="c1">##### Constants
</span><span class="n">TITLE</span><span class="o">=</span><span class="s">"System Information for $HOSTNAME"</span>
<span class="n">RIGHT_NOW</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">date</span> <span class="o">+</span><span class="s">"%x %r %Z"</span><span class="p">)</span>
<span class="n">TIME_STAMP</span><span class="o">=</span><span class="s">"Updated on $RIGHT_NOW by $USER"</span>

<span class="c1">##### Functions
</span><span class="nf">system_info</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1"># Temporary function stub
</span>    <span class="n">echo</span> <span class="s">"function system_info"</span>
<span class="p">}</span>

<span class="nf">show_uptime</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1"># Temporary function stub
</span>    <span class="n">echo</span> <span class="s">"function show_uptime"</span>
<span class="p">}</span>

<span class="nf">drive_space</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1"># Temporary function stub
</span>    <span class="n">echo</span> <span class="s">"function drive_space"</span>
<span class="p">}</span>

<span class="nf">home_space</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1"># Temporary function stub
</span>    <span class="n">echo</span> <span class="s">"function home_space"</span>
<span class="p">}</span>

<span class="c1">##### Main
</span>
<span class="n">cat</span> <span class="o">&lt;&lt;-</span> <span class="n">_EOF_</span>
  <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="err">$</span><span class="n">TITLE</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>

  <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="err">$</span><span class="n">TITLE</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">$</span><span class="n">TIME_STAMP</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
      <span class="err">$</span><span class="p">(</span><span class="n">system_info</span><span class="p">)</span>
      <span class="err">$</span><span class="p">(</span><span class="n">show_uptime</span><span class="p">)</span>
      <span class="err">$</span><span class="p">(</span><span class="n">drive_space</span><span class="p">)</span>
      <span class="err">$</span><span class="p">(</span><span class="n">home_space</span><span class="p">)</span>
  <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
<span class="n">_EOF_</span>
</pre></table></code></div></div><h3 id="some-real-work">Some Real Work</h3><h4 id="show_uptime">show_uptime</h4><ul><li>The <code class="language-plaintext highlighter-rouge">show_uptime</code> function: display the output of the <code class="language-plaintext highlighter-rouge">uptime</code> command.<li><p>The <code class="language-plaintext highlighter-rouge">uptime</code> command: outputs several interesting facts about the system, including the length of time the system has been “up” (running) since its last re-boot, the number of users and recent system load.</p><p>$ uptime 9:15pm up 2 days, 2:32, 2 users, load average: 0.00, 0.00, 0.00</p></ul><p>To get the output of the uptime command into our HTML page:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>show_uptime()
{
    echo "&lt;h2&gt;System uptime&lt;/h2&gt;"
    echo "&lt;pre&gt;"
    uptime
    echo "&lt;/pre&gt;"
}
</pre></table></code></div></div><p>As you can see, this function outputs a stream of text containing a mixture of HTML tags and command output. When the command substitution takes place in the main body of the our program, the output from our function becomes part of the here script.</p><h4 id="drive_space">drive_space</h4><p>The <code class="language-plaintext highlighter-rouge">drive_space</code> function: use the <code class="language-plaintext highlighter-rouge">df</code> command to provide a summary of the space used by all of the mounted file systems.</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>$ df
Filesystem   1k-blocks      Used Available Use% Mounted on
/dev/hda2       509992    225772    279080  45% /
/dev/hda1        23324      1796     21288   8% /boot
/dev/hda3     15739176   1748176  13832360  12% /home
/dev/hda5      3123888   3039584     52820  99% /usr
</pre></table></code></div></div><p>the drive_space function is very similar to the show_uptime function:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>drive_space()
{
    echo "&lt;h2&gt;Filesystem space&lt;/h2&gt;"
    echo "&lt;pre&gt;"
    df
    echo "&lt;/pre&gt;"
}
</pre></table></code></div></div><h4 id="home_space">home_space</h4><p>The <code class="language-plaintext highlighter-rouge">home_space</code> function: display the amount of space each user is using in his/her home directory. It will display this as a list, sorted in descending order by the amount of space used.</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>home_space()
{
    echo "&lt;h2&gt;Home directory space by user&lt;/h2&gt;"
    echo "&lt;pre&gt;"
    echo "Bytes Directory"
    du -s /home/* | sort -nr
    echo "&lt;/pre&gt;"
}
</pre></table></code></div></div><p>Note that in order for this function to successfully execute, the script must be run by the superuser, since the du command requires superuser privileges to examine the contents of the /home directory.</p><h4 id="system_info">system_info</h4><p>not ready to finish the system_info function yet. improve the stubbing code so it produces valid HTML:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>system_info()
{
    echo "&lt;h2&gt;System release info&lt;/h2&gt;"
    echo "&lt;p&gt;Function not yet implemented&lt;/p&gt;"
}
</pre></table></code></div></div><hr /><h1 id="flow-control---part-1">Flow Control - Part 1</h1><p>how to add intelligence to our scripts. So far, our project script has only consisted of a sequence of commands that starts at the first line and continues line by line until it reaches the end. Most programs do much more than this. They make decisions and perform different actions depending on conditions.</p><p>The shell provides several commands that we can use to <code class="language-plaintext highlighter-rouge">control the flow of execution</code> in our program.</p><h2 id="if-commands-then-commands-elif-commands-then-commands-fi"><code class="language-plaintext highlighter-rouge">if commands; then commands [elif commands; then commands] fi</code></h2><p>if command: makes a decision based on the exit status of a command.</p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="n">commands</span><span class="p">;</span> <span class="n">then</span>
<span class="n">commands</span>
<span class="p">[</span><span class="k">elif</span> <span class="n">commands</span><span class="p">;</span> <span class="n">then</span>
<span class="n">commands</span><span class="p">...]</span>
<span class="p">[</span><span class="k">else</span>
<span class="n">commands</span><span class="p">]</span>
<span class="n">fi</span>
</pre></table></code></div></div><h2 id="exit-status">Exit Status</h2><p>Commands (including the scripts and shell functions we write) issue a value to the system when they terminate, called an <code class="language-plaintext highlighter-rouge">exit status</code>.</p><ul><li>This value, which is an integer in the range of 0 to 255, indicates the success or failure of the command’s execution.<li>By convention, zero indicates success and any other value indicates failure.<li>The shell provides a parameter to examine the exit status.</ul><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="n">Some</span> <span class="n">commands</span> <span class="n">use</span> <span class="n">different</span> <span class="nb">exit</span> <span class="n">status</span> <span class="n">values</span> <span class="n">to</span> <span class="n">provide</span> <span class="n">diagnostics</span> <span class="k">for</span> <span class="n">errors</span>
<span class="o">-</span> <span class="n">many</span> <span class="n">commands</span> <span class="n">simply</span> <span class="nb">exit</span> <span class="k">with</span> <span class="n">a</span> <span class="sb">`value of one`</span> <span class="n">when</span> <span class="n">they</span> <span class="n">fail</span><span class="p">.</span>
<span class="o">-</span> <span class="n">zero</span> <span class="n">always</span> <span class="n">indicates</span> <span class="n">success</span><span class="p">.</span>

<span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span>
<span class="err">$</span> <span class="n">echo</span> <span class="err">$?</span>
<span class="mi">0</span>
<span class="c1"># the command executes successfully
</span>
<span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">usr</span>
<span class="n">ls</span><span class="p">:</span> <span class="n">cannot</span> <span class="n">access</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">usr</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="nb">file</span> <span class="ow">or</span> <span class="n">directory</span>
<span class="err">$</span> <span class="n">echo</span> <span class="err">$?</span>
<span class="mi">2</span>
<span class="c1"># indicating that the command encountered an error.
</span></pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>The shell provides two extremely simple builtin commands that do nothing except terminate with either a zero or one exit status. The true command always executes successfully and the false command always executes unsuccessfully:

[me@linuxbox~]$ true
[me@linuxbox~]$ echo $?
0
[me@linuxbox~]$ false
[me@linuxbox~]$ echo $?
1
</pre></table></code></div></div><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="n">use</span> <span class="n">these</span> <span class="n">commands</span> <span class="n">to</span> <span class="n">see</span> <span class="n">how</span> <span class="n">the</span> <span class="k">if</span> <span class="n">statement</span> <span class="n">works</span><span class="p">.</span>
<span class="n">What</span> <span class="n">the</span> <span class="k">if</span> <span class="n">statement</span> <span class="n">really</span> <span class="n">does</span> <span class="ow">is</span> <span class="n">evaluate</span> <span class="n">the</span> <span class="n">success</span> <span class="ow">or</span> <span class="n">failure</span> <span class="n">of</span> <span class="n">commands</span><span class="p">:</span>

<span class="n">The</span> <span class="n">command</span> <span class="n">echo</span> <span class="s">"It's true."</span>
<span class="o">-</span> <span class="n">executed</span> <span class="n">when</span> <span class="n">the</span> <span class="n">command</span> <span class="n">following</span> <span class="k">if</span> <span class="n">executes</span> <span class="n">successfully</span>
<span class="o">-</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">executed</span> <span class="n">when</span> <span class="n">the</span> <span class="n">command</span> <span class="n">following</span> <span class="k">if</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">execute</span> <span class="n">successfully</span><span class="p">.</span>


<span class="p">[</span><span class="n">me</span><span class="nd">@linuxbox</span> <span class="o">~</span><span class="p">]</span><span class="err">$</span> <span class="k">if</span> <span class="n">true</span><span class="p">;</span> <span class="n">then</span> <span class="n">echo</span> <span class="s">"It's true."</span><span class="p">;</span> <span class="n">fi</span>
<span class="n">It</span><span class="s">'s true.
[me@linuxbox ~]$ if false; then echo "It'</span><span class="n">s</span> <span class="n">true</span><span class="p">.</span><span class="s">"; fi
[me@linuxbox ~]$
</span></pre></table></code></div></div><h2 id="test"><code class="language-plaintext highlighter-rouge">test</code></h2><p>used most often with the <code class="language-plaintext highlighter-rouge">if</code> command to perform true/false decisions.</p><p>The command is unusual in that it has two different syntactic forms:</p><ul><li>First form: <code class="language-plaintext highlighter-rouge">test</code> expression<li>Second form: <code class="language-plaintext highlighter-rouge">[ expression ]</code></ul><p>The <code class="language-plaintext highlighter-rouge">test</code> command:</p><ul><li>If the given expression is true, test exits with a status of zero;<li>otherwise it exits with a status of 1.</ul><p>a partial list of the conditions that test can evaluate.</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre><td class="rouge-code"><pre>J:etc luo$ help test
test: test [expr]
    Exits with a status of 0 (true) or 1 (false) depending on
    the evaluation of EXPR.  Expressions may be unary or binary.  Unary
    expressions are often used to examine the status of a file.  There
    are string operators as well, and numeric comparison operators.

    File operators:

        -a FILE        True if file exists.
        -b FILE        True if file is block special.
        -c FILE        True if file is character special.
        -d FILE        True if file is a directory.
        -e FILE        True if file exists.
        -f FILE        True if file exists and is a regular file.
        -g FILE        True if file is set-group-id.
        -h FILE        True if file is a symbolic link.
        -L FILE        True if file is a symbolic link.
        -k FILE        True if file has its `sticky' bit set.
        -p FILE        True if file is a named pipe.
        -r FILE        True if file is readable by you.
        -s FILE        True if file exists and is not empty.
        -S FILE        True if file is a socket.
        -t FD          True if FD is opened on a terminal.
        -u FILE        True if the file is set-user-id.
        -w FILE        True if the file is writable by you.
        -x FILE        True if the file is executable by you.
        -O FILE        True if the file is effectively owned by you.
        -G FILE        True if the file is effectively owned by your group.
        -N FILE        True if the file has been modified since it was last read.

      FILE1 -nt FILE2  True if file1 is newer than file2 (according to
                       modification date).

      FILE1 -ot FILE2  True if file1 is older than file2.

      FILE1 -ef FILE2  True if file1 is a hard link to file2.

    String operators:

        -z STRING      True if string is empty.

        -n STRING
        STRING         True if string is not empty.

        STRING1 = STRING2
                       True if the strings are equal.
        STRING1 != STRING2
                       True if the strings are not equal.
        STRING1 &lt; STRING2
                       True if STRING1 sorts before STRING2 lexicographically.
        STRING1 &gt; STRING2
                       True if STRING1 sorts after STRING2 lexicographically.

    Other operators:

        -o OPTION      True if the shell option OPTION is enabled.
        ! EXPR         True if expr is false.
        EXPR1 -a EXPR2 True if both expr1 AND expr2 are true.
        EXPR1 -o EXPR2 True if either expr1 OR expr2 is true.

        arg1 OP arg2   Arithmetic tests.  OP is one of -eq, -ne,
                       -lt, -le, -gt, or -ge.

    Arithmetic binary operators return true if ARG1 is equal, not-equal,
    less-than, less-than-or-equal, greater-than, or greater-than-or-equal
    than ARG2.
</pre></table></code></div></div><p>example:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>if [ -f .bash_profile ]; then
    echo "You have a .bash_profile. Things are fine."
else
    echo "Yikes! You have no .bash_profile!"
fi
</pre></table></code></div></div><p>In this example, use the expression “ -f .bash_profile “.</p><ul><li>This expression asks, “Is .bash_profile a file?”<li>If the expression is true, then <code class="language-plaintext highlighter-rouge">test</code> exits with a zero (indicating true) and the if command executes the command(s) following the word then.<li>If the expression is false, then <code class="language-plaintext highlighter-rouge">test</code> exits with a status of one and the if command executes the command(s) following the word else.</ul><p>the if command followed by the <code class="language-plaintext highlighter-rouge">test</code> command, followed by a semicolon, and finally the word then.</p><ul><li>use the <code class="language-plaintext highlighter-rouge">[ expression ]</code> form of the <code class="language-plaintext highlighter-rouge">test</code> command<ul><li>Notice that <code class="language-plaintext highlighter-rouge">the spaces</code> required between the “[”, expression expression, the trailing “]” are required.</ul><li>The <code class="language-plaintext highlighter-rouge">semicolon</code> is a command separator. Using it allows you to put more than one command on a line. For example:<ul><li><code class="language-plaintext highlighter-rouge">$ clear; ls</code> : will clear the screen and execute the ls command.</ul></ul><p>On the second line, there is our old friend echo. The only thing of note on this line is the <code class="language-plaintext highlighter-rouge">indentation</code>.</p><ul><li>traditional to indent all blocks of conditional code; that is, any code that will only be executed if certain conditions are met.<li>The shell does not require this; it is done to make the code easier to read.</ul><p>we could write the following and get the same results:</p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1"># Alternate form
</span>
<span class="k">if</span> <span class="p">[</span> <span class="o">-</span><span class="n">f</span> <span class="p">.</span><span class="n">bash_profile</span> <span class="p">]</span>
<span class="n">then</span>
    <span class="n">echo</span> <span class="s">"You have a .bash_profile. Things are fine."</span>
<span class="k">else</span>
    <span class="n">echo</span> <span class="s">"Yikes! You have no .bash_profile!"</span>
<span class="n">fi</span>

<span class="c1"># Another alternate form
</span>
<span class="k">if</span> <span class="p">[</span> <span class="o">-</span><span class="n">f</span> <span class="p">.</span><span class="n">bash_profile</span> <span class="p">]</span>
<span class="n">then</span> <span class="n">echo</span> <span class="s">"You have a .bash_profile. Things are fine."</span>
<span class="k">else</span> <span class="n">echo</span> <span class="s">"Yikes! You have no .bash_profile!"</span>
<span class="n">fi</span>
</pre></table></code></div></div><h2 id="exit">exit</h2><p>In order to be good script writers, we must set the <code class="language-plaintext highlighter-rouge">exit status</code> when our scripts finish. To do this, use the <code class="language-plaintext highlighter-rouge">exit</code> command: causes the script to terminate immediately and set the exit status to whatever value is given as an argument.</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>For example:

exit 0
exits your script and sets the exit status to 0 (success), whereas

exit 1
exits your script and sets the exit status to 1 (failure).
</pre></table></code></div></div><h2 id="testing-for-root">Testing for Root</h2><p>When we last left our script, we required that it be run with superuser privileges. This is because the <code class="language-plaintext highlighter-rouge">home_space</code> function needs to examine the size of each user’s home directory, and only the superuser is allowed to do that.</p><p>But what happens if a regular user runs our script? It produces error messages. What if we could put something in the script to stop regular user run it?</p><p>The <code class="language-plaintext highlighter-rouge">id</code> command: tell us who the current user is. When executed with the “-u” option, it prints the numeric user id of the current user.</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>J:etc luo$ sudo id -u
Password:
0
J:etc luo$ id -u
502
</pre></table></code></div></div><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1"># this code will detect if the user is the superuser
</span><span class="k">if</span> <span class="p">[</span> <span class="err">$</span><span class="p">(</span><span class="nb">id</span> <span class="o">-</span><span class="n">u</span><span class="p">)</span> <span class="o">=</span> <span class="s">"0"</span> <span class="p">];</span> <span class="n">then</span>
    <span class="n">echo</span> <span class="s">"superuser"</span>
<span class="n">fi</span>

<span class="c1"># to stop the script if the user is not the superuser
</span><span class="k">if</span> <span class="p">[</span> <span class="err">$</span><span class="p">(</span><span class="nb">id</span> <span class="o">-</span><span class="n">u</span><span class="p">)</span> <span class="o">!=</span> <span class="s">"0"</span> <span class="p">];</span> <span class="n">then</span>
    <span class="n">echo</span> <span class="s">"You must be the superuser to run this script"</span> <span class="o">&gt;&amp;</span><span class="mi">2</span>
    <span class="nb">exit</span> <span class="mi">1</span>
<span class="n">fi</span>
</pre></table></code></div></div><p>if the output of the id -u command is not equal to “0”,</p><ul><li>then the script prints a descriptive error message, exits,<li>and sets the exit status to 1, indicating to the operating system that the script executed unsuccessfully.</ul><p><code class="language-plaintext highlighter-rouge">&gt;&amp;2</code> at the end of the echo command.</p><ul><li>another form of I/O direction. You will often notice this in routines that display error messages.<li>If this redirection were not done, the error message would go to standard output.<li>With this redirection, the message is sent to standard error.<li>Since we are executing our script and redirecting its standard output to a file, we want the error messages separated from the normal output.</ul><p>We could put this routine near the beginning of our script so it has a chance to detect a possible error before things get under way</p><p>but in order to run this script as an ordinary user, we will use the same idea and modify the <code class="language-plaintext highlighter-rouge">home_space</code> function to test for proper privileges instead, like so:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>function home_space
{
    # Only the superuser can get this information

    if [ "$(id -u)" = "0" ]; then
        echo "&lt;h2&gt;Home directory space by user&lt;/h2&gt;"
        echo "&lt;pre&gt;"
        echo "Bytes Directory"
            du -s /home/* | sort -nr
        echo "&lt;/pre&gt;"
    fi

}   # end of home_space
</pre></table></code></div></div><p>This way, if an ordinary user runs the script, the troublesome code will be passed over, rather than executed and the problem will be solved.</p><h1 id="stay-out-of-trouble">Stay Out of Trouble</h1><p>Now that our scripts are getting a little more complicated, I want to point out some common mistakes that you might run into. To do this, create the following script called <code class="language-plaintext highlighter-rouge">trouble.bash</code>. enter it exactly as written.</p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1">#!/bin/bash
</span>
<span class="n">number</span><span class="o">=</span><span class="mi">1</span>

<span class="k">if</span> <span class="p">[</span> <span class="err">$</span><span class="n">number</span> <span class="o">=</span> <span class="s">"1"</span> <span class="p">];</span> <span class="n">then</span>
    <span class="n">echo</span> <span class="s">"Number equals 1"</span>
<span class="k">else</span>
    <span class="n">echo</span> <span class="s">"Number does not equal 1"</span>
<span class="n">fi</span>

<span class="c1"># run
</span><span class="err">$</span> <span class="n">nano</span>
<span class="err">$</span> <span class="n">chmod</span> <span class="mi">755</span> <span class="n">trouble</span><span class="p">.</span><span class="n">bash</span>
<span class="err">$</span> <span class="n">trouble</span><span class="p">.</span><span class="n">bash</span>
<span class="n">Number</span> <span class="n">equals</span> <span class="mi">1</span>
</pre></table></code></div></div><h2 id="empty-variables">Empty Variables</h2><p>Edit the script to change line 3 from <code class="language-plaintext highlighter-rouge">number=1</code> to <code class="language-plaintext highlighter-rouge">number=</code></p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">#!/bin/bash
</span>
<span class="n">number</span><span class="o">=</span>

<span class="k">if</span> <span class="p">[</span> <span class="err">$</span><span class="n">number</span> <span class="o">=</span> <span class="s">"1"</span> <span class="p">];</span> <span class="n">then</span>
    <span class="n">echo</span> <span class="s">"Number equals 1"</span>
<span class="k">else</span>
    <span class="n">echo</span> <span class="s">"Number does not equal 1"</span>
<span class="n">fi</span>

<span class="c1"># run the script again.
</span><span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">trouble</span><span class="p">.</span><span class="n">bash</span>
<span class="s">"/trouble.bash: [: =: unary operator expected."</span>    <span class="c1"># bash displayed an error message when we ran the script.
</span><span class="n">Number</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">equal</span> <span class="mi">1</span>
</pre></table></code></div></div><p>the error message: <code class="language-plaintext highlighter-rouge">./trouble.bash: [: =: unary operator expected</code></p><p>error is occurring on line 5 not line 3.</p><ul><li><p>there is nothing wrong with line 3. number= is perfectly good syntax. set a variable’s value to nothing. You can confirm the validity of this by trying it on the command line:</p><p>[me@linuxbox me]$ number= [me@linuxbox me]$ no error message.</p></ul><p>wrong with line 5</p><ul><li>In line 5, the shell expands the value of number where it sees $number.<li>when number=1, the shell substituted 1 for $number like so: <code class="language-plaintext highlighter-rouge">if [ 1 = "1" ]; then</code><li>when number=, the shell saw this after the expansion: <code class="language-plaintext highlighter-rouge">if [ = "1" ]; then</code><ul><li>which is an error. It also explains the rest of the error message we received.<li>The “=” is a binary operator; that is, it expects two items to operate upon - one on each side. What the shell is trying to tell us is that there is only one item and there should be a unary operator (like “!”) that only operates on a single item.</ul></ul><p>To fix this problem, change line 5: <code class="language-plaintext highlighter-rouge">if [ "$number" = "1" ]; then</code></p><ul><li>Now when the shell performs the expansion it will see: <code class="language-plaintext highlighter-rouge">if [ "" = "1" ]; then</code><li>which correctly expresses our intent.</ul><p>This brings up an important thing to remember when you are writing your scripts. Consider what happens if a variable is set to equal nothing.</p><h2 id="missing-quotes">Missing Quotes</h2><p>Edit line 6 to remove the trailing quote from the end of the line: echo “Number equals 1</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>#!/bin/bash

number=

if [ $number = "1" ]; then
    echo "Number equals 1
else
    echo "Number does not equal 1"
fi
</pre></table></code></div></div><p>run the script again. You should get this:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>[me@linuxbox me]$ ./trouble.bash
./trouble.bash: line 8: unexpected EOF while looking for matching "
./trouble.bash: line 10 syntax error: unexpected end of file
</pre></table></code></div></div><p>Here we have another case of a mistake in one line causing a problem later in the script. What happens is the shell keeps looking for the closing quotation mark to tell it where the end of the string is, but runs into the end of the file before it finds it.</p><p>These errors can be a real pain to find in a long script. This is one reason you should test your scripts frequently when you are writing them so there is less new code to test. I also find that text editors with syntax highlighting make these kinds of bugs easier to find.</p><h2 id="isolating-problems">Isolating Problems</h2><p>Finding bugs in your programs can sometimes be very difficult and frustrating.</p><p>couple of techniques useful:</p><ol><li>Isolate blocks of code by “commenting them out.”<ul><li>This trick involves putting comment characters at the beginning of lines of code to stop the shell from reading them.<li><p>Frequently, you will do this to a block of code to see if a particular problem goes away. By doing this, you can isolate which part of a program is causing (or not causing) a problem.</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>#!/bin/bash
number=1
if [ $number = "1" ]; then
    echo "Number equals 1
#else
#   echo "Number does not equal 1"
fi
</pre></table></code></div></div><li>By commenting out the else clause and running the script, we could show that the problem was not in the else clause even though the error message suggested that it was.</ul><li>Use echo commands to verify your assumptions.<ul><li>As you gain experience tracking down bugs, you will discover that bugs are often not where you first expect to find them. A common problem will be that you will make a false assumption about the performance of your program. You will see a problem develop at a certain point in your program and assume that the problem is there. This is often incorrect, as we have seen.<li>To combat this, you should place echo commands in your code while you are debugging, to produce messages that confirm the program is doing what is expected. There are two kinds of messages that you should insert.<ul><li>The first type: simply announces that you have reached a certain point in the program. We saw this in our earlier discussion on stubbing. It is useful to know that program flow is happening the way we expect.<li>The second type: displays the value of a variable (or variables) used in a calculation or test. You will often find that a portion of your program will fail because something that you assumed was correct earlier in your program is, in fact, incorrect and is causing your program to fail later on.</ul></ul></ol><h2 id="watching-your-script-run">Watching Your Script Run</h2><p>It is possible to have bash show you what it is doing when you run your script.</p><ol><li>add <code class="language-plaintext highlighter-rouge">-x</code> to the first line of your script:<ul><li><code class="language-plaintext highlighter-rouge">#!/bin/bash -x</code><li><p>Now, when you run your script, bash will display each line (with expansions performed) as it executes it. This technique is called <code class="language-plaintext highlighter-rouge">tracing</code>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>$ ./trouble.bash
+ number=1
+ '[' 1 = 1 ']'
+ echo 'Number equals 1'
Number equals 1
</pre></table></code></div></div></ul><li>use the <code class="language-plaintext highlighter-rouge">set</code> command within your script to turn tracing on and off.<ul><li><code class="language-plaintext highlighter-rouge">set -x</code> to turn tracing on<li><p><code class="language-plaintext highlighter-rouge">set +x</code> to turn tracing off.</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>#!/bin/bash
number=1

set -x
if [ $number = "1" ]; then
    echo "Number equals 1"
else
    echo "Number does not equal 1"
fi
set +x
</pre></table></code></div></div></ul></ol><h1 id="keyboard-input-and-arithmetic">Keyboard Input and Arithmetic</h1><p>Up to now, our scripts have not been interactive. did not require any input from the user.</p><h2 id="read">read</h2><p>To get input from the keyboard, use the <code class="language-plaintext highlighter-rouge">read</code> command.</p><ul><li>takes input from the keyboard and assigns it to a variable.</ul><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">#!/bin/bash
</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">n</span> <span class="s">"Enter some text &gt; "</span>
<span class="n">read</span> <span class="n">text</span>
<span class="n">echo</span> <span class="s">"You entered: $text"</span>

<span class="c1"># the script in action:
</span><span class="err">$</span> <span class="n">read_demo</span><span class="p">.</span><span class="n">bash</span>
<span class="n">Enter</span> <span class="n">some</span> <span class="n">text</span> <span class="o">&gt;</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">some</span> <span class="n">text</span>
<span class="n">You</span> <span class="n">entered</span><span class="p">:</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">some</span> <span class="n">text</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">-n</code> given to the echo command causes it to keep the cursor on the same line; i.e., it does not output a linefeed at the end of the prompt.</p><p>invoke the <code class="language-plaintext highlighter-rouge">read</code> command with “text” as its argument: wait for the user to type something followed by a carriage return (the Enter key) and then assign whatever was typed to the variable text.</p><ul><li>If you don’t give the read command the name of a variable to assign its input, it will use the environment variable REPLY.</ul><p>The read command: command line options.</p><ul><li>The <code class="language-plaintext highlighter-rouge">-t</code> option followed by a number of seconds provides an automatic timeout for the read command. the read command will give up after the specified seconds if no response has been received from the user.<ul><li><p>could be used in the case of a script that must continue (perhaps resorting to a default response) even if the user does not answer the prompts.</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>#!/bin/bash

echo -n "Hurry up and type something! &gt; "
if read -t 3 response; then
    echo "Great, you made it in time!"
else
    echo "Sorry, you are too slow!"
fi
</pre></table></code></div></div></ul><li>The <code class="language-plaintext highlighter-rouge">-s</code> option causes the user’s typing not to be displayed.<ul><li>useful when you are asking the user to type in a password or other confidential information.</ul></ul><h2 id="arithmetic">Arithmetic</h2><p>The shell provides features for integer arithmetic.</p><ul><li>integer: whole numbers like 1, 2, 458, -2859.<li>does not mean fractional numbers like 0.5, .333, or 3.1415.<ul><li>If you must deal with fractional numbers, there is a separate program called <code class="language-plaintext highlighter-rouge">bc</code> which provides an arbitrary precision calculator language. It can be used in shell scripts</ul></ul><ol><li>to use the command line as a primitive calculator: <code class="language-plaintext highlighter-rouge">$ echo $((2+2))</code><ul><li>surround an arithmetic expression with <code class="language-plaintext highlighter-rouge">the double parentheses</code>, the shell will perform <code class="language-plaintext highlighter-rouge">arithmetic expansion</code>.<li><p>whitespace is ignored:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre> [me@linuxbox me]$ echo $((2+2))
 4
 [me@linuxbox me]$ echo $(( 2+2 ))
 4
 [me@linuxbox me]$ echo $(( 2 + 2 ))
 4
</pre></table></code></div></div></ul><li><p>The shell can perform a variety of common (and not so common) arithmetic operations.</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre> #!/bin/bash
 first_num=0
 second_num=0

 echo -n "Enter the first number --&gt; "
 read first_num
 echo -n "Enter the second number -&gt; "
 read second_num

 echo "first number + second number = $((first_num + second_num))"
 echo "first number - second number = $((first_num - second_num))"
 echo "first number * second number = $((first_num * second_num))"
 echo "first number / second number = $((first_num / second_num))"
 echo "first number % second number = $((first_num % second_num))"
 echo "first number raised to the"
 echo "power of the second number   = $((first_num ** second_num))"
</pre></table></code></div></div></ol><ul><li>the leading <code class="language-plaintext highlighter-rouge">$</code> is not needed to reference <code class="language-plaintext highlighter-rouge">variables inside the arithmetic expression</code> such as “first_num + second_num”.<li>Numbers that get too large overflow like the odometer in a car when you exceed the number of miles it was designed to count. It starts over but first it goes through all the negative numbers because of how integers are represented in memory.<li><p>Division by zero (which is mathematically invalid) does cause an error.</p><li><code class="language-plaintext highlighter-rouge">%</code> symbol represents remainder (also known as modulo), performs division but instead of returning a quotient like division, it returns the remainder.<ul><li><p>For example, when a remainder operation returns zero, it indicates that the first number is an exact multiple of the second. This can be very handy:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>  #!/bin/bash
  number=0

  echo -n "Enter a number &gt; "
  read number

  echo "Number is $number"
  if [ $((number % 2)) -eq 0 ]; then
      echo "Number is even"
  else
      echo "Number is odd"
  fi
</pre></table></code></div></div></ul></ul><p>Or, in this program that formats an arbitrary number of seconds into hours and minutes:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>#!/bin/bash
seconds=0
echo -n "Enter number of seconds &gt; "
read seconds

hours=$((seconds / 3600))
seconds=$((seconds % 3600))
minutes=$((seconds / 60))
seconds=$((seconds % 60))

echo "$hours hour(s) $minutes minute(s) $seconds second(s)"
</pre></table></code></div></div><h1 id="flow-control">Flow Control</h1><h2 id="case-word-in-patterns--commands--esac"><code class="language-plaintext highlighter-rouge">case word in patterns ) commands ;; esac</code></h2><ul><li><code class="language-plaintext highlighter-rouge">if</code> command: alter program flow based on a command’s exit status.<li>In programming terms, this type of program flow is called <code class="language-plaintext highlighter-rouge">branching</code> because it is like traversing a tree. You come to a fork in the tree and the evaluation of a condition determines which branch you take.<li>more complex kind of branching called <code class="language-plaintext highlighter-rouge">a case</code>. A case is multiple-choice branch. Unlike the simple branch, where you take one of two possible paths, a case supports several possible outcomes based on the evaluation of a value.</ul><ol><li><p>construct this type of branch with multiple <code class="language-plaintext highlighter-rouge">if</code> statements.</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre> #!/bin/bash
 echo -n "Enter a number between 1 and 3 inclusive &gt; "
 read character

 if [ "$character" = "1" ]; then
     echo "You entered one."
 elif [ "$character" = "2" ]; then
     echo "You entered two."
 elif [ "$character" = "3" ]; then
     echo "You entered three."
 else
     echo "You did not enter a number between 1 and 3."
 fi
</pre></table></code></div></div><li><p>built-in command <code class="language-plaintext highlighter-rouge">case</code> can be used to construct an equivalent program:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre> #!/bin/bash
 echo -n "Enter a number between 1 and 3 inclusive &gt; "
 read character

 case $character in
     1 ) echo "You entered one."
         ;;
     2 ) echo "You entered two."
         ;;
     3 ) echo "You entered three."
         ;;
     * ) echo "You did not enter a number between 1 and 3."
 esac
</pre></table></code></div></div></ol><p>The <code class="language-plaintext highlighter-rouge">case</code> command has the following form:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>  case word in
      patterns ) commands ;;
  esac
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">case</code> selectively executes statements if <code class="language-plaintext highlighter-rouge">word</code> matches a <code class="language-plaintext highlighter-rouge">pattern</code>. You can have any number of patterns and statements.<li>Patterns can be literal text or wildcards.<li><div class="table-wrapper"><table><tbody><tr><td>You can have multiple patterns separated by the “<td>” character.</table></div><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>#!/bin/bash
echo -n "Type a digit or a letter &gt; "
read character

case $character in
                                # Check for letters
    [[:lower:]] | [[:upper:]] ) echo "You typed the letter $character"
                                ;;

                                # Check for digits
    [0-9] )                     echo "You typed the digit $character"
                                ;;

                                # Check for anything else
    * )                         echo "You did not type a letter or a digit"
esac
</pre></table></code></div></div></ul><p>pattern <code class="language-plaintext highlighter-rouge">*</code> :</p><ul><li>will match anything, so it is used to catch cases that did not match previous patterns.<li>Inclusion of <code class="language-plaintext highlighter-rouge">*</code> at the end is wise, can be <code class="language-plaintext highlighter-rouge">used to detect invalid input</code>.</ul><h2 id="loops">Loops</h2><p>Looping is repeatedly executing a section of your program based on the exit status of a command.</p><ul><li>The shell provides three commands for looping: <code class="language-plaintext highlighter-rouge">while</code>, <code class="language-plaintext highlighter-rouge">until</code> and <code class="language-plaintext highlighter-rouge">for</code>. We are going to cover while and until in this lesson and for in a upcoming lesson.</ul><h3 id="while--true--do-xx-done"><code class="language-plaintext highlighter-rouge">while [ true ]; do xx done</code></h3><p>causes a block of code to be executed over and over, <code class="language-plaintext highlighter-rouge">as long as the exit status of a specified command is true</code>.</p><ul><li><p>example of a program that counts from zero to nine:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>#!/bin/bash
number=0
while [ "$number" -lt 10 ]; do
    echo "Number = $number"
    number=$((number + 1))
done
</pre></table></code></div></div><ul><li>create a variable number, initialize its value to 0<li>start the while loop. specified a command to test the value of number, see if number has a value less than 10.<li>Notice the word <code class="language-plaintext highlighter-rouge">do</code> and <code class="language-plaintext highlighter-rouge">done</code>. These enclose the block of code that will be repeated as long as the exit status remains zero, true.</ul></ul><p>In most cases, the block of code that repeats must do something that will eventually change the exit status, otherwise you will have what is called an <code class="language-plaintext highlighter-rouge">endless loop</code>.</p><ul><li>In the example, the repeating block of code outputs the value of number (the echo command on line 5) and increments number by one on line 6.<li>Each time the block of code is completed, the test command’s exit status is evaluated again. After the tenth iteration of the loop, number has been incremented ten times and the test command will terminate with a non-zero exit status.<li>At that point, the program flow resumes with the statement following the word <code class="language-plaintext highlighter-rouge">done</code>. Since <code class="language-plaintext highlighter-rouge">done</code> is the last line of our example, the program ends.</ul><h3 id="until--false--do-xx-done"><code class="language-plaintext highlighter-rouge">until [ false ]; do xx done</code></h3><p>works exactly the same way, except the block of code is repeated <code class="language-plaintext highlighter-rouge">as long as the specified command's exit status is false</code>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>#!/bin/bash
number=0

until [ "$number" -ge 10 ]; do
    echo "Number = $number"
    number=$((number + 1))
done
</pre></table></code></div></div><h2 id="building-a-menu">Building a Menu</h2><p>One common way of presenting a user interface for a text based program is by using a <code class="language-plaintext highlighter-rouge">menu</code>. A <code class="language-plaintext highlighter-rouge">menu</code> is a list of choices from which the user can pick.</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>#!/bin/bash
selection=
until [ "$selection" = "0" ]; do
    echo "
    PROGRAM MENU
    1 - Display free disk space
    2 - Display free memory
    0 - exit program
"
    echo -n "Enter selection: "
    read selection

    echo ""
    case $selection in
        1 ) df ;;
        2 ) free ;;
        0 ) exit ;;
        * ) echo "Please enter 1, 2, or 0"
    esac
done
</pre></table></code></div></div><ul><li>The purpose of the <code class="language-plaintext highlighter-rouge">until</code> loop in this program is to re-display the menu each time a selection has been completed. The loop will continue until selection is equal to “0,” the “exit” choice. Notice how we defend against entries from the user that are not valid choices.</ul><p>To make this program better</p><ul><li>adding a function that asks the user to press the <code class="language-plaintext highlighter-rouge">Enter</code> key after each selection has been completed<li><p>and clears the screen before the menu is displayed again. Here is the enhanced example:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>#!/bin/bash

press_enter()
{
    echo -en "\nPress Enter to continue"
    read
    clear
}

selection=
until [ "$selection" = "0" ]; do
    echo "
    PROGRAM MENU
    1 - display free disk space
    2 - display free memory

    0 - exit program
"
    echo -n "Enter selection: "
    read selection
    echo ""
    case $selection in
        1 ) df ; press_enter ;;
        2 ) free ; press_enter ;;
        0 ) exit ;;
        * ) echo "Please enter 1, 2, or 0"; press_enter
    esac
done
</pre></table></code></div></div></ul><h2 id="when-your-computer-hangs">When your computer hangs…</h2><p>Hanging is when a program suddenly seems to stop and become unresponsive. in most cases, the program is still running but its program logic is stuck in an endless loop.</p><p>Imagine this situation: you have an external device attached to your computer, such as a USB disk drive but you forgot to turn it on. You try and use the device but the application hangs instead. When this happens, you could picture the following dialog going on between the application and the interface for the device:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>Application:    Are you ready?
Interface:  Device not ready.

Application:    Are you ready?
Interface:  Device not ready.

Application:    Are you ready?
Interface:  Device not ready.

Application:    Are you ready?
Interface:  Device not ready.
</pre></table></code></div></div><p>and so on, forever.</p><ul><li>Well-written software tries to avoid this situation by instituting a <code class="language-plaintext highlighter-rouge">timeout</code>: the loop is counting <code class="language-plaintext highlighter-rouge">the number of attempts</code> or calculating <code class="language-plaintext highlighter-rouge">the amount of time it has waited</code> for something to happen.<li>If the number of tries or the amount of time allowed is exceeded, the loop <code class="language-plaintext highlighter-rouge">exits</code> and the program generates an <code class="language-plaintext highlighter-rouge">error</code> and <code class="language-plaintext highlighter-rouge">exits</code>.</ul><h1 id="positional-parameters">Positional Parameters</h1><p>When we last left our script, it looked something like this:</p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre><td class="rouge-code"><pre><span class="c1">#!/bin/bash
# sysinfo_page - A script to produce a system information HTML file
</span>
<span class="c1">##### Constants
</span><span class="n">TITLE</span><span class="o">=</span><span class="s">"System Information for $HOSTNAME"</span>
<span class="n">RIGHT_NOW</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">date</span> <span class="o">+</span><span class="s">"%x %r %Z"</span><span class="p">)</span>
<span class="n">TIME_STAMP</span><span class="o">=</span><span class="s">"Updated on $RIGHT_NOW by $USER"</span>

<span class="c1">##### Functions
</span><span class="nf">system_info</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">echo</span> <span class="s">"&lt;h2&gt;System release info&lt;/h2&gt;"</span>
    <span class="n">echo</span> <span class="s">"&lt;p&gt;Function not yet implemented&lt;/p&gt;"</span>
<span class="p">}</span>   <span class="c1"># end of system_info
</span>
<span class="nf">show_uptime</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">echo</span> <span class="s">"&lt;h2&gt;System uptime&lt;/h2&gt;"</span>
    <span class="n">echo</span> <span class="s">"&lt;pre&gt;"</span>
    <span class="n">uptime</span>
    <span class="n">echo</span> <span class="s">"&lt;/pre&gt;"</span>
<span class="p">}</span>   <span class="c1"># end of show_uptime
</span>
<span class="nf">drive_space</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">echo</span> <span class="s">"&lt;h2&gt;Filesystem space&lt;/h2&gt;"</span>
    <span class="n">echo</span> <span class="s">"&lt;pre&gt;"</span>
    <span class="n">df</span>
    <span class="n">echo</span> <span class="s">"&lt;/pre&gt;"</span>
<span class="p">}</span>   <span class="c1"># end of drive_space
</span>
<span class="nf">home_space</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1"># Only the superuser can get this information
</span>
    <span class="k">if</span> <span class="p">[</span> <span class="s">"$(id -u)"</span> <span class="o">=</span> <span class="s">"0"</span> <span class="p">];</span> <span class="n">then</span>
        <span class="n">echo</span> <span class="s">"&lt;h2&gt;Home directory space by user&lt;/h2&gt;"</span>
        <span class="n">echo</span> <span class="s">"&lt;pre&gt;"</span>
        <span class="n">echo</span> <span class="s">"Bytes Directory"</span>
        <span class="n">du</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">home</span><span class="o">/*</span> <span class="o">|</span> <span class="n">sort</span> <span class="o">-</span><span class="n">nr</span>
        <span class="n">echo</span> <span class="s">"&lt;/pre&gt;"</span>
    <span class="n">fi</span>
<span class="p">}</span>   <span class="c1"># end of home_space
</span>

<span class="c1">##### Main
</span><span class="n">cat</span> <span class="o">&lt;&lt;-</span> <span class="n">_EOF_</span>
  <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="err">$</span><span class="n">TITLE</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="err">$</span><span class="n">TITLE</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">$</span><span class="n">TIME_STAMP</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
      <span class="err">$</span><span class="p">(</span><span class="n">system_info</span><span class="p">)</span>
      <span class="err">$</span><span class="p">(</span><span class="n">show_uptime</span><span class="p">)</span>
      <span class="err">$</span><span class="p">(</span><span class="n">drive_space</span><span class="p">)</span>
      <span class="err">$</span><span class="p">(</span><span class="n">home_space</span><span class="p">)</span>
  <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
<span class="n">_EOF_</span>
</pre></table></code></div></div><p>more features I want to add:</p><ul><li>want to specify the name of the output file on the command line, as well as set a default output file name if no name is specified.<li>want to offer an interactive mode that will prompt for a file name and warn the user if the file exists and prompt the user to overwrite it.</ul><p>Naturally, we want to have a help option that will display a usage message. All of these features involve using command line options and arguments.</p><ul><li>To handle options on the command line, we use a facility in the shell called <code class="language-plaintext highlighter-rouge">positional parameters</code>: a series of special variables ($0 through $9) that contain the contents of the command line.</ul><p>Let’s imagine the following command line:</p><p>[me@linuxbox me]$ some_program word1 word2 word3</p><p>If some_program were a bash shell script, we could read each item on the command line because the positional parameters contain the following:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>$0 would contain "some_program"
$1 would contain "word1"
$2 would contain "word2"
$3 would contain "word3"
</pre></table></code></div></div><p>Here is a script you can use to try this out:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>#!/bin/bash

echo "Positional Parameters"
echo '$0 = ' $0
echo '$1 = ' $1
echo '$2 = ' $2
echo '$3 = ' $3
</pre></table></code></div></div><h2 id="detecting-command-line-arguments">Detecting Command Line Arguments</h2><p>Often, you will want to check to see if you have arguments on which to act. There are a couple of ways to do this.</p><p>First, simply check to see if $1 contains anything like so:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>#!/bin/bash

if [ "$1" != "" ]; then
    echo "Positional parameter 1 contains something"
else
    echo "Positional parameter 1 is empty"
fi
</pre></table></code></div></div><p>Second, the shell maintains a variable called <code class="language-plaintext highlighter-rouge">$#</code> that contains the number of items on the command line in addition to the name of the command ($0).</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>#!/bin/bash

if [ $# -gt 0 ]; then
    echo "Your command line contains $# arguments"
else
    echo "Your command line contains no arguments"
fi
</pre></table></code></div></div><h2 id="command-line-options">Command Line Options</h2><p>construct a while loop relies on <code class="language-plaintext highlighter-rouge">shift</code>.</p><ul><li><code class="language-plaintext highlighter-rouge">shift</code> is a <code class="language-plaintext highlighter-rouge">shell builtin 执行内建的函数；内键指令 </code> that operates on the <code class="language-plaintext highlighter-rouge">positional parameters</code>.<ul><li>Each time you invoke <code class="language-plaintext highlighter-rouge">shift</code>, it “shifts” all the positional parameters down by one.<li>$2 becomes $1, $3 becomes $2, $4 becomes $3, and so on.<li>shift(shift 1) 命令每执行一次，变量的个数($#)减一（之前的$1变量被销毁,之后的$2就变成了$1），而变量值提前一位。</ul></ul><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="mf">1.</span>
<span class="c1">#!/bin/bash
# run.sh
</span><span class="n">echo</span> <span class="s">"You start with $# positional parameters"</span>
<span class="k">while</span> <span class="p">[</span> <span class="s">"$1"</span> <span class="o">!=</span> <span class="s">""</span> <span class="p">];</span> <span class="n">do</span>                             <span class="c1"># Loop until all parameters are used up
</span>    <span class="n">echo</span> <span class="s">"Parameter 1 equals $1"</span>
    <span class="n">echo</span> <span class="s">"You now have $# positional parameters"</span>
    <span class="n">shift</span>                                            <span class="c1"># Shift all the parameters down by one
</span><span class="n">done</span>

<span class="n">J</span><span class="p">:</span><span class="n">Desktop</span> <span class="n">luo</span><span class="err">$</span> <span class="n">nano</span> <span class="n">run</span><span class="p">.</span><span class="n">sh</span>
<span class="n">J</span><span class="p">:</span><span class="n">Desktop</span> <span class="n">luo</span><span class="err">$</span> <span class="n">chmod</span> <span class="mi">755</span> <span class="n">run</span><span class="p">.</span><span class="n">sh</span>
<span class="n">J</span><span class="p">:</span><span class="n">Desktop</span> <span class="n">luo</span><span class="err">$</span> <span class="n">run</span><span class="p">.</span><span class="n">sh</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span>

<span class="n">You</span> <span class="n">start</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">positional</span> <span class="n">parameters</span>
<span class="n">Parameter</span> <span class="mi">1</span> <span class="n">equals</span> <span class="n">a</span>
<span class="n">You</span> <span class="n">now</span> <span class="n">have</span> <span class="mi">3</span> <span class="n">positional</span> <span class="n">parameters</span>
<span class="n">Parameter</span> <span class="mi">1</span> <span class="n">equals</span> <span class="n">b</span>
<span class="n">You</span> <span class="n">now</span> <span class="n">have</span> <span class="mi">2</span> <span class="n">positional</span> <span class="n">parameters</span>
<span class="n">Parameter</span> <span class="mi">1</span> <span class="n">equals</span> <span class="n">c</span>
<span class="n">You</span> <span class="n">now</span> <span class="n">have</span> <span class="mi">1</span> <span class="n">positional</span> <span class="n">parameters</span>
<span class="n">J</span><span class="p">:</span><span class="n">Desktop</span> <span class="n">luo</span><span class="err">$</span>

<span class="mf">2.</span>
<span class="c1"># 示例： 依次读取输入的参数并打印参数个数：
#!/bin/bash
# run.sh
</span><span class="k">while</span> <span class="p">[</span> <span class="s">"$#"</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">;</span> <span class="n">do</span>

    <span class="n">echo</span> <span class="s">"第一个参数为：$1, 参数个数为：$#"</span>
    <span class="n">shift</span>
<span class="n">done</span>

<span class="c1"># 输入命令
</span><span class="err">$</span> <span class="n">run</span><span class="p">.</span><span class="n">sh</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="n">f</span>
<span class="c1"># 结果：
</span>
<span class="n">第一个参数为</span><span class="err">：</span><span class="n">a</span><span class="p">,</span><span class="n">参数个数为</span><span class="err">：</span><span class="mi">6</span>
<span class="n">第一个参数为</span><span class="err">：</span><span class="n">b</span><span class="p">,</span><span class="n">参数个数为</span><span class="err">：</span><span class="mi">5</span>
<span class="n">第一个参数为</span><span class="err">：</span><span class="n">c</span><span class="p">,</span><span class="n">参数个数为</span><span class="err">：</span><span class="mi">4</span>
<span class="n">第一个参数为</span><span class="err">：</span><span class="n">d</span><span class="p">,</span><span class="n">参数个数为</span><span class="err">：</span><span class="mi">3</span>
<span class="n">第一个参数为</span><span class="err">：</span><span class="n">e</span><span class="p">,</span><span class="n">参数个数为</span><span class="err">：</span><span class="mi">2</span>
<span class="n">第一个参数为</span><span class="err">：</span><span class="n">f</span><span class="p">,</span><span class="n">参数个数为</span><span class="err">：</span><span class="mi">1</span>
</pre></table></code></div></div><p>many programs, particularly ones from the GNU Project, support both short and long command line options.</p><ul><li>For example:<ul><li>to display a help message for many of these programs, either the <code class="language-plaintext highlighter-rouge">-h</code> option or the longer <code class="language-plaintext highlighter-rouge">--help</code> option.</ul><li>Long option names are typically preceded by a double dash.</ul><p>Here is the code we will use to process our command line:</p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="n">interactive</span><span class="o">=</span>
<span class="n">filename</span><span class="o">=~/</span><span class="n">sysinfo_page</span><span class="p">.</span><span class="n">html</span>

<span class="k">while</span> <span class="p">[</span> <span class="s">"$1"</span> <span class="o">!=</span> <span class="s">""</span> <span class="p">];</span> <span class="n">do</span>
    <span class="n">case</span> <span class="err">$</span><span class="mi">1</span> <span class="ow">in</span>
        <span class="o">-</span><span class="n">f</span> <span class="o">|</span> <span class="o">--</span><span class="nb">file</span> <span class="p">)</span>           <span class="n">shift</span>
                                <span class="n">filename</span><span class="o">=</span><span class="err">$</span><span class="mi">1</span>
                                <span class="p">;;</span>
        <span class="o">-</span><span class="n">i</span> <span class="o">|</span> <span class="o">--</span><span class="n">interactive</span> <span class="p">)</span>    <span class="n">interactive</span><span class="o">=</span><span class="mi">1</span>
                                <span class="p">;;</span>
        <span class="o">-</span><span class="n">h</span> <span class="o">|</span> <span class="o">--</span><span class="n">help</span> <span class="p">)</span>           <span class="n">usage</span>
                                <span class="nb">exit</span>
                                <span class="p">;;</span>
        <span class="o">*</span> <span class="p">)</span>                     <span class="n">usage</span>
                                <span class="nb">exit</span> <span class="mi">1</span>
    <span class="n">esac</span>
    <span class="n">shift</span>
<span class="n">done</span>
</pre></table></code></div></div><ul><li>The first two lines:<ul><li>set the variable <code class="language-plaintext highlighter-rouge">interactive</code> to be empty: indicate that the <code class="language-plaintext highlighter-rouge">interactive mode</code> has not been requested.<li>set the variable <code class="language-plaintext highlighter-rouge">filename</code> to contain a default file name. If nothing else is specified on the command line, this file name will be used.<li>After these two variables are set, we have default settings, in case the user does not specify any options.</ul><li>loop with <code class="language-plaintext highlighter-rouge">shift</code><li>Getting an Option’s Argument<ul><li>“-f” option requires a valid file name as an argument. We use <code class="language-plaintext highlighter-rouge">shift</code> again to get the next item from the command line and assign it to filename. Later we will have to check the content of filename to make sure it is valid.</ul></ul><h2 id="integrating-the-command-line-processor-into-the-script">Integrating the Command Line Processor into the Script</h2><p>We will have to move a few things around and add a usage function to get this new routine integrated into our script. We’ll also add some test code to verify that the command line processor is working correctly. Our script now looks like this:</p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
</pre><td class="rouge-code"><pre><span class="c1">#!/bin/bash
</span>
<span class="c1"># sysinfo_page - A script to produce a system information HTML file
</span>
<span class="c1">##### Constants
</span>
<span class="n">TITLE</span><span class="o">=</span><span class="s">"System Information for $HOSTNAME"</span>
<span class="n">RIGHT_NOW</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">date</span> <span class="o">+</span><span class="s">"%x %r %Z"</span><span class="p">)</span>
<span class="n">TIME_STAMP</span><span class="o">=</span><span class="s">"Updated on $RIGHT_NOW by $USER"</span>

<span class="c1">##### Functions
</span>
<span class="nf">system_info</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">echo</span> <span class="s">"&lt;h2&gt;System release info&lt;/h2&gt;"</span>
    <span class="n">echo</span> <span class="s">"&lt;p&gt;Function not yet implemented&lt;/p&gt;"</span>

<span class="p">}</span>   <span class="c1"># end of system_info
</span>

<span class="nf">show_uptime</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">echo</span> <span class="s">"&lt;h2&gt;System uptime&lt;/h2&gt;"</span>
    <span class="n">echo</span> <span class="s">"&lt;pre&gt;"</span>
    <span class="n">uptime</span>
    <span class="n">echo</span> <span class="s">"&lt;/pre&gt;"</span>

<span class="p">}</span>   <span class="c1"># end of show_uptime
</span>

<span class="nf">drive_space</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">echo</span> <span class="s">"&lt;h2&gt;Filesystem space&lt;/h2&gt;"</span>
    <span class="n">echo</span> <span class="s">"&lt;pre&gt;"</span>
    <span class="n">df</span>
    <span class="n">echo</span> <span class="s">"&lt;/pre&gt;"</span>

<span class="p">}</span>   <span class="c1"># end of drive_space
</span>

<span class="nf">home_space</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1"># Only the superuser can get this information
</span>
    <span class="k">if</span> <span class="p">[</span> <span class="s">"$(id -u)"</span> <span class="o">=</span> <span class="s">"0"</span> <span class="p">];</span> <span class="n">then</span>
        <span class="n">echo</span> <span class="s">"&lt;h2&gt;Home directory space by user&lt;/h2&gt;"</span>
        <span class="n">echo</span> <span class="s">"&lt;pre&gt;"</span>
        <span class="n">echo</span> <span class="s">"Bytes Directory"</span>
        <span class="n">du</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">home</span><span class="o">/*</span> <span class="o">|</span> <span class="n">sort</span> <span class="o">-</span><span class="n">nr</span>
        <span class="n">echo</span> <span class="s">"&lt;/pre&gt;"</span>
    <span class="n">fi</span>

<span class="p">}</span>   <span class="c1"># end of home_space
</span>

<span class="nf">write_page</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">cat</span> <span class="o">&lt;&lt;-</span> <span class="n">_EOF_</span>
    <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="err">$</span><span class="n">TITLE</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="err">$</span><span class="n">TITLE</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">$</span><span class="n">TIME_STAMP</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
        <span class="err">$</span><span class="p">(</span><span class="n">system_info</span><span class="p">)</span>
        <span class="err">$</span><span class="p">(</span><span class="n">show_uptime</span><span class="p">)</span>
        <span class="err">$</span><span class="p">(</span><span class="n">drive_space</span><span class="p">)</span>
        <span class="err">$</span><span class="p">(</span><span class="n">home_space</span><span class="p">)</span>
        <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
<span class="n">_EOF_</span>

<span class="p">}</span>

<span class="nf">usage</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">echo</span> <span class="s">"usage: sysinfo_page [[[-f file ] [-i]] | [-h]]"</span>
<span class="p">}</span>


<span class="c1">##### Main
</span>
<span class="n">interactive</span><span class="o">=</span>
<span class="n">filename</span><span class="o">=~/</span><span class="n">sysinfo_page</span><span class="p">.</span><span class="n">html</span>

<span class="k">while</span> <span class="p">[</span> <span class="s">"$1"</span> <span class="o">!=</span> <span class="s">""</span> <span class="p">];</span> <span class="n">do</span>
    <span class="n">case</span> <span class="err">$</span><span class="mi">1</span> <span class="ow">in</span>
        <span class="o">-</span><span class="n">f</span> <span class="o">|</span> <span class="o">--</span><span class="nb">file</span> <span class="p">)</span>           <span class="n">shift</span>
                                <span class="n">filename</span><span class="o">=</span><span class="err">$</span><span class="mi">1</span>
                                <span class="p">;;</span>
        <span class="o">-</span><span class="n">i</span> <span class="o">|</span> <span class="o">--</span><span class="n">interactive</span> <span class="p">)</span>    <span class="n">interactive</span><span class="o">=</span><span class="mi">1</span>
                                <span class="p">;;</span>
        <span class="o">-</span><span class="n">h</span> <span class="o">|</span> <span class="o">--</span><span class="n">help</span> <span class="p">)</span>           <span class="n">usage</span>
                                <span class="nb">exit</span>
                                <span class="p">;;</span>
        <span class="o">*</span> <span class="p">)</span>                     <span class="n">usage</span>
                                <span class="nb">exit</span> <span class="mi">1</span>
    <span class="n">esac</span>
    <span class="n">shift</span>
<span class="n">done</span>


<span class="c1"># Test code to verify command line processing
</span>
<span class="k">if</span> <span class="p">[</span> <span class="s">"$interactive"</span> <span class="o">=</span> <span class="s">"1"</span> <span class="p">];</span> <span class="n">then</span>
	<span class="n">echo</span> <span class="s">"interactive is on"</span>
<span class="k">else</span>
	<span class="n">echo</span> <span class="s">"interactive is off"</span>
<span class="n">fi</span>
<span class="n">echo</span> <span class="s">"output file = $filename"</span>


<span class="c1"># Write page (comment out until testing is complete)
</span>
<span class="c1"># write_page &gt; $filename
</span></pre></table></code></div></div><h3 id="adding-interactive-mode">Adding Interactive Mode</h3><p>The <code class="language-plaintext highlighter-rouge">interactive mode</code> is implemented with the following code:</p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="p">[</span> <span class="s">"$interactive"</span> <span class="o">=</span> <span class="s">"1"</span> <span class="p">];</span> <span class="n">then</span>

    <span class="n">response</span><span class="o">=</span>

    <span class="n">echo</span> <span class="o">-</span><span class="n">n</span> <span class="s">"Enter name of output file [$filename] &gt; "</span>
    <span class="n">read</span> <span class="n">response</span>
    <span class="k">if</span> <span class="p">[</span> <span class="o">-</span><span class="n">n</span> <span class="s">"$response"</span> <span class="p">];</span> <span class="n">then</span>
        <span class="n">filename</span><span class="o">=</span><span class="err">$</span><span class="n">response</span>
    <span class="n">fi</span>

    <span class="k">if</span> <span class="p">[</span> <span class="o">-</span><span class="n">f</span> <span class="err">$</span><span class="n">filename</span> <span class="p">];</span> <span class="n">then</span>
        <span class="n">echo</span> <span class="o">-</span><span class="n">n</span> <span class="s">"Output file exists. Overwrite? (y/n) &gt; "</span>
        <span class="n">read</span> <span class="n">response</span>
        <span class="k">if</span> <span class="p">[</span> <span class="s">"$response"</span> <span class="o">!=</span> <span class="s">"y"</span> <span class="p">];</span> <span class="n">then</span>
            <span class="n">echo</span> <span class="s">"Exiting program."</span>
            <span class="nb">exit</span> <span class="mi">1</span>
        <span class="n">fi</span>
    <span class="n">fi</span>
<span class="n">fi</span>
</pre></table></code></div></div><ul><li>First, we check if the interactive mode is on, otherwise we don’t have anything to do.<li>Next, we ask the user for the file name. Notice the way the prompt is worded:<ul><li>echo -n “Enter name of output file <code class="language-plaintext highlighter-rouge">[$filename] &gt;</code> “</ul><li>We display the current value of filename since, the way this routine is coded<ul><li>if the user just presses the enter key, the default value of filename will be used.<li>This is accomplished in the next two lines where the value of response is checked.<li>If response is not empty, then <code class="language-plaintext highlighter-rouge">filename</code> is assigned the value of response.<li>Otherwise, filename is left unchanged, preserving its default value.</ul><li>After we have the name of the output file, we check if it already exists.<ul><li>If it does, we prompt the user.<li>If the user response is not “y,” we give up and exit, otherwise we can proceed.</ul></ul><hr /><h1 id="flow-control-1">Flow Control</h1><h2 id="for-variable-in-words-do-commands-done"><code class="language-plaintext highlighter-rouge">for variable in words; do commands done</code></h2><p>the remaining <code class="language-plaintext highlighter-rouge">flow control</code> statement, <code class="language-plaintext highlighter-rouge">for</code>.</p><ul><li><p>Like while and until, for is used to construct loops. for works like this:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>for variable in words; do
    commands
done
</pre></table></code></div></div><li><p><code class="language-plaintext highlighter-rouge">for</code> assigns a <code class="language-plaintext highlighter-rouge">word</code> from the list of <code class="language-plaintext highlighter-rouge">words</code> to the specified <code class="language-plaintext highlighter-rouge">variable</code>, executes the commands, and repeats this over and over until all the words have been used up.</p></ul><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>#!/bin/bash

for i in word1 word2 word3; do
    echo $i
done
</pre></table></code></div></div><ul><li>the variable <code class="language-plaintext highlighter-rouge">i</code> is assigned the string “word1”, then the statement <code class="language-plaintext highlighter-rouge">echo $i</code> is executed,<li>then the variable <code class="language-plaintext highlighter-rouge">i</code> is assigned the string “word2”, and the statement <code class="language-plaintext highlighter-rouge">echo $i</code> is executed,<li>and so on, until all the words in the list of words have been assigned.</ul><p>The interesting thing about for is the many ways you can construct the list of words.</p><ul><li>All kinds of expansions can be used.</ul><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">#!/bin/bash
</span><span class="n">count</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="err">$</span><span class="p">(</span><span class="n">cat</span> <span class="o">~/</span><span class="p">.</span><span class="n">bash_profile</span><span class="p">);</span> <span class="n">do</span>
    <span class="n">count</span><span class="o">=</span><span class="err">$</span><span class="p">((</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">echo</span> <span class="s">"Word $count ($i) contains $(echo -n $i | wc -c) characters"</span>
<span class="n">done</span>
<span class="c1"># take the file .bash_profile and count the number of words in the file and the number of characters in each word.
</span></pre></table></code></div></div><p>So what’s this got to do with positional parameters? Well, one of the features of for is that it can use the positional parameters as the list of words:</p><div class="language-plaintext highlighter-rouge"><div class="code-header" text-data="plaintext"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>#!/bin/bash

for i in "$@"; do
    echo $i
done
</pre></table></code></div></div><p>The shell variable <code class="language-plaintext highlighter-rouge">$@</code> contains the list of command line arguments.</p><ul><li>This technique is often used to process a <code class="language-plaintext highlighter-rouge">list of files</code> on the command line.</ul><p>an example:</p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="c1">#!/bin/bash
</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="s">"$@"</span><span class="p">;</span> <span class="n">do</span>
    <span class="n">result</span><span class="o">=</span>
    <span class="k">if</span> <span class="p">[</span> <span class="o">-</span><span class="n">f</span> <span class="s">"$filename"</span> <span class="p">];</span> <span class="n">then</span>
        <span class="n">result</span><span class="o">=</span><span class="s">"$filename is a regular file"</span>
    <span class="k">elif</span> <span class="p">[</span> <span class="o">-</span><span class="n">d</span> <span class="s">"$filename"</span> <span class="p">];</span> <span class="n">then</span>
        <span class="n">result</span><span class="o">=</span><span class="s">"$filename is a directory"</span>
    <span class="k">else</span>
        <span class="n">result</span><span class="o">=</span><span class="s">"$filename is not a exist file or directory"</span>
    <span class="n">fi</span>

<span class="c1">#    else
#        if [ -d "$filename" ]; then
#            result="$filename is a directory"
#        fi
#    fi
</span>
    <span class="k">if</span> <span class="p">[</span> <span class="o">-</span><span class="n">w</span> <span class="s">"$filename"</span> <span class="p">];</span> <span class="n">then</span>
        <span class="n">result</span><span class="o">=</span><span class="s">"$result and it is writable"</span>
    <span class="k">else</span>
        <span class="n">result</span><span class="o">=</span><span class="s">"$result and it is not writable"</span>
    <span class="n">fi</span>
    <span class="n">echo</span> <span class="s">"$result"</span>
<span class="n">done</span>

<span class="c1"># Try this script
</span><span class="err">$</span> <span class="k">try</span> <span class="o">*</span>
<span class="mi">1</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">regular</span> <span class="nb">file</span> <span class="ow">and</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">writable</span>
<span class="mf">2017.</span><span class="n">pdf</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">regular</span> <span class="nb">file</span> <span class="ow">and</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">writable</span>

<span class="err">$</span> <span class="k">try</span> <span class="n">dy7</span> <span class="n">hryf</span>
<span class="n">dy7</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">exist</span> <span class="nb">file</span> <span class="ow">or</span> <span class="n">directory</span> <span class="ow">and</span> <span class="n">it</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">writable</span>
<span class="n">hryf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">exist</span> <span class="nb">file</span> <span class="ow">or</span> <span class="n">directory</span> <span class="ow">and</span> <span class="n">it</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">writable</span>
</pre></table></code></div></div><p>another example script.</p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="n">This</span> <span class="n">one</span> <span class="n">compares</span> <span class="n">the</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">two</span> <span class="n">directories</span> <span class="ow">and</span> <span class="n">lists</span> <span class="n">which</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">first</span> <span class="n">directory</span> <span class="n">are</span> <span class="n">missing</span> <span class="k">from</span> <span class="n">the</span> <span class="n">second</span><span class="p">.</span>

<span class="c1">#!/bin/bashbash
# cmp_dir - program to compare two directories
</span>
<span class="c1"># Check for required arguments
#if [ $# -ne 2 ]; then
</span>    <span class="n">echo</span> <span class="s">"usage: $0 directory_1 directory_2"</span> <span class="mi">1</span><span class="o">&gt;&amp;</span><span class="mi">2</span>
    <span class="nb">exit</span> <span class="mi">1</span>
<span class="n">fi</span>

<span class="c1"># Make sure both arguments are directories
</span><span class="k">if</span> <span class="p">[</span> <span class="err">!</span> <span class="o">-</span><span class="n">d</span> <span class="err">$</span><span class="mi">1</span> <span class="p">];</span> <span class="n">then</span>
    <span class="n">echo</span> <span class="s">"$1 is not a directory!"</span> <span class="mi">1</span><span class="o">&gt;&amp;</span><span class="mi">2</span>
    <span class="nb">exit</span> <span class="mi">1</span>
<span class="n">fi</span>

<span class="k">if</span> <span class="p">[</span> <span class="err">!</span> <span class="o">-</span><span class="n">d</span> <span class="err">$</span><span class="mi">2</span> <span class="p">];</span> <span class="n">then</span>
    <span class="n">echo</span> <span class="s">"$2 is not a directory!"</span> <span class="mi">1</span><span class="o">&gt;&amp;</span><span class="mi">2</span>
    <span class="nb">exit</span> <span class="mi">1</span>
<span class="n">fi</span>

<span class="c1"># Process each file in directory_1, comparing it to directory_2
</span><span class="n">missing</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="err">$</span><span class="mi">1</span><span class="o">/*</span><span class="p">;</span> <span class="n">do</span>
    <span class="n">fn</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">basename</span> <span class="s">"$filename"</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">[</span> <span class="o">-</span><span class="n">f</span> <span class="s">"$filename"</span> <span class="p">];</span> <span class="n">then</span>
        <span class="k">if</span> <span class="p">[</span> <span class="err">!</span> <span class="o">-</span><span class="n">f</span> <span class="s">"$2/$fn"</span> <span class="p">];</span> <span class="n">then</span>
            <span class="n">echo</span> <span class="s">"$fn is missing from $2"</span>
            <span class="n">missing</span><span class="o">=</span><span class="err">$</span><span class="p">((</span><span class="n">missing</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">fi</span>
    <span class="n">fi</span>
<span class="n">done</span>
<span class="n">echo</span> <span class="s">"$missing files missing"</span>
</pre></table></code></div></div><p>to improve the home_space function in our script to output more information.</p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nf">home_space</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1"># Only the superuser can get this information
</span>
    <span class="k">if</span> <span class="p">[</span> <span class="s">"$(id -u)"</span> <span class="o">=</span> <span class="s">"0"</span> <span class="p">];</span> <span class="n">then</span>
    <span class="n">echo</span> <span class="s">"&lt;h2&gt;Home directory space by user&lt;/h2&gt;"</span>
    <span class="n">echo</span> <span class="s">"&lt;pre&gt;"</span>
    <span class="n">echo</span> <span class="s">"Bytes Directory"</span>
        <span class="n">du</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">home</span><span class="o">/*</span> <span class="o">|</span> <span class="n">sort</span> <span class="o">-</span><span class="n">nr</span>
    <span class="n">echo</span> <span class="s">"&lt;/pre&gt;"</span>
    <span class="n">fi</span>

<span class="p">}</span>   <span class="c1"># end of home_space
</span></pre></table></code></div></div><p>Here is the new version:</p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="nf">home_space</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">echo</span> <span class="s">"&lt;h2&gt;Home directory space by user&lt;/h2&gt;"</span>
    <span class="n">echo</span> <span class="s">"&lt;pre&gt;"</span>
    <span class="nb">format</span><span class="o">=</span><span class="s">"%8s%10s%10s   %-s</span><span class="se">\n</span><span class="s">"</span>
    <span class="n">printf</span> <span class="s">"$format"</span> <span class="s">"Dirs"</span> <span class="s">"Files"</span> <span class="s">"Blocks"</span> <span class="s">"Directory"</span>
    <span class="n">printf</span> <span class="s">"$format"</span> <span class="s">"----"</span> <span class="s">"-----"</span> <span class="s">"------"</span> <span class="s">"---------"</span>
    <span class="k">if</span> <span class="p">[</span> <span class="err">$</span><span class="p">(</span><span class="nb">id</span> <span class="o">-</span><span class="n">u</span><span class="p">)</span> <span class="o">=</span> <span class="s">"0"</span> <span class="p">];</span> <span class="n">then</span>
        <span class="n">dir_list</span><span class="o">=</span><span class="s">"/home/*"</span>
    <span class="k">else</span>
        <span class="n">dir_list</span><span class="o">=</span><span class="err">$</span><span class="n">HOME</span>
    <span class="n">fi</span>
    <span class="k">for</span> <span class="n">home_dir</span> <span class="ow">in</span> <span class="err">$</span><span class="n">dir_list</span><span class="p">;</span> <span class="n">do</span>
        <span class="n">total_dirs</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">find</span> <span class="err">$</span><span class="n">home_dir</span> <span class="o">-</span><span class="nb">type</span> <span class="n">d</span> <span class="o">|</span> <span class="n">wc</span> <span class="o">-</span><span class="n">l</span><span class="p">)</span>
        <span class="n">total_files</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">find</span> <span class="err">$</span><span class="n">home_dir</span> <span class="o">-</span><span class="nb">type</span> <span class="n">f</span> <span class="o">|</span> <span class="n">wc</span> <span class="o">-</span><span class="n">l</span><span class="p">)</span>
        <span class="n">total_blocks</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">du</span> <span class="o">-</span><span class="n">s</span> <span class="err">$</span><span class="n">home_dir</span><span class="p">)</span>
        <span class="n">printf</span> <span class="s">"$format"</span> <span class="err">$</span><span class="n">total_dirs</span> <span class="err">$</span><span class="n">total_files</span> <span class="err">$</span><span class="n">total_blocks</span>
    <span class="n">done</span>
    <span class="n">echo</span> <span class="s">"&lt;/pre&gt;"</span>
<span class="p">}</span>   <span class="c1"># end of home_space
</span></pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">printf</code>: to produce formatted output according to the contents of a format string. printf comes from the C programming language and has been implemented in many other programming languages including C++, Perl, awk, java, PHP, and of course, bash.<li><code class="language-plaintext highlighter-rouge">find</code>: to search for files or directories that meet specific criteria. In the home_space function, we use find to list the directories and regular files in each home directory.<li><code class="language-plaintext highlighter-rouge">wc</code>: count the number of files and directories found.</ul><p>deal with the problem of superuser access.</p><ul><li>test for the superuser with id<li>according to the outcome of the test, assign different strings to the <code class="language-plaintext highlighter-rouge">variable dir_list</code>, the list of words for the for loop.<li>This way, if an ordinary user runs the script, only his/her home directory will be listed.</ul><p>Another function that can use a for loop is our unfinished system_info function. We can build it like this:</p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nf">system_info</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1"># Find any release files in /etc
</span>    <span class="k">if</span> <span class="n">ls</span> <span class="o">/</span><span class="n">etc</span><span class="o">/*</span><span class="n">release</span> <span class="mi">1</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span><span class="p">;</span> <span class="n">then</span>
        <span class="n">echo</span> <span class="s">"&lt;h2&gt;System release info&lt;/h2&gt;"</span>
        <span class="n">echo</span> <span class="s">"&lt;pre&gt;"</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="o">/</span><span class="n">etc</span><span class="o">/*</span><span class="n">release</span><span class="p">;</span> <span class="n">do</span>
            <span class="c1"># Since we can't be sure of the length of the file,
</span>            <span class="c1"># only display the first line.
</span>            <span class="n">head</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1</span> <span class="err">$</span><span class="n">i</span>
        <span class="n">done</span>
        <span class="n">uname</span> <span class="o">-</span><span class="n">orp</span>
        <span class="n">echo</span> <span class="s">"&lt;/pre&gt;"</span>
    <span class="n">fi</span>
<span class="p">}</span>   <span class="c1"># end of system_info
</span></pre></table></code></div></div><ul><li>first determine if there are any <code class="language-plaintext highlighter-rouge">release files</code> to process.<ul><li>The <code class="language-plaintext highlighter-rouge">release files</code> contain the name of the vendor and the version of the distribution.<li>They are located in the <code class="language-plaintext highlighter-rouge">/etc directory.</code><li>To detect them, perform <code class="language-plaintext highlighter-rouge">ls</code> command and throw away all of its output.<li>in the exit status. It will be <code class="language-plaintext highlighter-rouge">true</code> if any files are found.</ul><li>Next, we output the HTML for this section of the page, since we now know that there are release files to process.<ul><li>To process the files, we start a <code class="language-plaintext highlighter-rouge">for</code> loop to act on each one.<li>Inside the loop, we use the <code class="language-plaintext highlighter-rouge">head</code> command to return the first line of each file.</ul><li>Finally, we use the <code class="language-plaintext highlighter-rouge">uname</code> command with the <code class="language-plaintext highlighter-rouge">o</code>, <code class="language-plaintext highlighter-rouge">r</code>, and <code class="language-plaintext highlighter-rouge">p</code> options to obtain some additional information from the system.</ul><p>http://linuxcommand.org/lc3_wss0140.php</p><p>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/00codenote/'>00CodeNote</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/script/" class="post-tag no-text-decoration" >Script</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=ShellScripts - Grace&url=https://ocholuo.github.io//posts/shellscripts/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=ShellScripts - Grace&u=https://ocholuo.github.io//posts/shellscripts/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=ShellScripts - Grace&url=https://ocholuo.github.io//posts/shellscripts/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Amazon-CloudFront/">AWS Lab - AWS CloudFront</a><li><a href="/posts/Alexa-1stSkill/">AWS Alex First Skill - RedVelvet Time</a><li><a href="/posts/NetworkProtocol-SSL-TLS-Handshake/">NetworkProtocol SSL/TLS Handshake</a><li><a href="/posts/pythonCrash/">Python Crash</a><li><a href="/posts/%E4%B8%80%E5%8F%A5%E8%AF%9D%E8%A7%A3%E9%87%8AAWS/">AWS - 一句话解释AWS</a><li><a href="/posts/GKE/">GCP - Google Cloud Computing - Kubernetes and Kubernetes Engine</a><li><a href="/posts/Go-Note/">Go Note</a><li><a href="/posts/SCPs/">AWS - IdenAccessManage - SCPs (Service Control Policies)</a><li><a href="/posts/CompanyBenefit/">Company Benefit</a><li><a href="/posts/Encryption-SSL&TLS/">Cryptography - SSL/TLS Encryption</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/cyberattack/">CyberAttack</a> <a class="post-tag" href="/tags/lab/">Lab</a> <a class="post-tag" href="/tags/cyberattacktools/">CyberAttackTools</a> <a class="post-tag" href="/tags/gcp/">GCP</a> <a class="post-tag" href="/tags/sysadmin/">Sysadmin</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/soc/">SOC</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/CPP-setup/"><div class="card-body"> <span class="timeago small" >May 25, 2017<i class="unloaded">2017-05-25T11:11:11-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>C++</h3><div class="text-muted small"><p> [toc] C++ C++ basic 一种中级语言， 由 Bjarne Stroustrup 于 1979 年在贝尔实验室开始设计开发的。 C++ 进一步扩充和完善了 C 语言，是一种面向对象的程序设计语言。 C++ 可运行于多种平台上，如 Windows、MAC 操作系统以及 UNIX 的各种版本。 面向对象程序设计 C++ 完全支持面向对象的程序设计...</p></div></div></a></div><div class="card"> <a href="/posts/README/"><div class="card-body"> <span class="timeago small" >Sep 4, 2020<i class="unloaded">2020-09-04T11:11:11-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Coding Problems & Solutions</h3><div class="text-muted small"><p> Coding Problems &amp; Solutions cheatsheet if none while generate list Problems &amp; Solutions solution: ...</p></div></div></a></div><div class="card"> <a href="/posts/bash/"><div class="card-body"> <span class="timeago small" >Sep 25, 2020<i class="unloaded">2020-09-25T11:11:11-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Bash Note</h3><div class="text-muted small"><p> [toc] bash Note 1 2 3 4 5 6 7 8 9 10 Number of elements: ${#ARRAY[@]} echo ${ARRAY[@]} stdin # standard input. It takes text as input. stdout # standard output. The text output of a command ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Makefile/" class="btn btn-outline-primary" prompt="Older"><p>Makefile</p></a> <a href="/posts/test-UnitTest/" class="btn btn-outline-primary" prompt="Newer"><p>Unittest</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/ocholuo">Grace JyL</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/cyberattack/">CyberAttack</a> <a class="post-tag" href="/tags/lab/">Lab</a> <a class="post-tag" href="/tags/cyberattacktools/">CyberAttackTools</a> <a class="post-tag" href="/tags/gcp/">GCP</a> <a class="post-tag" href="/tags/sysadmin/">Sysadmin</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/soc/">SOC</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://ocholuo.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script async src="https://cdn.jsdelivr.net/npm/countup.js@1.9.3/dist/countUp.min.js"></script> <script defer src="/assets/js/dist/pvreport.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-179830187-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-179830187-1'); }); </script>
