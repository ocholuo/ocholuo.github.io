<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="pv-proxy-endpoint" content="https://myochosite-291718.appspot.com/query?id=ahNwfm15b2Nob3NpdGUtMjkxNzE4chULEghBcGlRdWVyeRiAgIDo14eBCgw"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="AWS Alex First Skill - RedVelvet Time" /><meta property="og:locale" content="en" /><meta name="description" content="Alex First Skill - RedVelvet Time" /><meta property="og:description" content="Alex First Skill - RedVelvet Time" /><link rel="canonical" href="https://ocholuo.github.io//posts/Alexa-1stSkill/" /><meta property="og:url" content="https://ocholuo.github.io//posts/Alexa-1stSkill/" /><meta property="og:site_name" content="Grace" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-07-16T11:11:11-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="AWS Alex First Skill - RedVelvet Time" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-03-23T03:33:33-04:00","datePublished":"2020-07-16T11:11:11-04:00","description":"Alex First Skill - RedVelvet Time","headline":"AWS Alex First Skill - RedVelvet Time","mainEntityOfPage":{"@type":"WebPage","@id":"https://ocholuo.github.io//posts/Alexa-1stSkill/"},"url":"https://ocholuo.github.io//posts/Alexa-1stSkill/"}</script><title>AWS Alex First Skill - RedVelvet Time | Grace</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Grace"><meta name="application-name" content="Grace"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://myochosite-291718.appspot.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://myochosite-291718.appspot.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/huoye.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Grace</a></div><div class="site-subtitle font-italic">2023 Mar 14 updated</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/ocholuo" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>AWS Alex First Skill - RedVelvet Time</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>AWS Alex First Skill - RedVelvet Time</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Grace JyL </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Jul 16, 2020, 11:11 AM -0400" >Jul 16, 2020<i class="unloaded">2020-07-16T11:11:11-04:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Mar 23, 2023, 12:33 AM -0700" >Mar 23<i class="unloaded">2023-03-23T03:33:33-04:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5991 words">33 min read</span> <span id="pv" class="pageviews"> <i class="fas fa-spinner fa-spin fa-fw"></i> </span> views</div></div><div class="post-content"><h1 id="alex-first-skill---redvelvet-time">Alex First Skill - RedVelvet Time</h1><ul><li><a href="#alex-first-skill---redvelvet-time">Alex First Skill - RedVelvet Time</a><ul><li><a href="#create-a-skill-in-five-minutes">Create a Skill in Five Minutes</a><li><a href="#introduction-how-users-will-interact-with-cake-time">Introduction: How Users Will Interact With Cake Time</a><li><a href="#build-the-cake-time-skill">Build the Cake Time Skill</a><ul><li><a href="#step-1-log-in">Step 1. Log in</a><li><a href="#step-2-create-your-skill">Step 2. Create your skill</a><li><a href="#step-3-greet-the-user">Step 3. Greet the user</a><li><a href="#step-4-build">Step 4: Build</a><li><a href="#step-5-test-your-skill">Step 5: Test your skill</a><li><a href="#code">Code</a></ul><li><a href="#collecting-slots-turn-by-turn-with-auto-delegation">Collecting slots turn-by-turn with auto-delegation</a><ul><li><a href="#step-1-ask-the-user-for-their-birthday">Step 1: Ask the user for their birthday</a><li><a href="#step-2-use-an-intent-and-slots-to-capture-information">Step 2: Use an intent and slots to capture information</a><li><a href="#step-3-use-dialog-management">Step 3: Use dialog management</a><li><a href="#step-4-define-a-new-handler">Step 4: Define a new handler</a><li><a href="#step-5-test-your-skill-1">Step 5: Test your skill</a><li><a href="#wrap-up">Wrap-up</a></ul><li><a href="#adding-memory-to-skill">Adding memory to skill</a><ul><li><a href="#step-1-use-amazon-s3-to-save-and-read-data">Step 1: Use Amazon S3 to save and read data</a><li><a href="#step-2-save-data">Step 2: Save Data</a><li><a href="#step-3-read-stored-data">Step 3: Read stored data</a><li><a href="#how-to-delete-or-reset-the-users-birthday">How to delete or reset the user’s birthday</a><li><a href="#test-so-click-the-test-tab-then-follow-the-steps-below">test, so click the Test tab, then follow the steps below.</a></ul><li><a href="#using-the-alexa-settings-api">Using the Alexa Settings API</a><ul><li><a href="#step-1-get-device-id-api-endpoint-and-authorization-token-for-alexa-settings-api">Step 1: Get Device ID, API endpoint, and Authorization Token for Alexa Settings API</a><li><a href="#step-2-using-the-alexa-settings-api-to-retrieve-the-user-time-zone">Step 2: Using the Alexa Settings API to retrieve the user time zone</a></ul></ul></ul><hr /><h2 id="create-a-skill-in-five-minutes">Create a Skill in Five Minutes</h2><p>create a skill: “Cake Time”</p><p>What you’ll learn:</p><ul><li>How to build a simple skill called Cake Time with step-by-step instructions<li>How to use the Alexa Developer Console<li>How to host your skill’s backend resources<li>How to modify the response that Alexa speaks to customers<li>How to test your skill</ul><h2 id="introduction-how-users-will-interact-with-cake-time">Introduction: How Users Will Interact With Cake Time</h2><p>build Cake Time, a simple skill that:</p><ul><li>asks the user for their birthday<li>remembers it<li>tells them how many days until their next birthday<li>wishes them Happy Birthday on their birthday</ul><p>At the end of module 3, your first Alexa skill will say “Hello! Welcome to Cake Time. That was a piece of cake! Bye!”</p><ul><li>The skill is simple to use yet a bit complex to build. The burden is on us, the skill builder, to make the interaction simple and natural.<li>One way to make it as natural as possible is to mimic human conversational patterns. Humans have memory so your skill should too. It would be frustrating if your best friend always had to ask your name (which may be a sign that they really aren’t your best friend at all). While you could build cake time in a day, because of its complexity you’ll build cake time over four modules in this course.</ul><h2 id="build-the-cake-time-skill">Build the Cake Time Skill</h2><h3 id="step-1-log-in">Step 1. Log in</h3><h3 id="step-2-create-your-skill">Step 2. Create your skill</h3><ol><li>Click Create Skill on the right-hand side of the console. A new page displays.<li>In the Skill name field, enter Cake Time.<li>Leave the Default language set to English (US).<li>You are building a <code class="language-plaintext highlighter-rouge">custom skill</code>. Under Choose a model to add to your skill, select Custom.<li>Skills have a <strong>front end</strong> and <strong>backend</strong>.<li>The front end is where you map utterances (what the user says) into an intent (the desired action).<li>You must decide how to handle the user’s intent in the backend.<li>Host the skill yourself using an <code class="language-plaintext highlighter-rouge">AWS Lambda function or HTTPS endpoint</code>, or choose Alexa to host the skill for you.<li>There are limits to the AWS Free Tier, so if your skill goes viral, you may want to move to the self-hosted option.<li>To follow the steps in this course, choose Alexa-Hosted (Node.js).<li>Choose a method to host your skill’s backend resource: <code class="language-plaintext highlighter-rouge">Alexa-Hosted (Python)</code>.<li>Create skill.<li>exit and return to the Alexa developer console, find your skill on the Skills tab, in the Alexa Skills list. Click Edit to continue working on your skill.</ol><h3 id="step-3-greet-the-user">Step 3. Greet the user</h3><ol><li>The first thing a user will want to do with the skill is open it.<li>The intent of opening the skill is built into the experience, so you don’t need to define this intent in your front end.<li>However, you need to respond to the intent in your backend.<ul><li>update your backend code to greet the user when they open the skill.</ul><li><p>Open the Cake Time skill. Click the <strong>Code tab</strong>.</p><li>There are two pieces to a handler:<ul><li><code class="language-plaintext highlighter-rouge">can_handle() function</code>: define what requests the handler responds to.<ul><li>If your skill receives a request, the can_handle() function within each handler determines whether or not that handler can service the request.<li>In this case<li>the user wants to launch the skill, which is a <code class="language-plaintext highlighter-rouge">LaunchRequest</code>.<li>Therefore, the ca n_handle() function within the <code class="language-plaintext highlighter-rouge">LaunchRequestHandler</code> will let the SDK know it can fulfill the request.<li>In computer terms, the can_handle returns true to confirm it can do the work.</ul><li><code class="language-plaintext highlighter-rouge">handle() function</code>: returns a response to the user.<ul><li>line that begins <code class="language-plaintext highlighter-rouge">speak_output =</code>.<li>This variable contains the string of words the skill should say back to the user when they launch the skill.</ul><li>What should happen when a user launches the Cake Time skill?<ul><li>want the skill to simply confirm that the user opened it by saying, “Hello! Welcome to Cake Time. That was a piece of cake! Bye!” Within the <code class="language-plaintext highlighter-rouge">LaunchRequestHandler</code> object, find the <code class="language-plaintext highlighter-rouge">handle()</code> function.<li>This function uses the <code class="language-plaintext highlighter-rouge">responseBuilder</code> function to compose and return the response to the user.</ul></ul><li>Within the <code class="language-plaintext highlighter-rouge">LaunchRequestHandler</code> object<ul><li>the handle() function<li>Replace: <code class="language-plaintext highlighter-rouge">speak_output = "Hello! Welcome to Cake Time. That was a piece of cake! Bye!"</code><li><code class="language-plaintext highlighter-rouge">.ask() function</code>: omit this line of code for now.</ul></ol><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">LaunchRequestHandler</span><span class="p">(</span><span class="n">AbstractRequestHandler</span><span class="p">):</span>
    <span class="s">"""Handler for Skill Launch."""</span>

    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>    <span class="c1"># type: (HandlerInput) -&gt; bool
</span>        <span class="k">return</span> <span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_request_type</span><span class="p">(</span><span class="s">"LaunchRequest"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>        <span class="c1"># type: (HandlerInput) -&gt; Response
</span>
        <span class="n">speak_output</span> <span class="o">=</span> <span class="s">"Hello! Welcome to Cake Time. That was a piece of cake! Bye!"</span>
        <span class="c1"># words the skill should say back to the user when launch the skill
</span>
        <span class="nf">return </span><span class="p">(</span>
            <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span>  <span class="c1"># help build the response to the user
</span>                <span class="p">.</span><span class="nf">speak</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>   <span class="c1"># .speak(): tells responseBuilder to speak the value of speak_output to the user.
</span>                <span class="c1"># .ask(speak_output)   # .ask(): If the skill was supposed to listen for the user’s response
</span>                <span class="p">.</span><span class="n">response</span>              <span class="c1"># converts the responseBuilder’s work into the response that the skill will return.
</span>        <span class="p">)</span>
</pre></table></code></div></div><ol><li><p><strong>save</strong></p><li><p><strong>Deploy</strong></p></ol><h3 id="step-4-build">Step 4: Build</h3><ol><li>Build &gt; Invacation &gt; change <code class="language-plaintext highlighter-rouge">Skill Invocation Name</code> &gt; save &gt; <code class="language-plaintext highlighter-rouge">Build Model</code></ol><h3 id="step-5-test-your-skill">Step 5: Test your skill</h3><ol><li>Click the <strong>Test tab</strong>.<li>An alert may appear requesting to use your computer’s microphone. Click Allow.<li>From the drop-down menu at the top left of the page, select <code class="language-plaintext highlighter-rouge">Development</code>.<ul><li>2 ways to test your skill in the console.<ul><li>type what the user would say into the box at the top left.<li>speak to the skill by clicking and holding the microphone icon and speaking.</ul></ul><li>So far, the skill has one intent: LaunchRequest.<ul><li>This function responds to the user when they ask Alexa to open or launch the skill.<li>The user will say, “Alexa, open Cake Time.” Cake Time is the name of your skill and was automatically set as the invocation name for the skill. You can change the invocation name, but let’s leave it as is for this exercise.</ul><li><p>Test the skill. Type open Cake Time (not case sensitive) into the box at the top left and press ENTER, or click and hold the microphone icon and say, “Open Cake Time.”</p><li>When testing on an Alexa-enabled device, you need the wake word: “Alexa, open Cake Time”</ol><h3 id="code">Code</h3><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
</pre><td class="rouge-code"><pre><span class="c1"># -*- coding: utf-8 -*-
</span>
<span class="c1"># This sample demonstrates handling intents from an Alexa skill using the Alexa Skills Kit SDK for Python.
# Please visit https://alexa.design/cookbook for additional examples on implementing slots, dialog management,
# session persistence, api calls, and more.
# This sample is built using the handler classes approach in skill builder.
</span><span class="kn">import</span> <span class="n">logging</span>
<span class="kn">import</span> <span class="n">ask_sdk_core.utils</span> <span class="k">as</span> <span class="n">ask_utils</span>

<span class="kn">from</span> <span class="n">ask_sdk_core.skill_builder</span> <span class="kn">import</span> <span class="n">SkillBuilder</span>
<span class="kn">from</span> <span class="n">ask_sdk_core.dispatch_components</span> <span class="kn">import</span> <span class="n">AbstractRequestHandler</span>
<span class="kn">from</span> <span class="n">ask_sdk_core.dispatch_components</span> <span class="kn">import</span> <span class="n">AbstractExceptionHandler</span>
<span class="kn">from</span> <span class="n">ask_sdk_core.handler_input</span> <span class="kn">import</span> <span class="n">HandlerInput</span>

<span class="kn">from</span> <span class="n">ask_sdk_model</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="p">.</span><span class="nf">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">LaunchRequestHandler</span><span class="p">(</span><span class="n">AbstractRequestHandler</span><span class="p">):</span>
    <span class="s">"""Handler for Skill Launch."""</span>
    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; bool
</span>
        <span class="k">return</span> <span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_request_type</span><span class="p">(</span><span class="s">"LaunchRequest"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; Response
</span>        <span class="n">speak_output</span> <span class="o">=</span> <span class="s">"Hello! Welcome to Cake Time. That was a piece of cake! Bye!"</span>

        <span class="nf">return </span><span class="p">(</span>
            <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span>
                <span class="p">.</span><span class="nf">speak</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>
                <span class="c1">#.ask(speak_output)
</span>                <span class="p">.</span><span class="n">response</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">HelloWorldIntentHandler</span><span class="p">(</span><span class="n">AbstractRequestHandler</span><span class="p">):</span>
    <span class="s">"""Handler for Hello World Intent."""</span>
    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; bool
</span>        <span class="k">return</span> <span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_intent_name</span><span class="p">(</span><span class="s">"HelloWorldIntent"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; Response
</span>        <span class="n">speak_output</span> <span class="o">=</span> <span class="s">"Hello World!"</span>

        <span class="nf">return </span><span class="p">(</span>
            <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span>
                <span class="p">.</span><span class="nf">speak</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>
                <span class="c1"># .ask("add a reprompt if you want to keep the session open for the user to respond")
</span>                <span class="p">.</span><span class="n">response</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">HelpIntentHandler</span><span class="p">(</span><span class="n">AbstractRequestHandler</span><span class="p">):</span>
    <span class="s">"""Handler for Help Intent."""</span>
    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; bool
</span>        <span class="k">return</span> <span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_intent_name</span><span class="p">(</span><span class="s">"AMAZON.HelpIntent"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; Response
</span>        <span class="n">speak_output</span> <span class="o">=</span> <span class="s">"You can say hello to me! How can I help?"</span>

        <span class="nf">return </span><span class="p">(</span>
            <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span>
                <span class="p">.</span><span class="nf">speak</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">ask</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>
                <span class="p">.</span><span class="n">response</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">CancelOrStopIntentHandler</span><span class="p">(</span><span class="n">AbstractRequestHandler</span><span class="p">):</span>
    <span class="s">"""Single handler for Cancel and Stop Intent."""</span>
    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; bool
</span>        <span class="nf">return </span><span class="p">(</span><span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_intent_name</span><span class="p">(</span><span class="s">"AMAZON.CancelIntent"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">)</span> <span class="ow">or</span>
                <span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_intent_name</span><span class="p">(</span><span class="s">"AMAZON.StopIntent"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; Response
</span>        <span class="n">speak_output</span> <span class="o">=</span> <span class="s">"Goodbye!"</span>

        <span class="nf">return </span><span class="p">(</span>
            <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span>
                <span class="p">.</span><span class="nf">speak</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>
                <span class="p">.</span><span class="n">response</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">SessionEndedRequestHandler</span><span class="p">(</span><span class="n">AbstractRequestHandler</span><span class="p">):</span>
    <span class="s">"""Handler for Session End."""</span>
    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; bool
</span>        <span class="k">return</span> <span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_request_type</span><span class="p">(</span><span class="s">"SessionEndedRequest"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; Response
</span>
        <span class="c1"># Any cleanup logic goes here.
</span>
        <span class="k">return</span> <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span><span class="p">.</span><span class="n">response</span>


<span class="k">class</span> <span class="nc">IntentReflectorHandler</span><span class="p">(</span><span class="n">AbstractRequestHandler</span><span class="p">):</span>
    <span class="s">"""The intent reflector is used for interaction model testing and debugging.
    It will simply repeat the intent the user said. You can create custom handlers
    for your intents by defining them above, then also adding them to the request
    handler chain below.
    """</span>
    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; bool
</span>        <span class="k">return</span> <span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_request_type</span><span class="p">(</span><span class="s">"IntentRequest"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; Response
</span>        <span class="n">intent_name</span> <span class="o">=</span> <span class="n">ask_utils</span><span class="p">.</span><span class="nf">get_intent_name</span><span class="p">(</span><span class="n">handler_input</span><span class="p">)</span>
        <span class="n">speak_output</span> <span class="o">=</span> <span class="s">"You just triggered "</span> <span class="o">+</span> <span class="n">intent_name</span> <span class="o">+</span> <span class="s">"."</span>

        <span class="nf">return </span><span class="p">(</span>
            <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span>
                <span class="p">.</span><span class="nf">speak</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>
                <span class="c1"># .ask("add a reprompt if you want to keep the session open for the user to respond")
</span>                <span class="p">.</span><span class="n">response</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">CatchAllExceptionHandler</span><span class="p">(</span><span class="n">AbstractExceptionHandler</span><span class="p">):</span>
    <span class="s">"""Generic error handling to capture any syntax or routing errors. If you receive an error
    stating the request handler chain is not found, you have not implemented a handler for
    the intent being invoked or included it in the skill builder below.
    """</span>
    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput, Exception) -&gt; bool
</span>        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput, Exception) -&gt; Response
</span>        <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">speak_output</span> <span class="o">=</span> <span class="s">"Sorry, I had trouble doing what you asked. Please try again."</span>

        <span class="nf">return </span><span class="p">(</span>
            <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span>
                <span class="p">.</span><span class="nf">speak</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">ask</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>
                <span class="p">.</span><span class="n">response</span>
        <span class="p">)</span>

<span class="c1"># The SkillBuilder object acts as the entry point for your skill, routing all request and response
# payloads to the handlers above. Make sure any new handlers or interceptors you've
# defined are included below. The order matters - they're processed top to bottom.
</span>

<span class="n">sb</span> <span class="o">=</span> <span class="nc">SkillBuilder</span><span class="p">()</span>

<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">LaunchRequestHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">HelloWorldIntentHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">HelpIntentHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">CancelOrStopIntentHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">SessionEndedRequestHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">IntentReflectorHandler</span><span class="p">())</span> <span class="c1"># make sure IntentReflectorHandler is last so it doesn't override your custom intent handlers
</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_exception_handler</span><span class="p">(</span><span class="nc">CatchAllExceptionHandler</span><span class="p">())</span>

<span class="n">lambda_handler</span> <span class="o">=</span> <span class="n">sb</span><span class="p">.</span><span class="nf">lambda_handler</span><span class="p">()</span>
</pre></table></code></div></div><hr /><h2 id="collecting-slots-turn-by-turn-with-auto-delegation">Collecting slots turn-by-turn with auto-delegation</h2><p>At the end of this module, your Cake Time skill will be able to:</p><ul><li>Ask the user a question<li>Listen for the answer<li>Respond to the user</ul><h3 id="step-1-ask-the-user-for-their-birthday">Step 1: Ask the user for their birthday</h3><ol><li><p>Code tab.</p><li><p>Within the LaunchRequestHandler, in the handle() function, change <code class="language-plaintext highlighter-rouge">speak_output =</code>.</p><li><code class="language-plaintext highlighter-rouge">.ask() function</code> does two things:<ul><li>Tells the skill to wait for the user to reply, rather than simply exiting<li>Allows you to specify a way to ask the question to the user again, if they don’t respond. <code class="language-plaintext highlighter-rouge">reprompt_text</code></ul><li>replace <code class="language-plaintext highlighter-rouge">.ask(speak_output)</code> with <code class="language-plaintext highlighter-rouge">.ask(reprompt_text)</code></ol><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">LaunchRequestHandler</span><span class="p">(</span><span class="n">AbstractRequestHandler</span><span class="p">):</span>
    <span class="s">"""Handler for Skill Launch."""</span>

    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>        <span class="c1"># type: (HandlerInput) -&gt; bool
</span>
        <span class="k">return</span> <span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_request_type</span><span class="p">(</span><span class="s">"LaunchRequest"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>        <span class="c1"># type: (HandlerInput) -&gt; Response
</span>
        <span class="n">speak_output</span> <span class="o">=</span> <span class="s">"Aniyo! Welcome to red velevt Time. What is your birthday?"</span>
        <span class="n">reprompt_text</span> <span class="o">=</span> <span class="s">"I was born Aug. 1st, 2014. When are you born?"</span>

        <span class="nf">return </span><span class="p">(</span>
            <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span>
                <span class="p">.</span><span class="nf">speak</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">ask</span><span class="p">(</span><span class="n">reprompt_text</span><span class="p">)</span>
                <span class="p">.</span><span class="n">response</span>
        <span class="p">)</span>
</pre></table></code></div></div><h3 id="step-2-use-an-intent-and-slots-to-capture-information">Step 2: Use an intent and slots to capture information</h3><ol><li>Now make adjustments to the skill’s front end.<li>need to create an <code class="language-plaintext highlighter-rouge">intent</code> that will <code class="language-plaintext highlighter-rouge">interpret how the user responds to Alexa's question</code>.<ul><li>When you name an intent, think about what the intent is going to do.<li>In this case, the intent is going to capture the user’s birthday, so name it <code class="language-plaintext highlighter-rouge">CaptureBirthdayIntent</code>.<li>Notice the words are not separated by spaces, and each new word begins with an uppercase letter.<li><strong>intent</strong>: an action to fulfill a user’s request.<li><strong>utterance</strong>: is what invokes the intent.<li>In response to the birthday question, a user might say - “I was born on November seventh, nineteen eighty three.”<li>You will add this utterance to the CaptureBirthdayIntent by typing it in exactly the way the user is expected to say it.</ul><li>In the <strong>Sample Utterances</strong> field<ul><li><code class="language-plaintext highlighter-rouge">I was born on November seventh nineteen eighty three</code><li>press ENTER or click the + icon<li>When finished, the Cake Time skill will be able to capture any birthday.</ul><li>In the dialog box, click the field under Create a new slot, type the name of the slot without curly brackets (for example, month), and click Add.<ul><li>From this utterance<ul><li>there are three key pieces of information to collect: month, day, and year. <code class="language-plaintext highlighter-rouge">slots</code><li>need to let Alexa know which words are slots and what kind of slots they are.<ul><li>Start with the month slot.<li>replace the word representing the month (November) with the word month in curly brackets <code class="language-plaintext highlighter-rouge">{ }</code>.<li>This creates a slot called month.<li>The utterance will then look like this: I was born on {month} seventh nineteen eighty three</ul><li>2 ways to create a slot.<ul><li>1.<ul><li>select the word in the sample utterance where the slot should go,<li>type the name of the slot in curly brackets (for example, {month}).</ul><li>2.<ul><li>select the word in the sample utterance and use the Select an Existing Slot dialog box when it appears.</ul></ul></ul><li><code class="language-plaintext highlighter-rouge">I was born on {month} {day} {year}</code><li><code class="language-plaintext highlighter-rouge">{month} {day} {year}</code> if the user omits the words I was born on</ul></ol><p><img data-proofer-ignore data-src="https://i.imgur.com/sQzbfah.png" alt="Screen Shot 2020-07-16 at 14.28.15" /></p><ol><li>Now define exactly what those slots are by assigning a <code class="language-plaintext highlighter-rouge">slot type</code> to each <code class="language-plaintext highlighter-rouge">slot</code>: <code class="language-plaintext highlighter-rouge">Intent Slots</code><ul><li>Slots are assigned from the <code class="language-plaintext highlighter-rouge">Slot Type</code><li>2 types of slot types: <code class="language-plaintext highlighter-rouge">custom</code> and <code class="language-plaintext highlighter-rouge">built-in</code>.<li>Wherever possible, use built-in slots. Alexa manages the definitions of built-in slots.<li>If an applicable built-in slot does not exist, create a custom slot and define the values it represents.</ul></ol><p><img data-proofer-ignore data-src="https://i.imgur.com/QRofGSq.png" alt="Screen Shot 2020-07-16 at 14.31.49" /></p><ol><li>Save Model.</ol><h3 id="step-3-use-dialog-management">Step 3: Use dialog management</h3><p>Slots can be <code class="language-plaintext highlighter-rouge">required</code> or <code class="language-plaintext highlighter-rouge">optional</code>.</p><ul><li>if you need a given value from the user, you can designate a slot as <code class="language-plaintext highlighter-rouge">required</code> using dialog management.<ul><li>Marking a slot as required triggers Alexa to actively work to fill it. Start by making each of the slots required.</ul></ul><ol><li>Click on “CaptureBirthdayIntent” on the left nav bar.<li>In the Intent Slots section, to the right of the month slot, click <code class="language-plaintext highlighter-rouge">Edit Dialog</code>.<li>Under Slot Filling, toggle to make the slot required: mark <code class="language-plaintext highlighter-rouge">Is this slot required to fulfill the intent?</code><li>The <strong>Alexa speech prompts</strong> field:<ul><li>enter text for Alexa to say if the user fails to provide a value for the month slot.<li><code class="language-plaintext highlighter-rouge">What month were you born in?</code></ul><li>Repeat the process for the <code class="language-plaintext highlighter-rouge">day</code> and <code class="language-plaintext highlighter-rouge">year</code> slots.<ul><li>if a user responds, “July nineteen eighty two,”<ul><li>Alexa recognizes that the month and year slots are filled, but the day slot is not.<li>Alexa will prompt the user for each unfilled slot. In this example, Alexa would ask, “What day were you born?”</ul><li>One of the great things about <code class="language-plaintext highlighter-rouge">dialog management</code><ul><li>the skill doesn’t break or get confused if the user leaves out a piece of information or provides it out of the expected order.<li>Instead, Alexa takes on the responsibility of collecting information designated as required to ensure a useful experience.<li>You have built an <code class="language-plaintext highlighter-rouge">intent</code> that listens for the user’s answer to the birthday question.<li>When the user responds, Alexa collects the user’s birthday month, day, and year.<li>This information will be sent to the skill’s <strong>backend code</strong> in a <code class="language-plaintext highlighter-rouge">JSON request</code>.</ul></ul><li><p>Delete the <code class="language-plaintext highlighter-rouge">HelloWorldIntent</code> intent</p><li>other intents (such as AMAZON.HelpIntent) were automatically added to your skill.<ul><li>These are required for every skill and provide the user a means to cancel, stop, and get help.<li>Do not remove these.</ul><li><p>Save Model.</p><li>Build Model.</ol><h3 id="step-4-define-a-new-handler">Step 4: Define a new handler</h3><ol><li>To make the Cake Time skill respond, you need to update the backend.<li>Code tab.<li>change <code class="language-plaintext highlighter-rouge">HelloWorldIntent</code> to <code class="language-plaintext highlighter-rouge">CaptureBirthdayIntent</code><li><code class="language-plaintext highlighter-rouge">canHandle() function</code> will be invoked when a <code class="language-plaintext highlighter-rouge">CaptureBirthdayIntent</code> request comes through.<li>creating three variables in the handler to save the slots the skill is collecting.<li>update the speak_output: <code class="language-plaintext highlighter-rouge">'Thanks, I will remember that you were born {month} {day} {year}.'.format(month=month, day=day, year=year)</code></ol><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">CaptureBirthdayIntentHandler</span><span class="p">(</span><span class="n">AbstractRequestHandler</span><span class="p">):</span>
    <span class="s">"""Handler for Hello World Intent."""</span>
    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; bool
</span>        <span class="k">return</span> <span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_intent_name</span><span class="p">(</span><span class="s">"CaptureBirthdayIntent"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; Response
</span>        <span class="n">slots</span> <span class="o">=</span> <span class="n">handler_input</span><span class="p">.</span><span class="n">request_envelope</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">intent</span><span class="p">.</span><span class="n">slots</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">slots</span><span class="p">[</span><span class="s">"year"</span><span class="p">].</span><span class="n">value</span>
        <span class="n">month</span> <span class="o">=</span> <span class="n">slots</span><span class="p">[</span><span class="s">"month"</span><span class="p">].</span><span class="n">value</span>
        <span class="n">day</span> <span class="o">=</span> <span class="n">slots</span><span class="p">[</span><span class="s">"day"</span><span class="p">].</span><span class="n">value</span>

        <span class="n">speak_output</span> <span class="o">=</span> <span class="s">'Thanks, I will remember that you were born {month} {day} {year}.'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">)</span>

        <span class="nf">return </span><span class="p">(</span>
            <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span>
                <span class="p">.</span><span class="nf">speak</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>
                <span class="c1"># .ask("add a reprompt if you want to keep the session open for the user to respond")
</span>                <span class="p">.</span><span class="n">response</span>
        <span class="p">)</span>
</pre></table></code></div></div><ol><li>Scroll down in the code until you find the line that begins <code class="language-plaintext highlighter-rouge">sb = SkillBuilder()</code>.<ul><li>Replace the HelloWorld with CaptureBirthday</ul></ol><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">logging</span>
<span class="kn">import</span> <span class="n">ask_sdk_core.utils</span> <span class="k">as</span> <span class="n">ask_utils</span>

<span class="kn">from</span> <span class="n">ask_sdk_core.skill_builder</span> <span class="kn">import</span> <span class="n">SkillBuilder</span>
<span class="kn">from</span> <span class="n">ask_sdk_core.dispatch_components</span> <span class="kn">import</span> <span class="n">AbstractRequestHandler</span>
<span class="kn">from</span> <span class="n">ask_sdk_core.dispatch_components</span> <span class="kn">import</span> <span class="n">AbstractExceptionHandler</span>
<span class="kn">from</span> <span class="n">ask_sdk_core.handler_input</span> <span class="kn">import</span> <span class="n">HandlerInput</span>

<span class="kn">from</span> <span class="n">ask_sdk_model</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="p">.</span><span class="nf">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="c1"># ......
</span>
<span class="n">sb</span> <span class="o">=</span> <span class="nc">SkillBuilder</span><span class="p">()</span>

<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">LaunchRequestHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">CaptureBirthdayIntentHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">HelpIntentHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">CancelOrStopIntentHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">SessionEndedRequestHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">IntentReflectorHandler</span><span class="p">())</span> <span class="c1"># make sure IntentReflectorHandler is last so it doesn't override your custom intent handlers
</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_exception_handler</span><span class="p">(</span><span class="nc">CatchAllExceptionHandler</span><span class="p">())</span>

<span class="n">lambda_handler</span> <span class="o">=</span> <span class="n">sb</span><span class="p">.</span><span class="nf">lambda_handler</span><span class="p">()</span>
</pre></table></code></div></div><ol><li>Click Save.<li>Click Deploy. Because of the new handler, your skill will take a few moments to deploy.</ol><h3 id="step-5-test-your-skill-1">Step 5: Test your skill</h3><p>The Redvelvet Time Time skill should now be able to do the following:</p><ul><li>Ask the user for their birthday<li>Listen to the answer from the user and automatically follow up with questions if any required slots (month, day, year) are missing<li>Respond to the user by repeating their birthday Let’s test the skill.</ul><ol><li>Click the Test tab.<li>Test your skill by opening Cake Time and responding when Alexa asks for your birthday.</ol><h3 id="wrap-up">Wrap-up</h3><p><img data-proofer-ignore data-src="https://i.imgur.com/vsSyTwV.png" alt="Screen Shot 2020-07-16 at 16.40.25" /></p><hr /><h2 id="adding-memory-to-skill">Adding memory to skill</h2><p>enable the Cake Time skill to remember the user’s birthday.</p><h3 id="step-1-use-amazon-s3-to-save-and-read-data">Step 1: Use Amazon S3 to save and read data</h3><ul><li>you have the birthday, month, and year within the code.<ul><li>but the skill forgets these values when the code finishes running.<li>save the values to Amazon S3<li>so the skill can read them from session to session.</ul><li>The SDK provides mechanism for saving information across sessions: the <code class="language-plaintext highlighter-rouge">AttributesManager</code><ul><li><p>Withhe manager, your read/write code can remain the same, even if you change where you save your data later.</p><li>The <code class="language-plaintext highlighter-rouge">backend code</code> for Alexa skills can live on any <code class="language-plaintext highlighter-rouge">HTTPS server</code>.<li>Most of the time, Alexa developers write and host their backend code using AWS.<ul><li>writing code in the developer console using an <strong>Alexa-hosted skill</strong>.<ul><li>That code is running on the AWS Free Tier, which has limitations.<li>great for learning and publish simple skills.<li>When using an Alexa-hosted skill for backend code, it will be stored in <code class="language-plaintext highlighter-rouge">Amazon S3</code>.</ul><li>if skill becomes popular, consider your own AWS <strong>resources</strong>.<ul><li>If build code on your own AWS resources, it may use <code class="language-plaintext highlighter-rouge">Amazon DynamoDB</code>.<li>it will only require minor changes to work with DynamoDB if you decide to migrate to your own AWS resources later</ul></ul></ul></ul><ol><li>use <code class="language-plaintext highlighter-rouge">AttributesManager</code> to save the user’s birthday in Cake Time.<ul><li>Code tab.<li>requirements.txt file<li>add a requirement. import the dependency for the S3 adapter.<ul><li><code class="language-plaintext highlighter-rouge">ask-sdk-s3-persistence-adapter</code></ul><li>Click Save.</ul><li>lambda_function.py tab<ul><li><p>The new dependency allows to use the <code class="language-plaintext highlighter-rouge">AttributesManager</code> to save and read user data using <code class="language-plaintext highlighter-rouge">Amazon S3</code>.</p><li><p>import that dependency to the code.</p><ul><li>find the line begins <code class="language-plaintext highlighter-rouge">import ask_sdk_core.utils as ask_utils</code>.<li>Create a new line just below it, and copy and paste in the following code:</ul></ul></ol><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">os</span>
<span class="kn">from</span> <span class="n">ask_sdk_s3.adapter</span> <span class="kn">import</span> <span class="n">S3Adapter</span>
<span class="n">s3_adapter</span> <span class="o">=</span> <span class="nc">S3Adapter</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="s">"S3_PERSISTENCE_BUCKET"</span><span class="p">])</span>
</pre></table></code></div></div><ul><li>find the line that begins <code class="language-plaintext highlighter-rouge">from ask_sdk_core.skill_builder import SkillBuilder</code>.<ul><li>Replace this line with the following code:<li><code class="language-plaintext highlighter-rouge">from ask_sdk_core.skill_builder import CustomSkillBuilder</code><ul><li>This will import the <code class="language-plaintext highlighter-rouge">S3 Persistence adapter</code>,<li>create your S3 adapter and set you up with a bucket on S3 to store your data.<li>Once done, this section of code should look like:</ul></ul><li>find the line that begins <code class="language-plaintext highlighter-rouge">sb = SkillBuilder()</code>.<ul><li>Replace this line with the following code:<li><code class="language-plaintext highlighter-rouge">sb = CustomSkillBuilder(persistence_adapter=s3_adapter)</code></ul></ul><ol><li>Click Save.</ol><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">logging</span>
<span class="kn">import</span> <span class="n">ask_sdk_core.utils</span> <span class="k">as</span> <span class="n">ask_utils</span>


<span class="kn">import</span> <span class="n">os</span>
<span class="kn">from</span> <span class="n">ask_sdk_s3.adapter</span> <span class="kn">import</span> <span class="n">S3Adapter</span>
<span class="n">s3_adapter</span> <span class="o">=</span> <span class="nc">S3Adapter</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="s">"S3_PERSISTENCE_BUCKET"</span><span class="p">])</span>

<span class="kn">from</span> <span class="n">ask_sdk_core.skill_builder</span> <span class="kn">import</span> <span class="n">CustomSkillBuilder</span>
<span class="kn">from</span> <span class="n">ask_sdk_core.dispatch_components</span> <span class="kn">import</span> <span class="n">AbstractRequestHandler</span>
<span class="kn">from</span> <span class="n">ask_sdk_core.dispatch_components</span> <span class="kn">import</span> <span class="n">AbstractExceptionHandler</span>
<span class="kn">from</span> <span class="n">ask_sdk_core.handler_input</span> <span class="kn">import</span> <span class="n">HandlerInput</span>

<span class="kn">from</span> <span class="n">ask_sdk_model</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="p">.</span><span class="nf">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="c1">#.....
</span>
<span class="n">sb</span> <span class="o">=</span> <span class="nc">CustomSkillBuilder</span><span class="p">(</span><span class="n">persistence_adapter</span><span class="o">=</span><span class="n">s3_adapter</span><span class="p">)</span>
</pre></table></code></div></div><p>You are now set up to use <code class="language-plaintext highlighter-rouge">AttributesManager</code> to save and read data to Amazon S3.</p><p>Later, if you decide to move your skill’s backend code to your own AWS resources, you will reverse the changes made in this step.</p><h3 id="step-2-save-data">Step 2: Save Data</h3><ol><li><p>Now modify the code to save the user’s birthday.</p><li>lambda_function.py file,<ul><li>find the <code class="language-plaintext highlighter-rouge">CaptureBirthdayIntentHandler</code>. use the <code class="language-plaintext highlighter-rouge">AttributesManager</code> to save the user’s birthday.<ul><li>create a new line <code class="language-plaintext highlighter-rouge">attributes_manager = handler_input.attributes_manager</code><li>The Cake Time skill code receives the year, month, and day.<li>You need to tell Amazon S3 to save these values.<li>The code tells the AttributesManager what the data is, and the manager sends it to Amazon S3.</ul></ul><li>Within the <code class="language-plaintext highlighter-rouge">CaptureBirthdayIntentHandler</code><ul><li>mapping <code class="language-plaintext highlighter-rouge">the variables already declared in the code</code> to corresponding<code class="language-plaintext highlighter-rouge"> variables that will be created in Amazon S3</code> when the code runs.<li><code class="language-plaintext highlighter-rouge">birthday_attributes = { }</code></ul><li><code class="language-plaintext highlighter-rouge">attributes_manager.persistent_attributes = birthday_attributes</code><ul><li>These variables are now declared as persistent (they are local to the function in which they are declared, yet their values are retained in memory between calls to the function).<li>Now you save the user’s data to them.<li>First, use the AttributesManager to set the data to save to Amazon S3.</ul><li><p><code class="language-plaintext highlighter-rouge">attributes_manager.save_persistent_attributes()</code></p><li><p>Click Save.</p><li><code class="language-plaintext highlighter-rouge">CaptureBirthdayIntentHandler</code> should now look like:</ol><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">CaptureBirthdayIntentHandler</span><span class="p">(</span><span class="n">AbstractRequestHandler</span><span class="p">):</span>
    <span class="s">"""Handler for Hello World Intent."""</span>
    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; bool
</span>        <span class="k">return</span> <span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_intent_name</span><span class="p">(</span><span class="s">"CaptureBirthdayIntent"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; Response
</span>        <span class="n">slots</span> <span class="o">=</span> <span class="n">handler_input</span><span class="p">.</span><span class="n">request_envelope</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">intent</span><span class="p">.</span><span class="n">slots</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">slots</span><span class="p">[</span><span class="s">"year"</span><span class="p">].</span><span class="n">value</span>
        <span class="n">month</span> <span class="o">=</span> <span class="n">slots</span><span class="p">[</span><span class="s">"month"</span><span class="p">].</span><span class="n">value</span>
        <span class="n">day</span> <span class="o">=</span> <span class="n">slots</span><span class="p">[</span><span class="s">"day"</span><span class="p">].</span><span class="n">value</span>

        <span class="n">attributes_manager</span> <span class="o">=</span> <span class="n">handler_input</span><span class="p">.</span><span class="n">attributes_manager</span>

        <span class="n">birthday_attributes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"year"</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span>
            <span class="s">"month"</span><span class="p">:</span> <span class="n">month</span><span class="p">,</span>
            <span class="s">"day"</span><span class="p">:</span> <span class="n">day</span>
        <span class="p">}</span>

        <span class="n">attributes_manager</span><span class="p">.</span><span class="n">persistent_attributes</span> <span class="o">=</span> <span class="n">birthday_attributes</span>
        <span class="n">attributes_manager</span><span class="p">.</span><span class="nf">save_persistent_attributes</span><span class="p">()</span>

        <span class="n">speak_output</span> <span class="o">=</span> <span class="s">'Thanks, I will remember that you were born {month} {day} {year}.’.format(month=month, day=day, year=year)

        return (
            handler_input.response_builder
                .speak(speak_output)
                # .ask("add a reprompt if you want to keep the session open for the user to respond")
                .response
        )
</span></pre></table></code></div></div><h3 id="step-3-read-stored-data">Step 3: Read stored data</h3><ul><li>now the user’s birthday is saved to Amazon S3.<li>However, now the <code class="language-plaintext highlighter-rouge">skill needs to be updated</code><ul><li>so the next time the user opens Cake Time, the skill knows the user’s birthday information is stored and doesn’t have to ask for it.</ul><li>To do this,<li><code class="language-plaintext highlighter-rouge">modify the code to read the data stored in Amazon S3</code> before asking the user for their birthday.<ul><li>If the data exists, the skill doesn’t need to ask for it.<li>If the data isn’t there, it will ask for the information.</ul><li>An <code class="language-plaintext highlighter-rouge">Amazon S3 bucket</code> is a public cloud storage resource.<ul><li>A bucket is similar to a file folder for storing objects, consists of data and descriptive metadata.</ul><li>A <code class="language-plaintext highlighter-rouge">new handler</code> is needed to read the stored data.<ul><li>The canHandle() and handle() functions in the new handler will communicate with Amazon S3.<li>You will add it between the <code class="language-plaintext highlighter-rouge">LaunchRequestHandler</code> and the <code class="language-plaintext highlighter-rouge">CaptureBirthdayIntentHandler</code>.</ul></ul><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">HasBirthdayLaunchRequestHandler</span><span class="p">(</span><span class="n">AbstractRequestHandler</span><span class="p">):</span>
    <span class="s">"""Handler for launch after they have set their birthday"""</span>

    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># extract persistent attributes and check if they are all present
</span>        <span class="n">attr</span> <span class="o">=</span> <span class="n">handler_input</span><span class="p">.</span><span class="n">attributes_manager</span><span class="p">.</span><span class="n">persistent_attributes</span>
        <span class="n">attributes_are_present</span> <span class="o">=</span> <span class="p">(</span><span class="s">"year"</span> <span class="ow">in</span> <span class="n">attr</span> <span class="ow">and</span> <span class="s">"month"</span> <span class="ow">in</span> <span class="n">attr</span> <span class="ow">and</span> <span class="s">"day"</span> <span class="ow">in</span> <span class="n">attr</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">attributes_are_present</span> <span class="ow">and</span> <span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_request_type</span><span class="p">(</span><span class="s">"LaunchRequest"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">handler_input</span><span class="p">.</span><span class="n">attributes_manager</span><span class="p">.</span><span class="n">persistent_attributes</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="s">'year'</span><span class="p">]</span>
        <span class="n">month</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="s">'month'</span><span class="p">]</span> <span class="c1"># month is a string, and we need to convert it to a month index later
</span>        <span class="n">day</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="s">'day'</span><span class="p">]</span>

        <span class="c1"># TODO:: Use the settings API to get current date and then compute how many days until user’s bday
</span>        <span class="c1"># TODO:: Say happy birthday on the user’s birthday
</span>
        <span class="n">speak_output</span> <span class="o">=</span> <span class="s">"Welcome back it looks like there are X more days until your y-th birthday."</span>

        <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span><span class="p">.</span><span class="nf">speak</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span><span class="p">.</span><span class="n">response</span>
</pre></table></code></div></div><ol><li>Find the line that begins CaptureBirthdayIntentHandler. Create new code.<ul><li>The new handler has the canHandle() and handle() functions.<li>The canHandle() function checks if the user’s birthday information is saved in Amazon S3.<ul><li>If it is, the handler lets the SDK know it can do the work (it has the user’s birthday information and can do what comes next).<ul><li>The handle() function tells Alexa to say, “Welcome back. It looks like there are x more days until your y-th birthday.”</ul></ul></ul><li><p>When changed the name of a handler in a previous section, also had to change the name in the list of handlers at the bottom of the code.</p><li>added a new handler, you must add the new handler to this list.<ul><li>Toward the bottom of the code, find the line that begins with sb.add_request_handler(LaunchRequestHandler()), Create a new line just above it.<li><code class="language-plaintext highlighter-rouge">sb.add_request_handler(HasBirthdayLaunchRequestHandler())</code></ul><li><p>Click Save.</p><li>Click Deploy.</ol><p>That section of code:</p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">HasBirthdayLaunchRequestHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">LaunchRequestHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">CaptureBirthdayIntentHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">HelpIntentHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">CancelOrStopIntentHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">SessionEndedRequestHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">IntentReflectorHandler</span><span class="p">())</span> <span class="c1"># make sure IntentReflectorHandler is last so it doesn’t override your custom intent handlers
</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_exception_handler</span><span class="p">(</span><span class="nc">CatchAllExceptionHandler</span><span class="p">())</span>

<span class="n">lambda_handler</span> <span class="o">=</span> <span class="n">sb</span><span class="p">.</span><span class="nf">lambda_handler</span><span class="p">()</span>
</pre></table></code></div></div><h3 id="how-to-delete-or-reset-the-users-birthday">How to delete or reset the user’s birthday</h3><ul><li>When testing, you may need to delete or reset the user’s birthday. There are two ways to do this.<ol><li><strong>Test tab</strong>, Type or say, “Alexa, tell Cake Time I was born on {month} {day} {year}.”<li>delete the saved information from Amazon S3:<ul><li><strong>Code tab</strong><li>click <strong>Media storage</strong> on the bottom left-hand corner of the screen.<li>The S3 Management Console opens.<li>Click the breadcrumb that starts <code class="language-plaintext highlighter-rouge">amzn-1-ask-skill</code>.<li>Click on the check box next to the file(s) that begins with <code class="language-plaintext highlighter-rouge">amzn1.ask.account</code>.<li>Delete.<li>The user’s birthday is deleted.</ul></ol></ul><h3 id="test-so-click-the-test-tab-then-follow-the-steps-below">test, so click the Test tab, then follow the steps below.</h3><ol><li>Launch the skill first time<ul><li>Say “open redvelvet time”<li>Alexa should respond, “Hello! This is Cake Time. When is your birthday?”<li>Tell Alexa your birthday<li>Once the skill has your birth month, day, and year, it should respond, “Thanks, I’ll remember that your birthday is {month} {day} {year}.”<li>The session ends. At this point, without the code you added in this section, the next time you invoke the skill, the skill would ask for your birthday again. Now, the skill stores this information.</ul><li>Launch the skill a second time<ul><li>Say “open redvelvet time”<li>Alexa should respond, “Welcome back. It looks like there are X more days until your y-th birthday.”<li>You probably noticed that, with the way the code works right now, Alexa is saying “X” and “Y T H”. Don’t worry. In the next section, you will work on the code to calculate how many days until the user’s next birthday so Alexa can respond with that information.</ul></ol><h2 id="using-the-alexa-settings-api">Using the Alexa Settings API</h2><ul><li>enable the Cake Time skill to calculate the number of days until the user’s next birthday.<ul><li>To calculate the number of days until the user’s next birthday accurately, we need additional information, like current date, and user’s time zone.<li>can use the Alexa Settings API to get this information.<li>To do that, need to pass the following information to the Alexa Settings API:<ul><li>Device ID<li>URL for the Alexa Settings API (API Endpoint)<li>Authorization token (Access Token)<li>Import supporting libraries (We will do this in Step 3)</ul></ul></ul><h3 id="step-1-get-device-id-api-endpoint-and-authorization-token-for-alexa-settings-api">Step 1: Get Device ID, API endpoint, and Authorization Token for Alexa Settings API</h3><h3 id="step-2-using-the-alexa-settings-api-to-retrieve-the-user-time-zone">Step 2: Using the Alexa Settings API to retrieve the user time zone</h3><p>requirements.txt:</p><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">boto3</span><span class="o">==</span><span class="mf">1.9</span><span class="p">.</span><span class="mi">216</span>
<span class="n">ask</span><span class="o">-</span><span class="n">sdk</span><span class="o">-</span><span class="n">core</span><span class="o">==</span><span class="mf">1.11</span><span class="p">.</span><span class="mi">0</span>
<span class="n">ask</span><span class="o">-</span><span class="n">sdk</span><span class="o">-</span><span class="n">s3</span><span class="o">-</span><span class="n">persistence</span><span class="o">-</span><span class="n">adapter</span>
<span class="n">pytz</span>
<span class="c1"># The pytz library allows accurate and cross platform timezone calculations, and will help us figure out the user's timezone accurately.
</span></pre></table></code></div></div><div class="language-py highlighter-rouge"><div class="code-header" text-data="py"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
</pre><td class="rouge-code"><pre><span class="c1"># -*- coding: utf-8 -*-
</span>
<span class="c1"># This sample demonstrates handling intents from an Alexa skill using the Alexa Skills Kit SDK for Python.
# Please visit https://alexa.design/cookbook for additional examples on implementing slots, dialog management,
# session persistence, api calls, and more.
# This sample is built using the handler classes approach in skill builder.
</span><span class="kn">import</span> <span class="n">logging</span>
<span class="kn">import</span> <span class="n">ask_sdk_core.utils</span> <span class="k">as</span> <span class="n">ask_utils</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">calendar</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="n">pytz</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="n">ask_sdk_s3.adapter</span> <span class="kn">import</span> <span class="n">S3Adapter</span>
<span class="n">s3_adapter</span> <span class="o">=</span> <span class="nc">S3Adapter</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="s">"S3_PERSISTENCE_BUCKET"</span><span class="p">])</span>

<span class="kn">from</span> <span class="n">ask_sdk_core.skill_builder</span> <span class="kn">import</span> <span class="n">CustomSkillBuilder</span>
<span class="kn">from</span> <span class="n">ask_sdk_core.dispatch_components</span> <span class="kn">import</span> <span class="n">AbstractRequestHandler</span>
<span class="kn">from</span> <span class="n">ask_sdk_core.dispatch_components</span> <span class="kn">import</span> <span class="n">AbstractExceptionHandler</span>
<span class="kn">from</span> <span class="n">ask_sdk_core.handler_input</span> <span class="kn">import</span> <span class="n">HandlerInput</span>

<span class="kn">from</span> <span class="n">ask_sdk_model</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="p">.</span><span class="nf">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">LaunchRequestHandler</span><span class="p">(</span><span class="n">AbstractRequestHandler</span><span class="p">):</span>
    <span class="s">"""Handler for Skill Launch."""</span>
    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; bool
</span>
        <span class="k">return</span> <span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_request_type</span><span class="p">(</span><span class="s">"LaunchRequest"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; Response
</span>        <span class="n">speak_output</span> <span class="o">=</span> <span class="s">"Hello! This is Cake Time. What is your birthday?"</span>
        <span class="n">reprompt_text</span> <span class="o">=</span> <span class="s">"I was born Nov. 6th, 2015. When are you born?"</span>

        <span class="nf">return </span><span class="p">(</span>
            <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span>
                <span class="p">.</span><span class="nf">speak</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">ask</span><span class="p">(</span><span class="n">reprompt_text</span><span class="p">)</span>
                <span class="p">.</span><span class="n">response</span>
        <span class="p">)</span>

<span class="k">class</span> <span class="nc">HasBirthdayLaunchRequestHandler</span><span class="p">(</span><span class="n">AbstractRequestHandler</span><span class="p">):</span>
    <span class="s">"""Handler for launch after they have set their birthday"""</span>

    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># extract persistent attributes and check if they are all present
</span>        <span class="n">attr</span> <span class="o">=</span> <span class="n">handler_input</span><span class="p">.</span><span class="n">attributes_manager</span><span class="p">.</span><span class="n">persistent_attributes</span>
        <span class="n">attributes_are_present</span> <span class="o">=</span> <span class="p">(</span><span class="s">"year"</span> <span class="ow">in</span> <span class="n">attr</span> <span class="ow">and</span> <span class="s">"month"</span> <span class="ow">in</span> <span class="n">attr</span> <span class="ow">and</span> <span class="s">"day"</span> <span class="ow">in</span> <span class="n">attr</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">attributes_are_present</span> <span class="ow">and</span> <span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_request_type</span><span class="p">(</span><span class="s">"LaunchRequest"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">handler_input</span><span class="p">.</span><span class="n">attributes_manager</span><span class="p">.</span><span class="n">persistent_attributes</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s">'year'</span><span class="p">])</span>
        <span class="n">month</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="s">'month'</span><span class="p">]</span> <span class="c1"># month is a string, and we need to convert it to a month index later
</span>        <span class="n">day</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s">'day'</span><span class="p">])</span>

        <span class="c1"># get device id
</span>        <span class="n">sys_object</span> <span class="o">=</span> <span class="n">handler_input</span><span class="p">.</span><span class="n">request_envelope</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">system</span>
        <span class="n">device_id</span> <span class="o">=</span> <span class="n">sys_object</span><span class="p">.</span><span class="n">device</span><span class="p">.</span><span class="n">device_id</span>

        <span class="c1"># get Alexa Settings API information
</span>        <span class="n">api_endpoint</span> <span class="o">=</span> <span class="n">sys_object</span><span class="p">.</span><span class="n">api_endpoint</span>
        <span class="n">api_access_token</span> <span class="o">=</span> <span class="n">sys_object</span><span class="p">.</span><span class="n">api_access_token</span>

        <span class="c1"># construct systems api timezone url
</span>        <span class="n">url</span> <span class="o">=</span> <span class="s">'{api_endpoint}/v2/devices/{device_id}/settings/System.timeZone'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">api_endpoint</span><span class="o">=</span><span class="n">api_endpoint</span><span class="p">,</span> <span class="n">device_id</span><span class="o">=</span><span class="n">device_id</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Authorization'</span><span class="p">:</span> <span class="s">'Bearer '</span> <span class="o">+</span> <span class="n">api_access_token</span><span class="p">}</span>

        <span class="n">userTimeZone</span> <span class="o">=</span> <span class="s">""</span>
        <span class="k">try</span><span class="p">:</span>
	        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
	        <span class="n">res</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
	        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="s">"Device API result: {}"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">res</span><span class="p">)))</span>
	        <span class="n">userTimeZone</span> <span class="o">=</span> <span class="n">res</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
	        <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span><span class="p">.</span><span class="nf">speak</span><span class="p">(</span><span class="s">"There was a problem connecting to the service"</span><span class="p">)</span>
	        <span class="k">return</span> <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span><span class="p">.</span><span class="n">response</span>

        <span class="c1"># getting the current date with the time
</span>        <span class="n">now_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">(</span><span class="nf">timezone</span><span class="p">(</span><span class="n">userTimeZone</span><span class="p">))</span>

        <span class="c1"># Removing the time from the date because it affects our difference calculation
</span>        <span class="n">now_date</span> <span class="o">=</span> <span class="nf">datetime</span><span class="p">(</span><span class="n">now_time</span><span class="p">.</span><span class="n">year</span><span class="p">,</span> <span class="n">now_time</span><span class="p">.</span><span class="n">month</span><span class="p">,</span> <span class="n">now_time</span><span class="p">.</span><span class="n">day</span><span class="p">)</span>
        <span class="n">current_year</span> <span class="o">=</span> <span class="n">now_time</span><span class="p">.</span><span class="n">year</span>

        <span class="c1"># getting the next birthday
</span>        <span class="n">month_as_index</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">calendar</span><span class="p">.</span><span class="n">month_abbr</span><span class="p">).</span><span class="nf">index</span><span class="p">(</span><span class="n">month</span><span class="p">[:</span><span class="mi">3</span><span class="p">].</span><span class="nf">title</span><span class="p">())</span>
        <span class="n">next_birthday</span> <span class="o">=</span> <span class="nf">datetime</span><span class="p">(</span><span class="n">current_year</span><span class="p">,</span> <span class="n">month_as_index</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span>

        <span class="c1"># check if we need to adjust bday by one year
</span>        <span class="k">if</span> <span class="n">now_date</span> <span class="o">&gt;</span> <span class="n">next_birthday</span><span class="p">:</span>
            <span class="n">next_birthday</span> <span class="o">=</span> <span class="nf">datetime</span><span class="p">(</span>
                <span class="n">current_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">month_as_index</span><span class="p">,</span>
                <span class="n">day</span>
            <span class="p">)</span>
            <span class="n">current_year</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># setting the default speak_output to Happy xth Birthday!!
</span>        <span class="c1"># alexa will automatically correct the ordinal for you.
</span>        <span class="c1"># no need to worry about when to use st, th, rd
</span>        <span class="n">speak_output</span> <span class="o">=</span> <span class="s">"Happy {}th birthday!"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">current_year</span> <span class="o">-</span> <span class="n">year</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">now_date</span> <span class="o">!=</span> <span class="n">next_birthday</span><span class="p">:</span>
            <span class="n">diff_days</span> <span class="o">=</span> <span class="nf">abs</span><span class="p">((</span><span class="n">now_date</span> <span class="o">-</span> <span class="n">next_birthday</span><span class="p">).</span><span class="n">days</span><span class="p">)</span>
            <span class="n">speak_output</span> <span class="o">=</span> <span class="s">"Welcome back. It looks like there are </span><span class="se">\
</span><span class="s">                            {days} days until your {birthday_num}th</span><span class="se">\
</span><span class="s">                            birthday"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span>
                                <span class="n">days</span><span class="o">=</span><span class="n">diff_days</span><span class="p">,</span>
                                <span class="n">birthday_num</span><span class="o">=</span><span class="p">(</span><span class="n">current_year</span><span class="o">-</span><span class="n">year</span><span class="p">)</span>
                            <span class="p">)</span>

        <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span><span class="p">.</span><span class="nf">speak</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span><span class="p">.</span><span class="n">response</span>

<span class="k">class</span> <span class="nc">CaptureBirthdayIntentHandler</span><span class="p">(</span><span class="n">AbstractRequestHandler</span><span class="p">):</span>
    <span class="s">"""Handler for Hello World Intent."""</span>
    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; bool
</span>        <span class="k">return</span> <span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_intent_name</span><span class="p">(</span><span class="s">"CaptureBirthdayIntent"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; Response
</span>        <span class="n">slots</span> <span class="o">=</span> <span class="n">handler_input</span><span class="p">.</span><span class="n">request_envelope</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">intent</span><span class="p">.</span><span class="n">slots</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">slots</span><span class="p">[</span><span class="s">"year"</span><span class="p">].</span><span class="n">value</span>
        <span class="n">month</span> <span class="o">=</span> <span class="n">slots</span><span class="p">[</span><span class="s">"month"</span><span class="p">].</span><span class="n">value</span>
        <span class="n">day</span> <span class="o">=</span> <span class="n">slots</span><span class="p">[</span><span class="s">"day"</span><span class="p">].</span><span class="n">value</span>

        <span class="n">attributes_manager</span> <span class="o">=</span> <span class="n">handler_input</span><span class="p">.</span><span class="n">attributes_manager</span>

        <span class="n">birthday_attributes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"year"</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span>
            <span class="s">"month"</span><span class="p">:</span> <span class="n">month</span><span class="p">,</span>
            <span class="s">"day"</span><span class="p">:</span> <span class="n">day</span>
        <span class="p">}</span>

        <span class="n">attributes_manager</span><span class="p">.</span><span class="n">persistent_attributes</span> <span class="o">=</span> <span class="n">birthday_attributes</span>
        <span class="n">attributes_manager</span><span class="p">.</span><span class="nf">save_persistent_attributes</span><span class="p">()</span>

        <span class="n">speak_output</span> <span class="o">=</span> <span class="s">'Thanks, I will remember that you were born {month} {day} {year}.'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">)</span>

        <span class="nf">return </span><span class="p">(</span>
            <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span>
                <span class="p">.</span><span class="nf">speak</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>
                <span class="c1"># .ask("add a reprompt if you want to keep the session open for the user to respond")
</span>                <span class="p">.</span><span class="n">response</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">HelpIntentHandler</span><span class="p">(</span><span class="n">AbstractRequestHandler</span><span class="p">):</span>
    <span class="s">"""Handler for Help Intent."""</span>
    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; bool
</span>        <span class="k">return</span> <span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_intent_name</span><span class="p">(</span><span class="s">"AMAZON.HelpIntent"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; Response
</span>        <span class="n">speak_output</span> <span class="o">=</span> <span class="s">"You can say hello to me! How can I help?"</span>

        <span class="nf">return </span><span class="p">(</span>
            <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span>
                <span class="p">.</span><span class="nf">speak</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">ask</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>
                <span class="p">.</span><span class="n">response</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">CancelOrStopIntentHandler</span><span class="p">(</span><span class="n">AbstractRequestHandler</span><span class="p">):</span>
    <span class="s">"""Single handler for Cancel and Stop Intent."""</span>
    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; bool
</span>        <span class="nf">return </span><span class="p">(</span><span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_intent_name</span><span class="p">(</span><span class="s">"AMAZON.CancelIntent"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">)</span> <span class="ow">or</span>
                <span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_intent_name</span><span class="p">(</span><span class="s">"AMAZON.StopIntent"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; Response
</span>        <span class="n">speak_output</span> <span class="o">=</span> <span class="s">"Goodbye!"</span>

        <span class="nf">return </span><span class="p">(</span>
            <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span>
                <span class="p">.</span><span class="nf">speak</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>
                <span class="p">.</span><span class="n">response</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">SessionEndedRequestHandler</span><span class="p">(</span><span class="n">AbstractRequestHandler</span><span class="p">):</span>
    <span class="s">"""Handler for Session End."""</span>
    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; bool
</span>        <span class="k">return</span> <span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_request_type</span><span class="p">(</span><span class="s">"SessionEndedRequest"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; Response
</span>
        <span class="c1"># Any cleanup logic goes here.
</span>
        <span class="k">return</span> <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span><span class="p">.</span><span class="n">response</span>


<span class="k">class</span> <span class="nc">IntentReflectorHandler</span><span class="p">(</span><span class="n">AbstractRequestHandler</span><span class="p">):</span>
    <span class="s">"""The intent reflector is used for interaction model testing and debugging.
    It will simply repeat the intent the user said. You can create custom handlers
    for your intents by defining them above, then also adding them to the request
    handler chain below.
    """</span>
    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; bool
</span>        <span class="k">return</span> <span class="n">ask_utils</span><span class="p">.</span><span class="nf">is_request_type</span><span class="p">(</span><span class="s">"IntentRequest"</span><span class="p">)(</span><span class="n">handler_input</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput) -&gt; Response
</span>        <span class="n">intent_name</span> <span class="o">=</span> <span class="n">ask_utils</span><span class="p">.</span><span class="nf">get_intent_name</span><span class="p">(</span><span class="n">handler_input</span><span class="p">)</span>
        <span class="n">speak_output</span> <span class="o">=</span> <span class="s">"You just triggered "</span> <span class="o">+</span> <span class="n">intent_name</span> <span class="o">+</span> <span class="s">"."</span>

        <span class="nf">return </span><span class="p">(</span>
            <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span>
                <span class="p">.</span><span class="nf">speak</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>
                <span class="c1"># .ask("add a reprompt if you want to keep the session open for the user to respond")
</span>                <span class="p">.</span><span class="n">response</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">CatchAllExceptionHandler</span><span class="p">(</span><span class="n">AbstractExceptionHandler</span><span class="p">):</span>
    <span class="s">"""Generic error handling to capture any syntax or routing errors. If you receive an error
    stating the request handler chain is not found, you have not implemented a handler for
    the intent being invoked or included it in the skill builder below.
    """</span>
    <span class="k">def</span> <span class="nf">can_handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput, Exception) -&gt; bool
</span>        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">handler_input</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
        <span class="c1"># type: (HandlerInput, Exception) -&gt; Response
</span>        <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">speak_output</span> <span class="o">=</span> <span class="s">"Sorry, I had trouble doing what you asked. Please try again."</span>

        <span class="nf">return </span><span class="p">(</span>
            <span class="n">handler_input</span><span class="p">.</span><span class="n">response_builder</span>
                <span class="p">.</span><span class="nf">speak</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">ask</span><span class="p">(</span><span class="n">speak_output</span><span class="p">)</span>
                <span class="p">.</span><span class="n">response</span>
        <span class="p">)</span>

<span class="c1"># The SkillBuilder object acts as the entry point for your skill, routing all request and response
# payloads to the handlers above. Make sure any new handlers or interceptors you've
# defined are included below. The order matters - they're processed top to bottom.
</span>

<span class="n">sb</span> <span class="o">=</span> <span class="nc">CustomSkillBuilder</span><span class="p">(</span><span class="n">persistence_adapter</span><span class="o">=</span><span class="n">s3_adapter</span><span class="p">)</span>

<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">HasBirthdayLaunchRequestHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">LaunchRequestHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">CaptureBirthdayIntentHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">HelpIntentHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">CancelOrStopIntentHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">SessionEndedRequestHandler</span><span class="p">())</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_request_handler</span><span class="p">(</span><span class="nc">IntentReflectorHandler</span><span class="p">())</span> <span class="c1"># make sure IntentReflectorHandler is last so it doesn't override your custom intent handlers
</span>
<span class="n">sb</span><span class="p">.</span><span class="nf">add_exception_handler</span><span class="p">(</span><span class="nc">CatchAllExceptionHandler</span><span class="p">())</span>

<span class="n">lambda_handler</span> <span class="o">=</span> <span class="n">sb</span><span class="p">.</span><span class="nf">lambda_handler</span><span class="p">()</span>
</pre></table></code></div></div><p>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/01aws/'>01AWS</a>, <a href='/categories/alexa/'>Alexa</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/aws/" class="post-tag no-text-decoration" >AWS</a> <a href="/tags/lab/" class="post-tag no-text-decoration" >Lab</a> <a href="/tags/alexa/" class="post-tag no-text-decoration" >Alexa</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=AWS Alex First Skill - RedVelvet Time - Grace&url=https://ocholuo.github.io//posts/Alexa-1stSkill/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=AWS Alex First Skill - RedVelvet Time - Grace&u=https://ocholuo.github.io//posts/Alexa-1stSkill/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=AWS Alex First Skill - RedVelvet Time - Grace&url=https://ocholuo.github.io//posts/Alexa-1stSkill/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Amazon-CloudFront/">AWS Lab - AWS CloudFront</a><li><a href="/posts/Alexa-1stSkill/">AWS Alex First Skill - RedVelvet Time</a><li><a href="/posts/NetworkProtocol-SSL-TLS-Handshake/">NetworkProtocol SSL/TLS Handshake</a><li><a href="/posts/pythonCrash/">Python Crash</a><li><a href="/posts/%E4%B8%80%E5%8F%A5%E8%AF%9D%E8%A7%A3%E9%87%8AAWS/">AWS - 一句话解释AWS</a><li><a href="/posts/GKE/">GCP - Google Cloud Computing - Kubernetes and Kubernetes Engine</a><li><a href="/posts/Go-Note/">Go Note</a><li><a href="/posts/SCPs/">AWS - IdenAccessManage - SCPs (Service Control Policies)</a><li><a href="/posts/CompanyBenefit/">Company Benefit</a><li><a href="/posts/Encryption-SSL&TLS/">Cryptography - SSL/TLS Encryption</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/cyberattack/">CyberAttack</a> <a class="post-tag" href="/tags/lab/">Lab</a> <a class="post-tag" href="/tags/cyberattacktools/">CyberAttackTools</a> <a class="post-tag" href="/tags/gcp/">GCP</a> <a class="post-tag" href="/tags/sysadmin/">Sysadmin</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/soc/">SOC</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/AlexaBasic/"><div class="card-body"> <span class="timeago small" >Jul 16, 2020<i class="unloaded">2020-07-16T11:11:11-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS Alex</h3><div class="text-muted small"><p> Alexa Basic Alexa Basic Module 1: Why Build Alexa Skills Skill resources Pre-Built Model Alexa workflow Steps to Build a Skill? Requirements to bu...</p></div></div></a></div><div class="card"> <a href="/posts/AWS-Create-simple-microservice-using-Lambda-and-API-Gateway/"><div class="card-body"> <span class="timeago small" >Jul 16, 2020<i class="unloaded">2020-07-16T11:11:11-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS Lab - Create a simple microservice using Lambda and API Gateway</h3><div class="text-muted small"><p> Create a simple microservice using Lambda and API Gateway Create a simple microservice using Lambda and API Gateway overall create an API using Amazon API Gateway o...</p></div></div></a></div><div class="card"> <a href="/posts/AWS-lab/"><div class="card-body"> <span class="timeago small" >Jul 16, 2020<i class="unloaded">2020-07-16T11:11:11-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS Lab</h3><div class="text-muted small"><p> AWS Lab AWS Lab 1. beginning 启动实例 2 连接实例 remote desktop 1.3 终止您的实例 2. begin 2.1 Active directory ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Lab-AWSCloudFormation/" class="btn btn-outline-primary" prompt="Older"><p>AWS Lab - AWS CloudFormation</p></a> <a href="/posts/AlexaBasic/" class="btn btn-outline-primary" prompt="Newer"><p>AWS Alex</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/ocholuo">Grace JyL</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/cyberattack/">CyberAttack</a> <a class="post-tag" href="/tags/lab/">Lab</a> <a class="post-tag" href="/tags/cyberattacktools/">CyberAttackTools</a> <a class="post-tag" href="/tags/gcp/">GCP</a> <a class="post-tag" href="/tags/sysadmin/">Sysadmin</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/soc/">SOC</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://ocholuo.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script async src="https://cdn.jsdelivr.net/npm/countup.js@1.9.3/dist/countUp.min.js"></script> <script defer src="/assets/js/dist/pvreport.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-179830187-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-179830187-1'); }); </script>
